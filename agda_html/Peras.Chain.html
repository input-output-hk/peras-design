<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Peras.Chain</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="Agda.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre class="Agda"><a id="9" class="Keyword">module</a> <a id="16" href="Peras.Chain.html" class="Module">Peras.Chain</a> <a id="28" class="Keyword">where</a>
</pre>
<!--
<pre class="Agda"><a id="52" class="Keyword">open</a> <a id="57" class="Keyword">import</a> <a id="64" href="Data.Bool.html" class="Module">Data.Bool</a> <a id="74" class="Keyword">using</a> <a id="80" class="Symbol">(</a><a id="81" href="Data.Bool.Base.html#995" class="Function Operator">_∧_</a><a id="84" class="Symbol">;</a> <a id="86" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a><a id="90" class="Symbol">;</a> <a id="92" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a><a id="97" class="Symbol">)</a>
<a id="99" class="Keyword">open</a> <a id="104" class="Keyword">import</a> <a id="111" href="Data.List.html" class="Module">Data.List</a> <a id="121" class="Keyword">using</a> <a id="127" class="Symbol">(</a><a id="128" href="Data.List.Base.html#5003" class="Function">sum</a><a id="131" class="Symbol">;</a> <a id="133" href="Data.List.Base.html#6860" class="Function">upTo</a><a id="137" class="Symbol">;</a> <a id="139" href="Data.List.Base.html#6379" class="Function">applyUpTo</a><a id="148" class="Symbol">;</a> <a id="150" href="Data.List.Base.html#11049" class="Function">filterᵇ</a><a id="157" class="Symbol">;</a> <a id="159" href="Data.List.Base.html#10878" class="Function">filter</a><a id="165" class="Symbol">;</a> <a id="167" href="Data.List.Base.html#4538" class="Function">concat</a><a id="173" class="Symbol">;</a> <a id="175" href="Data.List.Base.html#1716" class="Function">mapMaybe</a><a id="183" class="Symbol">;</a> <a id="185" href="Data.List.Base.html#3714" class="Function">zip</a><a id="188" class="Symbol">)</a> <a id="190" class="Keyword">renaming</a> <a id="199" class="Symbol">(</a><a id="200" href="Data.List.Base.html#5083" class="Function">length</a> <a id="207" class="Symbol">to</a> <a id="210" class="Function">∣_∣</a><a id="213" class="Symbol">)</a>
<a id="215" class="Keyword">open</a> <a id="220" class="Keyword">import</a> <a id="227" href="Data.List.Membership.Propositional.html" class="Module">Data.List.Membership.Propositional</a> <a id="262" class="Keyword">using</a> <a id="268" class="Symbol">(</a><a id="269" href="Data.List.Membership.Setoid.html#950" class="Function Operator">_∈_</a><a id="272" class="Symbol">)</a>
<a id="274" class="Keyword">open</a> <a id="279" class="Keyword">import</a> <a id="286" href="Data.List.Relation.Unary.Any.html" class="Module">Data.List.Relation.Unary.Any</a> <a id="315" class="Keyword">using</a> <a id="321" class="Symbol">(</a><a id="322" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a><a id="326" class="Symbol">;</a> <a id="328" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a><a id="331" class="Symbol">;</a> <a id="333" href="Data.List.Relation.Unary.Any.html#1226" class="InductiveConstructor">here</a><a id="337" class="Symbol">;</a> <a id="339" href="Data.List.Relation.Unary.Any.html#1279" class="InductiveConstructor">there</a><a id="344" class="Symbol">;</a> <a id="346" href="Data.List.Relation.Unary.Any.html#1926" class="Function">lookup</a><a id="352" class="Symbol">)</a>
<a id="354" class="Keyword">open</a> <a id="359" class="Keyword">import</a> <a id="366" href="Data.List.Relation.Unary.All.html" class="Module">Data.List.Relation.Unary.All</a> <a id="395" class="Keyword">using</a> <a id="401" class="Symbol">(</a><a id="402" href="Data.List.Relation.Unary.All.html#1627" class="Datatype">All</a><a id="405" class="Symbol">)</a>
<a id="407" class="Keyword">open</a> <a id="412" class="Keyword">import</a> <a id="419" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="430" class="Symbol">as</a> <a id="433" class="Module">M</a> <a id="435" class="Keyword">using</a> <a id="441" class="Symbol">(</a><a id="442" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="449" class="Symbol">;</a> <a id="451" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a><a id="455" class="Symbol">)</a>
<a id="457" class="Keyword">open</a> <a id="462" class="Keyword">import</a> <a id="469" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="478" class="Keyword">using</a> <a id="484" class="Symbol">(</a><a id="485" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="486" class="Symbol">;</a> <a id="488" href="Data.Nat.Base.html#7096" class="Function Operator">_/_</a><a id="491" class="Symbol">;</a> <a id="493" href="Data.Nat.Base.html#2289" class="Function Operator">_&gt;_</a><a id="496" class="Symbol">;</a> <a id="498" href="Data.Nat.Base.html#2259" class="Function Operator">_≥_</a><a id="501" class="Symbol">;</a> <a id="503" href="Data.Nat.Properties.html#6212" class="Function Operator">_≥?_</a><a id="507" class="Symbol">;</a> <a id="509" href="Data.Nat.Properties.html#6146" class="Function Operator">_≤?_</a><a id="513" class="Symbol">;</a> <a id="515" href="Data.Nat.Base.html#3260" class="Record">NonZero</a><a id="522" class="Symbol">;</a> <a id="524" href="Data.Nat.Base.html#5266" class="Function">pred</a><a id="528" class="Symbol">;</a> <a id="530" href="Data.Nat.Base.html#4456" class="Primitive Operator">_∸_</a><a id="533" class="Symbol">;</a> <a id="535" href="Data.Nat.Base.html#1714" class="InductiveConstructor">z≤n</a><a id="538" class="Symbol">;</a> <a id="540" href="Data.Nat.Base.html#1756" class="InductiveConstructor">s≤s</a><a id="543" class="Symbol">)</a>
<a id="545" class="Keyword">open</a> <a id="550" class="Keyword">import</a> <a id="557" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="566" class="Keyword">using</a> <a id="572" class="Symbol">(</a><a id="573" href="Data.Nat.Base.html#1691" class="Datatype Operator">_≤_</a><a id="576" class="Symbol">;</a> <a id="578" href="Data.Nat.Base.html#1801" class="Function Operator">_&lt;_</a><a id="581" class="Symbol">;</a> <a id="583" href="Data.Nat.Base.html#4456" class="Primitive Operator">_∸_</a><a id="586" class="Symbol">)</a>
<a id="588" class="Keyword">open</a> <a id="593" class="Keyword">import</a> <a id="600" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="620" class="Keyword">using</a> <a id="626" class="Symbol">(</a><a id="627" href="Data.Nat.Properties.html#12185" class="Function">n≮n</a><a id="630" class="Symbol">;</a> <a id="632" href="Data.Nat.Properties.html#3311" class="Function Operator">_≟_</a><a id="635" class="Symbol">)</a>
<a id="637" class="Keyword">open</a> <a id="642" class="Keyword">import</a> <a id="649" href="Data.Product.html" class="Module">Data.Product</a> <a id="662" class="Keyword">using</a> <a id="668" class="Symbol">(</a><a id="669" href="Agda.Builtin.Sigma.html#165" class="Record">Σ</a><a id="670" class="Symbol">;</a> <a id="672" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,_</a><a id="675" class="Symbol">;</a> <a id="677" href="Data.Product.Base.html#852" class="Function">∃</a><a id="678" class="Symbol">;</a> <a id="680" href="Data.Product.Base.html#1244" class="Function">Σ-syntax</a><a id="688" class="Symbol">;</a> <a id="690" href="Data.Product.Base.html#1371" class="Function">∃-syntax</a><a id="698" class="Symbol">;</a> <a id="700" href="Data.Product.Base.html#1618" class="Function Operator">_×_</a><a id="703" class="Symbol">;</a> <a id="705" href="Data.Product.Base.html#636" class="Field">proj₁</a><a id="710" class="Symbol">;</a> <a id="712" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="717" class="Symbol">)</a>
<a id="719" class="Keyword">open</a> <a id="724" class="Keyword">import</a> <a id="731" href="Function.Base.html" class="Module">Function.Base</a> <a id="745" class="Keyword">using</a> <a id="751" class="Symbol">(</a><a id="752" href="Function.Base.html#1115" class="Function Operator">_∘_</a><a id="755" class="Symbol">;</a> <a id="757" href="Function.Base.html#1974" class="Function Operator">_$_</a><a id="760" class="Symbol">)</a>
<a id="762" class="Keyword">open</a> <a id="767" class="Keyword">import</a> <a id="774" href="Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="791" class="Keyword">using</a> <a id="797" class="Symbol">(</a><a id="798" href="Relation.Nullary.Negation.Core.html#698" class="Function Operator">¬_</a><a id="800" class="Symbol">;</a> <a id="802" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a><a id="805" class="Symbol">;</a> <a id="807" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a><a id="810" class="Symbol">;</a> <a id="812" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a><a id="814" class="Symbol">;</a> <a id="816" href="Relation.Nullary.Decidable.Core.html#2517" class="Function">¬?</a><a id="818" class="Symbol">)</a>
<a id="820" class="Keyword">open</a> <a id="825" class="Keyword">import</a> <a id="832" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a> <a id="859" class="Keyword">using</a> <a id="865" class="Symbol">(</a><a id="866" href="Relation.Nullary.Decidable.Core.html#2609" class="Function Operator">_×-dec_</a><a id="873" class="Symbol">)</a>
<a id="875" class="Keyword">open</a> <a id="880" class="Keyword">import</a> <a id="887" href="Relation.Binary.html" class="Module">Relation.Binary</a> <a id="903" class="Keyword">using</a> <a id="909" class="Symbol">(</a><a id="910" href="Relation.Binary.Definitions.html#6469" class="Function">DecidableEquality</a><a id="927" class="Symbol">)</a>
<a id="929" class="Keyword">open</a> <a id="934" class="Keyword">import</a> <a id="941" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="979" class="Keyword">using</a> <a id="985" class="Symbol">(</a><a id="986" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">_≢_</a><a id="989" class="Symbol">)</a>

<a id="992" class="Keyword">open</a> <a id="997" class="Keyword">import</a> <a id="1004" href="Peras.Crypto.html" class="Module">Peras.Crypto</a>
<a id="1017" class="Keyword">open</a> <a id="1022" class="Keyword">import</a> <a id="1029" href="Peras.Block.html" class="Module">Peras.Block</a>
<a id="1041" class="Keyword">open</a> <a id="1046" class="Keyword">import</a> <a id="1053" href="Peras.Numbering.html" class="Module">Peras.Numbering</a>
<a id="1069" class="Keyword">open</a> <a id="1074" class="Keyword">import</a> <a id="1081" href="Peras.Params.html" class="Module">Peras.Params</a>

<a id="1095" class="Keyword">open</a> <a id="1100" class="Keyword">import</a> <a id="1107" href="Haskell.Prelude.html" class="Module">Haskell.Prelude</a> <a id="1123" class="Keyword">hiding</a> <a id="1130" class="Symbol">(</a><a id="1131" href="Haskell.Prim.Foldable.html#999" class="Field">length</a><a id="1137" class="Symbol">;</a> <a id="1139" href="Haskell.Prim.Ord.html#1072" class="Field Operator">_&lt;_</a><a id="1142" class="Symbol">;</a> <a id="1144" href="Haskell.Prim.Ord.html#1096" class="Field Operator">_&gt;_</a><a id="1147" class="Symbol">;</a> <a id="1149" href="Haskell.Prim.html#1330" class="Function Operator">_∘_</a><a id="1152" class="Symbol">;</a> <a id="1154" href="Haskell.Prim.Foldable.html#921" class="Field">sum</a><a id="1157" class="Symbol">;</a> <a id="1159" href="Haskell.Prim.html#1193" class="Generalizable">b</a><a id="1160" class="Symbol">;</a> <a id="1162" href="Haskell.Prim.Enum.html#2173" class="Field">pred</a><a id="1166" class="Symbol">;</a> <a id="1168" href="Haskell.Prim.List.html#419" class="Function">filter</a><a id="1174" class="Symbol">;</a> <a id="1176" href="Haskell.Prim.Foldable.html#741" class="Field">concat</a><a id="1182" class="Symbol">;</a> <a id="1184" href="Haskell.Prim.html#1480" class="Function Operator">_$_</a><a id="1187" class="Symbol">;</a> <a id="1189" href="Haskell.Prelude.html#3964" class="Function">lookup</a><a id="1195" class="Symbol">;</a> <a id="1197" href="Haskell.Prim.List.html#1793" class="Function">zip</a><a id="1200" class="Symbol">;</a> <a id="1202" href="Haskell.Prim.html#2804" class="Datatype">All</a><a id="1205" class="Symbol">;</a> <a id="1207" href="Haskell.Prim.html#2981" class="Datatype">Any</a><a id="1210" class="Symbol">;</a> <a id="1212" href="Haskell.Prim.Tuple.html#211" class="InductiveConstructor Operator">_,_</a><a id="1215" class="Symbol">;</a> <a id="1217" href="Haskell.Prim.Tuple.html#169" class="Record Operator">_×_</a><a id="1220" class="Symbol">)</a>
<a id="1222" class="Keyword">open</a> <a id="1227" class="Keyword">import</a> <a id="1234" href="Haskell.Law.Equality.html" class="Module">Haskell.Law.Equality</a> <a id="1255" class="Keyword">using</a> <a id="1261" class="Symbol">(</a><a id="1262" href="Haskell.Law.Equality.html#226" class="Function">cong</a><a id="1266" class="Symbol">)</a>

<a id="1269" class="Symbol">{-#</a> <a id="1273" class="Keyword">FOREIGN</a> <a id="1281" class="Pragma">AGDA2HS</a>
<a id="1289" class="Symbol">{-#</a> <a id="1293" class="Pragma">LANGUAGE</a> <a id="1302" class="Pragma">DeriveGeneric</a> <a id="1316" class="Symbol">#-}</a>
<a id="1320" class="Pragma">import</a> <a id="1327" class="Pragma">GHC.Generics</a> <a id="1340" class="Pragma">(Generic)</a>
<a id="1350" class="Symbol">#-}</a>

<a id="1355" class="Symbol">{-#</a> <a id="1359" class="Keyword">FOREIGN</a> <a id="1367" class="Pragma">GHC</a>
<a id="1371" class="Pragma">import</a> <a id="1378" class="Pragma">qualified</a> <a id="1388" class="Pragma">Peras.Chain</a> <a id="1400" class="Pragma">as</a> <a id="1403" class="Pragma">G</a>
<a id="1405" class="Symbol">#-}</a>
</pre>-->
<h2 id="voting">Voting</h2>
<h3 id="vote">Vote</h3>
<pre class="Agda"><a id="VotingWeight"></a><a id="1447" href="Peras.Chain.html#1447" class="Function">VotingWeight</a> <a id="1460" class="Symbol">=</a> <a id="1462" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>

<a id="1465" class="Keyword">record</a> <a id="Vote"></a><a id="1472" href="Peras.Chain.html#1472" class="Record">Vote</a> <a id="1477" class="Symbol">:</a> <a id="1479" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1483" class="Keyword">where</a>
  <a id="1491" class="Keyword">constructor</a> <a id="MkVote"></a><a id="1503" href="Peras.Chain.html#1503" class="InductiveConstructor">MkVote</a>
  <a id="1512" class="Keyword">field</a> <a id="Vote.votingRound"></a><a id="1518" href="Peras.Chain.html#1518" class="Field">votingRound</a> <a id="1530" class="Symbol">:</a> <a id="1532" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a>
        <a id="Vote.creatorId"></a><a id="1552" href="Peras.Chain.html#1552" class="Field">creatorId</a>   <a id="1564" class="Symbol">:</a> <a id="1566" href="Peras.Block.html#1264" class="Function">PartyId</a>
        <a id="Vote.proofM"></a><a id="1582" href="Peras.Chain.html#1582" class="Field">proofM</a>      <a id="1594" class="Symbol">:</a> <a id="1596" href="Peras.Crypto.html#2161" class="Record">MembershipProof</a>
        <a id="Vote.blockHash"></a><a id="1620" href="Peras.Chain.html#1620" class="Field">blockHash</a>   <a id="1632" class="Symbol">:</a> <a id="1634" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="1639" href="Peras.Block.html#2807" class="Record">Block</a>
        <a id="Vote.signature"></a><a id="1653" href="Peras.Chain.html#1653" class="Field">signature</a>   <a id="1665" class="Symbol">:</a> <a id="1667" href="Peras.Crypto.html#3115" class="Record">Signature</a>

  <a id="Vote.votingRound&#39;"></a><a id="1680" href="Peras.Chain.html#1680" class="Function">votingRound&#39;</a> <a id="1693" class="Symbol">:</a> <a id="1695" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
  <a id="1699" href="Peras.Chain.html#1680" class="Function">votingRound&#39;</a> <a id="1712" class="Symbol">=</a> <a id="1714" href="Peras.Numbering.html#1729" class="Field">getRoundNumber</a> <a id="1729" href="Peras.Chain.html#1518" class="Field">votingRound</a>

<a id="1742" class="Keyword">open</a> <a id="1747" href="Peras.Chain.html#1472" class="Module">Vote</a> <a id="1752" class="Keyword">public</a>

<a id="1760" class="Keyword">instance</a>
  <a id="iVoteEq"></a><a id="1771" href="Peras.Chain.html#1771" class="Function">iVoteEq</a> <a id="1779" class="Symbol">:</a> <a id="1781" href="Haskell.Prim.Eq.html#401" class="Record">Eq</a> <a id="1784" href="Peras.Chain.html#1472" class="Record">Vote</a>
  <a id="1791" href="Peras.Chain.html#1771" class="Function">iVoteEq</a> <a id="1799" class="Symbol">.</a><a id="1800" href="Haskell.Prim.Eq.html#453" class="Field Operator">_==_</a> <a id="1805" href="Peras.Chain.html#1805" class="Bound">x</a> <a id="1807" href="Peras.Chain.html#1807" class="Bound">y</a> <a id="1809" class="Symbol">=</a> <a id="1811" href="Peras.Chain.html#1518" class="Field">votingRound</a> <a id="1823" href="Peras.Chain.html#1805" class="Bound">x</a> <a id="1825" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="1828" href="Peras.Chain.html#1518" class="Field">votingRound</a> <a id="1840" href="Peras.Chain.html#1807" class="Bound">y</a>
                        <a id="1866" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="1869" href="Peras.Chain.html#1552" class="Field">creatorId</a> <a id="1879" href="Peras.Chain.html#1805" class="Bound">x</a> <a id="1881" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="1884" href="Peras.Chain.html#1552" class="Field">creatorId</a> <a id="1894" href="Peras.Chain.html#1807" class="Bound">y</a>
                        <a id="1920" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="1923" href="Peras.Chain.html#1582" class="Field">proofM</a> <a id="1930" href="Peras.Chain.html#1805" class="Bound">x</a> <a id="1932" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="1935" href="Peras.Chain.html#1582" class="Field">proofM</a> <a id="1942" href="Peras.Chain.html#1807" class="Bound">y</a>
                        <a id="1968" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="1971" href="Peras.Chain.html#1620" class="Field">blockHash</a> <a id="1981" href="Peras.Chain.html#1805" class="Bound">x</a> <a id="1983" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="1986" href="Peras.Chain.html#1620" class="Field">blockHash</a> <a id="1996" href="Peras.Chain.html#1807" class="Bound">y</a>
                        <a id="2022" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="2025" href="Peras.Chain.html#1653" class="Field">signature</a> <a id="2035" href="Peras.Chain.html#1805" class="Bound">x</a> <a id="2037" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="2040" href="Peras.Chain.html#1653" class="Field">signature</a> <a id="2050" href="Peras.Chain.html#1807" class="Bound">y</a>
</pre>
<!--
<pre class="Agda"><a id="2070" class="Symbol">{-#</a> <a id="2074" class="Keyword">COMPILE</a> <a id="2082" class="Keyword">AGDA2HS</a> <a id="2090" href="Peras.Chain.html#1447" class="Function">VotingWeight</a> <a id="2103" class="Symbol">#-}</a>
<a id="2107" class="Symbol">{-#</a> <a id="2111" class="Keyword">COMPILE</a> <a id="2119" class="Keyword">AGDA2HS</a> <a id="2127" href="Peras.Chain.html#1472" class="Record">Vote</a> <a id="2132" class="Pragma">deriving</a> <a id="2141" class="Pragma">(Generic)</a> <a id="2151" class="Symbol">#-}</a>
<a id="2155" class="Symbol">{-#</a> <a id="2159" class="Keyword">COMPILE</a> <a id="2167" class="Keyword">GHC</a> <a id="2171" href="Peras.Chain.html#1472" class="Record">Vote</a> <a id="2176" class="Pragma">=</a> <a id="2178" class="Pragma">data</a> <a id="2183" class="Pragma">G.Vote</a> <a id="2190" class="Pragma">(G.MkVote)</a> <a id="2201" class="Symbol">#-}</a>
<a id="2205" class="Symbol">{-#</a> <a id="2209" class="Keyword">COMPILE</a> <a id="2217" class="Keyword">AGDA2HS</a> <a id="2225" href="Peras.Chain.html#1771" class="Function">iVoteEq</a> <a id="2233" class="Symbol">#-}</a>
</pre>-->
<pre class="Agda"><a id="2253" class="Keyword">record</a> <a id="Postulates"></a><a id="2260" href="Peras.Chain.html#2260" class="Record">Postulates</a> <a id="2271" class="Symbol">:</a> <a id="2273" href="Agda.Primitive.html#388" class="Primitive">Set₁</a> <a id="2278" class="Keyword">where</a>
  <a id="2286" class="Keyword">field</a>
    <a id="Postulates.IsSlotLeader"></a><a id="2296" href="Peras.Chain.html#2296" class="Field">IsSlotLeader</a> <a id="2309" class="Symbol">:</a> <a id="2311" href="Peras.Block.html#1264" class="Function">PartyId</a> <a id="2319" class="Symbol">→</a> <a id="2321" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="2332" class="Symbol">→</a> <a id="2334" href="Peras.Crypto.html#2593" class="Record">LeadershipProof</a> <a id="2350" class="Symbol">→</a> <a id="2352" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="Postulates.IsCommitteeMember"></a><a id="2360" href="Peras.Chain.html#2360" class="Field">IsCommitteeMember</a> <a id="2378" class="Symbol">:</a> <a id="2380" href="Peras.Block.html#1264" class="Function">PartyId</a> <a id="2388" class="Symbol">→</a> <a id="2390" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="2402" class="Symbol">→</a> <a id="2404" href="Peras.Crypto.html#2161" class="Record">MembershipProof</a> <a id="2420" class="Symbol">→</a> <a id="2422" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="Postulates.IsBlockSignature"></a><a id="2430" href="Peras.Chain.html#2430" class="Field">IsBlockSignature</a> <a id="2447" class="Symbol">:</a> <a id="2449" href="Peras.Block.html#2807" class="Record">Block</a> <a id="2455" class="Symbol">→</a> <a id="2457" href="Peras.Crypto.html#3115" class="Record">Signature</a> <a id="2467" class="Symbol">→</a> <a id="2469" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="Postulates.IsVoteSignature"></a><a id="2477" href="Peras.Chain.html#2477" class="Field">IsVoteSignature</a> <a id="2493" class="Symbol">:</a> <a id="2495" href="Peras.Chain.html#1472" class="Record">Vote</a> <a id="2500" class="Symbol">→</a> <a id="2502" href="Peras.Crypto.html#3115" class="Record">Signature</a> <a id="2512" class="Symbol">→</a> <a id="2514" href="Agda.Primitive.html#388" class="Primitive">Set</a>

<a id="2519" class="Keyword">record</a> <a id="Network"></a><a id="2526" href="Peras.Chain.html#2526" class="Record">Network</a> <a id="2534" class="Symbol">:</a> <a id="2536" href="Agda.Primitive.html#388" class="Primitive">Set₁</a> <a id="2541" class="Keyword">where</a>
  <a id="2549" class="Keyword">field</a>
    <a id="Network.Δ"></a><a id="2559" href="Peras.Chain.html#2559" class="Field">Δ</a> <a id="2561" class="Symbol">:</a> <a id="2563" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
</pre>
<pre class="Agda"><a id="2577" class="Keyword">module</a> <a id="2584" href="Peras.Chain.html#2584" class="Module">_</a> <a id="2586" class="Symbol">⦃</a> <a id="2588" href="Peras.Chain.html#2588" class="Bound">_</a> <a id="2590" class="Symbol">:</a> <a id="2592" href="Peras.Chain.html#2260" class="Record">Postulates</a> <a id="2603" class="Symbol">⦄</a>
         <a id="2614" class="Keyword">where</a>

  <a id="2623" class="Keyword">open</a> <a id="2628" href="Peras.Chain.html#2260" class="Module">Postulates</a> <a id="2639" class="Symbol">⦃...⦄</a>

  <a id="2648" href="Peras.Chain.html#2648" class="Function">ValidVote</a> <a id="2658" class="Symbol">:</a> <a id="2660" href="Peras.Chain.html#1472" class="Record">Vote</a> <a id="2665" class="Symbol">→</a> <a id="2667" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="2673" href="Peras.Chain.html#2648" class="Function">ValidVote</a> <a id="2683" href="Peras.Chain.html#2683" class="Bound">v</a> <a id="2685" class="Symbol">=</a>
    <a id="2691" href="Peras.Chain.html#2360" class="Field">IsCommitteeMember</a>
        <a id="2717" class="Symbol">(</a><a id="2718" href="Peras.Chain.html#1552" class="Field">creatorId</a> <a id="2728" href="Peras.Chain.html#2683" class="Bound">v</a><a id="2729" class="Symbol">)</a>
        <a id="2739" class="Symbol">(</a><a id="2740" href="Peras.Chain.html#1518" class="Field">votingRound</a> <a id="2752" href="Peras.Chain.html#2683" class="Bound">v</a><a id="2753" class="Symbol">)</a>
        <a id="2763" class="Symbol">(</a><a id="2764" href="Peras.Chain.html#1582" class="Field">proofM</a> <a id="2771" href="Peras.Chain.html#2683" class="Bound">v</a><a id="2772" class="Symbol">)</a>
    <a id="2778" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="2780" href="Peras.Chain.html#2477" class="Field">IsVoteSignature</a> <a id="2796" href="Peras.Chain.html#2683" class="Bound">v</a> <a id="2798" class="Symbol">(</a><a id="2799" href="Peras.Chain.html#1653" class="Field">signature</a> <a id="2809" href="Peras.Chain.html#2683" class="Bound">v</a><a id="2810" class="Symbol">)</a>
</pre>
<h3 id="equivocation-relation">Equivocation relation</h3>
<p>Equivocal votes are multiple votes by the same party for the same
round.</p>
<pre class="Agda"><a id="2926" class="Keyword">data</a> <a id="_∻_"></a><a id="2931" href="Peras.Chain.html#2931" class="Datatype Operator">_∻_</a> <a id="2935" class="Symbol">:</a> <a id="2937" href="Peras.Chain.html#1472" class="Record">Vote</a> <a id="2942" class="Symbol">→</a> <a id="2944" href="Peras.Chain.html#1472" class="Record">Vote</a> <a id="2949" class="Symbol">→</a> <a id="2951" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="2955" class="Keyword">where</a>

  <a id="_∻_.Equivocation"></a><a id="2964" href="Peras.Chain.html#2964" class="InductiveConstructor">Equivocation</a> <a id="2977" class="Symbol">:</a> <a id="2979" class="Symbol">∀</a> <a id="2981" class="Symbol">{</a><a id="2982" href="Peras.Chain.html#2982" class="Bound">v₁</a> <a id="2985" href="Peras.Chain.html#2985" class="Bound">v₂</a><a id="2987" class="Symbol">}</a>
    <a id="2993" class="Symbol">→</a> <a id="2995" href="Peras.Chain.html#1552" class="Field">creatorId</a> <a id="3005" href="Peras.Chain.html#2982" class="Bound">v₁</a> <a id="3008" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3010" href="Peras.Chain.html#1552" class="Field">creatorId</a> <a id="3020" href="Peras.Chain.html#2985" class="Bound">v₂</a>
    <a id="3027" class="Symbol">→</a> <a id="3029" href="Peras.Chain.html#1518" class="Field">votingRound</a> <a id="3041" href="Peras.Chain.html#2982" class="Bound">v₁</a> <a id="3044" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3046" href="Peras.Chain.html#1518" class="Field">votingRound</a> <a id="3058" href="Peras.Chain.html#2985" class="Bound">v₂</a>
    <a id="3065" class="Symbol">→</a> <a id="3067" href="Peras.Chain.html#2982" class="Bound">v₁</a> <a id="3070" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="3072" href="Peras.Chain.html#2985" class="Bound">v₂</a>
    <a id="3079" class="Symbol">→</a> <a id="3081" href="Peras.Chain.html#2982" class="Bound">v₁</a> <a id="3084" href="Peras.Chain.html#2931" class="Datatype Operator">∻</a> <a id="3086" href="Peras.Chain.html#2985" class="Bound">v₂</a>
</pre>
<h2 id="chain">Chain</h2>
<pre class="Agda"><a id="Chain"></a><a id="3111" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="3117" class="Symbol">=</a> <a id="3119" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3124" href="Peras.Block.html#2807" class="Record">Block</a>
</pre>
<!--
<pre class="Agda"><a id="3147" class="Symbol">{-#</a> <a id="3151" class="Keyword">COMPILE</a> <a id="3159" class="Keyword">AGDA2HS</a> <a id="3167" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="3173" class="Symbol">#-}</a>
</pre>-->
<pre class="Agda"><a id="certsFromChain"></a><a id="3194" href="Peras.Chain.html#3194" class="Function">certsFromChain</a> <a id="3209" class="Symbol">:</a> <a id="3211" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="3217" class="Symbol">→</a> <a id="3219" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3224" href="Peras.Block.html#2849" class="Record">Certificate</a>
<a id="3236" href="Peras.Chain.html#3194" class="Function">certsFromChain</a> <a id="3251" class="Symbol">=</a> <a id="3253" href="Data.List.Base.html#1716" class="Function">mapMaybe</a> <a id="3262" href="Peras.Block.html#3326" class="Field">certificate</a>
</pre>
<pre class="Agda"><a id="insertCert"></a><a id="3286" href="Peras.Chain.html#3286" class="Function">insertCert</a> <a id="3297" class="Symbol">:</a> <a id="3299" href="Peras.Block.html#2849" class="Record">Certificate</a> <a id="3311" class="Symbol">→</a> <a id="3313" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3318" href="Peras.Block.html#2849" class="Record">Certificate</a> <a id="3330" class="Symbol">→</a> <a id="3332" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3337" href="Peras.Block.html#2849" class="Record">Certificate</a>
<a id="3349" href="Peras.Chain.html#3286" class="Function">insertCert</a> <a id="3360" href="Peras.Chain.html#3360" class="Bound">cert</a> <a id="3365" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="3368" class="Symbol">=</a> <a id="3370" href="Peras.Chain.html#3360" class="Bound">cert</a> <a id="3375" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3377" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
<a id="3380" href="Peras.Chain.html#3286" class="Function">insertCert</a> <a id="3391" href="Peras.Chain.html#3391" class="Bound">cert</a> <a id="3396" class="Symbol">(</a><a id="3397" href="Peras.Chain.html#3397" class="Bound">cert&#39;</a> <a id="3403" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3405" href="Peras.Chain.html#3405" class="Bound">certs</a><a id="3410" class="Symbol">)</a> <a id="3412" class="Symbol">=</a>
  <a id="3416" href="Haskell.Prim.html#1713" class="Function Operator">if</a> <a id="3419" href="Peras.Chain.html#3391" class="Bound">cert</a> <a id="3424" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="3427" href="Peras.Chain.html#3397" class="Bound">cert&#39;</a>
  <a id="3435" href="Haskell.Prim.html#1713" class="Function Operator">then</a> <a id="3440" href="Peras.Chain.html#3397" class="Bound">cert&#39;</a> <a id="3446" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3448" href="Peras.Chain.html#3405" class="Bound">certs</a>
  <a id="3456" href="Haskell.Prim.html#1713" class="Function Operator">else</a> <a id="3461" href="Peras.Chain.html#3397" class="Bound">cert&#39;</a> <a id="3467" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3469" href="Peras.Chain.html#3286" class="Function">insertCert</a> <a id="3480" href="Peras.Chain.html#3391" class="Bound">cert</a> <a id="3485" href="Peras.Chain.html#3405" class="Bound">certs</a>

<a id="3492" class="Symbol">{-#</a> <a id="3496" class="Keyword">COMPILE</a> <a id="3504" class="Keyword">AGDA2HS</a> <a id="3512" href="Peras.Chain.html#3286" class="Function">insertCert</a> <a id="3523" class="Symbol">#-}</a>
</pre>
<h3 id="chain-prefix">Chain prefix</h3>
<pre class="Agda"><a id="3557" class="Keyword">data</a> <a id="_⪯_"></a><a id="3562" href="Peras.Chain.html#3562" class="Datatype Operator">_⪯_</a> <a id="3566" class="Symbol">:</a> <a id="3568" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="3574" class="Symbol">→</a> <a id="3576" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="3582" class="Symbol">→</a> <a id="3584" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="3588" class="Keyword">where</a>

  <a id="_⪯_.Prefix"></a><a id="3597" href="Peras.Chain.html#3597" class="InductiveConstructor">Prefix</a> <a id="3604" class="Symbol">:</a> <a id="3606" class="Symbol">∀</a> <a id="3608" class="Symbol">{</a><a id="3609" href="Peras.Chain.html#3609" class="Bound">c₁</a> <a id="3612" href="Peras.Chain.html#3612" class="Bound">c₂</a> <a id="3615" href="Peras.Chain.html#3615" class="Bound">c₃</a> <a id="3618" class="Symbol">:</a> <a id="3620" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="3625" class="Symbol">}</a>
    <a id="3631" class="Symbol">→</a> <a id="3633" href="Peras.Chain.html#3609" class="Bound">c₁</a> <a id="3636" href="Haskell.Prim.List.html#310" class="Function Operator">++</a> <a id="3639" href="Peras.Chain.html#3615" class="Bound">c₃</a> <a id="3642" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3644" href="Peras.Chain.html#3612" class="Bound">c₂</a>
    <a id="3651" class="Symbol">→</a> <a id="3653" href="Peras.Chain.html#3609" class="Bound">c₁</a> <a id="3656" href="Peras.Chain.html#3562" class="Datatype Operator">⪯</a> <a id="3658" href="Peras.Chain.html#3612" class="Bound">c₂</a>
</pre>
<h3 id="chain-pruning">Chain pruning</h3>
<pre class="Agda"><a id="prune"></a><a id="3693" href="Peras.Chain.html#3693" class="Function">prune</a> <a id="3699" class="Symbol">:</a> <a id="3701" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="3712" class="Symbol">→</a> <a id="3714" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="3720" class="Symbol">→</a> <a id="3722" href="Peras.Chain.html#3111" class="Function">Chain</a>
<a id="3728" href="Peras.Chain.html#3693" class="Function">prune</a> <a id="3734" class="Symbol">(</a><a id="3735" href="Peras.Numbering.html#779" class="InductiveConstructor">MkSlotNumber</a> <a id="3748" href="Peras.Chain.html#3748" class="Bound">sl</a><a id="3750" class="Symbol">)</a> <a id="3752" class="Symbol">=</a> <a id="3754" href="Data.List.Base.html#10878" class="Function">filter</a> <a id="3761" class="Symbol">((</a><a id="3763" href="Data.Nat.Properties.html#6146" class="Function Operator">_≤?</a> <a id="3767" href="Peras.Chain.html#3748" class="Bound">sl</a><a id="3769" class="Symbol">)</a> <a id="3771" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3773" href="Peras.Block.html#3465" class="Function">slotNumber&#39;</a><a id="3784" class="Symbol">)</a>
</pre>
<h3 id="chain-weight">Chain weight</h3>
The weight of a chain is defined with respect of the Peras parameters
<pre class="Agda"><a id="3886" class="Keyword">open</a> <a id="3891" href="Peras.Params.html#166" class="Module">Params</a> <a id="3898" class="Symbol">⦃...⦄</a>
</pre>
<pre class="Agda"><a id="3917" class="Keyword">module</a> <a id="3924" href="Peras.Chain.html#3924" class="Module">_</a> <a id="3926" class="Symbol">⦃</a> <a id="3928" href="Peras.Chain.html#3928" class="Bound">_</a> <a id="3930" class="Symbol">:</a> <a id="3932" href="Peras.Crypto.html#1994" class="Record">Hashable</a> <a id="3941" href="Peras.Block.html#2807" class="Record">Block</a> <a id="3947" class="Symbol">⦄</a>
         <a id="3958" class="Keyword">where</a>

  <a id="3967" class="Keyword">open</a> <a id="3972" href="Peras.Crypto.html#1994" class="Module">Hashable</a> <a id="3981" class="Symbol">⦃...⦄</a>

  <a id="3990" href="Peras.Chain.html#3990" class="Function">ChainExtends</a> <a id="4003" class="Symbol">:</a> <a id="4005" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="4010" href="Peras.Block.html#2807" class="Record">Block</a> <a id="4016" class="Symbol">→</a> <a id="4018" href="Peras.Block.html#2849" class="Record">Certificate</a> <a id="4030" class="Symbol">→</a> <a id="4032" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="4038" class="Symbol">→</a> <a id="4040" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="4046" href="Peras.Chain.html#3990" class="Function">ChainExtends</a> <a id="4059" href="Peras.Chain.html#4059" class="Bound">h</a> <a id="4061" href="Peras.Chain.html#4061" class="Bound">c</a> <a id="4063" class="Symbol">=</a>
    <a id="4069" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="4073" class="Symbol">(λ</a> <a id="4076" href="Peras.Chain.html#4076" class="Bound">block</a> <a id="4082" class="Symbol">→</a> <a id="4084" class="Symbol">(</a><a id="4085" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="4090" href="Peras.Chain.html#4076" class="Bound">block</a> <a id="4096" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="4098" href="Peras.Block.html#2976" class="Field">blockRef</a> <a id="4107" href="Peras.Chain.html#4061" class="Bound">c</a><a id="4108" class="Symbol">))</a>
      <a id="4117" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4119" href="Data.List.Base.html#10622" class="Function">Data.List.dropWhile</a> <a id="4139" class="Symbol">(λ</a> <a id="4142" href="Peras.Chain.html#4142" class="Bound">block&#39;</a> <a id="4149" class="Symbol">→</a> <a id="4151" href="Relation.Nullary.Decidable.Core.html#2517" class="Function">¬?</a> <a id="4154" class="Symbol">(</a><a id="4155" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="4160" href="Peras.Chain.html#4142" class="Bound">block&#39;</a> <a id="4167" href="Peras.Block.html#3542" class="Function Operator">≟-BlockHash</a> <a id="4179" href="Peras.Chain.html#4059" class="Bound">h</a><a id="4180" class="Symbol">))</a>

  <a id="4186" href="Peras.Chain.html#4186" class="Function">ChainExtends?</a> <a id="4200" class="Symbol">:</a> <a id="4202" class="Symbol">(</a><a id="4203" href="Peras.Chain.html#4203" class="Bound">h</a> <a id="4205" class="Symbol">:</a> <a id="4207" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="4212" href="Peras.Block.html#2807" class="Record">Block</a><a id="4217" class="Symbol">)</a> <a id="4219" class="Symbol">→</a> <a id="4221" class="Symbol">(</a><a id="4222" href="Peras.Chain.html#4222" class="Bound">c</a> <a id="4224" class="Symbol">:</a> <a id="4226" href="Peras.Block.html#2849" class="Record">Certificate</a><a id="4237" class="Symbol">)</a> <a id="4239" class="Symbol">→</a> <a id="4241" class="Symbol">(</a><a id="4242" href="Peras.Chain.html#4242" class="Bound">chain</a> <a id="4248" class="Symbol">:</a> <a id="4250" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="4255" class="Symbol">)</a> <a id="4257" class="Symbol">→</a> <a id="4259" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="4263" class="Symbol">(</a><a id="4264" href="Peras.Chain.html#3990" class="Function">ChainExtends</a> <a id="4277" href="Peras.Chain.html#4203" class="Bound">h</a> <a id="4279" href="Peras.Chain.html#4222" class="Bound">c</a> <a id="4281" href="Peras.Chain.html#4242" class="Bound">chain</a><a id="4286" class="Symbol">)</a>
  <a id="4290" href="Peras.Chain.html#4186" class="Function">ChainExtends?</a> <a id="4304" href="Peras.Chain.html#4304" class="Bound">h</a> <a id="4306" href="Peras.Chain.html#4306" class="Bound">c</a> <a id="4308" class="Symbol">=</a>
    <a id="4314" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a> <a id="4319" class="Symbol">(λ</a> <a id="4322" href="Peras.Chain.html#4322" class="Bound">block</a> <a id="4328" class="Symbol">→</a> <a id="4330" class="Symbol">(</a><a id="4331" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="4336" href="Peras.Chain.html#4322" class="Bound">block</a> <a id="4342" href="Peras.Block.html#3542" class="Function Operator">≟-BlockHash</a> <a id="4354" href="Peras.Block.html#2976" class="Field">blockRef</a> <a id="4363" href="Peras.Chain.html#4306" class="Bound">c</a><a id="4364" class="Symbol">))</a>
      <a id="4373" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4375" href="Data.List.Base.html#10622" class="Function">Data.List.dropWhile</a> <a id="4395" class="Symbol">(λ</a> <a id="4398" href="Peras.Chain.html#4398" class="Bound">block&#39;</a> <a id="4405" class="Symbol">→</a> <a id="4407" href="Relation.Nullary.Decidable.Core.html#2517" class="Function">¬?</a> <a id="4410" class="Symbol">(</a><a id="4411" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="4416" href="Peras.Chain.html#4398" class="Bound">block&#39;</a> <a id="4423" href="Peras.Block.html#3542" class="Function Operator">≟-BlockHash</a> <a id="4435" href="Peras.Chain.html#4304" class="Bound">h</a><a id="4436" class="Symbol">))</a>

  <a id="4442" href="Peras.Chain.html#4442" class="Function">Extends</a> <a id="4450" class="Symbol">:</a> <a id="4452" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="4457" href="Peras.Block.html#2807" class="Record">Block</a> <a id="4463" class="Symbol">→</a> <a id="4465" href="Peras.Block.html#2849" class="Record">Certificate</a> <a id="4477" class="Symbol">→</a> <a id="4479" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4484" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="4490" class="Symbol">→</a> <a id="4492" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="4498" href="Peras.Chain.html#4442" class="Function">Extends</a> <a id="4506" href="Peras.Chain.html#4506" class="Bound">h</a> <a id="4508" href="Peras.Chain.html#4508" class="Bound">c</a> <a id="4510" class="Symbol">=</a> <a id="4512" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="4516" class="Symbol">(</a><a id="4517" href="Peras.Chain.html#3990" class="Function">ChainExtends</a> <a id="4530" href="Peras.Chain.html#4506" class="Bound">h</a> <a id="4532" href="Peras.Chain.html#4508" class="Bound">c</a><a id="4533" class="Symbol">)</a>

  <a id="4538" href="Peras.Chain.html#4538" class="Function">Extends?</a> <a id="4547" class="Symbol">:</a> <a id="4549" class="Symbol">(</a><a id="4550" href="Peras.Chain.html#4550" class="Bound">h</a> <a id="4552" class="Symbol">:</a> <a id="4554" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="4559" href="Peras.Block.html#2807" class="Record">Block</a><a id="4564" class="Symbol">)</a> <a id="4566" class="Symbol">→</a> <a id="4568" class="Symbol">(</a><a id="4569" href="Peras.Chain.html#4569" class="Bound">c</a> <a id="4571" class="Symbol">:</a> <a id="4573" href="Peras.Block.html#2849" class="Record">Certificate</a><a id="4584" class="Symbol">)</a> <a id="4586" class="Symbol">→</a> <a id="4588" class="Symbol">(</a><a id="4589" href="Peras.Chain.html#4589" class="Bound">chains</a> <a id="4596" class="Symbol">:</a> <a id="4598" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4603" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="4608" class="Symbol">)</a> <a id="4610" class="Symbol">→</a> <a id="4612" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="4616" class="Symbol">(</a><a id="4617" href="Peras.Chain.html#4442" class="Function">Extends</a> <a id="4625" href="Peras.Chain.html#4550" class="Bound">h</a> <a id="4627" href="Peras.Chain.html#4569" class="Bound">c</a> <a id="4629" href="Peras.Chain.html#4589" class="Bound">chains</a><a id="4635" class="Symbol">)</a>
  <a id="4639" href="Peras.Chain.html#4538" class="Function">Extends?</a> <a id="4648" href="Peras.Chain.html#4648" class="Bound">h</a> <a id="4650" href="Peras.Chain.html#4650" class="Bound">c</a> <a id="4652" class="Symbol">=</a> <a id="4654" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a> <a id="4659" class="Symbol">(</a><a id="4660" href="Peras.Chain.html#4186" class="Function">ChainExtends?</a> <a id="4674" href="Peras.Chain.html#4648" class="Bound">h</a> <a id="4676" href="Peras.Chain.html#4650" class="Bound">c</a><a id="4677" class="Symbol">)</a>
</pre>
<pre class="Agda">  <a id="4694" href="Peras.Chain.html#4694" class="Function">tipHash</a> <a id="4702" class="Symbol">:</a> <a id="4704" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="4710" class="Symbol">→</a> <a id="4712" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="4717" href="Peras.Block.html#2807" class="Record">Block</a>
  <a id="4725" href="Peras.Chain.html#4694" class="Function">tipHash</a> <a id="4733" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="4736" class="Symbol">=</a> <a id="4738" class="Keyword">record</a> <a id="4745" class="Symbol">{</a> <a id="4747" href="Peras.Crypto.html#1598" class="Field">hashBytes</a> <a id="4757" class="Symbol">=</a> <a id="4759" href="Peras.Crypto.html#676" class="Postulate">emptyBS</a> <a id="4767" class="Symbol">}</a>
  <a id="4771" href="Peras.Chain.html#4694" class="Function">tipHash</a> <a id="4779" class="Symbol">(</a><a id="4780" href="Peras.Chain.html#4780" class="Bound">b</a> <a id="4782" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="4784" class="Symbol">_)</a> <a id="4787" class="Symbol">=</a> <a id="4789" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="4794" href="Peras.Chain.html#4780" class="Bound">b</a>
</pre>
The weight of a chain is computed wrt to a set of dangling votes
<pre class="Agda"><a id="4874" class="Keyword">module</a> <a id="4881" href="Peras.Chain.html#4881" class="Module">_</a> <a id="4883" class="Symbol">⦃</a> <a id="4885" href="Peras.Chain.html#4885" class="Bound">_</a> <a id="4887" class="Symbol">:</a> <a id="4889" href="Peras.Crypto.html#1994" class="Record">Hashable</a> <a id="4898" href="Peras.Block.html#2807" class="Record">Block</a> <a id="4904" class="Symbol">⦄</a>
         <a id="4915" class="Symbol">⦃</a> <a id="4917" href="Peras.Chain.html#4917" class="Bound">_</a> <a id="4919" class="Symbol">:</a> <a id="4921" href="Peras.Params.html#166" class="Record">Params</a> <a id="4928" class="Symbol">⦄</a>
         <a id="4939" class="Keyword">where</a>
</pre>
<pre class="Agda">  <a id="4959" class="Keyword">open</a> <a id="4964" href="Peras.Crypto.html#1994" class="Module">Hashable</a> <a id="4973" class="Symbol">⦃...⦄</a>
</pre>
<pre class="Agda">  <a id="4993" href="Peras.Chain.html#4993" class="Function Operator">_PointsInto_</a> <a id="5006" class="Symbol">:</a> <a id="5008" href="Peras.Block.html#2849" class="Record">Certificate</a> <a id="5020" class="Symbol">→</a> <a id="5022" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="5028" class="Symbol">→</a> <a id="5030" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="5036" href="Peras.Chain.html#4993" class="Function Operator">_PointsInto_</a> <a id="5049" href="Peras.Chain.html#5049" class="Bound">c</a> <a id="5051" class="Symbol">=</a> <a id="5053" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="5057" class="Symbol">((</a><a id="5059" href="Peras.Block.html#2976" class="Field">blockRef</a> <a id="5068" href="Peras.Chain.html#5049" class="Bound">c</a> <a id="5070" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡_</a><a id="5072" class="Symbol">)</a> <a id="5074" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="5076" href="Peras.Crypto.html#2033" class="Field">hash</a><a id="5080" class="Symbol">)</a>
</pre>
<pre class="Agda">  <a id="5096" href="Peras.Chain.html#5096" class="Function Operator">_PointsInto?_</a> <a id="5110" class="Symbol">:</a> <a id="5112" class="Symbol">∀</a> <a id="5114" class="Symbol">(</a><a id="5115" href="Peras.Chain.html#5115" class="Bound">c</a> <a id="5117" class="Symbol">:</a> <a id="5119" href="Peras.Block.html#2849" class="Record">Certificate</a><a id="5130" class="Symbol">)</a> <a id="5132" class="Symbol">→</a> <a id="5134" class="Symbol">(</a><a id="5135" href="Peras.Chain.html#5135" class="Bound">ch</a> <a id="5138" class="Symbol">:</a> <a id="5140" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="5145" class="Symbol">)</a> <a id="5147" class="Symbol">→</a> <a id="5149" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="5153" class="Symbol">(</a><a id="5154" href="Peras.Chain.html#5115" class="Bound">c</a> <a id="5156" href="Peras.Chain.html#4993" class="Function Operator">PointsInto</a> <a id="5167" href="Peras.Chain.html#5135" class="Bound">ch</a><a id="5169" class="Symbol">)</a>
  <a id="5173" href="Peras.Chain.html#5096" class="Function Operator">_PointsInto?_</a> <a id="5187" href="Peras.Chain.html#5187" class="Bound">c</a> <a id="5189" class="Symbol">=</a> <a id="5191" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a> <a id="5196" class="Symbol">((</a><a id="5198" href="Peras.Block.html#2976" class="Field">blockRef</a> <a id="5207" href="Peras.Chain.html#5187" class="Bound">c</a> <a id="5209" href="Peras.Block.html#3542" class="Function Operator">≟-BlockHash_</a><a id="5221" class="Symbol">)</a> <a id="5223" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="5225" href="Peras.Crypto.html#2033" class="Field">hash</a><a id="5229" class="Symbol">)</a>
</pre>
<pre class="Agda">  <a id="5245" href="Peras.Chain.html#5245" class="Function">StartOfRound</a> <a id="5258" class="Symbol">:</a> <a id="5260" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="5271" class="Symbol">→</a> <a id="5273" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="5285" class="Symbol">→</a> <a id="5287" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="5293" href="Peras.Chain.html#5245" class="Function">StartOfRound</a> <a id="5306" class="Symbol">(</a><a id="5307" href="Peras.Numbering.html#779" class="InductiveConstructor">MkSlotNumber</a> <a id="5320" href="Peras.Chain.html#5320" class="Bound">sl</a><a id="5322" class="Symbol">)</a> <a id="5324" class="Symbol">(</a><a id="5325" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="5339" href="Peras.Chain.html#5339" class="Bound">r</a><a id="5340" class="Symbol">)</a> <a id="5342" class="Symbol">=</a> <a id="5344" href="Peras.Chain.html#5320" class="Bound">sl</a> <a id="5347" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5349" href="Peras.Chain.html#5339" class="Bound">r</a> <a id="5351" href="Haskell.Prim.Num.html#632" class="Field Operator">*</a> <a id="5353" href="Peras.Params.html#193" class="Field">U</a>
</pre>
<pre class="Agda">  <a id="5369" href="Peras.Chain.html#5369" class="Function">StartOfRound?</a> <a id="5383" class="Symbol">:</a> <a id="5385" class="Symbol">(</a><a id="5386" href="Peras.Chain.html#5386" class="Bound">sl</a> <a id="5389" class="Symbol">:</a> <a id="5391" href="Peras.Numbering.html#742" class="Record">SlotNumber</a><a id="5401" class="Symbol">)</a> <a id="5403" class="Symbol">→</a> <a id="5405" class="Symbol">(</a><a id="5406" href="Peras.Chain.html#5406" class="Bound">r</a> <a id="5408" class="Symbol">:</a> <a id="5410" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a><a id="5421" class="Symbol">)</a> <a id="5423" class="Symbol">→</a> <a id="5425" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="5429" class="Symbol">(</a><a id="5430" href="Peras.Chain.html#5245" class="Function">StartOfRound</a> <a id="5443" href="Peras.Chain.html#5386" class="Bound">sl</a> <a id="5446" href="Peras.Chain.html#5406" class="Bound">r</a><a id="5447" class="Symbol">)</a>
  <a id="5451" href="Peras.Chain.html#5369" class="Function">StartOfRound?</a> <a id="5465" class="Symbol">(</a><a id="5466" href="Peras.Numbering.html#779" class="InductiveConstructor">MkSlotNumber</a> <a id="5479" href="Peras.Chain.html#5479" class="Bound">sl</a><a id="5481" class="Symbol">)</a> <a id="5483" class="Symbol">(</a><a id="5484" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="5498" href="Peras.Chain.html#5498" class="Bound">r</a><a id="5499" class="Symbol">)</a> <a id="5501" class="Symbol">=</a> <a id="5503" href="Peras.Chain.html#5479" class="Bound">sl</a> <a id="5506" href="Data.Nat.Properties.html#3311" class="Function Operator">≟</a> <a id="5508" href="Peras.Chain.html#5498" class="Bound">r</a> <a id="5510" href="Haskell.Prim.Num.html#632" class="Field Operator">*</a> <a id="5512" href="Peras.Params.html#193" class="Field">U</a>
</pre>
<pre class="Agda">  <a id="5528" href="Peras.Chain.html#5528" class="Function">rnd</a> <a id="5532" class="Symbol">:</a> <a id="5534" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="5536" class="Symbol">→</a> <a id="5538" class="Symbol">⦃</a> <a id="5540" href="Peras.Chain.html#5540" class="Symbol">_</a> <a id="5542" class="Symbol">:</a> <a id="5544" href="Data.Nat.Base.html#3260" class="Record">NonZero</a> <a id="5552" href="Peras.Params.html#193" class="Field">U</a> <a id="5554" class="Symbol">⦄</a> <a id="5556" class="Symbol">→</a> <a id="5558" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
  <a id="5562" href="Peras.Chain.html#5528" class="Function">rnd</a> <a id="5566" href="Peras.Chain.html#5566" class="Bound">s</a> <a id="5568" class="Symbol">=</a> <a id="5570" href="Peras.Chain.html#5566" class="Bound">s</a> <a id="5572" href="Data.Nat.Base.html#7096" class="Function Operator">/</a> <a id="5574" href="Peras.Params.html#193" class="Field">U</a>
</pre>
<pre class="Agda">  <a id="5590" href="Peras.Chain.html#5590" class="Function">v-round</a> <a id="5598" class="Symbol">:</a> <a id="5600" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="5611" class="Symbol">→</a> <a id="5613" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a>
  <a id="5627" href="Peras.Chain.html#5590" class="Function">v-round</a> <a id="5635" class="Symbol">(</a><a id="5636" href="Peras.Numbering.html#779" class="InductiveConstructor">MkSlotNumber</a> <a id="5649" href="Peras.Chain.html#5649" class="Bound">s</a><a id="5650" class="Symbol">)</a> <a id="5652" class="Symbol">=</a> <a id="5654" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="5668" class="Symbol">(</a><a id="5669" href="Peras.Chain.html#5528" class="Function">rnd</a> <a id="5673" href="Peras.Chain.html#5649" class="Bound">s</a><a id="5674" class="Symbol">)</a>
</pre>
<h3 id="chain-weight-1">Chain weight</h3>
<pre class="Agda">  <a id="5708" href="Peras.Chain.html#5708" class="Function Operator">∥_∥_</a> <a id="5713" class="Symbol">:</a> <a id="5715" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="5721" class="Symbol">→</a> <a id="5723" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5728" href="Peras.Block.html#2849" class="Record">Certificate</a> <a id="5740" class="Symbol">→</a> <a id="5742" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
  <a id="5746" href="Peras.Chain.html#5708" class="Function Operator">∥</a> <a id="5748" href="Peras.Chain.html#5748" class="Bound">ch</a> <a id="5751" href="Peras.Chain.html#5708" class="Function Operator">∥</a> <a id="5753" href="Peras.Chain.html#5753" class="Bound">cts</a> <a id="5757" class="Symbol">=</a> <a id="5759" href="Peras.Chain.html#210" class="Function Operator">∣</a> <a id="5761" href="Peras.Chain.html#5748" class="Bound">ch</a> <a id="5764" href="Peras.Chain.html#210" class="Function Operator">∣</a> <a id="5766" href="Haskell.Prim.Num.html#547" class="Field Operator">+</a> <a id="5768" href="Peras.Chain.html#210" class="Function Operator">∣</a> <a id="5770" href="Data.List.Base.html#10878" class="Function">filter</a> <a id="5777" class="Symbol">(</a><a id="5778" href="Peras.Chain.html#5096" class="Function Operator">_PointsInto?</a> <a id="5791" href="Peras.Chain.html#5748" class="Bound">ch</a><a id="5793" class="Symbol">)</a> <a id="5795" href="Peras.Chain.html#5753" class="Bound">cts</a> <a id="5799" href="Peras.Chain.html#210" class="Function Operator">∣</a> <a id="5801" href="Haskell.Prim.Num.html#632" class="Field Operator">*</a> <a id="5803" href="Peras.Params.html#277" class="Field">B</a>
</pre>
<h3 id="chain-validity">Chain validity</h3>
<!--
<pre class="Agda"><a id="5843" class="Keyword">open</a> <a id="5848" class="Keyword">import</a> <a id="5855" href="Data.List.Membership.Propositional.html" class="Module">Data.List.Membership.Propositional</a> <a id="5890" class="Keyword">using</a> <a id="5896" class="Symbol">(</a><a id="5897" href="Data.List.Membership.Setoid.html#950" class="Function Operator">_∈_</a><a id="5900" class="Symbol">)</a>
<a id="5902" class="Keyword">open</a> <a id="5907" class="Keyword">import</a> <a id="5914" href="Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="5940" class="Keyword">using</a> <a id="5946" class="Symbol">(</a><a id="5947" href="Relation.Nullary.Negation.Core.html#698" class="Function Operator">¬_</a><a id="5949" class="Symbol">)</a>
<a id="5951" class="Keyword">open</a> <a id="5956" class="Keyword">import</a> <a id="5963" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="6001" class="Keyword">using</a> <a id="6007" class="Symbol">(</a><a id="6008" href="Relation.Binary.PropositionalEquality.Core.html#1757" class="Function">trans</a><a id="6013" class="Symbol">)</a>

<a id="6016" class="Keyword">open</a> <a id="6021" href="Peras.Block.html#2807" class="Module">Block</a>
</pre>-->
<pre class="Agda"><a id="6043" class="Keyword">module</a> <a id="6050" href="Peras.Chain.html#6050" class="Module">_</a> <a id="6052" class="Symbol">⦃</a> <a id="6054" href="Peras.Chain.html#6054" class="Bound">_</a> <a id="6056" class="Symbol">:</a> <a id="6058" href="Peras.Crypto.html#1994" class="Record">Hashable</a> <a id="6067" href="Peras.Block.html#2807" class="Record">Block</a> <a id="6073" class="Symbol">⦄</a>
         <a id="6084" class="Symbol">⦃</a> <a id="6086" href="Peras.Chain.html#6086" class="Bound">_</a> <a id="6088" class="Symbol">:</a> <a id="6090" href="Peras.Chain.html#2260" class="Record">Postulates</a> <a id="6101" class="Symbol">⦄</a>
         <a id="6112" class="Symbol">⦃</a> <a id="6114" href="Peras.Chain.html#6114" class="Bound">_</a> <a id="6116" class="Symbol">:</a> <a id="6118" href="Peras.Chain.html#2526" class="Record">Network</a> <a id="6126" class="Symbol">⦄</a>

         <a id="6138" class="Keyword">where</a>

  <a id="6147" class="Keyword">open</a> <a id="6152" href="Peras.Crypto.html#1994" class="Module">Hashable</a> <a id="6161" class="Symbol">⦃...⦄</a>
  <a id="6169" class="Keyword">open</a> <a id="6174" href="Peras.Chain.html#2260" class="Module">Postulates</a> <a id="6185" class="Symbol">⦃...⦄</a>
  <a id="6193" class="Keyword">open</a> <a id="6198" href="Peras.Chain.html#2526" class="Module">Network</a> <a id="6206" class="Symbol">⦃...⦄</a>
</pre>
<pre class="Agda">  <a id="6226" class="Keyword">data</a> <a id="6231" href="Peras.Chain.html#6231" class="Datatype">ValidChain</a> <a id="6242" class="Symbol">:</a> <a id="6244" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="6250" class="Symbol">→</a> <a id="6252" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="6256" class="Keyword">where</a>

    <a id="6267" href="Peras.Chain.html#6267" class="InductiveConstructor">Genesis</a> <a id="6275" class="Symbol">:</a> <a id="6277" href="Peras.Chain.html#6231" class="Datatype">ValidChain</a> <a id="6288" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

    <a id="6296" href="Peras.Chain.html#6296" class="InductiveConstructor">Cons</a> <a id="6301" class="Symbol">:</a> <a id="6303" class="Symbol">∀</a> <a id="6305" class="Symbol">{</a><a id="6306" href="Peras.Chain.html#6306" class="Bound">c</a> <a id="6308" class="Symbol">:</a> <a id="6310" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="6315" class="Symbol">}</a> <a id="6317" class="Symbol">{</a><a id="6318" href="Peras.Chain.html#6318" class="Bound">b</a> <a id="6320" class="Symbol">:</a> <a id="6322" href="Peras.Block.html#2807" class="Record">Block</a><a id="6327" class="Symbol">}</a>
      <a id="6335" class="Symbol">→</a> <a id="6337" href="Peras.Chain.html#2430" class="Field">IsBlockSignature</a> <a id="6354" href="Peras.Chain.html#6318" class="Bound">b</a> <a id="6356" class="Symbol">(</a><a id="6357" href="Peras.Block.html#3408" class="Field">signature</a> <a id="6367" href="Peras.Chain.html#6318" class="Bound">b</a><a id="6368" class="Symbol">)</a>
      <a id="6376" class="Symbol">→</a> <a id="6378" href="Peras.Chain.html#2296" class="Field">IsSlotLeader</a> <a id="6391" class="Symbol">(</a><a id="6392" href="Peras.Block.html#3265" class="Field">creatorId</a> <a id="6402" href="Peras.Chain.html#6318" class="Bound">b</a><a id="6403" class="Symbol">)</a> <a id="6405" class="Symbol">(</a><a id="6406" href="Peras.Block.html#3233" class="Field">slotNumber</a> <a id="6417" href="Peras.Chain.html#6318" class="Bound">b</a><a id="6418" class="Symbol">)</a> <a id="6420" class="Symbol">(</a><a id="6421" href="Peras.Block.html#3366" class="Field">leadershipProof</a> <a id="6437" href="Peras.Chain.html#6318" class="Bound">b</a><a id="6438" class="Symbol">)</a>
      <a id="6446" class="Symbol">→</a> <a id="6448" href="Peras.Block.html#3293" class="Field">parentBlock</a> <a id="6460" href="Peras.Chain.html#6318" class="Bound">b</a> <a id="6462" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6464" href="Peras.Chain.html#4694" class="Function">tipHash</a> <a id="6472" href="Peras.Chain.html#6306" class="Bound">c</a>
      <a id="6480" class="Symbol">→</a> <a id="6482" href="Peras.Chain.html#6231" class="Datatype">ValidChain</a> <a id="6493" href="Peras.Chain.html#6306" class="Bound">c</a>
      <a id="6501" class="Symbol">→</a> <a id="6503" href="Peras.Chain.html#6231" class="Datatype">ValidChain</a> <a id="6514" class="Symbol">(</a><a id="6515" href="Peras.Chain.html#6318" class="Bound">b</a> <a id="6517" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6519" href="Peras.Chain.html#6306" class="Bound">c</a><a id="6520" class="Symbol">)</a>
</pre>
&lt;!–
<pre class="Agda"><a id="6539" class="Comment">-- | `foldl` does not exist in `Haskell.Prelude` so let&#39;s roll our own</a>
<a id="6610" class="Comment">-- but let&#39;s make it total.</a>
<a id="foldl1Maybe"></a><a id="6638" href="Peras.Chain.html#6638" class="Function">foldl1Maybe</a> <a id="6650" class="Symbol">:</a> <a id="6652" class="Symbol">∀</a> <a id="6654" class="Symbol">{</a><a id="6655" href="Peras.Chain.html#6655" class="Bound">a</a> <a id="6657" class="Symbol">:</a> <a id="6659" href="Agda.Primitive.html#388" class="Primitive">Set</a><a id="6662" class="Symbol">}</a> <a id="6664" class="Symbol">-&gt;</a> <a id="6667" class="Symbol">(</a><a id="6668" href="Peras.Chain.html#6655" class="Bound">a</a> <a id="6670" class="Symbol">-&gt;</a> <a id="6673" href="Peras.Chain.html#6655" class="Bound">a</a> <a id="6675" class="Symbol">-&gt;</a> <a id="6678" href="Peras.Chain.html#6655" class="Bound">a</a><a id="6679" class="Symbol">)</a> <a id="6681" class="Symbol">-&gt;</a> <a id="6684" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6689" href="Peras.Chain.html#6655" class="Bound">a</a> <a id="6691" class="Symbol">-&gt;</a> <a id="6694" href="Haskell.Prim.Maybe.html#101" class="Datatype">Maybe</a> <a id="6700" href="Peras.Chain.html#6655" class="Bound">a</a>
<a id="6702" href="Peras.Chain.html#6638" class="Function">foldl1Maybe</a> <a id="6714" href="Peras.Chain.html#6714" class="Bound">f</a> <a id="6716" href="Peras.Chain.html#6716" class="Bound">xs</a> <a id="6719" class="Symbol">=</a>
  <a id="6723" href="Haskell.Prim.Foldable.html#566" class="Field">foldl</a> <a id="6729" class="Symbol">(λ</a> <a id="6732" href="Peras.Chain.html#6732" class="Bound">m</a> <a id="6734" href="Peras.Chain.html#6734" class="Bound">y</a> <a id="6736" class="Symbol">-&gt;</a> <a id="6739" href="Haskell.Prim.Maybe.html#162" class="InductiveConstructor">Just</a> <a id="6744" class="Symbol">(</a><a id="6745" href="Haskell.Prim.html#1609" class="Function Operator">case</a> <a id="6750" href="Peras.Chain.html#6732" class="Bound">m</a> <a id="6752" href="Haskell.Prim.html#1609" class="Function Operator">of</a> <a id="6755" class="Symbol">λ</a> <a id="6757" class="Keyword">where</a>
                             <a id="6792" href="Haskell.Prim.Maybe.html#142" class="InductiveConstructor">Nothing</a> <a id="6800" class="Symbol">-&gt;</a> <a id="6803" href="Peras.Chain.html#6734" class="Bound">y</a>
                             <a id="6834" class="Symbol">(</a><a id="6835" href="Haskell.Prim.Maybe.html#162" class="InductiveConstructor">Just</a> <a id="6840" href="Peras.Chain.html#6840" class="Bound">x</a><a id="6841" class="Symbol">)</a>  <a id="6844" class="Symbol">-&gt;</a> <a id="6847" href="Peras.Chain.html#6714" class="Bound">f</a> <a id="6849" href="Peras.Chain.html#6840" class="Bound">x</a> <a id="6851" href="Peras.Chain.html#6734" class="Bound">y</a><a id="6852" class="Symbol">))</a>
        <a id="6863" href="Haskell.Prim.Maybe.html#142" class="InductiveConstructor">Nothing</a> <a id="6871" href="Peras.Chain.html#6716" class="Bound">xs</a>

<a id="6875" class="Symbol">{-#</a> <a id="6879" class="Keyword">COMPILE</a> <a id="6887" class="Keyword">AGDA2HS</a> <a id="6895" href="Peras.Chain.html#6638" class="Function">foldl1Maybe</a> <a id="6907" class="Symbol">#-}</a>

<a id="prefix"></a><a id="6912" href="Peras.Chain.html#6912" class="Function">prefix</a> <a id="6919" class="Symbol">:</a> <a id="6921" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6926" href="Peras.Block.html#2807" class="Record">Block</a> <a id="6932" class="Symbol">-&gt;</a> <a id="6935" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6940" href="Peras.Block.html#2807" class="Record">Block</a> <a id="6946" class="Symbol">-&gt;</a> <a id="6949" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6954" href="Peras.Block.html#2807" class="Record">Block</a> <a id="6960" class="Symbol">-&gt;</a> <a id="6963" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6968" href="Peras.Block.html#2807" class="Record">Block</a>
<a id="6974" href="Peras.Chain.html#6912" class="Function">prefix</a> <a id="6981" href="Peras.Chain.html#6981" class="Bound">acc</a> <a id="6985" class="Symbol">(</a><a id="6986" href="Peras.Chain.html#6986" class="Bound">x</a> <a id="6988" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6990" href="Peras.Chain.html#6990" class="Bound">xs</a><a id="6992" class="Symbol">)</a> <a id="6994" class="Symbol">(</a><a id="6995" href="Peras.Chain.html#6995" class="Bound">y</a> <a id="6997" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6999" href="Peras.Chain.html#6999" class="Bound">ys</a><a id="7001" class="Symbol">)</a> <a id="7003" class="Symbol">=</a>
  <a id="7007" href="Haskell.Prim.html#1713" class="Function Operator">if</a> <a id="7010" href="Peras.Chain.html#6986" class="Bound">x</a> <a id="7012" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="7015" href="Peras.Chain.html#6995" class="Bound">y</a>
   <a id="7020" href="Haskell.Prim.html#1713" class="Function Operator">then</a> <a id="7025" href="Peras.Chain.html#6912" class="Function">prefix</a> <a id="7032" class="Symbol">(</a><a id="7033" href="Peras.Chain.html#6986" class="Bound">x</a> <a id="7035" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7037" href="Peras.Chain.html#6981" class="Bound">acc</a><a id="7040" class="Symbol">)</a> <a id="7042" href="Peras.Chain.html#6990" class="Bound">xs</a> <a id="7045" href="Peras.Chain.html#6999" class="Bound">ys</a>
   <a id="7051" href="Haskell.Prim.html#1713" class="Function Operator">else</a> <a id="7056" href="Haskell.Prelude.html#3598" class="Function">reverse</a> <a id="7064" href="Peras.Chain.html#6981" class="Bound">acc</a>
<a id="7068" href="Peras.Chain.html#6912" class="CatchallClause Function">prefix</a><a id="7074" class="CatchallClause"> </a><a id="7075" href="Peras.Chain.html#7075" class="CatchallClause Bound">acc</a><a id="7078" class="CatchallClause"> </a><a id="7079" class="CatchallClause Symbol">_</a><a id="7080" class="CatchallClause"> </a><a id="7081" class="CatchallClause Symbol">_</a> <a id="7083" class="Symbol">=</a> <a id="7085" href="Haskell.Prelude.html#3598" class="Function">reverse</a> <a id="7093" href="Peras.Chain.html#7075" class="Bound">acc</a>

<a id="7098" class="Symbol">{-#</a> <a id="7102" class="Keyword">COMPILE</a> <a id="7110" class="Keyword">AGDA2HS</a> <a id="7118" href="Peras.Chain.html#6912" class="Function">prefix</a> <a id="7125" class="Symbol">#-}</a>

<a id="commonPrefix"></a><a id="7130" href="Peras.Chain.html#7130" class="Function">commonPrefix</a> <a id="7143" class="Symbol">:</a> <a id="7145" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7150" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="7156" class="Symbol">-&gt;</a> <a id="7159" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7164" href="Peras.Block.html#2807" class="Record">Block</a>
<a id="7170" href="Peras.Chain.html#7130" class="Function">commonPrefix</a> <a id="7183" href="Peras.Chain.html#7183" class="Bound">chains</a> <a id="7190" class="Symbol">=</a>
  <a id="7194" href="Haskell.Prim.html#1609" class="Function Operator">case</a> <a id="7199" href="Peras.Chain.html#7283" class="Function">listPrefix</a> <a id="7210" href="Haskell.Prim.html#1609" class="Function Operator">of</a> <a id="7213" class="Symbol">λ</a> <a id="7215" class="Keyword">where</a>
     <a id="7226" href="Haskell.Prim.Maybe.html#142" class="InductiveConstructor">Nothing</a> <a id="7234" class="Symbol">-&gt;</a> <a id="7237" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
     <a id="7245" class="Symbol">(</a><a id="7246" href="Haskell.Prim.Maybe.html#162" class="InductiveConstructor">Just</a> <a id="7251" href="Peras.Chain.html#7251" class="Bound">bs</a><a id="7253" class="Symbol">)</a> <a id="7255" class="Symbol">-&gt;</a> <a id="7258" href="Haskell.Prelude.html#3598" class="Function">reverse</a> <a id="7266" href="Peras.Chain.html#7251" class="Bound">bs</a>
   <a id="7272" class="Keyword">where</a>
     <a id="7283" href="Peras.Chain.html#7283" class="Function">listPrefix</a> <a id="7294" class="Symbol">:</a> <a id="7296" href="Haskell.Prim.Maybe.html#101" class="Datatype">Maybe</a> <a id="7302" class="Symbol">(</a><a id="7303" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7308" href="Peras.Block.html#2807" class="Record">Block</a><a id="7313" class="Symbol">)</a>
     <a id="7320" href="Peras.Chain.html#7283" class="Function">listPrefix</a> <a id="7331" class="Symbol">=</a> <a id="7333" href="Peras.Chain.html#6638" class="Function">foldl1Maybe</a> <a id="7345" class="Symbol">(</a><a id="7346" href="Peras.Chain.html#6912" class="Function">prefix</a> <a id="7353" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="7355" class="Symbol">)</a> <a id="7357" class="Symbol">(</a><a id="7358" href="Haskell.Prim.List.html#211" class="Function">map</a> <a id="7362" class="Symbol">(λ</a> <a id="7365" href="Peras.Chain.html#7365" class="Bound">l</a> <a id="7367" class="Symbol">-&gt;</a> <a id="7370" href="Haskell.Prelude.html#3598" class="Function">reverse</a> <a id="7378" href="Peras.Chain.html#7365" class="Bound">l</a><a id="7379" class="Symbol">)</a> <a id="7381" href="Peras.Chain.html#7183" class="Bound">chains</a><a id="7387" class="Symbol">)</a>

<a id="7390" class="Symbol">{-#</a> <a id="7394" class="Keyword">COMPILE</a> <a id="7402" class="Keyword">AGDA2HS</a> <a id="7410" href="Peras.Chain.html#7130" class="Function">commonPrefix</a> <a id="7423" class="Symbol">#-}</a>
<a id="7427" class="Comment">--&gt;</a>
</pre>
</body>
</html>
