<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Peras.Chain</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="Agda.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre class="Agda"><a id="9" class="Keyword">module</a> <a id="16" href="Peras.Chain.html" class="Module">Peras.Chain</a> <a id="28" class="Keyword">where</a>
</pre>
<!--
<pre class="Agda"><a id="52" class="Keyword">open</a> <a id="57" class="Keyword">import</a> <a id="64" href="Data.Bool.html" class="Module">Data.Bool</a> <a id="74" class="Keyword">using</a> <a id="80" class="Symbol">(</a><a id="81" href="Data.Bool.Base.html#995" class="Function Operator">_∧_</a><a id="84" class="Symbol">;</a> <a id="86" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a><a id="90" class="Symbol">;</a> <a id="92" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a><a id="97" class="Symbol">)</a>
<a id="99" class="Keyword">open</a> <a id="104" class="Keyword">import</a> <a id="111" href="Data.List.html" class="Module">Data.List</a> <a id="121" class="Keyword">using</a> <a id="127" class="Symbol">(</a><a id="128" href="Data.List.Base.html#5003" class="Function">sum</a><a id="131" class="Symbol">;</a> <a id="133" href="Data.List.Base.html#6860" class="Function">upTo</a><a id="137" class="Symbol">;</a> <a id="139" href="Data.List.Base.html#6379" class="Function">applyUpTo</a><a id="148" class="Symbol">;</a> <a id="150" href="Data.List.Base.html#11049" class="Function">filterᵇ</a><a id="157" class="Symbol">;</a> <a id="159" href="Data.List.Base.html#10878" class="Function">filter</a><a id="165" class="Symbol">;</a> <a id="167" href="Data.List.Base.html#4538" class="Function">concat</a><a id="173" class="Symbol">;</a> <a id="175" href="Data.List.Base.html#1716" class="Function">mapMaybe</a><a id="183" class="Symbol">;</a> <a id="185" href="Data.List.Base.html#3714" class="Function">zip</a><a id="188" class="Symbol">)</a> <a id="190" class="Keyword">renaming</a> <a id="199" class="Symbol">(</a><a id="200" href="Data.List.Base.html#5083" class="Function">length</a> <a id="207" class="Symbol">to</a> <a id="210" class="Function">∣_∣</a><a id="213" class="Symbol">)</a>
<a id="215" class="Keyword">open</a> <a id="220" class="Keyword">import</a> <a id="227" href="Data.List.Membership.Propositional.html" class="Module">Data.List.Membership.Propositional</a> <a id="262" class="Keyword">using</a> <a id="268" class="Symbol">(</a><a id="269" href="Data.List.Membership.Setoid.html#950" class="Function Operator">_∈_</a><a id="272" class="Symbol">)</a>
<a id="274" class="Keyword">open</a> <a id="279" class="Keyword">import</a> <a id="286" href="Data.List.Relation.Unary.Any.html" class="Module">Data.List.Relation.Unary.Any</a> <a id="315" class="Keyword">using</a> <a id="321" class="Symbol">(</a><a id="322" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a><a id="326" class="Symbol">;</a> <a id="328" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a><a id="331" class="Symbol">;</a> <a id="333" href="Data.List.Relation.Unary.Any.html#1226" class="InductiveConstructor">here</a><a id="337" class="Symbol">;</a> <a id="339" href="Data.List.Relation.Unary.Any.html#1279" class="InductiveConstructor">there</a><a id="344" class="Symbol">;</a> <a id="346" href="Data.List.Relation.Unary.Any.html#1926" class="Function">lookup</a><a id="352" class="Symbol">)</a>
<a id="354" class="Keyword">open</a> <a id="359" class="Keyword">import</a> <a id="366" href="Data.List.Relation.Unary.All.html" class="Module">Data.List.Relation.Unary.All</a> <a id="395" class="Keyword">using</a> <a id="401" class="Symbol">(</a><a id="402" href="Data.List.Relation.Unary.All.html#1627" class="Datatype">All</a><a id="405" class="Symbol">)</a>
<a id="407" class="Keyword">open</a> <a id="412" class="Keyword">import</a> <a id="419" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="430" class="Symbol">as</a> <a id="433" class="Module">M</a> <a id="435" class="Keyword">using</a> <a id="441" class="Symbol">(</a><a id="442" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="449" class="Symbol">;</a> <a id="451" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a><a id="455" class="Symbol">)</a>
<a id="457" class="Keyword">open</a> <a id="462" class="Keyword">import</a> <a id="469" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="478" class="Keyword">using</a> <a id="484" class="Symbol">(</a><a id="485" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="486" class="Symbol">;</a> <a id="488" href="Data.Nat.Base.html#7096" class="Function Operator">_/_</a><a id="491" class="Symbol">;</a> <a id="493" href="Data.Nat.Base.html#2289" class="Function Operator">_&gt;_</a><a id="496" class="Symbol">;</a> <a id="498" href="Data.Nat.Base.html#2259" class="Function Operator">_≥_</a><a id="501" class="Symbol">;</a> <a id="503" href="Data.Nat.Properties.html#6212" class="Function Operator">_≥?_</a><a id="507" class="Symbol">;</a> <a id="509" href="Data.Nat.Properties.html#6146" class="Function Operator">_≤?_</a><a id="513" class="Symbol">;</a> <a id="515" href="Data.Nat.Base.html#3260" class="Record">NonZero</a><a id="522" class="Symbol">;</a> <a id="524" href="Data.Nat.Base.html#5266" class="Function">pred</a><a id="528" class="Symbol">;</a> <a id="530" href="Data.Nat.Base.html#4456" class="Primitive Operator">_∸_</a><a id="533" class="Symbol">;</a> <a id="535" href="Data.Nat.Base.html#1714" class="InductiveConstructor">z≤n</a><a id="538" class="Symbol">;</a> <a id="540" href="Data.Nat.Base.html#1756" class="InductiveConstructor">s≤s</a><a id="543" class="Symbol">)</a>
<a id="545" class="Keyword">open</a> <a id="550" class="Keyword">import</a> <a id="557" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="566" class="Keyword">using</a> <a id="572" class="Symbol">(</a><a id="573" href="Data.Nat.Base.html#1691" class="Datatype Operator">_≤_</a><a id="576" class="Symbol">;</a> <a id="578" href="Data.Nat.Base.html#1801" class="Function Operator">_&lt;_</a><a id="581" class="Symbol">;</a> <a id="583" href="Data.Nat.Base.html#4456" class="Primitive Operator">_∸_</a><a id="586" class="Symbol">)</a>
<a id="588" class="Keyword">open</a> <a id="593" class="Keyword">import</a> <a id="600" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="620" class="Keyword">using</a> <a id="626" class="Symbol">(</a><a id="627" href="Data.Nat.Properties.html#12185" class="Function">n≮n</a><a id="630" class="Symbol">;</a> <a id="632" href="Data.Nat.Properties.html#3311" class="Function Operator">_≟_</a><a id="635" class="Symbol">)</a>
<a id="637" class="Keyword">open</a> <a id="642" class="Keyword">import</a> <a id="649" href="Data.Product.html" class="Module">Data.Product</a> <a id="662" class="Keyword">using</a> <a id="668" class="Symbol">(</a><a id="669" href="Agda.Builtin.Sigma.html#165" class="Record">Σ</a><a id="670" class="Symbol">;</a> <a id="672" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,_</a><a id="675" class="Symbol">;</a> <a id="677" href="Data.Product.Base.html#852" class="Function">∃</a><a id="678" class="Symbol">;</a> <a id="680" href="Data.Product.Base.html#1244" class="Function">Σ-syntax</a><a id="688" class="Symbol">;</a> <a id="690" href="Data.Product.Base.html#1371" class="Function">∃-syntax</a><a id="698" class="Symbol">;</a> <a id="700" href="Data.Product.Base.html#1618" class="Function Operator">_×_</a><a id="703" class="Symbol">;</a> <a id="705" href="Data.Product.Base.html#636" class="Field">proj₁</a><a id="710" class="Symbol">;</a> <a id="712" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="717" class="Symbol">)</a>
<a id="719" class="Keyword">open</a> <a id="724" class="Keyword">import</a> <a id="731" href="Function.Base.html" class="Module">Function.Base</a> <a id="745" class="Keyword">using</a> <a id="751" class="Symbol">(</a><a id="752" href="Function.Base.html#1115" class="Function Operator">_∘_</a><a id="755" class="Symbol">;</a> <a id="757" href="Function.Base.html#1974" class="Function Operator">_$_</a><a id="760" class="Symbol">)</a>
<a id="762" class="Keyword">open</a> <a id="767" class="Keyword">import</a> <a id="774" href="Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="791" class="Keyword">using</a> <a id="797" class="Symbol">(</a><a id="798" href="Relation.Nullary.Negation.Core.html#698" class="Function Operator">¬_</a><a id="800" class="Symbol">;</a> <a id="802" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a><a id="805" class="Symbol">;</a> <a id="807" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a><a id="810" class="Symbol">;</a> <a id="812" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a><a id="814" class="Symbol">;</a> <a id="816" href="Relation.Nullary.Decidable.Core.html#2517" class="Function">¬?</a><a id="818" class="Symbol">)</a>
<a id="820" class="Keyword">open</a> <a id="825" class="Keyword">import</a> <a id="832" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a> <a id="859" class="Keyword">using</a> <a id="865" class="Symbol">(</a><a id="866" href="Relation.Nullary.Decidable.Core.html#2609" class="Function Operator">_×-dec_</a><a id="873" class="Symbol">)</a>
<a id="875" class="Keyword">open</a> <a id="880" class="Keyword">import</a> <a id="887" href="Relation.Binary.html" class="Module">Relation.Binary</a> <a id="903" class="Keyword">using</a> <a id="909" class="Symbol">(</a><a id="910" href="Relation.Binary.Definitions.html#6469" class="Function">DecidableEquality</a><a id="927" class="Symbol">)</a>

<a id="930" class="Keyword">import</a> <a id="937" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="975" class="Symbol">as</a> <a id="978" class="Module">Eq</a>
<a id="981" class="Keyword">open</a> <a id="986" href="Relation.Binary.PropositionalEquality.html" class="Module">Eq</a> <a id="989" class="Keyword">using</a> <a id="995" class="Symbol">(</a><a id="996" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">_≢_</a><a id="999" class="Symbol">)</a>

<a id="1002" class="Keyword">open</a> <a id="1007" class="Keyword">import</a> <a id="1014" href="Peras.Crypto.html" class="Module">Peras.Crypto</a>
<a id="1027" class="Keyword">open</a> <a id="1032" class="Keyword">import</a> <a id="1039" href="Peras.Block.html" class="Module">Peras.Block</a>
<a id="1051" class="Keyword">open</a> <a id="1056" class="Keyword">import</a> <a id="1063" href="Peras.Numbering.html" class="Module">Peras.Numbering</a>
<a id="1079" class="Keyword">open</a> <a id="1084" class="Keyword">import</a> <a id="1091" href="Peras.Params.html" class="Module">Peras.Params</a>

<a id="1105" class="Keyword">open</a> <a id="1110" class="Keyword">import</a> <a id="1117" href="Haskell.Prelude.html" class="Module">Haskell.Prelude</a> <a id="1133" class="Keyword">hiding</a> <a id="1140" class="Symbol">(</a><a id="1141" href="Haskell.Prim.Foldable.html#999" class="Field">length</a><a id="1147" class="Symbol">;</a> <a id="1149" href="Haskell.Prim.Ord.html#1072" class="Field Operator">_&lt;_</a><a id="1152" class="Symbol">;</a> <a id="1154" href="Haskell.Prim.Ord.html#1096" class="Field Operator">_&gt;_</a><a id="1157" class="Symbol">;</a> <a id="1159" href="Haskell.Prim.html#1330" class="Function Operator">_∘_</a><a id="1162" class="Symbol">;</a> <a id="1164" href="Haskell.Prim.Foldable.html#921" class="Field">sum</a><a id="1167" class="Symbol">;</a> <a id="1169" href="Haskell.Prim.html#1193" class="Generalizable">b</a><a id="1170" class="Symbol">;</a> <a id="1172" href="Haskell.Prim.Enum.html#2173" class="Field">pred</a><a id="1176" class="Symbol">;</a> <a id="1178" href="Haskell.Prim.List.html#419" class="Function">filter</a><a id="1184" class="Symbol">;</a> <a id="1186" href="Haskell.Prim.Foldable.html#741" class="Field">concat</a><a id="1192" class="Symbol">;</a> <a id="1194" href="Haskell.Prim.html#1480" class="Function Operator">_$_</a><a id="1197" class="Symbol">;</a> <a id="1199" href="Haskell.Prelude.html#3964" class="Function">lookup</a><a id="1205" class="Symbol">;</a> <a id="1207" href="Haskell.Prim.List.html#1793" class="Function">zip</a><a id="1210" class="Symbol">;</a> <a id="1212" href="Haskell.Prim.html#2804" class="Datatype">All</a><a id="1215" class="Symbol">;</a> <a id="1217" href="Haskell.Prim.html#2981" class="Datatype">Any</a><a id="1220" class="Symbol">;</a> <a id="1222" href="Haskell.Prim.Tuple.html#211" class="InductiveConstructor Operator">_,_</a><a id="1225" class="Symbol">;</a> <a id="1227" href="Haskell.Prim.Tuple.html#169" class="Record Operator">_×_</a><a id="1230" class="Symbol">)</a>
<a id="1232" class="Keyword">open</a> <a id="1237" class="Keyword">import</a> <a id="1244" href="Haskell.Law.Equality.html" class="Module">Haskell.Law.Equality</a> <a id="1265" class="Keyword">using</a> <a id="1271" class="Symbol">(</a><a id="1272" href="Haskell.Law.Equality.html#226" class="Function">cong</a><a id="1276" class="Symbol">)</a>

<a id="1279" class="Symbol">{-#</a> <a id="1283" class="Keyword">FOREIGN</a> <a id="1291" class="Pragma">AGDA2HS</a>
<a id="1299" class="Symbol">{-#</a> <a id="1303" class="Pragma">LANGUAGE</a> <a id="1312" class="Pragma">DeriveGeneric</a> <a id="1326" class="Symbol">#-}</a>
<a id="1330" class="Pragma">import</a> <a id="1337" class="Pragma">GHC.Generics</a> <a id="1350" class="Pragma">(Generic)</a>
<a id="1360" class="Symbol">#-}</a>

<a id="1365" class="Symbol">{-#</a> <a id="1369" class="Keyword">FOREIGN</a> <a id="1377" class="Pragma">GHC</a>
<a id="1381" class="Pragma">import</a> <a id="1388" class="Pragma">qualified</a> <a id="1398" class="Pragma">Peras.Chain</a> <a id="1410" class="Pragma">as</a> <a id="1413" class="Pragma">G</a>
<a id="1415" class="Symbol">#-}</a>
</pre>-->
<h2 id="voting">Voting</h2>
<h3 id="vote">Vote</h3>
<pre class="Agda">
<a id="VotingWeight"></a><a id="1458" href="Peras.Chain.html#1458" class="Function">VotingWeight</a> <a id="1471" class="Symbol">=</a> <a id="1473" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>

<a id="1476" class="Keyword">record</a> <a id="Vote"></a><a id="1483" href="Peras.Chain.html#1483" class="Record">Vote</a> <a id="1488" class="Symbol">:</a> <a id="1490" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1494" class="Keyword">where</a>
  <a id="1502" class="Keyword">constructor</a> <a id="MkVote"></a><a id="1514" href="Peras.Chain.html#1514" class="InductiveConstructor">MkVote</a>
  <a id="1523" class="Keyword">field</a> <a id="Vote.votingRound"></a><a id="1529" href="Peras.Chain.html#1529" class="Field">votingRound</a> <a id="1541" class="Symbol">:</a> <a id="1543" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a>
        <a id="Vote.creatorId"></a><a id="1563" href="Peras.Chain.html#1563" class="Field">creatorId</a>   <a id="1575" class="Symbol">:</a> <a id="1577" href="Peras.Block.html#1264" class="Function">PartyId</a>
        <a id="Vote.proofM"></a><a id="1593" href="Peras.Chain.html#1593" class="Field">proofM</a>      <a id="1605" class="Symbol">:</a> <a id="1607" href="Peras.Crypto.html#2161" class="Record">MembershipProof</a>
        <a id="Vote.blockHash"></a><a id="1631" href="Peras.Chain.html#1631" class="Field">blockHash</a>   <a id="1643" class="Symbol">:</a> <a id="1645" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="1650" href="Peras.Block.html#2965" class="Record">Block</a>
        <a id="Vote.signature"></a><a id="1664" href="Peras.Chain.html#1664" class="Field">signature</a>   <a id="1676" class="Symbol">:</a> <a id="1678" href="Peras.Crypto.html#3115" class="Record">Signature</a>

  <a id="Vote.votingRound&#39;"></a><a id="1691" href="Peras.Chain.html#1691" class="Function">votingRound&#39;</a> <a id="1704" class="Symbol">:</a> <a id="1706" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
  <a id="1710" href="Peras.Chain.html#1691" class="Function">votingRound&#39;</a> <a id="1723" class="Symbol">=</a> <a id="1725" href="Peras.Numbering.html#1729" class="Field">getRoundNumber</a> <a id="1740" href="Peras.Chain.html#1529" class="Field">votingRound</a>

<a id="1753" class="Keyword">open</a> <a id="1758" href="Peras.Chain.html#1483" class="Module">Vote</a> <a id="1763" class="Keyword">public</a>

<a id="1771" class="Keyword">instance</a>
  <a id="iVoteEq"></a><a id="1782" href="Peras.Chain.html#1782" class="Function">iVoteEq</a> <a id="1790" class="Symbol">:</a> <a id="1792" href="Haskell.Prim.Eq.html#401" class="Record">Eq</a> <a id="1795" href="Peras.Chain.html#1483" class="Record">Vote</a>
  <a id="1802" href="Peras.Chain.html#1782" class="Function">iVoteEq</a> <a id="1810" class="Symbol">.</a><a id="1811" href="Haskell.Prim.Eq.html#453" class="Field Operator">_==_</a> <a id="1816" href="Peras.Chain.html#1816" class="Bound">x</a> <a id="1818" href="Peras.Chain.html#1818" class="Bound">y</a> <a id="1820" class="Symbol">=</a> <a id="1822" href="Peras.Chain.html#1529" class="Field">votingRound</a> <a id="1834" href="Peras.Chain.html#1816" class="Bound">x</a> <a id="1836" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="1839" href="Peras.Chain.html#1529" class="Field">votingRound</a> <a id="1851" href="Peras.Chain.html#1818" class="Bound">y</a>
                        <a id="1877" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="1880" href="Peras.Chain.html#1563" class="Field">creatorId</a> <a id="1890" href="Peras.Chain.html#1816" class="Bound">x</a> <a id="1892" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="1895" href="Peras.Chain.html#1563" class="Field">creatorId</a> <a id="1905" href="Peras.Chain.html#1818" class="Bound">y</a>
                        <a id="1931" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="1934" href="Peras.Chain.html#1593" class="Field">proofM</a> <a id="1941" href="Peras.Chain.html#1816" class="Bound">x</a> <a id="1943" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="1946" href="Peras.Chain.html#1593" class="Field">proofM</a> <a id="1953" href="Peras.Chain.html#1818" class="Bound">y</a>
                        <a id="1979" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="1982" href="Peras.Chain.html#1631" class="Field">blockHash</a> <a id="1992" href="Peras.Chain.html#1816" class="Bound">x</a> <a id="1994" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="1997" href="Peras.Chain.html#1631" class="Field">blockHash</a> <a id="2007" href="Peras.Chain.html#1818" class="Bound">y</a>
                        <a id="2033" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="2036" href="Peras.Chain.html#1664" class="Field">signature</a> <a id="2046" href="Peras.Chain.html#1816" class="Bound">x</a> <a id="2048" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="2051" href="Peras.Chain.html#1664" class="Field">signature</a> <a id="2061" href="Peras.Chain.html#1818" class="Bound">y</a>
</pre>
<!--
<pre class="Agda"><a id="2081" class="Symbol">{-#</a> <a id="2085" class="Keyword">COMPILE</a> <a id="2093" class="Keyword">AGDA2HS</a> <a id="2101" href="Peras.Chain.html#1458" class="Function">VotingWeight</a> <a id="2114" class="Symbol">#-}</a>
<a id="2118" class="Symbol">{-#</a> <a id="2122" class="Keyword">COMPILE</a> <a id="2130" class="Keyword">AGDA2HS</a> <a id="2138" href="Peras.Chain.html#1483" class="Record">Vote</a> <a id="2143" class="Pragma">deriving</a> <a id="2152" class="Pragma">(Generic)</a> <a id="2162" class="Symbol">#-}</a>
<a id="2166" class="Symbol">{-#</a> <a id="2170" class="Keyword">COMPILE</a> <a id="2178" class="Keyword">GHC</a> <a id="2182" href="Peras.Chain.html#1483" class="Record">Vote</a> <a id="2187" class="Pragma">=</a> <a id="2189" class="Pragma">data</a> <a id="2194" class="Pragma">G.Vote</a> <a id="2201" class="Pragma">(G.MkVote)</a> <a id="2212" class="Symbol">#-}</a>
<a id="2216" class="Symbol">{-#</a> <a id="2220" class="Keyword">COMPILE</a> <a id="2228" class="Keyword">AGDA2HS</a> <a id="2236" href="Peras.Chain.html#1782" class="Function">iVoteEq</a> <a id="2244" class="Symbol">#-}</a>
</pre>-->
<!--
<pre class="Agda"><a id="2270" class="Comment">{-
toSignable : ∀{msg} → Vote msg -&gt; ByteString
toSignable _ = emptyBS -- const &quot;&quot;
-}</a>

<a id="2357" class="Comment">{-
postulate
  makeVote : ∀{msg} → RoundNumber -&gt; PartyId -&gt; msg -&gt; Vote msg
-}</a>
</pre>-->
<!--
<pre class="Agda"><a id="2459" class="Comment">-- | A vote is valid if the committee-membership proof and the signature are valid.</a>
<a id="2543" class="Comment">{-
isValid : ∀{msg} → Vote msg -&gt; Bool
isValid v@(vote _ (MkPartyId vkey) committeeMembershipProof _ signature) =
  isCommitteeMember vkey committeeMembershipProof
    ∧ verify vkey signature (toSignable v)
-}</a>
</pre>-->
<pre class="Agda"><a id="2769" class="Keyword">record</a> <a id="Postulates"></a><a id="2776" href="Peras.Chain.html#2776" class="Record">Postulates</a> <a id="2787" class="Symbol">:</a> <a id="2789" href="Agda.Primitive.html#388" class="Primitive">Set₁</a> <a id="2794" class="Keyword">where</a>
  <a id="2802" class="Keyword">field</a>
    <a id="Postulates.IsSlotLeader"></a><a id="2812" href="Peras.Chain.html#2812" class="Field">IsSlotLeader</a> <a id="2825" class="Symbol">:</a> <a id="2827" href="Peras.Block.html#1264" class="Function">PartyId</a> <a id="2835" class="Symbol">→</a> <a id="2837" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="2848" class="Symbol">→</a> <a id="2850" href="Peras.Crypto.html#2593" class="Record">LeadershipProof</a> <a id="2866" class="Symbol">→</a> <a id="2868" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="Postulates.IsCommitteeMember"></a><a id="2876" href="Peras.Chain.html#2876" class="Field">IsCommitteeMember</a> <a id="2894" class="Symbol">:</a> <a id="2896" href="Peras.Block.html#1264" class="Function">PartyId</a> <a id="2904" class="Symbol">→</a> <a id="2906" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="2918" class="Symbol">→</a> <a id="2920" href="Peras.Crypto.html#2161" class="Record">MembershipProof</a> <a id="2936" class="Symbol">→</a> <a id="2938" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="Postulates.IsBlockSignature"></a><a id="2946" href="Peras.Chain.html#2946" class="Field">IsBlockSignature</a> <a id="2963" class="Symbol">:</a> <a id="2965" href="Peras.Block.html#2965" class="Record">Block</a> <a id="2971" class="Symbol">→</a> <a id="2973" href="Peras.Crypto.html#3115" class="Record">Signature</a> <a id="2983" class="Symbol">→</a> <a id="2985" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="Postulates.IsVoteSignature"></a><a id="2993" href="Peras.Chain.html#2993" class="Field">IsVoteSignature</a> <a id="3009" class="Symbol">:</a> <a id="3011" href="Peras.Chain.html#1483" class="Record">Vote</a> <a id="3016" class="Symbol">→</a> <a id="3018" href="Peras.Crypto.html#3115" class="Record">Signature</a> <a id="3028" class="Symbol">→</a> <a id="3030" href="Agda.Primitive.html#388" class="Primitive">Set</a>

<a id="3035" class="Keyword">record</a> <a id="Network"></a><a id="3042" href="Peras.Chain.html#3042" class="Record">Network</a> <a id="3050" class="Symbol">:</a> <a id="3052" href="Agda.Primitive.html#388" class="Primitive">Set₁</a> <a id="3057" class="Keyword">where</a>
  <a id="3065" class="Keyword">field</a>
    <a id="Network.Δ"></a><a id="3075" href="Peras.Chain.html#3075" class="Field">Δ</a> <a id="3077" class="Symbol">:</a> <a id="3079" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
</pre>
<pre class="Agda"><a id="3093" class="Keyword">module</a> <a id="3100" href="Peras.Chain.html#3100" class="Module">_</a> <a id="3102" class="Symbol">⦃</a> <a id="3104" href="Peras.Chain.html#3104" class="Bound">_</a> <a id="3106" class="Symbol">:</a> <a id="3108" href="Peras.Chain.html#2776" class="Record">Postulates</a> <a id="3119" class="Symbol">⦄</a>

         <a id="3131" class="Keyword">where</a>

  <a id="3140" class="Keyword">open</a> <a id="3145" href="Peras.Chain.html#2776" class="Module">Postulates</a> <a id="3156" class="Symbol">⦃...⦄</a>

  <a id="3165" href="Peras.Chain.html#3165" class="Function">ValidVote</a> <a id="3175" class="Symbol">:</a> <a id="3177" href="Peras.Chain.html#1483" class="Record">Vote</a> <a id="3182" class="Symbol">→</a> <a id="3184" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="3190" href="Peras.Chain.html#3165" class="Function">ValidVote</a> <a id="3200" href="Peras.Chain.html#3200" class="Bound">v</a> <a id="3202" class="Symbol">=</a>
    <a id="3208" href="Peras.Chain.html#2876" class="Field">IsCommitteeMember</a>
        <a id="3234" class="Symbol">(</a><a id="3235" href="Peras.Chain.html#1563" class="Field">creatorId</a> <a id="3245" href="Peras.Chain.html#3200" class="Bound">v</a><a id="3246" class="Symbol">)</a>
        <a id="3256" class="Symbol">(</a><a id="3257" href="Peras.Chain.html#1529" class="Field">votingRound</a> <a id="3269" href="Peras.Chain.html#3200" class="Bound">v</a><a id="3270" class="Symbol">)</a>
        <a id="3280" class="Symbol">(</a><a id="3281" href="Peras.Chain.html#1593" class="Field">proofM</a> <a id="3288" href="Peras.Chain.html#3200" class="Bound">v</a><a id="3289" class="Symbol">)</a>
    <a id="3295" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3297" href="Peras.Chain.html#2993" class="Field">IsVoteSignature</a> <a id="3313" href="Peras.Chain.html#3200" class="Bound">v</a> <a id="3315" class="Symbol">(</a><a id="3316" href="Peras.Chain.html#1664" class="Field">signature</a> <a id="3326" href="Peras.Chain.html#3200" class="Bound">v</a><a id="3327" class="Symbol">)</a>
</pre>
<h3 id="equivocation-relation">Equivocation relation</h3>
<p>Equivocal votes are multiple votes by the same party for the same
round.</p>
<pre class="Agda"><a id="3443" class="Keyword">data</a> <a id="_∻_"></a><a id="3448" href="Peras.Chain.html#3448" class="Datatype Operator">_∻_</a> <a id="3452" class="Symbol">:</a> <a id="3454" href="Peras.Chain.html#1483" class="Record">Vote</a> <a id="3459" class="Symbol">→</a> <a id="3461" href="Peras.Chain.html#1483" class="Record">Vote</a> <a id="3466" class="Symbol">→</a> <a id="3468" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="3472" class="Keyword">where</a>

  <a id="_∻_.Equivocation"></a><a id="3481" href="Peras.Chain.html#3481" class="InductiveConstructor">Equivocation</a> <a id="3494" class="Symbol">:</a> <a id="3496" class="Symbol">∀</a> <a id="3498" class="Symbol">{</a><a id="3499" href="Peras.Chain.html#3499" class="Bound">v₁</a> <a id="3502" href="Peras.Chain.html#3502" class="Bound">v₂</a><a id="3504" class="Symbol">}</a>
    <a id="3510" class="Symbol">→</a> <a id="3512" href="Peras.Chain.html#1563" class="Field">creatorId</a> <a id="3522" href="Peras.Chain.html#3499" class="Bound">v₁</a> <a id="3525" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3527" href="Peras.Chain.html#1563" class="Field">creatorId</a> <a id="3537" href="Peras.Chain.html#3502" class="Bound">v₂</a>
    <a id="3544" class="Symbol">→</a> <a id="3546" href="Peras.Chain.html#1529" class="Field">votingRound</a> <a id="3558" href="Peras.Chain.html#3499" class="Bound">v₁</a> <a id="3561" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3563" href="Peras.Chain.html#1529" class="Field">votingRound</a> <a id="3575" href="Peras.Chain.html#3502" class="Bound">v₂</a>
    <a id="3582" class="Symbol">→</a> <a id="3584" href="Peras.Chain.html#3499" class="Bound">v₁</a> <a id="3587" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="3589" href="Peras.Chain.html#3502" class="Bound">v₂</a>
    <a id="3596" class="Symbol">→</a> <a id="3598" href="Peras.Chain.html#3499" class="Bound">v₁</a> <a id="3601" href="Peras.Chain.html#3448" class="Datatype Operator">∻</a> <a id="3603" href="Peras.Chain.html#3502" class="Bound">v₂</a>
</pre>
<!--
<pre class="Agda"><a id="3623" class="Comment">-- NonEquivocation : Vote → Vote → Set</a>
<a id="3662" class="Comment">-- NonEquivocation v₁ v₂ = ¬ (v₁ ∻ v₂)</a>

<a id="3702" class="Comment">-- open import Data.List.Relation.Unary.AllPairs.Core NonEquivocation renaming (AllPairs to NoEquivocations) public</a>
</pre>-->
<h2 id="chain">Chain</h2>
<pre class="Agda"><a id="Chain"></a><a id="3845" href="Peras.Chain.html#3845" class="Function">Chain</a> <a id="3851" class="Symbol">=</a> <a id="3853" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3858" href="Peras.Block.html#2965" class="Record">Block</a>
</pre>
<!--
<pre class="Agda"><a id="3881" class="Symbol">{-#</a> <a id="3885" class="Keyword">COMPILE</a> <a id="3893" class="Keyword">AGDA2HS</a> <a id="3901" href="Peras.Chain.html#3845" class="Function">Chain</a> <a id="3907" class="Symbol">#-}</a>
</pre>-->
<pre class="Agda"><a id="certsFromChain"></a><a id="3928" href="Peras.Chain.html#3928" class="Function">certsFromChain</a> <a id="3943" class="Symbol">:</a> <a id="3945" href="Peras.Chain.html#3845" class="Function">Chain</a> <a id="3951" class="Symbol">→</a> <a id="3953" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3958" href="Peras.Block.html#3007" class="Record">Certificate</a>
<a id="3970" href="Peras.Chain.html#3928" class="Function">certsFromChain</a> <a id="3985" class="Symbol">=</a> <a id="3987" href="Data.List.Base.html#1716" class="Function">mapMaybe</a> <a id="3996" href="Peras.Block.html#3484" class="Field">certificate</a>
</pre>
<h3 id="chain-prefix">Chain prefix</h3>
<pre class="Agda"><a id="4038" class="Keyword">data</a> <a id="_⪯_"></a><a id="4043" href="Peras.Chain.html#4043" class="Datatype Operator">_⪯_</a> <a id="4047" class="Symbol">:</a> <a id="4049" href="Peras.Chain.html#3845" class="Function">Chain</a> <a id="4055" class="Symbol">→</a> <a id="4057" href="Peras.Chain.html#3845" class="Function">Chain</a> <a id="4063" class="Symbol">→</a> <a id="4065" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="4069" class="Keyword">where</a>

  <a id="_⪯_.Prefix"></a><a id="4078" href="Peras.Chain.html#4078" class="InductiveConstructor">Prefix</a> <a id="4085" class="Symbol">:</a> <a id="4087" class="Symbol">∀</a> <a id="4089" class="Symbol">{</a><a id="4090" href="Peras.Chain.html#4090" class="Bound">c₁</a> <a id="4093" href="Peras.Chain.html#4093" class="Bound">c₂</a> <a id="4096" href="Peras.Chain.html#4096" class="Bound">c₃</a> <a id="4099" class="Symbol">:</a> <a id="4101" href="Peras.Chain.html#3845" class="Function">Chain</a><a id="4106" class="Symbol">}</a>
    <a id="4112" class="Symbol">→</a> <a id="4114" href="Peras.Chain.html#4090" class="Bound">c₁</a> <a id="4117" href="Haskell.Prim.List.html#310" class="Function Operator">++</a> <a id="4120" href="Peras.Chain.html#4096" class="Bound">c₃</a> <a id="4123" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="4125" href="Peras.Chain.html#4093" class="Bound">c₂</a>
    <a id="4132" class="Symbol">→</a> <a id="4134" href="Peras.Chain.html#4090" class="Bound">c₁</a> <a id="4137" href="Peras.Chain.html#4043" class="Datatype Operator">⪯</a> <a id="4139" href="Peras.Chain.html#4093" class="Bound">c₂</a>
</pre>
<h3 id="chain-pruning">Chain pruning</h3>
<pre class="Agda"><a id="prune"></a><a id="4174" href="Peras.Chain.html#4174" class="Function">prune</a> <a id="4180" class="Symbol">:</a> <a id="4182" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="4193" class="Symbol">→</a> <a id="4195" href="Peras.Chain.html#3845" class="Function">Chain</a> <a id="4201" class="Symbol">→</a> <a id="4203" href="Peras.Chain.html#3845" class="Function">Chain</a>
<a id="4209" href="Peras.Chain.html#4174" class="Function">prune</a> <a id="4215" class="Symbol">(</a><a id="4216" href="Peras.Numbering.html#779" class="InductiveConstructor">MkSlotNumber</a> <a id="4229" href="Peras.Chain.html#4229" class="Bound">sl</a><a id="4231" class="Symbol">)</a> <a id="4233" class="Symbol">=</a> <a id="4235" href="Data.List.Base.html#10878" class="Function">filter</a> <a id="4242" class="Symbol">((</a><a id="4244" href="Data.Nat.Properties.html#6146" class="Function Operator">_≤?</a> <a id="4248" href="Peras.Chain.html#4229" class="Bound">sl</a><a id="4250" class="Symbol">)</a> <a id="4252" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4254" href="Peras.Block.html#3623" class="Function">slotNumber&#39;</a><a id="4265" class="Symbol">)</a>
</pre>
<h3 id="chain-weight">Chain weight</h3>
The weight of a chain is defined with respect of the Peras parameters
<pre class="Agda"><a id="4367" class="Keyword">open</a> <a id="4372" href="Peras.Params.html#166" class="Module">Params</a> <a id="4379" class="Symbol">⦃...⦄</a>
</pre>
<pre class="Agda"><a id="4398" class="Keyword">module</a> <a id="4405" href="Peras.Chain.html#4405" class="Module">_</a> <a id="4407" class="Symbol">⦃</a> <a id="4409" href="Peras.Chain.html#4409" class="Bound">_</a> <a id="4411" class="Symbol">:</a> <a id="4413" href="Peras.Crypto.html#1994" class="Record">Hashable</a> <a id="4422" href="Peras.Block.html#2965" class="Record">Block</a> <a id="4428" class="Symbol">⦄</a>
         <a id="4439" class="Keyword">where</a>

  <a id="4448" class="Keyword">open</a> <a id="4453" href="Peras.Crypto.html#1994" class="Module">Hashable</a> <a id="4462" class="Symbol">⦃...⦄</a>

  <a id="4471" href="Peras.Chain.html#4471" class="Function">ChainExtends</a> <a id="4484" class="Symbol">:</a> <a id="4486" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="4491" href="Peras.Block.html#2965" class="Record">Block</a> <a id="4497" class="Symbol">→</a> <a id="4499" href="Peras.Block.html#3007" class="Record">Certificate</a> <a id="4511" class="Symbol">→</a> <a id="4513" href="Peras.Chain.html#3845" class="Function">Chain</a> <a id="4519" class="Symbol">→</a> <a id="4521" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="4527" href="Peras.Chain.html#4471" class="Function">ChainExtends</a> <a id="4540" href="Peras.Chain.html#4540" class="Bound">h</a> <a id="4542" href="Peras.Chain.html#4542" class="Bound">c</a> <a id="4544" class="Symbol">=</a>
    <a id="4550" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="4554" class="Symbol">(λ</a> <a id="4557" href="Peras.Chain.html#4557" class="Bound">block</a> <a id="4563" class="Symbol">→</a> <a id="4565" class="Symbol">(</a><a id="4566" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="4571" href="Peras.Chain.html#4557" class="Bound">block</a> <a id="4577" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="4579" href="Peras.Block.html#3134" class="Field">blockRef</a> <a id="4588" href="Peras.Chain.html#4542" class="Bound">c</a><a id="4589" class="Symbol">))</a>
      <a id="4598" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4600" href="Data.List.Base.html#10622" class="Function">Data.List.dropWhile</a> <a id="4620" class="Symbol">(λ</a> <a id="4623" href="Peras.Chain.html#4623" class="Bound">block&#39;</a> <a id="4630" class="Symbol">→</a> <a id="4632" href="Relation.Nullary.Decidable.Core.html#2517" class="Function">¬?</a> <a id="4635" class="Symbol">(</a><a id="4636" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="4641" href="Peras.Chain.html#4623" class="Bound">block&#39;</a> <a id="4648" href="Peras.Block.html#3700" class="Function Operator">≟-BlockHash</a> <a id="4660" href="Peras.Chain.html#4540" class="Bound">h</a><a id="4661" class="Symbol">))</a>

  <a id="4667" href="Peras.Chain.html#4667" class="Function">ChainExtends?</a> <a id="4681" class="Symbol">:</a> <a id="4683" class="Symbol">(</a><a id="4684" href="Peras.Chain.html#4684" class="Bound">h</a> <a id="4686" class="Symbol">:</a> <a id="4688" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="4693" href="Peras.Block.html#2965" class="Record">Block</a><a id="4698" class="Symbol">)</a> <a id="4700" class="Symbol">→</a> <a id="4702" class="Symbol">(</a><a id="4703" href="Peras.Chain.html#4703" class="Bound">c</a> <a id="4705" class="Symbol">:</a> <a id="4707" href="Peras.Block.html#3007" class="Record">Certificate</a><a id="4718" class="Symbol">)</a> <a id="4720" class="Symbol">→</a> <a id="4722" class="Symbol">(</a><a id="4723" href="Peras.Chain.html#4723" class="Bound">chain</a> <a id="4729" class="Symbol">:</a> <a id="4731" href="Peras.Chain.html#3845" class="Function">Chain</a><a id="4736" class="Symbol">)</a> <a id="4738" class="Symbol">→</a> <a id="4740" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="4744" class="Symbol">(</a><a id="4745" href="Peras.Chain.html#4471" class="Function">ChainExtends</a> <a id="4758" href="Peras.Chain.html#4684" class="Bound">h</a> <a id="4760" href="Peras.Chain.html#4703" class="Bound">c</a> <a id="4762" href="Peras.Chain.html#4723" class="Bound">chain</a><a id="4767" class="Symbol">)</a>
  <a id="4771" href="Peras.Chain.html#4667" class="Function">ChainExtends?</a> <a id="4785" href="Peras.Chain.html#4785" class="Bound">h</a> <a id="4787" href="Peras.Chain.html#4787" class="Bound">c</a> <a id="4789" class="Symbol">=</a>
    <a id="4795" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a> <a id="4800" class="Symbol">(λ</a> <a id="4803" href="Peras.Chain.html#4803" class="Bound">block</a> <a id="4809" class="Symbol">→</a> <a id="4811" class="Symbol">(</a><a id="4812" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="4817" href="Peras.Chain.html#4803" class="Bound">block</a> <a id="4823" href="Peras.Block.html#3700" class="Function Operator">≟-BlockHash</a> <a id="4835" href="Peras.Block.html#3134" class="Field">blockRef</a> <a id="4844" href="Peras.Chain.html#4787" class="Bound">c</a><a id="4845" class="Symbol">))</a>
      <a id="4854" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4856" href="Data.List.Base.html#10622" class="Function">Data.List.dropWhile</a> <a id="4876" class="Symbol">(λ</a> <a id="4879" href="Peras.Chain.html#4879" class="Bound">block&#39;</a> <a id="4886" class="Symbol">→</a> <a id="4888" href="Relation.Nullary.Decidable.Core.html#2517" class="Function">¬?</a> <a id="4891" class="Symbol">(</a><a id="4892" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="4897" href="Peras.Chain.html#4879" class="Bound">block&#39;</a> <a id="4904" href="Peras.Block.html#3700" class="Function Operator">≟-BlockHash</a> <a id="4916" href="Peras.Chain.html#4785" class="Bound">h</a><a id="4917" class="Symbol">))</a>

  <a id="4923" href="Peras.Chain.html#4923" class="Function">Extends</a> <a id="4931" class="Symbol">:</a> <a id="4933" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="4938" href="Peras.Block.html#2965" class="Record">Block</a> <a id="4944" class="Symbol">→</a> <a id="4946" href="Peras.Block.html#3007" class="Record">Certificate</a> <a id="4958" class="Symbol">→</a> <a id="4960" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4965" href="Peras.Chain.html#3845" class="Function">Chain</a> <a id="4971" class="Symbol">→</a> <a id="4973" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="4979" href="Peras.Chain.html#4923" class="Function">Extends</a> <a id="4987" href="Peras.Chain.html#4987" class="Bound">h</a> <a id="4989" href="Peras.Chain.html#4989" class="Bound">c</a> <a id="4991" class="Symbol">=</a> <a id="4993" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="4997" class="Symbol">(</a><a id="4998" href="Peras.Chain.html#4471" class="Function">ChainExtends</a> <a id="5011" href="Peras.Chain.html#4987" class="Bound">h</a> <a id="5013" href="Peras.Chain.html#4989" class="Bound">c</a><a id="5014" class="Symbol">)</a>

  <a id="5019" href="Peras.Chain.html#5019" class="Function">Extends?</a> <a id="5028" class="Symbol">:</a> <a id="5030" class="Symbol">(</a><a id="5031" href="Peras.Chain.html#5031" class="Bound">h</a> <a id="5033" class="Symbol">:</a> <a id="5035" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="5040" href="Peras.Block.html#2965" class="Record">Block</a><a id="5045" class="Symbol">)</a> <a id="5047" class="Symbol">→</a> <a id="5049" class="Symbol">(</a><a id="5050" href="Peras.Chain.html#5050" class="Bound">c</a> <a id="5052" class="Symbol">:</a> <a id="5054" href="Peras.Block.html#3007" class="Record">Certificate</a><a id="5065" class="Symbol">)</a> <a id="5067" class="Symbol">→</a> <a id="5069" class="Symbol">(</a><a id="5070" href="Peras.Chain.html#5070" class="Bound">chains</a> <a id="5077" class="Symbol">:</a> <a id="5079" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5084" href="Peras.Chain.html#3845" class="Function">Chain</a><a id="5089" class="Symbol">)</a> <a id="5091" class="Symbol">→</a> <a id="5093" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="5097" class="Symbol">(</a><a id="5098" href="Peras.Chain.html#4923" class="Function">Extends</a> <a id="5106" href="Peras.Chain.html#5031" class="Bound">h</a> <a id="5108" href="Peras.Chain.html#5050" class="Bound">c</a> <a id="5110" href="Peras.Chain.html#5070" class="Bound">chains</a><a id="5116" class="Symbol">)</a>
  <a id="5120" href="Peras.Chain.html#5019" class="Function">Extends?</a> <a id="5129" href="Peras.Chain.html#5129" class="Bound">h</a> <a id="5131" href="Peras.Chain.html#5131" class="Bound">c</a> <a id="5133" class="Symbol">=</a> <a id="5135" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a> <a id="5140" class="Symbol">(</a><a id="5141" href="Peras.Chain.html#4667" class="Function">ChainExtends?</a> <a id="5155" href="Peras.Chain.html#5129" class="Bound">h</a> <a id="5157" href="Peras.Chain.html#5131" class="Bound">c</a><a id="5158" class="Symbol">)</a>
</pre>
<pre class="Agda">  <a id="5175" href="Peras.Chain.html#5175" class="Function">tipHash</a> <a id="5183" class="Symbol">:</a> <a id="5185" href="Peras.Chain.html#3845" class="Function">Chain</a> <a id="5191" class="Symbol">→</a> <a id="5193" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="5198" href="Peras.Block.html#2965" class="Record">Block</a>
  <a id="5206" href="Peras.Chain.html#5175" class="Function">tipHash</a> <a id="5214" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="5217" class="Symbol">=</a> <a id="5219" class="Keyword">record</a> <a id="5226" class="Symbol">{</a> <a id="5228" href="Peras.Crypto.html#1598" class="Field">hashBytes</a> <a id="5238" class="Symbol">=</a> <a id="5240" href="Peras.Crypto.html#676" class="Postulate">emptyBS</a> <a id="5248" class="Symbol">}</a>
  <a id="5252" href="Peras.Chain.html#5175" class="Function">tipHash</a> <a id="5260" class="Symbol">(</a><a id="5261" href="Peras.Chain.html#5261" class="Bound">b</a> <a id="5263" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5265" class="Symbol">_)</a> <a id="5268" class="Symbol">=</a> <a id="5270" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="5275" href="Peras.Chain.html#5261" class="Bound">b</a>
</pre>
The weight of a chain is computed wrt to a set of dangling votes
<pre class="Agda"><a id="5355" class="Keyword">module</a> <a id="5362" href="Peras.Chain.html#5362" class="Module">_</a> <a id="5364" class="Symbol">⦃</a> <a id="5366" href="Peras.Chain.html#5366" class="Bound">_</a> <a id="5368" class="Symbol">:</a> <a id="5370" href="Peras.Crypto.html#1994" class="Record">Hashable</a> <a id="5379" href="Peras.Block.html#2965" class="Record">Block</a> <a id="5385" class="Symbol">⦄</a>
         <a id="5396" class="Symbol">⦃</a> <a id="5398" href="Peras.Chain.html#5398" class="Bound">_</a> <a id="5400" class="Symbol">:</a> <a id="5402" href="Peras.Params.html#166" class="Record">Params</a> <a id="5409" class="Symbol">⦄</a>
         <a id="5420" class="Keyword">where</a>
</pre>
<pre class="Agda">  <a id="5440" class="Keyword">open</a> <a id="5445" href="Peras.Crypto.html#1994" class="Module">Hashable</a> <a id="5454" class="Symbol">⦃...⦄</a>
</pre>
<pre class="Agda">  <a id="5474" href="Peras.Chain.html#5474" class="Function Operator">_PointsInto_</a> <a id="5487" class="Symbol">:</a> <a id="5489" href="Peras.Block.html#3007" class="Record">Certificate</a> <a id="5501" class="Symbol">→</a> <a id="5503" href="Peras.Chain.html#3845" class="Function">Chain</a> <a id="5509" class="Symbol">→</a> <a id="5511" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="5517" href="Peras.Chain.html#5474" class="Function Operator">_PointsInto_</a> <a id="5530" href="Peras.Chain.html#5530" class="Bound">c</a> <a id="5532" class="Symbol">=</a> <a id="5534" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="5538" class="Symbol">((</a><a id="5540" href="Peras.Block.html#3134" class="Field">blockRef</a> <a id="5549" href="Peras.Chain.html#5530" class="Bound">c</a> <a id="5551" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡_</a><a id="5553" class="Symbol">)</a> <a id="5555" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="5557" href="Peras.Crypto.html#2033" class="Field">hash</a><a id="5561" class="Symbol">)</a>
</pre>
<pre class="Agda">  <a id="5577" href="Peras.Chain.html#5577" class="Function Operator">_PointsInto?_</a> <a id="5591" class="Symbol">:</a> <a id="5593" class="Symbol">∀</a> <a id="5595" class="Symbol">(</a><a id="5596" href="Peras.Chain.html#5596" class="Bound">c</a> <a id="5598" class="Symbol">:</a> <a id="5600" href="Peras.Block.html#3007" class="Record">Certificate</a><a id="5611" class="Symbol">)</a> <a id="5613" class="Symbol">→</a> <a id="5615" class="Symbol">(</a><a id="5616" href="Peras.Chain.html#5616" class="Bound">ch</a> <a id="5619" class="Symbol">:</a> <a id="5621" href="Peras.Chain.html#3845" class="Function">Chain</a><a id="5626" class="Symbol">)</a> <a id="5628" class="Symbol">→</a> <a id="5630" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="5634" class="Symbol">(</a><a id="5635" href="Peras.Chain.html#5596" class="Bound">c</a> <a id="5637" href="Peras.Chain.html#5474" class="Function Operator">PointsInto</a> <a id="5648" href="Peras.Chain.html#5616" class="Bound">ch</a><a id="5650" class="Symbol">)</a>
  <a id="5654" href="Peras.Chain.html#5577" class="Function Operator">_PointsInto?_</a> <a id="5668" href="Peras.Chain.html#5668" class="Bound">c</a> <a id="5670" class="Symbol">=</a> <a id="5672" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a> <a id="5677" class="Symbol">((</a><a id="5679" href="Peras.Block.html#3134" class="Field">blockRef</a> <a id="5688" href="Peras.Chain.html#5668" class="Bound">c</a> <a id="5690" href="Peras.Block.html#3700" class="Function Operator">≟-BlockHash_</a><a id="5702" class="Symbol">)</a> <a id="5704" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="5706" href="Peras.Crypto.html#2033" class="Field">hash</a><a id="5710" class="Symbol">)</a>
</pre>
<pre class="Agda">  <a id="5726" href="Peras.Chain.html#5726" class="Function">StartOfRound</a> <a id="5739" class="Symbol">:</a> <a id="5741" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="5752" class="Symbol">→</a> <a id="5754" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="5766" class="Symbol">→</a> <a id="5768" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="5774" href="Peras.Chain.html#5726" class="Function">StartOfRound</a> <a id="5787" class="Symbol">(</a><a id="5788" href="Peras.Numbering.html#779" class="InductiveConstructor">MkSlotNumber</a> <a id="5801" href="Peras.Chain.html#5801" class="Bound">sl</a><a id="5803" class="Symbol">)</a> <a id="5805" class="Symbol">(</a><a id="5806" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="5820" href="Peras.Chain.html#5820" class="Bound">r</a><a id="5821" class="Symbol">)</a> <a id="5823" class="Symbol">=</a> <a id="5825" href="Peras.Chain.html#5801" class="Bound">sl</a> <a id="5828" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5830" href="Peras.Chain.html#5820" class="Bound">r</a> <a id="5832" href="Haskell.Prim.Num.html#632" class="Field Operator">*</a> <a id="5834" href="Peras.Params.html#193" class="Field">U</a>
</pre>
<pre class="Agda">  <a id="5850" href="Peras.Chain.html#5850" class="Function">StartOfRound?</a> <a id="5864" class="Symbol">:</a> <a id="5866" class="Symbol">(</a><a id="5867" href="Peras.Chain.html#5867" class="Bound">sl</a> <a id="5870" class="Symbol">:</a> <a id="5872" href="Peras.Numbering.html#742" class="Record">SlotNumber</a><a id="5882" class="Symbol">)</a> <a id="5884" class="Symbol">→</a> <a id="5886" class="Symbol">(</a><a id="5887" href="Peras.Chain.html#5887" class="Bound">r</a> <a id="5889" class="Symbol">:</a> <a id="5891" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a><a id="5902" class="Symbol">)</a> <a id="5904" class="Symbol">→</a> <a id="5906" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="5910" class="Symbol">(</a><a id="5911" href="Peras.Chain.html#5726" class="Function">StartOfRound</a> <a id="5924" href="Peras.Chain.html#5867" class="Bound">sl</a> <a id="5927" href="Peras.Chain.html#5887" class="Bound">r</a><a id="5928" class="Symbol">)</a>
  <a id="5932" href="Peras.Chain.html#5850" class="Function">StartOfRound?</a> <a id="5946" class="Symbol">(</a><a id="5947" href="Peras.Numbering.html#779" class="InductiveConstructor">MkSlotNumber</a> <a id="5960" href="Peras.Chain.html#5960" class="Bound">sl</a><a id="5962" class="Symbol">)</a> <a id="5964" class="Symbol">(</a><a id="5965" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="5979" href="Peras.Chain.html#5979" class="Bound">r</a><a id="5980" class="Symbol">)</a> <a id="5982" class="Symbol">=</a> <a id="5984" href="Peras.Chain.html#5960" class="Bound">sl</a> <a id="5987" href="Data.Nat.Properties.html#3311" class="Function Operator">≟</a> <a id="5989" href="Peras.Chain.html#5979" class="Bound">r</a> <a id="5991" href="Haskell.Prim.Num.html#632" class="Field Operator">*</a> <a id="5993" href="Peras.Params.html#193" class="Field">U</a>
</pre>
<pre class="Agda">  <a id="6009" href="Peras.Chain.html#6009" class="Function">rnd</a> <a id="6013" class="Symbol">:</a> <a id="6015" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="6017" class="Symbol">→</a> <a id="6019" class="Symbol">⦃</a> <a id="6021" href="Peras.Chain.html#6021" class="Symbol">_</a> <a id="6023" class="Symbol">:</a> <a id="6025" href="Data.Nat.Base.html#3260" class="Record">NonZero</a> <a id="6033" href="Peras.Params.html#193" class="Field">U</a> <a id="6035" class="Symbol">⦄</a> <a id="6037" class="Symbol">→</a> <a id="6039" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
  <a id="6043" href="Peras.Chain.html#6009" class="Function">rnd</a> <a id="6047" href="Peras.Chain.html#6047" class="Bound">s</a> <a id="6049" class="Symbol">=</a> <a id="6051" href="Peras.Chain.html#6047" class="Bound">s</a> <a id="6053" href="Data.Nat.Base.html#7096" class="Function Operator">/</a> <a id="6055" href="Peras.Params.html#193" class="Field">U</a>
</pre>
<pre class="Agda">  <a id="6071" href="Peras.Chain.html#6071" class="Function">v-round</a> <a id="6079" class="Symbol">:</a> <a id="6081" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="6092" class="Symbol">→</a> <a id="6094" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a>
  <a id="6108" href="Peras.Chain.html#6071" class="Function">v-round</a> <a id="6116" class="Symbol">(</a><a id="6117" href="Peras.Numbering.html#779" class="InductiveConstructor">MkSlotNumber</a> <a id="6130" href="Peras.Chain.html#6130" class="Bound">s</a><a id="6131" class="Symbol">)</a> <a id="6133" class="Symbol">=</a> <a id="6135" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="6149" class="Symbol">(</a><a id="6150" href="Peras.Chain.html#6009" class="Function">rnd</a> <a id="6154" href="Peras.Chain.html#6130" class="Bound">s</a><a id="6155" class="Symbol">)</a>
</pre>
<h3 id="chain-weight-1">Chain weight</h3>
<pre class="Agda">  <a id="6189" href="Peras.Chain.html#6189" class="Function Operator">∥_∥_</a> <a id="6194" class="Symbol">:</a> <a id="6196" href="Peras.Chain.html#3845" class="Function">Chain</a> <a id="6202" class="Symbol">→</a> <a id="6204" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6209" href="Peras.Block.html#3007" class="Record">Certificate</a> <a id="6221" class="Symbol">→</a> <a id="6223" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
  <a id="6227" href="Peras.Chain.html#6189" class="Function Operator">∥</a> <a id="6229" href="Peras.Chain.html#6229" class="Bound">ch</a> <a id="6232" href="Peras.Chain.html#6189" class="Function Operator">∥</a> <a id="6234" href="Peras.Chain.html#6234" class="Bound">cts</a> <a id="6238" class="Symbol">=</a> <a id="6240" href="Peras.Chain.html#210" class="Function Operator">∣</a> <a id="6242" href="Peras.Chain.html#6229" class="Bound">ch</a> <a id="6245" href="Peras.Chain.html#210" class="Function Operator">∣</a> <a id="6247" href="Haskell.Prim.Num.html#547" class="Field Operator">+</a> <a id="6249" href="Peras.Chain.html#210" class="Function Operator">∣</a> <a id="6251" href="Data.List.Base.html#10878" class="Function">filter</a> <a id="6258" class="Symbol">(</a><a id="6259" href="Peras.Chain.html#5577" class="Function Operator">_PointsInto?</a> <a id="6272" href="Peras.Chain.html#6229" class="Bound">ch</a><a id="6274" class="Symbol">)</a> <a id="6276" href="Peras.Chain.html#6234" class="Bound">cts</a> <a id="6280" href="Peras.Chain.html#210" class="Function Operator">∣</a> <a id="6282" href="Haskell.Prim.Num.html#632" class="Field Operator">*</a> <a id="6284" href="Peras.Params.html#277" class="Field">B</a>
</pre>
<h3 id="chain-validity">Chain validity</h3>
<!--
<pre class="Agda"><a id="6324" class="Keyword">open</a> <a id="6329" class="Keyword">import</a> <a id="6336" href="Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="6362" class="Keyword">using</a> <a id="6368" class="Symbol">(</a><a id="6369" href="Relation.Nullary.Negation.Core.html#698" class="Function Operator">¬_</a><a id="6371" class="Symbol">)</a>

<a id="6374" class="Keyword">import</a> <a id="6381" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="6419" class="Symbol">as</a> <a id="6422" class="Module">PropEq</a>
<a id="6429" class="Keyword">open</a> <a id="6434" href="Relation.Binary.PropositionalEquality.html" class="Module">PropEq</a> <a id="6441" class="Keyword">using</a> <a id="6447" class="Symbol">(</a><a id="6448" href="Relation.Binary.PropositionalEquality.Core.html#1757" class="Function">trans</a><a id="6453" class="Symbol">)</a>

<a id="6456" class="Keyword">open</a> <a id="6461" href="Peras.Block.html#2965" class="Module">Block</a>

<a id="6468" class="Keyword">open</a> <a id="6473" class="Keyword">import</a> <a id="6480" href="Data.List.Membership.Propositional.html" class="Module">Data.List.Membership.Propositional</a> <a id="6515" class="Keyword">using</a> <a id="6521" class="Symbol">(</a><a id="6522" href="Data.List.Membership.Setoid.html#950" class="Function Operator">_∈_</a><a id="6525" class="Symbol">)</a>
</pre>-->
<pre class="Agda"><a id="6543" class="Keyword">module</a> <a id="6550" href="Peras.Chain.html#6550" class="Module">_</a> <a id="6552" class="Symbol">⦃</a> <a id="6554" href="Peras.Chain.html#6554" class="Bound">_</a> <a id="6556" class="Symbol">:</a> <a id="6558" href="Peras.Crypto.html#1994" class="Record">Hashable</a> <a id="6567" href="Peras.Block.html#2965" class="Record">Block</a> <a id="6573" class="Symbol">⦄</a>
         <a id="6584" class="Symbol">⦃</a> <a id="6586" href="Peras.Chain.html#6586" class="Bound">_</a> <a id="6588" class="Symbol">:</a> <a id="6590" href="Peras.Chain.html#2776" class="Record">Postulates</a> <a id="6601" class="Symbol">⦄</a>
         <a id="6612" class="Symbol">⦃</a> <a id="6614" href="Peras.Chain.html#6614" class="Bound">_</a> <a id="6616" class="Symbol">:</a> <a id="6618" href="Peras.Chain.html#3042" class="Record">Network</a> <a id="6626" class="Symbol">⦄</a>

         <a id="6638" class="Keyword">where</a>

  <a id="6647" class="Keyword">open</a> <a id="6652" href="Peras.Crypto.html#1994" class="Module">Hashable</a> <a id="6661" class="Symbol">⦃...⦄</a>
  <a id="6669" class="Keyword">open</a> <a id="6674" href="Peras.Chain.html#2776" class="Module">Postulates</a> <a id="6685" class="Symbol">⦃...⦄</a>
  <a id="6693" class="Keyword">open</a> <a id="6698" href="Peras.Chain.html#3042" class="Module">Network</a> <a id="6706" class="Symbol">⦃...⦄</a>
</pre>
<pre class="Agda">  <a id="6726" class="Keyword">data</a> <a id="6731" href="Peras.Chain.html#6731" class="Datatype">ValidChain</a> <a id="6742" class="Symbol">:</a> <a id="6744" href="Peras.Chain.html#3845" class="Function">Chain</a> <a id="6750" class="Symbol">→</a> <a id="6752" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="6756" class="Keyword">where</a>

    <a id="6767" href="Peras.Chain.html#6767" class="InductiveConstructor">Genesis</a> <a id="6775" class="Symbol">:</a> <a id="6777" href="Peras.Chain.html#6731" class="Datatype">ValidChain</a> <a id="6788" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

    <a id="6796" href="Peras.Chain.html#6796" class="InductiveConstructor">Cons</a> <a id="6801" class="Symbol">:</a> <a id="6803" class="Symbol">∀</a> <a id="6805" class="Symbol">{</a><a id="6806" href="Peras.Chain.html#6806" class="Bound">c</a> <a id="6808" class="Symbol">:</a> <a id="6810" href="Peras.Chain.html#3845" class="Function">Chain</a><a id="6815" class="Symbol">}</a> <a id="6817" class="Symbol">{</a><a id="6818" href="Peras.Chain.html#6818" class="Bound">b</a> <a id="6820" class="Symbol">:</a> <a id="6822" href="Peras.Block.html#2965" class="Record">Block</a><a id="6827" class="Symbol">}</a>
      <a id="6835" class="Symbol">→</a> <a id="6837" href="Peras.Chain.html#2946" class="Field">IsBlockSignature</a> <a id="6854" href="Peras.Chain.html#6818" class="Bound">b</a> <a id="6856" class="Symbol">(</a><a id="6857" href="Peras.Block.html#3566" class="Field">signature</a> <a id="6867" href="Peras.Chain.html#6818" class="Bound">b</a><a id="6868" class="Symbol">)</a>
      <a id="6876" class="Symbol">→</a> <a id="6878" href="Peras.Chain.html#2812" class="Field">IsSlotLeader</a> <a id="6891" class="Symbol">(</a><a id="6892" href="Peras.Block.html#3423" class="Field">creatorId</a> <a id="6902" href="Peras.Chain.html#6818" class="Bound">b</a><a id="6903" class="Symbol">)</a> <a id="6905" class="Symbol">(</a><a id="6906" href="Peras.Block.html#3391" class="Field">slotNumber</a> <a id="6917" href="Peras.Chain.html#6818" class="Bound">b</a><a id="6918" class="Symbol">)</a> <a id="6920" class="Symbol">(</a><a id="6921" href="Peras.Block.html#3524" class="Field">leadershipProof</a> <a id="6937" href="Peras.Chain.html#6818" class="Bound">b</a><a id="6938" class="Symbol">)</a>
      <a id="6946" class="Symbol">→</a> <a id="6948" href="Peras.Block.html#3451" class="Field">parentBlock</a> <a id="6960" href="Peras.Chain.html#6818" class="Bound">b</a> <a id="6962" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6964" href="Peras.Chain.html#5175" class="Function">tipHash</a> <a id="6972" href="Peras.Chain.html#6806" class="Bound">c</a>
      <a id="6980" class="Symbol">→</a> <a id="6982" href="Peras.Chain.html#6731" class="Datatype">ValidChain</a> <a id="6993" href="Peras.Chain.html#6806" class="Bound">c</a>
      <a id="7001" class="Symbol">→</a> <a id="7003" href="Peras.Chain.html#6731" class="Datatype">ValidChain</a> <a id="7014" class="Symbol">(</a><a id="7015" href="Peras.Chain.html#6818" class="Bound">b</a> <a id="7017" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7019" href="Peras.Chain.html#6806" class="Bound">c</a><a id="7020" class="Symbol">)</a>
</pre>
<!--
<pre class="Agda"><a id="7039" class="Comment">-- | `foldl` does not exist in `Haskell.Prelude` so let&#39;s roll our own</a>
<a id="7110" class="Comment">-- but let&#39;s make it total.</a>
<a id="foldl1Maybe"></a><a id="7138" href="Peras.Chain.html#7138" class="Function">foldl1Maybe</a> <a id="7150" class="Symbol">:</a> <a id="7152" class="Symbol">∀</a> <a id="7154" class="Symbol">{</a><a id="7155" href="Peras.Chain.html#7155" class="Bound">a</a> <a id="7157" class="Symbol">:</a> <a id="7159" href="Agda.Primitive.html#388" class="Primitive">Set</a><a id="7162" class="Symbol">}</a> <a id="7164" class="Symbol">-&gt;</a> <a id="7167" class="Symbol">(</a><a id="7168" href="Peras.Chain.html#7155" class="Bound">a</a> <a id="7170" class="Symbol">-&gt;</a> <a id="7173" href="Peras.Chain.html#7155" class="Bound">a</a> <a id="7175" class="Symbol">-&gt;</a> <a id="7178" href="Peras.Chain.html#7155" class="Bound">a</a><a id="7179" class="Symbol">)</a> <a id="7181" class="Symbol">-&gt;</a> <a id="7184" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7189" href="Peras.Chain.html#7155" class="Bound">a</a> <a id="7191" class="Symbol">-&gt;</a> <a id="7194" href="Haskell.Prim.Maybe.html#101" class="Datatype">Maybe</a> <a id="7200" href="Peras.Chain.html#7155" class="Bound">a</a>
<a id="7202" href="Peras.Chain.html#7138" class="Function">foldl1Maybe</a> <a id="7214" href="Peras.Chain.html#7214" class="Bound">f</a> <a id="7216" href="Peras.Chain.html#7216" class="Bound">xs</a> <a id="7219" class="Symbol">=</a>
  <a id="7223" href="Haskell.Prim.Foldable.html#566" class="Field">foldl</a> <a id="7229" class="Symbol">(λ</a> <a id="7232" href="Peras.Chain.html#7232" class="Bound">m</a> <a id="7234" href="Peras.Chain.html#7234" class="Bound">y</a> <a id="7236" class="Symbol">-&gt;</a> <a id="7239" href="Haskell.Prim.Maybe.html#162" class="InductiveConstructor">Just</a> <a id="7244" class="Symbol">(</a><a id="7245" href="Haskell.Prim.html#1609" class="Function Operator">case</a> <a id="7250" href="Peras.Chain.html#7232" class="Bound">m</a> <a id="7252" href="Haskell.Prim.html#1609" class="Function Operator">of</a> <a id="7255" class="Symbol">λ</a> <a id="7257" class="Keyword">where</a>
                             <a id="7292" href="Haskell.Prim.Maybe.html#142" class="InductiveConstructor">Nothing</a> <a id="7300" class="Symbol">-&gt;</a> <a id="7303" href="Peras.Chain.html#7234" class="Bound">y</a>
                             <a id="7334" class="Symbol">(</a><a id="7335" href="Haskell.Prim.Maybe.html#162" class="InductiveConstructor">Just</a> <a id="7340" href="Peras.Chain.html#7340" class="Bound">x</a><a id="7341" class="Symbol">)</a>  <a id="7344" class="Symbol">-&gt;</a> <a id="7347" href="Peras.Chain.html#7214" class="Bound">f</a> <a id="7349" href="Peras.Chain.html#7340" class="Bound">x</a> <a id="7351" href="Peras.Chain.html#7234" class="Bound">y</a><a id="7352" class="Symbol">))</a>
        <a id="7363" href="Haskell.Prim.Maybe.html#142" class="InductiveConstructor">Nothing</a> <a id="7371" href="Peras.Chain.html#7216" class="Bound">xs</a>

<a id="7375" class="Symbol">{-#</a> <a id="7379" class="Keyword">COMPILE</a> <a id="7387" class="Keyword">AGDA2HS</a> <a id="7395" href="Peras.Chain.html#7138" class="Function">foldl1Maybe</a> <a id="7407" class="Symbol">#-}</a>

<a id="prefix"></a><a id="7412" href="Peras.Chain.html#7412" class="Function">prefix</a> <a id="7419" class="Symbol">:</a> <a id="7421" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7426" href="Peras.Block.html#2965" class="Record">Block</a> <a id="7432" class="Symbol">-&gt;</a> <a id="7435" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7440" href="Peras.Block.html#2965" class="Record">Block</a> <a id="7446" class="Symbol">-&gt;</a> <a id="7449" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7454" href="Peras.Block.html#2965" class="Record">Block</a> <a id="7460" class="Symbol">-&gt;</a> <a id="7463" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7468" href="Peras.Block.html#2965" class="Record">Block</a>
<a id="7474" href="Peras.Chain.html#7412" class="Function">prefix</a> <a id="7481" href="Peras.Chain.html#7481" class="Bound">acc</a> <a id="7485" class="Symbol">(</a><a id="7486" href="Peras.Chain.html#7486" class="Bound">x</a> <a id="7488" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7490" href="Peras.Chain.html#7490" class="Bound">xs</a><a id="7492" class="Symbol">)</a> <a id="7494" class="Symbol">(</a><a id="7495" href="Peras.Chain.html#7495" class="Bound">y</a> <a id="7497" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7499" href="Peras.Chain.html#7499" class="Bound">ys</a><a id="7501" class="Symbol">)</a> <a id="7503" class="Symbol">=</a>
  <a id="7507" href="Haskell.Prim.html#1713" class="Function Operator">if</a> <a id="7510" href="Peras.Chain.html#7486" class="Bound">x</a> <a id="7512" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="7515" href="Peras.Chain.html#7495" class="Bound">y</a>
   <a id="7520" href="Haskell.Prim.html#1713" class="Function Operator">then</a> <a id="7525" href="Peras.Chain.html#7412" class="Function">prefix</a> <a id="7532" class="Symbol">(</a><a id="7533" href="Peras.Chain.html#7486" class="Bound">x</a> <a id="7535" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7537" href="Peras.Chain.html#7481" class="Bound">acc</a><a id="7540" class="Symbol">)</a> <a id="7542" href="Peras.Chain.html#7490" class="Bound">xs</a> <a id="7545" href="Peras.Chain.html#7499" class="Bound">ys</a>
   <a id="7551" href="Haskell.Prim.html#1713" class="Function Operator">else</a> <a id="7556" href="Haskell.Prelude.html#3598" class="Function">reverse</a> <a id="7564" href="Peras.Chain.html#7481" class="Bound">acc</a>
<a id="7568" href="Peras.Chain.html#7412" class="CatchallClause Function">prefix</a><a id="7574" class="CatchallClause"> </a><a id="7575" href="Peras.Chain.html#7575" class="CatchallClause Bound">acc</a><a id="7578" class="CatchallClause"> </a><a id="7579" class="CatchallClause Symbol">_</a><a id="7580" class="CatchallClause"> </a><a id="7581" class="CatchallClause Symbol">_</a> <a id="7583" class="Symbol">=</a> <a id="7585" href="Haskell.Prelude.html#3598" class="Function">reverse</a> <a id="7593" href="Peras.Chain.html#7575" class="Bound">acc</a>

<a id="7598" class="Symbol">{-#</a> <a id="7602" class="Keyword">COMPILE</a> <a id="7610" class="Keyword">AGDA2HS</a> <a id="7618" href="Peras.Chain.html#7412" class="Function">prefix</a> <a id="7625" class="Symbol">#-}</a>

<a id="commonPrefix"></a><a id="7630" href="Peras.Chain.html#7630" class="Function">commonPrefix</a> <a id="7643" class="Symbol">:</a> <a id="7645" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7650" href="Peras.Chain.html#3845" class="Function">Chain</a> <a id="7656" class="Symbol">-&gt;</a> <a id="7659" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7664" href="Peras.Block.html#2965" class="Record">Block</a>
<a id="7670" href="Peras.Chain.html#7630" class="Function">commonPrefix</a> <a id="7683" href="Peras.Chain.html#7683" class="Bound">chains</a> <a id="7690" class="Symbol">=</a>
  <a id="7694" href="Haskell.Prim.html#1609" class="Function Operator">case</a> <a id="7699" href="Peras.Chain.html#7783" class="Function">listPrefix</a> <a id="7710" href="Haskell.Prim.html#1609" class="Function Operator">of</a> <a id="7713" class="Symbol">λ</a> <a id="7715" class="Keyword">where</a>
     <a id="7726" href="Haskell.Prim.Maybe.html#142" class="InductiveConstructor">Nothing</a> <a id="7734" class="Symbol">-&gt;</a> <a id="7737" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
     <a id="7745" class="Symbol">(</a><a id="7746" href="Haskell.Prim.Maybe.html#162" class="InductiveConstructor">Just</a> <a id="7751" href="Peras.Chain.html#7751" class="Bound">bs</a><a id="7753" class="Symbol">)</a> <a id="7755" class="Symbol">-&gt;</a> <a id="7758" href="Haskell.Prelude.html#3598" class="Function">reverse</a> <a id="7766" href="Peras.Chain.html#7751" class="Bound">bs</a>
   <a id="7772" class="Keyword">where</a>
     <a id="7783" href="Peras.Chain.html#7783" class="Function">listPrefix</a> <a id="7794" class="Symbol">:</a> <a id="7796" href="Haskell.Prim.Maybe.html#101" class="Datatype">Maybe</a> <a id="7802" class="Symbol">(</a><a id="7803" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7808" href="Peras.Block.html#2965" class="Record">Block</a><a id="7813" class="Symbol">)</a>
     <a id="7820" href="Peras.Chain.html#7783" class="Function">listPrefix</a> <a id="7831" class="Symbol">=</a> <a id="7833" href="Peras.Chain.html#7138" class="Function">foldl1Maybe</a> <a id="7845" class="Symbol">(</a><a id="7846" href="Peras.Chain.html#7412" class="Function">prefix</a> <a id="7853" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="7855" class="Symbol">)</a> <a id="7857" class="Symbol">(</a><a id="7858" href="Haskell.Prim.List.html#211" class="Function">map</a> <a id="7862" class="Symbol">(λ</a> <a id="7865" href="Peras.Chain.html#7865" class="Bound">l</a> <a id="7867" class="Symbol">-&gt;</a> <a id="7870" href="Haskell.Prelude.html#3598" class="Function">reverse</a> <a id="7878" href="Peras.Chain.html#7865" class="Bound">l</a><a id="7879" class="Symbol">)</a> <a id="7881" href="Peras.Chain.html#7683" class="Bound">chains</a><a id="7887" class="Symbol">)</a>

<a id="7890" class="Symbol">{-#</a> <a id="7894" class="Keyword">COMPILE</a> <a id="7902" class="Keyword">AGDA2HS</a> <a id="7910" href="Peras.Chain.html#7630" class="Function">commonPrefix</a> <a id="7923" class="Symbol">#-}</a>

<a id="7928" class="Comment">-- I wish I could prove that and translate it to a QC property in Haskell :)</a>
<a id="8005" class="Comment">-- commonPrefixEq : {t : Set } -&gt; ⦃ eqt : Eq t ⦄ -&gt; (c₁ c₂ : Chain t) -&gt; (c₁ ≡ c₂) -&gt; (commonPrefix (c₁ ∷ c₂ ∷ []) ≡ c₁)</a>
<a id="8126" class="Comment">-- commonPrefixEq = {!!}</a>

<a id="8152" class="Comment">{-
postulate
  verifyLeadershipProof : Block → Bool

  properlyLinked : Chain → Bool
  decreasingSlots : Chain → Bool
-}</a>

<a id="8274" class="Comment">{-
correctBlocks : Chain → Bool
correctBlocks (MkChain blocks _ _) =
  let bs = toList BlockO blocks
  in all verifyLeadershipProof bs
-}</a>
</pre>-->
</body>
</html>
