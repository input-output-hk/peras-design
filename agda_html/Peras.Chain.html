<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Peras.Chain</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="Agda.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre class="Agda"><a id="9" class="Keyword">module</a> <a id="16" href="Peras.Chain.html" class="Module">Peras.Chain</a> <a id="28" class="Keyword">where</a>
</pre>
<!--
<pre class="Agda"><a id="52" class="Keyword">open</a> <a id="57" class="Keyword">import</a> <a id="64" href="Data.Bool.html" class="Module">Data.Bool</a> <a id="74" class="Keyword">using</a> <a id="80" class="Symbol">(</a><a id="81" href="Data.Bool.Base.html#995" class="Function Operator">_∧_</a><a id="84" class="Symbol">;</a> <a id="86" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a><a id="90" class="Symbol">;</a> <a id="92" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a><a id="97" class="Symbol">)</a>
<a id="99" class="Keyword">open</a> <a id="104" class="Keyword">import</a> <a id="111" href="Data.List.html" class="Module">Data.List</a> <a id="121" class="Keyword">using</a> <a id="127" class="Symbol">(</a><a id="128" href="Data.List.Base.html#5003" class="Function">sum</a><a id="131" class="Symbol">;</a> <a id="133" href="Data.List.Base.html#6860" class="Function">upTo</a><a id="137" class="Symbol">;</a> <a id="139" href="Data.List.Base.html#6379" class="Function">applyUpTo</a><a id="148" class="Symbol">;</a> <a id="150" href="Data.List.Base.html#11049" class="Function">filterᵇ</a><a id="157" class="Symbol">;</a> <a id="159" href="Data.List.Base.html#10878" class="Function">filter</a><a id="165" class="Symbol">;</a> <a id="167" href="Data.List.Base.html#4538" class="Function">concat</a><a id="173" class="Symbol">;</a> <a id="175" href="Data.List.Base.html#1878" class="Function">catMaybes</a><a id="184" class="Symbol">;</a> <a id="186" href="Data.List.Base.html#3714" class="Function">zip</a><a id="189" class="Symbol">)</a> <a id="191" class="Keyword">renaming</a> <a id="200" class="Symbol">(</a><a id="201" href="Data.List.Base.html#5083" class="Function">length</a> <a id="208" class="Symbol">to</a> <a id="211" class="Function">∣_∣</a><a id="214" class="Symbol">)</a>
<a id="216" class="Keyword">open</a> <a id="221" class="Keyword">import</a> <a id="228" href="Data.List.Membership.Propositional.html" class="Module">Data.List.Membership.Propositional</a> <a id="263" class="Keyword">using</a> <a id="269" class="Symbol">(</a><a id="270" href="Data.List.Membership.Setoid.html#950" class="Function Operator">_∈_</a><a id="273" class="Symbol">)</a>
<a id="275" class="Keyword">open</a> <a id="280" class="Keyword">import</a> <a id="287" href="Data.List.Relation.Unary.Any.html" class="Module">Data.List.Relation.Unary.Any</a> <a id="316" class="Keyword">using</a> <a id="322" class="Symbol">(</a><a id="323" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a><a id="327" class="Symbol">;</a> <a id="329" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a><a id="332" class="Symbol">;</a> <a id="334" href="Data.List.Relation.Unary.Any.html#1226" class="InductiveConstructor">here</a><a id="338" class="Symbol">;</a> <a id="340" href="Data.List.Relation.Unary.Any.html#1279" class="InductiveConstructor">there</a><a id="345" class="Symbol">;</a> <a id="347" href="Data.List.Relation.Unary.Any.html#1926" class="Function">lookup</a><a id="353" class="Symbol">)</a>
<a id="355" class="Keyword">open</a> <a id="360" class="Keyword">import</a> <a id="367" href="Data.List.Relation.Unary.All.html" class="Module">Data.List.Relation.Unary.All</a> <a id="396" class="Keyword">using</a> <a id="402" class="Symbol">(</a><a id="403" href="Data.List.Relation.Unary.All.html#1627" class="Datatype">All</a><a id="406" class="Symbol">)</a>
<a id="408" class="Keyword">open</a> <a id="413" class="Keyword">import</a> <a id="420" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="431" class="Symbol">as</a> <a id="434" class="Module">M</a> <a id="436" class="Keyword">using</a> <a id="442" class="Symbol">(</a><a id="443" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="450" class="Symbol">;</a> <a id="452" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a><a id="456" class="Symbol">)</a>
<a id="458" class="Keyword">open</a> <a id="463" class="Keyword">import</a> <a id="470" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="479" class="Keyword">using</a> <a id="485" class="Symbol">(</a><a id="486" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="487" class="Symbol">;</a> <a id="489" href="Data.Nat.Base.html#7096" class="Function Operator">_/_</a><a id="492" class="Symbol">;</a> <a id="494" href="Data.Nat.Base.html#2289" class="Function Operator">_&gt;_</a><a id="497" class="Symbol">;</a> <a id="499" href="Data.Nat.Base.html#2259" class="Function Operator">_≥_</a><a id="502" class="Symbol">;</a> <a id="504" href="Data.Nat.Properties.html#6212" class="Function Operator">_≥?_</a><a id="508" class="Symbol">;</a> <a id="510" href="Data.Nat.Properties.html#6146" class="Function Operator">_≤?_</a><a id="514" class="Symbol">;</a> <a id="516" href="Data.Nat.Base.html#3260" class="Record">NonZero</a><a id="523" class="Symbol">;</a> <a id="525" href="Data.Nat.Base.html#5266" class="Function">pred</a><a id="529" class="Symbol">;</a> <a id="531" href="Data.Nat.Base.html#4456" class="Primitive Operator">_∸_</a><a id="534" class="Symbol">;</a> <a id="536" href="Data.Nat.Base.html#1714" class="InductiveConstructor">z≤n</a><a id="539" class="Symbol">;</a> <a id="541" href="Data.Nat.Base.html#1756" class="InductiveConstructor">s≤s</a><a id="544" class="Symbol">)</a>
<a id="546" class="Keyword">open</a> <a id="551" class="Keyword">import</a> <a id="558" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="567" class="Keyword">using</a> <a id="573" class="Symbol">(</a><a id="574" href="Data.Nat.Base.html#1691" class="Datatype Operator">_≤_</a><a id="577" class="Symbol">;</a> <a id="579" href="Data.Nat.Base.html#1801" class="Function Operator">_&lt;_</a><a id="582" class="Symbol">;</a> <a id="584" href="Data.Nat.Base.html#4456" class="Primitive Operator">_∸_</a><a id="587" class="Symbol">)</a>
<a id="589" class="Keyword">open</a> <a id="594" class="Keyword">import</a> <a id="601" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="621" class="Keyword">using</a> <a id="627" class="Symbol">(</a><a id="628" href="Data.Nat.Properties.html#12185" class="Function">n≮n</a><a id="631" class="Symbol">;</a> <a id="633" href="Data.Nat.Properties.html#3311" class="Function Operator">_≟_</a><a id="636" class="Symbol">)</a>
<a id="638" class="Keyword">open</a> <a id="643" class="Keyword">import</a> <a id="650" href="Data.Product.html" class="Module">Data.Product</a> <a id="663" class="Keyword">using</a> <a id="669" class="Symbol">(</a><a id="670" href="Agda.Builtin.Sigma.html#165" class="Record">Σ</a><a id="671" class="Symbol">;</a> <a id="673" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,_</a><a id="676" class="Symbol">;</a> <a id="678" href="Data.Product.Base.html#852" class="Function">∃</a><a id="679" class="Symbol">;</a> <a id="681" href="Data.Product.Base.html#1244" class="Function">Σ-syntax</a><a id="689" class="Symbol">;</a> <a id="691" href="Data.Product.Base.html#1371" class="Function">∃-syntax</a><a id="699" class="Symbol">;</a> <a id="701" href="Data.Product.Base.html#1618" class="Function Operator">_×_</a><a id="704" class="Symbol">;</a> <a id="706" href="Data.Product.Base.html#636" class="Field">proj₁</a><a id="711" class="Symbol">;</a> <a id="713" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="718" class="Symbol">)</a>
<a id="720" class="Keyword">open</a> <a id="725" class="Keyword">import</a> <a id="732" href="Function.Base.html" class="Module">Function.Base</a> <a id="746" class="Keyword">using</a> <a id="752" class="Symbol">(</a><a id="753" href="Function.Base.html#1115" class="Function Operator">_∘_</a><a id="756" class="Symbol">;</a> <a id="758" href="Function.Base.html#1974" class="Function Operator">_$_</a><a id="761" class="Symbol">)</a>
<a id="763" class="Keyword">open</a> <a id="768" class="Keyword">import</a> <a id="775" href="Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="792" class="Keyword">using</a> <a id="798" class="Symbol">(</a><a id="799" href="Relation.Nullary.Negation.Core.html#698" class="Function Operator">¬_</a><a id="801" class="Symbol">;</a> <a id="803" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a><a id="806" class="Symbol">;</a> <a id="808" href="Relation.Nullary.Decidable.Core.html#1618" class="InductiveConstructor">yes</a><a id="811" class="Symbol">;</a> <a id="813" href="Relation.Nullary.Decidable.Core.html#1655" class="InductiveConstructor">no</a><a id="815" class="Symbol">)</a>
<a id="817" class="Keyword">open</a> <a id="822" class="Keyword">import</a> <a id="829" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a> <a id="856" class="Keyword">using</a> <a id="862" class="Symbol">(</a><a id="863" href="Relation.Nullary.Decidable.Core.html#2609" class="Function Operator">_×-dec_</a><a id="870" class="Symbol">)</a>
<a id="872" class="Keyword">open</a> <a id="877" class="Keyword">import</a> <a id="884" href="Relation.Binary.html" class="Module">Relation.Binary</a> <a id="900" class="Keyword">using</a> <a id="906" class="Symbol">(</a><a id="907" href="Relation.Binary.Definitions.html#6469" class="Function">DecidableEquality</a><a id="924" class="Symbol">)</a>

<a id="927" class="Keyword">import</a> <a id="934" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="972" class="Symbol">as</a> <a id="975" class="Module">Eq</a>
<a id="978" class="Keyword">open</a> <a id="983" href="Relation.Binary.PropositionalEquality.html" class="Module">Eq</a> <a id="986" class="Keyword">using</a> <a id="992" class="Symbol">(</a><a id="993" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">_≢_</a><a id="996" class="Symbol">)</a>

<a id="999" class="Keyword">open</a> <a id="1004" class="Keyword">import</a> <a id="1011" href="Peras.Crypto.html" class="Module">Peras.Crypto</a>
<a id="1024" class="Keyword">open</a> <a id="1029" class="Keyword">import</a> <a id="1036" href="Peras.Block.html" class="Module">Peras.Block</a>
<a id="1048" class="Keyword">open</a> <a id="1053" class="Keyword">import</a> <a id="1060" href="Peras.Numbering.html" class="Module">Peras.Numbering</a>
<a id="1076" class="Keyword">open</a> <a id="1081" class="Keyword">import</a> <a id="1088" href="Peras.Params.html" class="Module">Peras.Params</a>

<a id="1102" class="Keyword">open</a> <a id="1107" class="Keyword">import</a> <a id="1114" href="Haskell.Prelude.html" class="Module">Haskell.Prelude</a> <a id="1130" class="Keyword">hiding</a> <a id="1137" class="Symbol">(</a><a id="1138" href="Haskell.Prim.Foldable.html#999" class="Field">length</a><a id="1144" class="Symbol">;</a> <a id="1146" href="Haskell.Prim.Ord.html#1072" class="Field Operator">_&lt;_</a><a id="1149" class="Symbol">;</a> <a id="1151" href="Haskell.Prim.Ord.html#1096" class="Field Operator">_&gt;_</a><a id="1154" class="Symbol">;</a> <a id="1156" href="Haskell.Prim.html#1330" class="Function Operator">_∘_</a><a id="1159" class="Symbol">;</a> <a id="1161" href="Haskell.Prim.Foldable.html#921" class="Field">sum</a><a id="1164" class="Symbol">;</a> <a id="1166" href="Haskell.Prim.html#1193" class="Generalizable">b</a><a id="1167" class="Symbol">;</a> <a id="1169" href="Haskell.Prim.Enum.html#2173" class="Field">pred</a><a id="1173" class="Symbol">;</a> <a id="1175" href="Haskell.Prim.List.html#419" class="Function">filter</a><a id="1181" class="Symbol">;</a> <a id="1183" href="Haskell.Prim.Foldable.html#741" class="Field">concat</a><a id="1189" class="Symbol">;</a> <a id="1191" href="Haskell.Prim.html#1480" class="Function Operator">_$_</a><a id="1194" class="Symbol">;</a> <a id="1196" href="Haskell.Prelude.html#3964" class="Function">lookup</a><a id="1202" class="Symbol">;</a> <a id="1204" href="Haskell.Prim.List.html#1793" class="Function">zip</a><a id="1207" class="Symbol">;</a> <a id="1209" href="Haskell.Prim.html#2804" class="Datatype">All</a><a id="1212" class="Symbol">;</a> <a id="1214" href="Haskell.Prim.html#2981" class="Datatype">Any</a><a id="1217" class="Symbol">;</a> <a id="1219" href="Haskell.Prim.Tuple.html#211" class="InductiveConstructor Operator">_,_</a><a id="1222" class="Symbol">;</a> <a id="1224" href="Haskell.Prim.Tuple.html#169" class="Record Operator">_×_</a><a id="1227" class="Symbol">)</a>
<a id="1229" class="Keyword">open</a> <a id="1234" class="Keyword">import</a> <a id="1241" href="Haskell.Law.Equality.html" class="Module">Haskell.Law.Equality</a> <a id="1262" class="Keyword">using</a> <a id="1268" class="Symbol">(</a><a id="1269" href="Haskell.Law.Equality.html#226" class="Function">cong</a><a id="1273" class="Symbol">)</a>

<a id="1276" class="Symbol">{-#</a> <a id="1280" class="Keyword">FOREIGN</a> <a id="1288" class="Pragma">AGDA2HS</a>
<a id="1296" class="Symbol">{-#</a> <a id="1300" class="Pragma">LANGUAGE</a> <a id="1309" class="Pragma">DeriveGeneric</a> <a id="1323" class="Symbol">#-}</a>
<a id="1327" class="Pragma">import</a> <a id="1334" class="Pragma">GHC.Generics</a> <a id="1347" class="Pragma">(Generic)</a>
<a id="1357" class="Symbol">#-}</a>

<a id="1362" class="Symbol">{-#</a> <a id="1366" class="Keyword">FOREIGN</a> <a id="1374" class="Pragma">GHC</a>
<a id="1378" class="Pragma">import</a> <a id="1385" class="Pragma">qualified</a> <a id="1395" class="Pragma">Peras.Chain</a> <a id="1407" class="Pragma">as</a> <a id="1410" class="Pragma">G</a>
<a id="1412" class="Symbol">#-}</a>
</pre>-->
<h2 id="voting">Voting</h2>
<h3 id="vote">Vote</h3>
<pre class="Agda">
<a id="VotingWeight"></a><a id="1455" href="Peras.Chain.html#1455" class="Function">VotingWeight</a> <a id="1468" class="Symbol">=</a> <a id="1470" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>

<a id="1473" class="Keyword">record</a> <a id="Vote"></a><a id="1480" href="Peras.Chain.html#1480" class="Record">Vote</a> <a id="1485" class="Symbol">:</a> <a id="1487" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1491" class="Keyword">where</a>
  <a id="1499" class="Keyword">constructor</a> <a id="MkVote"></a><a id="1511" href="Peras.Chain.html#1511" class="InductiveConstructor">MkVote</a>
  <a id="1520" class="Keyword">field</a> <a id="Vote.votingRound"></a><a id="1526" href="Peras.Chain.html#1526" class="Field">votingRound</a> <a id="1538" class="Symbol">:</a> <a id="1540" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a>
        <a id="Vote.creatorId"></a><a id="1560" href="Peras.Chain.html#1560" class="Field">creatorId</a>   <a id="1572" class="Symbol">:</a> <a id="1574" href="Peras.Block.html#1249" class="Function">PartyId</a>
        <a id="Vote.proofM"></a><a id="1590" href="Peras.Chain.html#1590" class="Field">proofM</a>      <a id="1602" class="Symbol">:</a> <a id="1604" href="Peras.Crypto.html#1944" class="Record">MembershipProof</a>
        <a id="Vote.blockHash"></a><a id="1628" href="Peras.Chain.html#1628" class="Field">blockHash</a>   <a id="1640" class="Symbol">:</a> <a id="1642" href="Peras.Crypto.html#1431" class="Record">Hash</a> <a id="1647" href="Peras.Block.html#2950" class="Record">Block</a>
        <a id="Vote.signature"></a><a id="1661" href="Peras.Chain.html#1661" class="Field">signature</a>   <a id="1673" class="Symbol">:</a> <a id="1675" href="Peras.Crypto.html#2898" class="Record">Signature</a>

  <a id="Vote.votingRound&#39;"></a><a id="1688" href="Peras.Chain.html#1688" class="Function">votingRound&#39;</a> <a id="1701" class="Symbol">:</a> <a id="1703" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
  <a id="1707" href="Peras.Chain.html#1688" class="Function">votingRound&#39;</a> <a id="1720" class="Symbol">=</a> <a id="1722" href="Peras.Numbering.html#1729" class="Field">getRoundNumber</a> <a id="1737" href="Peras.Chain.html#1526" class="Field">votingRound</a>

<a id="1750" class="Keyword">open</a> <a id="1755" href="Peras.Chain.html#1480" class="Module">Vote</a> <a id="1760" class="Keyword">public</a>

<a id="1768" class="Keyword">instance</a>
  <a id="iVoteEq"></a><a id="1779" href="Peras.Chain.html#1779" class="Function">iVoteEq</a> <a id="1787" class="Symbol">:</a> <a id="1789" href="Haskell.Prim.Eq.html#401" class="Record">Eq</a> <a id="1792" href="Peras.Chain.html#1480" class="Record">Vote</a>
  <a id="1799" href="Peras.Chain.html#1779" class="Function">iVoteEq</a> <a id="1807" class="Symbol">.</a><a id="1808" href="Haskell.Prim.Eq.html#453" class="Field Operator">_==_</a> <a id="1813" href="Peras.Chain.html#1813" class="Bound">x</a> <a id="1815" href="Peras.Chain.html#1815" class="Bound">y</a> <a id="1817" class="Symbol">=</a> <a id="1819" href="Peras.Chain.html#1526" class="Field">votingRound</a> <a id="1831" href="Peras.Chain.html#1813" class="Bound">x</a> <a id="1833" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="1836" href="Peras.Chain.html#1526" class="Field">votingRound</a> <a id="1848" href="Peras.Chain.html#1815" class="Bound">y</a>
                        <a id="1874" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="1877" href="Peras.Chain.html#1560" class="Field">creatorId</a> <a id="1887" href="Peras.Chain.html#1813" class="Bound">x</a> <a id="1889" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="1892" href="Peras.Chain.html#1560" class="Field">creatorId</a> <a id="1902" href="Peras.Chain.html#1815" class="Bound">y</a>
                        <a id="1928" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="1931" href="Peras.Chain.html#1590" class="Field">proofM</a> <a id="1938" href="Peras.Chain.html#1813" class="Bound">x</a> <a id="1940" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="1943" href="Peras.Chain.html#1590" class="Field">proofM</a> <a id="1950" href="Peras.Chain.html#1815" class="Bound">y</a>
                        <a id="1976" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="1979" href="Peras.Chain.html#1628" class="Field">blockHash</a> <a id="1989" href="Peras.Chain.html#1813" class="Bound">x</a> <a id="1991" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="1994" href="Peras.Chain.html#1628" class="Field">blockHash</a> <a id="2004" href="Peras.Chain.html#1815" class="Bound">y</a>
                        <a id="2030" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="2033" href="Peras.Chain.html#1661" class="Field">signature</a> <a id="2043" href="Peras.Chain.html#1813" class="Bound">x</a> <a id="2045" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="2048" href="Peras.Chain.html#1661" class="Field">signature</a> <a id="2058" href="Peras.Chain.html#1815" class="Bound">y</a>
</pre>
<!--
<pre class="Agda"><a id="2078" class="Symbol">{-#</a> <a id="2082" class="Keyword">COMPILE</a> <a id="2090" class="Keyword">AGDA2HS</a> <a id="2098" href="Peras.Chain.html#1455" class="Function">VotingWeight</a> <a id="2111" class="Symbol">#-}</a>
<a id="2115" class="Symbol">{-#</a> <a id="2119" class="Keyword">COMPILE</a> <a id="2127" class="Keyword">AGDA2HS</a> <a id="2135" href="Peras.Chain.html#1480" class="Record">Vote</a> <a id="2140" class="Pragma">deriving</a> <a id="2149" class="Pragma">(Generic)</a> <a id="2159" class="Symbol">#-}</a>
<a id="2163" class="Symbol">{-#</a> <a id="2167" class="Keyword">COMPILE</a> <a id="2175" class="Keyword">GHC</a> <a id="2179" href="Peras.Chain.html#1480" class="Record">Vote</a> <a id="2184" class="Pragma">=</a> <a id="2186" class="Pragma">data</a> <a id="2191" class="Pragma">G.Vote</a> <a id="2198" class="Pragma">(G.MkVote)</a> <a id="2209" class="Symbol">#-}</a>
<a id="2213" class="Symbol">{-#</a> <a id="2217" class="Keyword">COMPILE</a> <a id="2225" class="Keyword">AGDA2HS</a> <a id="2233" href="Peras.Chain.html#1779" class="Function">iVoteEq</a> <a id="2241" class="Symbol">#-}</a>
</pre>-->
<!--
<pre class="Agda"><a id="2267" class="Comment">{-
toSignable : ∀{msg} → Vote msg -&gt; ByteString
toSignable _ = emptyBS -- const &quot;&quot;
-}</a>

<a id="2354" class="Comment">{-
postulate
  makeVote : ∀{msg} → RoundNumber -&gt; PartyId -&gt; msg -&gt; Vote msg
-}</a>
</pre>-->
<!--
<pre class="Agda"><a id="2456" class="Comment">-- | A vote is valid if the committee-membership proof and the signature are valid.</a>
<a id="2540" class="Comment">{-
isValid : ∀{msg} → Vote msg -&gt; Bool
isValid v@(vote _ (MkPartyId vkey) committeeMembershipProof _ signature) =
  isCommitteeMember vkey committeeMembershipProof
    ∧ verify vkey signature (toSignable v)
-}</a>
</pre>-->
<pre class="Agda"><a id="2766" class="Keyword">record</a> <a id="Postulates"></a><a id="2773" href="Peras.Chain.html#2773" class="Record">Postulates</a> <a id="2784" class="Symbol">:</a> <a id="2786" href="Agda.Primitive.html#388" class="Primitive">Set₁</a> <a id="2791" class="Keyword">where</a>
  <a id="2799" class="Keyword">field</a>
    <a id="Postulates.IsSlotLeader"></a><a id="2809" href="Peras.Chain.html#2809" class="Field">IsSlotLeader</a> <a id="2822" class="Symbol">:</a> <a id="2824" href="Peras.Block.html#1249" class="Function">PartyId</a> <a id="2832" class="Symbol">→</a> <a id="2834" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="2845" class="Symbol">→</a> <a id="2847" href="Peras.Crypto.html#2376" class="Record">LeadershipProof</a> <a id="2863" class="Symbol">→</a> <a id="2865" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="Postulates.IsCommitteeMember"></a><a id="2873" href="Peras.Chain.html#2873" class="Field">IsCommitteeMember</a> <a id="2891" class="Symbol">:</a> <a id="2893" href="Peras.Block.html#1249" class="Function">PartyId</a> <a id="2901" class="Symbol">→</a> <a id="2903" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="2915" class="Symbol">→</a> <a id="2917" href="Peras.Crypto.html#1944" class="Record">MembershipProof</a> <a id="2933" class="Symbol">→</a> <a id="2935" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="Postulates.IsBlockSignature"></a><a id="2943" href="Peras.Chain.html#2943" class="Field">IsBlockSignature</a> <a id="2960" class="Symbol">:</a> <a id="2962" href="Peras.Block.html#2950" class="Record">Block</a> <a id="2968" class="Symbol">→</a> <a id="2970" href="Peras.Crypto.html#2898" class="Record">Signature</a> <a id="2980" class="Symbol">→</a> <a id="2982" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="Postulates.IsVoteSignature"></a><a id="2990" href="Peras.Chain.html#2990" class="Field">IsVoteSignature</a> <a id="3006" class="Symbol">:</a> <a id="3008" href="Peras.Chain.html#1480" class="Record">Vote</a> <a id="3013" class="Symbol">→</a> <a id="3015" href="Peras.Crypto.html#2898" class="Record">Signature</a> <a id="3025" class="Symbol">→</a> <a id="3027" href="Agda.Primitive.html#388" class="Primitive">Set</a>

<a id="3032" class="Keyword">record</a> <a id="Network"></a><a id="3039" href="Peras.Chain.html#3039" class="Record">Network</a> <a id="3047" class="Symbol">:</a> <a id="3049" href="Agda.Primitive.html#388" class="Primitive">Set₁</a> <a id="3054" class="Keyword">where</a>
  <a id="3062" class="Keyword">field</a>
    <a id="Network.Δ"></a><a id="3072" href="Peras.Chain.html#3072" class="Field">Δ</a> <a id="3074" class="Symbol">:</a> <a id="3076" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
</pre>
<pre class="Agda"><a id="3090" class="Keyword">module</a> <a id="3097" href="Peras.Chain.html#3097" class="Module">_</a> <a id="3099" class="Symbol">⦃</a> <a id="3101" href="Peras.Chain.html#3101" class="Bound">_</a> <a id="3103" class="Symbol">:</a> <a id="3105" href="Peras.Chain.html#2773" class="Record">Postulates</a> <a id="3116" class="Symbol">⦄</a>

         <a id="3128" class="Keyword">where</a>

  <a id="3137" class="Keyword">open</a> <a id="3142" href="Peras.Chain.html#2773" class="Module">Postulates</a> <a id="3153" class="Symbol">⦃...⦄</a>

  <a id="3162" href="Peras.Chain.html#3162" class="Function">ValidVote</a> <a id="3172" class="Symbol">:</a> <a id="3174" href="Peras.Chain.html#1480" class="Record">Vote</a> <a id="3179" class="Symbol">→</a> <a id="3181" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="3187" href="Peras.Chain.html#3162" class="Function">ValidVote</a> <a id="3197" href="Peras.Chain.html#3197" class="Bound">v</a> <a id="3199" class="Symbol">=</a>
    <a id="3205" href="Peras.Chain.html#2873" class="Field">IsCommitteeMember</a>
        <a id="3231" class="Symbol">(</a><a id="3232" href="Peras.Chain.html#1560" class="Field">creatorId</a> <a id="3242" href="Peras.Chain.html#3197" class="Bound">v</a><a id="3243" class="Symbol">)</a>
        <a id="3253" class="Symbol">(</a><a id="3254" href="Peras.Chain.html#1526" class="Field">votingRound</a> <a id="3266" href="Peras.Chain.html#3197" class="Bound">v</a><a id="3267" class="Symbol">)</a>
        <a id="3277" class="Symbol">(</a><a id="3278" href="Peras.Chain.html#1590" class="Field">proofM</a> <a id="3285" href="Peras.Chain.html#3197" class="Bound">v</a><a id="3286" class="Symbol">)</a>
    <a id="3292" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3294" href="Peras.Chain.html#2990" class="Field">IsVoteSignature</a> <a id="3310" href="Peras.Chain.html#3197" class="Bound">v</a> <a id="3312" class="Symbol">(</a><a id="3313" href="Peras.Chain.html#1661" class="Field">signature</a> <a id="3323" href="Peras.Chain.html#3197" class="Bound">v</a><a id="3324" class="Symbol">)</a>
</pre>
<h3 id="equivocation-relation">Equivocation relation</h3>
<p>Equivocal votes are multiple votes by the same party for the same
round.</p>
<pre class="Agda"><a id="3440" class="Keyword">data</a> <a id="_∻_"></a><a id="3445" href="Peras.Chain.html#3445" class="Datatype Operator">_∻_</a> <a id="3449" class="Symbol">:</a> <a id="3451" href="Peras.Chain.html#1480" class="Record">Vote</a> <a id="3456" class="Symbol">→</a> <a id="3458" href="Peras.Chain.html#1480" class="Record">Vote</a> <a id="3463" class="Symbol">→</a> <a id="3465" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="3469" class="Keyword">where</a>

  <a id="_∻_.Equivocation"></a><a id="3478" href="Peras.Chain.html#3478" class="InductiveConstructor">Equivocation</a> <a id="3491" class="Symbol">:</a> <a id="3493" class="Symbol">∀</a> <a id="3495" class="Symbol">{</a><a id="3496" href="Peras.Chain.html#3496" class="Bound">v₁</a> <a id="3499" href="Peras.Chain.html#3499" class="Bound">v₂</a><a id="3501" class="Symbol">}</a>
    <a id="3507" class="Symbol">→</a> <a id="3509" href="Peras.Chain.html#1560" class="Field">creatorId</a> <a id="3519" href="Peras.Chain.html#3496" class="Bound">v₁</a> <a id="3522" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3524" href="Peras.Chain.html#1560" class="Field">creatorId</a> <a id="3534" href="Peras.Chain.html#3499" class="Bound">v₂</a>
    <a id="3541" class="Symbol">→</a> <a id="3543" href="Peras.Chain.html#1526" class="Field">votingRound</a> <a id="3555" href="Peras.Chain.html#3496" class="Bound">v₁</a> <a id="3558" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3560" href="Peras.Chain.html#1526" class="Field">votingRound</a> <a id="3572" href="Peras.Chain.html#3499" class="Bound">v₂</a>
    <a id="3579" class="Symbol">→</a> <a id="3581" href="Peras.Chain.html#3496" class="Bound">v₁</a> <a id="3584" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="3586" href="Peras.Chain.html#3499" class="Bound">v₂</a>
    <a id="3593" class="Symbol">→</a> <a id="3595" href="Peras.Chain.html#3496" class="Bound">v₁</a> <a id="3598" href="Peras.Chain.html#3445" class="Datatype Operator">∻</a> <a id="3600" href="Peras.Chain.html#3499" class="Bound">v₂</a>
</pre>
<!--
<pre class="Agda"><a id="3620" class="Comment">-- NonEquivocation : Vote → Vote → Set</a>
<a id="3659" class="Comment">-- NonEquivocation v₁ v₂ = ¬ (v₁ ∻ v₂)</a>

<a id="3699" class="Comment">-- open import Data.List.Relation.Unary.AllPairs.Core NonEquivocation renaming (AllPairs to NoEquivocations) public</a>
</pre>-->
<h2 id="chain">Chain</h2>
<pre class="Agda"><a id="Chain"></a><a id="3842" href="Peras.Chain.html#3842" class="Function">Chain</a> <a id="3848" class="Symbol">=</a> <a id="3850" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3855" href="Peras.Block.html#2950" class="Record">Block</a>
</pre>
<!--
<pre class="Agda"><a id="3878" class="Symbol">{-#</a> <a id="3882" class="Keyword">COMPILE</a> <a id="3890" class="Keyword">AGDA2HS</a> <a id="3898" href="Peras.Chain.html#3842" class="Function">Chain</a> <a id="3904" class="Symbol">#-}</a>
</pre>-->
<h3 id="chain-prefix">Chain prefix</h3>
<pre class="Agda"><a id="3943" class="Keyword">data</a> <a id="_⪯_"></a><a id="3948" href="Peras.Chain.html#3948" class="Datatype Operator">_⪯_</a> <a id="3952" class="Symbol">:</a> <a id="3954" href="Peras.Chain.html#3842" class="Function">Chain</a> <a id="3960" class="Symbol">→</a> <a id="3962" href="Peras.Chain.html#3842" class="Function">Chain</a> <a id="3968" class="Symbol">→</a> <a id="3970" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="3974" class="Keyword">where</a>

  <a id="_⪯_.Prefix"></a><a id="3983" href="Peras.Chain.html#3983" class="InductiveConstructor">Prefix</a> <a id="3990" class="Symbol">:</a> <a id="3992" class="Symbol">∀</a> <a id="3994" class="Symbol">{</a><a id="3995" href="Peras.Chain.html#3995" class="Bound">c₁</a> <a id="3998" href="Peras.Chain.html#3998" class="Bound">c₂</a> <a id="4001" href="Peras.Chain.html#4001" class="Bound">c₃</a> <a id="4004" class="Symbol">:</a> <a id="4006" href="Peras.Chain.html#3842" class="Function">Chain</a><a id="4011" class="Symbol">}</a>
    <a id="4017" class="Symbol">→</a> <a id="4019" href="Peras.Chain.html#3995" class="Bound">c₁</a> <a id="4022" href="Haskell.Prim.List.html#310" class="Function Operator">++</a> <a id="4025" href="Peras.Chain.html#4001" class="Bound">c₃</a> <a id="4028" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="4030" href="Peras.Chain.html#3998" class="Bound">c₂</a>
    <a id="4037" class="Symbol">→</a> <a id="4039" href="Peras.Chain.html#3995" class="Bound">c₁</a> <a id="4042" href="Peras.Chain.html#3948" class="Datatype Operator">⪯</a> <a id="4044" href="Peras.Chain.html#3998" class="Bound">c₂</a>
</pre>
<h3 id="chain-pruning">Chain pruning</h3>
<pre class="Agda"><a id="prune"></a><a id="4079" href="Peras.Chain.html#4079" class="Function">prune</a> <a id="4085" class="Symbol">:</a> <a id="4087" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="4098" class="Symbol">→</a> <a id="4100" href="Peras.Chain.html#3842" class="Function">Chain</a> <a id="4106" class="Symbol">→</a> <a id="4108" href="Peras.Chain.html#3842" class="Function">Chain</a>
<a id="4114" href="Peras.Chain.html#4079" class="Function">prune</a> <a id="4120" class="Symbol">(</a><a id="4121" href="Peras.Numbering.html#779" class="InductiveConstructor">MkSlotNumber</a> <a id="4134" href="Peras.Chain.html#4134" class="Bound">sl</a><a id="4136" class="Symbol">)</a> <a id="4138" class="Symbol">=</a> <a id="4140" href="Data.List.Base.html#10878" class="Function">filter</a> <a id="4147" class="Symbol">((</a><a id="4149" href="Data.Nat.Properties.html#6146" class="Function Operator">_≤?</a> <a id="4153" href="Peras.Chain.html#4134" class="Bound">sl</a><a id="4155" class="Symbol">)</a> <a id="4157" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4159" href="Peras.Block.html#3610" class="Function">slotNumber&#39;</a><a id="4170" class="Symbol">)</a>
</pre>
<h3 id="chain-weight">Chain weight</h3>
The weight of a chain is defined with respect of the Peras parameters
<pre class="Agda"><a id="4272" class="Keyword">open</a> <a id="4277" href="Peras.Params.html#166" class="Module">Params</a> <a id="4284" class="Symbol">⦃...⦄</a>
</pre>
The weight of a chain is computed wrt to a set of dangling votes
<pre class="Agda"><a id="4367" class="Keyword">module</a> <a id="4374" href="Peras.Chain.html#4374" class="Module">_</a> <a id="4376" class="Symbol">⦃</a> <a id="4378" href="Peras.Chain.html#4378" class="Bound">_</a> <a id="4380" class="Symbol">:</a> <a id="4382" href="Peras.Crypto.html#1777" class="Record">Hashable</a> <a id="4391" href="Peras.Block.html#2950" class="Record">Block</a> <a id="4397" class="Symbol">⦄</a>
         <a id="4408" class="Symbol">⦃</a> <a id="4410" href="Peras.Chain.html#4410" class="Bound">_</a> <a id="4412" class="Symbol">:</a> <a id="4414" href="Peras.Params.html#166" class="Record">Params</a> <a id="4421" class="Symbol">⦄</a>
         <a id="4432" class="Keyword">where</a>
</pre>
<pre class="Agda">  <a id="4452" class="Keyword">open</a> <a id="4457" href="Peras.Crypto.html#1777" class="Module">Hashable</a> <a id="4466" class="Symbol">⦃...⦄</a>
</pre>
<pre class="Agda">  <a id="4486" href="Peras.Chain.html#4486" class="Function Operator">_PointsInto_</a> <a id="4499" class="Symbol">:</a> <a id="4501" href="Peras.Block.html#2992" class="Record">Certificate</a> <a id="4513" class="Symbol">→</a> <a id="4515" href="Peras.Chain.html#3842" class="Function">Chain</a> <a id="4521" class="Symbol">→</a> <a id="4523" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="4529" href="Peras.Chain.html#4486" class="Function Operator">_PointsInto_</a> <a id="4542" href="Peras.Chain.html#4542" class="Bound">c</a> <a id="4544" class="Symbol">=</a> <a id="4546" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="4550" class="Symbol">((</a><a id="4552" href="Peras.Block.html#3119" class="Field">blockRef</a> <a id="4561" href="Peras.Chain.html#4542" class="Bound">c</a> <a id="4563" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡_</a><a id="4565" class="Symbol">)</a> <a id="4567" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4569" href="Peras.Crypto.html#1816" class="Field">hash</a><a id="4573" class="Symbol">)</a>
</pre>
<pre class="Agda">  <a id="4589" href="Peras.Chain.html#4589" class="Function Operator">_PointsInto?_</a> <a id="4603" class="Symbol">:</a> <a id="4605" class="Symbol">∀</a> <a id="4607" class="Symbol">(</a><a id="4608" href="Peras.Chain.html#4608" class="Bound">c</a> <a id="4610" class="Symbol">:</a> <a id="4612" href="Peras.Block.html#2992" class="Record">Certificate</a><a id="4623" class="Symbol">)</a> <a id="4625" class="Symbol">→</a> <a id="4627" class="Symbol">(</a><a id="4628" href="Peras.Chain.html#4628" class="Bound">ch</a> <a id="4631" class="Symbol">:</a> <a id="4633" href="Peras.Chain.html#3842" class="Function">Chain</a><a id="4638" class="Symbol">)</a> <a id="4640" class="Symbol">→</a> <a id="4642" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="4646" class="Symbol">(</a><a id="4647" href="Peras.Chain.html#4608" class="Bound">c</a> <a id="4649" href="Peras.Chain.html#4486" class="Function Operator">PointsInto</a> <a id="4660" href="Peras.Chain.html#4628" class="Bound">ch</a><a id="4662" class="Symbol">)</a>
  <a id="4666" href="Peras.Chain.html#4589" class="Function Operator">_PointsInto?_</a> <a id="4680" href="Peras.Chain.html#4680" class="Bound">c</a> <a id="4682" class="Symbol">=</a> <a id="4684" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a> <a id="4689" class="Symbol">((</a><a id="4691" href="Peras.Block.html#3119" class="Field">blockRef</a> <a id="4700" href="Peras.Chain.html#4680" class="Bound">c</a> <a id="4702" href="Peras.Block.html#3689" class="Function Operator">≟-BlockHash_</a><a id="4714" class="Symbol">)</a> <a id="4716" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4718" href="Peras.Crypto.html#1816" class="Field">hash</a><a id="4722" class="Symbol">)</a>
</pre>
<pre class="Agda">  <a id="4738" href="Peras.Chain.html#4738" class="Function">StartOfRound</a> <a id="4751" class="Symbol">:</a> <a id="4753" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="4764" class="Symbol">→</a> <a id="4766" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="4778" class="Symbol">→</a> <a id="4780" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="4786" href="Peras.Chain.html#4738" class="Function">StartOfRound</a> <a id="4799" class="Symbol">(</a><a id="4800" href="Peras.Numbering.html#779" class="InductiveConstructor">MkSlotNumber</a> <a id="4813" href="Peras.Chain.html#4813" class="Bound">sl</a><a id="4815" class="Symbol">)</a> <a id="4817" class="Symbol">(</a><a id="4818" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="4832" href="Peras.Chain.html#4832" class="Bound">r</a><a id="4833" class="Symbol">)</a> <a id="4835" class="Symbol">=</a> <a id="4837" href="Peras.Chain.html#4813" class="Bound">sl</a> <a id="4840" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="4842" href="Peras.Chain.html#4832" class="Bound">r</a> <a id="4844" href="Haskell.Prim.Num.html#632" class="Field Operator">*</a> <a id="4846" href="Peras.Params.html#193" class="Field">U</a>
</pre>
<pre class="Agda">  <a id="4862" href="Peras.Chain.html#4862" class="Function">StartOfRound?</a> <a id="4876" class="Symbol">:</a> <a id="4878" class="Symbol">(</a><a id="4879" href="Peras.Chain.html#4879" class="Bound">sl</a> <a id="4882" class="Symbol">:</a> <a id="4884" href="Peras.Numbering.html#742" class="Record">SlotNumber</a><a id="4894" class="Symbol">)</a> <a id="4896" class="Symbol">→</a> <a id="4898" class="Symbol">(</a><a id="4899" href="Peras.Chain.html#4899" class="Bound">r</a> <a id="4901" class="Symbol">:</a> <a id="4903" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a><a id="4914" class="Symbol">)</a> <a id="4916" class="Symbol">→</a> <a id="4918" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="4922" class="Symbol">(</a><a id="4923" href="Peras.Chain.html#4738" class="Function">StartOfRound</a> <a id="4936" href="Peras.Chain.html#4879" class="Bound">sl</a> <a id="4939" href="Peras.Chain.html#4899" class="Bound">r</a><a id="4940" class="Symbol">)</a>
  <a id="4944" href="Peras.Chain.html#4862" class="Function">StartOfRound?</a> <a id="4958" class="Symbol">(</a><a id="4959" href="Peras.Numbering.html#779" class="InductiveConstructor">MkSlotNumber</a> <a id="4972" href="Peras.Chain.html#4972" class="Bound">sl</a><a id="4974" class="Symbol">)</a> <a id="4976" class="Symbol">(</a><a id="4977" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="4991" href="Peras.Chain.html#4991" class="Bound">r</a><a id="4992" class="Symbol">)</a> <a id="4994" class="Symbol">=</a> <a id="4996" href="Peras.Chain.html#4972" class="Bound">sl</a> <a id="4999" href="Data.Nat.Properties.html#3311" class="Function Operator">≟</a> <a id="5001" href="Peras.Chain.html#4991" class="Bound">r</a> <a id="5003" href="Haskell.Prim.Num.html#632" class="Field Operator">*</a> <a id="5005" href="Peras.Params.html#193" class="Field">U</a>
</pre>
<pre class="Agda">  <a id="5021" href="Peras.Chain.html#5021" class="Function">rnd</a> <a id="5025" class="Symbol">:</a> <a id="5027" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="5029" class="Symbol">→</a> <a id="5031" class="Symbol">⦃</a> <a id="5033" href="Peras.Chain.html#5033" class="Symbol">_</a> <a id="5035" class="Symbol">:</a> <a id="5037" href="Data.Nat.Base.html#3260" class="Record">NonZero</a> <a id="5045" href="Peras.Params.html#193" class="Field">U</a> <a id="5047" class="Symbol">⦄</a> <a id="5049" class="Symbol">→</a> <a id="5051" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
  <a id="5055" href="Peras.Chain.html#5021" class="Function">rnd</a> <a id="5059" href="Peras.Chain.html#5059" class="Bound">s</a> <a id="5061" class="Symbol">=</a> <a id="5063" href="Peras.Chain.html#5059" class="Bound">s</a> <a id="5065" href="Data.Nat.Base.html#7096" class="Function Operator">/</a> <a id="5067" href="Peras.Params.html#193" class="Field">U</a>
</pre>
<pre class="Agda">  <a id="5083" href="Peras.Chain.html#5083" class="Function">v-round</a> <a id="5091" class="Symbol">:</a> <a id="5093" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="5104" class="Symbol">→</a> <a id="5106" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a>
  <a id="5120" href="Peras.Chain.html#5083" class="Function">v-round</a> <a id="5128" class="Symbol">(</a><a id="5129" href="Peras.Numbering.html#779" class="InductiveConstructor">MkSlotNumber</a> <a id="5142" href="Peras.Chain.html#5142" class="Bound">s</a><a id="5143" class="Symbol">)</a> <a id="5145" class="Symbol">=</a> <a id="5147" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="5161" class="Symbol">(</a><a id="5162" href="Peras.Chain.html#5021" class="Function">rnd</a> <a id="5166" href="Peras.Chain.html#5142" class="Bound">s</a><a id="5167" class="Symbol">)</a>
</pre>
<h3 id="chain-weight-1">Chain weight</h3>
<pre class="Agda">  <a id="5201" href="Peras.Chain.html#5201" class="Function Operator">∥_∥_</a> <a id="5206" class="Symbol">:</a> <a id="5208" href="Peras.Chain.html#3842" class="Function">Chain</a> <a id="5214" class="Symbol">→</a> <a id="5216" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5221" href="Peras.Block.html#2992" class="Record">Certificate</a> <a id="5233" class="Symbol">→</a> <a id="5235" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
  <a id="5239" href="Peras.Chain.html#5201" class="Function Operator">∥</a> <a id="5241" href="Peras.Chain.html#5241" class="Bound">ch</a> <a id="5244" href="Peras.Chain.html#5201" class="Function Operator">∥</a> <a id="5246" href="Peras.Chain.html#5246" class="Bound">cts</a> <a id="5250" class="Symbol">=</a> <a id="5252" href="Peras.Chain.html#211" class="Function Operator">∣</a> <a id="5254" href="Peras.Chain.html#5241" class="Bound">ch</a> <a id="5257" href="Peras.Chain.html#211" class="Function Operator">∣</a> <a id="5259" href="Haskell.Prim.Num.html#547" class="Field Operator">+</a> <a id="5261" href="Peras.Chain.html#211" class="Function Operator">∣</a> <a id="5263" href="Data.List.Base.html#10878" class="Function">filter</a> <a id="5270" class="Symbol">(</a><a id="5271" href="Peras.Chain.html#4589" class="Function Operator">_PointsInto?</a> <a id="5284" href="Peras.Chain.html#5241" class="Bound">ch</a><a id="5286" class="Symbol">)</a> <a id="5288" href="Peras.Chain.html#5246" class="Bound">cts</a> <a id="5292" href="Peras.Chain.html#211" class="Function Operator">∣</a> <a id="5294" href="Haskell.Prim.Num.html#632" class="Field Operator">*</a> <a id="5296" href="Peras.Params.html#277" class="Field">B</a>
</pre>
<h3 id="chain-validity">Chain validity</h3>
<!--
<pre class="Agda"><a id="5336" class="Keyword">open</a> <a id="5341" class="Keyword">import</a> <a id="5348" href="Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="5374" class="Keyword">using</a> <a id="5380" class="Symbol">(</a><a id="5381" href="Relation.Nullary.Negation.Core.html#698" class="Function Operator">¬_</a><a id="5383" class="Symbol">)</a>

<a id="5386" class="Keyword">import</a> <a id="5393" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="5431" class="Symbol">as</a> <a id="5434" class="Module">PropEq</a>
<a id="5441" class="Keyword">open</a> <a id="5446" href="Relation.Binary.PropositionalEquality.html" class="Module">PropEq</a> <a id="5453" class="Keyword">using</a> <a id="5459" class="Symbol">(</a><a id="5460" href="Relation.Binary.PropositionalEquality.Core.html#1757" class="Function">trans</a><a id="5465" class="Symbol">)</a>

<a id="5468" class="Keyword">open</a> <a id="5473" href="Peras.Block.html#2950" class="Module">Block</a>

<a id="5480" class="Keyword">open</a> <a id="5485" class="Keyword">import</a> <a id="5492" href="Data.List.Membership.Propositional.html" class="Module">Data.List.Membership.Propositional</a> <a id="5527" class="Keyword">using</a> <a id="5533" class="Symbol">(</a><a id="5534" href="Data.List.Membership.Setoid.html#950" class="Function Operator">_∈_</a><a id="5537" class="Symbol">)</a>
</pre>-->
<pre class="Agda"><a id="5555" class="Keyword">module</a> <a id="5562" href="Peras.Chain.html#5562" class="Module">_</a> <a id="5564" class="Symbol">⦃</a> <a id="5566" href="Peras.Chain.html#5566" class="Bound">_</a> <a id="5568" class="Symbol">:</a> <a id="5570" href="Peras.Crypto.html#1777" class="Record">Hashable</a> <a id="5579" href="Peras.Block.html#2950" class="Record">Block</a> <a id="5585" class="Symbol">⦄</a>
         <a id="5596" class="Symbol">⦃</a> <a id="5598" href="Peras.Chain.html#5598" class="Bound">_</a> <a id="5600" class="Symbol">:</a> <a id="5602" href="Peras.Chain.html#2773" class="Record">Postulates</a> <a id="5613" class="Symbol">⦄</a>
         <a id="5624" class="Symbol">⦃</a> <a id="5626" href="Peras.Chain.html#5626" class="Bound">_</a> <a id="5628" class="Symbol">:</a> <a id="5630" href="Peras.Chain.html#3039" class="Record">Network</a> <a id="5638" class="Symbol">⦄</a>

         <a id="5650" class="Keyword">where</a>

  <a id="5659" class="Keyword">open</a> <a id="5664" href="Peras.Crypto.html#1777" class="Module">Hashable</a> <a id="5673" class="Symbol">⦃...⦄</a>
  <a id="5681" class="Keyword">open</a> <a id="5686" href="Peras.Chain.html#2773" class="Module">Postulates</a> <a id="5697" class="Symbol">⦃...⦄</a>
  <a id="5705" class="Keyword">open</a> <a id="5710" href="Peras.Chain.html#3039" class="Module">Network</a> <a id="5718" class="Symbol">⦃...⦄</a>
</pre>
<pre class="Agda">  <a id="5738" class="Keyword">data</a> <a id="5743" href="Peras.Chain.html#5743" class="Datatype">ValidChain</a> <a id="5754" class="Symbol">:</a> <a id="5756" href="Peras.Chain.html#3842" class="Function">Chain</a> <a id="5762" class="Symbol">→</a> <a id="5764" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="5768" class="Keyword">where</a>

    <a id="5779" href="Peras.Chain.html#5779" class="InductiveConstructor">Genesis</a> <a id="5787" class="Symbol">:</a> <a id="5789" href="Peras.Chain.html#5743" class="Datatype">ValidChain</a> <a id="5800" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

    <a id="5808" href="Peras.Chain.html#5808" class="InductiveConstructor">Cons</a> <a id="5813" class="Symbol">:</a> <a id="5815" class="Symbol">∀</a> <a id="5817" class="Symbol">{</a><a id="5818" href="Peras.Chain.html#5818" class="Bound">c₁</a> <a id="5821" href="Peras.Chain.html#5821" class="Bound">c₂</a> <a id="5824" class="Symbol">:</a> <a id="5826" href="Peras.Chain.html#3842" class="Function">Chain</a><a id="5831" class="Symbol">}</a> <a id="5833" class="Symbol">{</a><a id="5834" href="Peras.Chain.html#5834" class="Bound">b₁</a> <a id="5837" href="Peras.Chain.html#5837" class="Bound">b₂</a> <a id="5840" class="Symbol">:</a> <a id="5842" href="Peras.Block.html#2950" class="Record">Block</a><a id="5847" class="Symbol">}</a>
      <a id="5855" class="Symbol">→</a> <a id="5857" href="Peras.Chain.html#2943" class="Field">IsBlockSignature</a> <a id="5874" href="Peras.Chain.html#5834" class="Bound">b₁</a> <a id="5877" class="Symbol">(</a><a id="5878" href="Peras.Block.html#3553" class="Field">signature</a> <a id="5888" href="Peras.Chain.html#5834" class="Bound">b₁</a><a id="5890" class="Symbol">)</a>
      <a id="5898" class="Symbol">→</a> <a id="5900" href="Peras.Chain.html#2809" class="Field">IsSlotLeader</a> <a id="5913" class="Symbol">(</a><a id="5914" href="Peras.Block.html#3410" class="Field">creatorId</a> <a id="5924" href="Peras.Chain.html#5834" class="Bound">b₁</a><a id="5926" class="Symbol">)</a> <a id="5928" class="Symbol">(</a><a id="5929" href="Peras.Block.html#3378" class="Field">slotNumber</a> <a id="5940" href="Peras.Chain.html#5834" class="Bound">b₁</a><a id="5942" class="Symbol">)</a> <a id="5944" class="Symbol">(</a><a id="5945" href="Peras.Block.html#3511" class="Field">leadershipProof</a> <a id="5961" href="Peras.Chain.html#5834" class="Bound">b₁</a><a id="5963" class="Symbol">)</a>
      <a id="5971" class="Symbol">→</a> <a id="5973" href="Peras.Block.html#3438" class="Field">parentBlock</a> <a id="5985" href="Peras.Chain.html#5834" class="Bound">b₁</a> <a id="5988" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5990" href="Peras.Crypto.html#1816" class="Field">hash</a> <a id="5995" href="Peras.Chain.html#5837" class="Bound">b₂</a>
      <a id="6004" class="Symbol">→</a> <a id="6006" href="Peras.Chain.html#5821" class="Bound">c₂</a> <a id="6009" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6011" href="Peras.Chain.html#5837" class="Bound">b₂</a> <a id="6014" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6016" href="Peras.Chain.html#5818" class="Bound">c₁</a>
      <a id="6025" class="Symbol">→</a> <a id="6027" href="Peras.Chain.html#5743" class="Datatype">ValidChain</a> <a id="6038" href="Peras.Chain.html#5821" class="Bound">c₂</a>
      <a id="6047" class="Symbol">→</a> <a id="6049" href="Peras.Chain.html#5743" class="Datatype">ValidChain</a> <a id="6060" class="Symbol">(</a><a id="6061" href="Peras.Chain.html#5834" class="Bound">b₁</a> <a id="6064" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6066" href="Peras.Chain.html#5821" class="Bound">c₂</a><a id="6068" class="Symbol">)</a>
</pre>
<pre class="Agda">  <a id="6084" href="Peras.Chain.html#6084" class="Function">tipHash</a> <a id="6092" class="Symbol">:</a> <a id="6094" class="Symbol">∀</a> <a id="6096" class="Symbol">{</a><a id="6097" href="Peras.Chain.html#6097" class="Bound">c</a> <a id="6099" class="Symbol">:</a> <a id="6101" href="Peras.Chain.html#3842" class="Function">Chain</a><a id="6106" class="Symbol">}</a> <a id="6108" class="Symbol">→</a> <a id="6110" href="Peras.Chain.html#5743" class="Datatype">ValidChain</a> <a id="6121" href="Peras.Chain.html#6097" class="Bound">c</a> <a id="6123" class="Symbol">→</a> <a id="6125" href="Peras.Crypto.html#1431" class="Record">Hash</a> <a id="6130" href="Peras.Block.html#2950" class="Record">Block</a>
  <a id="6138" href="Peras.Chain.html#6084" class="Function">tipHash</a> <a id="6146" href="Peras.Chain.html#5779" class="InductiveConstructor">Genesis</a> <a id="6154" class="Symbol">=</a> <a id="6156" class="Keyword">record</a> <a id="6163" class="Symbol">{</a> <a id="6165" href="Peras.Crypto.html#1487" class="Field">hashBytes</a> <a id="6175" class="Symbol">=</a> <a id="6177" href="Peras.Crypto.html#618" class="Postulate">emptyBS</a> <a id="6185" class="Symbol">}</a>
  <a id="6189" href="Peras.Chain.html#6084" class="Function">tipHash</a> <a id="6197" class="Symbol">(</a><a id="6198" href="Peras.Chain.html#5808" class="InductiveConstructor">Cons</a> <a id="6203" class="Symbol">{</a><a id="6204" class="Argument">b₁</a> <a id="6207" class="Symbol">=</a> <a id="6209" href="Peras.Chain.html#6209" class="Bound">b</a><a id="6210" class="Symbol">}</a> <a id="6212" class="Symbol">_</a> <a id="6214" class="Symbol">_</a> <a id="6216" class="Symbol">_</a> <a id="6218" class="Symbol">_</a> <a id="6220" class="Symbol">_)</a> <a id="6223" class="Symbol">=</a> <a id="6225" href="Peras.Crypto.html#1816" class="Field">hash</a> <a id="6230" href="Peras.Chain.html#6209" class="Bound">b</a>
</pre>
<pre class="Agda">  <a id="6246" href="Peras.Chain.html#6246" class="Function">certsFromChain</a> <a id="6261" class="Symbol">:</a> <a id="6263" href="Peras.Chain.html#3842" class="Function">Chain</a> <a id="6269" class="Symbol">→</a> <a id="6271" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6276" href="Peras.Block.html#2992" class="Record">Certificate</a>
  <a id="6290" href="Peras.Chain.html#6246" class="Function">certsFromChain</a> <a id="6305" class="Symbol">=</a> <a id="6307" href="Data.List.Base.html#1878" class="Function">catMaybes</a> <a id="6317" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="6319" href="Haskell.Prim.List.html#211" class="Function">map</a> <a id="6323" href="Peras.Block.html#3471" class="Field">certificate</a>
</pre>
<!--
<pre class="Agda"><a id="6352" class="Comment">-- | `foldl` does not exist in `Haskell.Prelude` so let&#39;s roll our own</a>
<a id="6423" class="Comment">-- but let&#39;s make it total.</a>
<a id="foldl1Maybe"></a><a id="6451" href="Peras.Chain.html#6451" class="Function">foldl1Maybe</a> <a id="6463" class="Symbol">:</a> <a id="6465" class="Symbol">∀</a> <a id="6467" class="Symbol">{</a><a id="6468" href="Peras.Chain.html#6468" class="Bound">a</a> <a id="6470" class="Symbol">:</a> <a id="6472" href="Agda.Primitive.html#388" class="Primitive">Set</a><a id="6475" class="Symbol">}</a> <a id="6477" class="Symbol">-&gt;</a> <a id="6480" class="Symbol">(</a><a id="6481" href="Peras.Chain.html#6468" class="Bound">a</a> <a id="6483" class="Symbol">-&gt;</a> <a id="6486" href="Peras.Chain.html#6468" class="Bound">a</a> <a id="6488" class="Symbol">-&gt;</a> <a id="6491" href="Peras.Chain.html#6468" class="Bound">a</a><a id="6492" class="Symbol">)</a> <a id="6494" class="Symbol">-&gt;</a> <a id="6497" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6502" href="Peras.Chain.html#6468" class="Bound">a</a> <a id="6504" class="Symbol">-&gt;</a> <a id="6507" href="Haskell.Prim.Maybe.html#101" class="Datatype">Maybe</a> <a id="6513" href="Peras.Chain.html#6468" class="Bound">a</a>
<a id="6515" href="Peras.Chain.html#6451" class="Function">foldl1Maybe</a> <a id="6527" href="Peras.Chain.html#6527" class="Bound">f</a> <a id="6529" href="Peras.Chain.html#6529" class="Bound">xs</a> <a id="6532" class="Symbol">=</a>
  <a id="6536" href="Haskell.Prim.Foldable.html#566" class="Field">foldl</a> <a id="6542" class="Symbol">(λ</a> <a id="6545" href="Peras.Chain.html#6545" class="Bound">m</a> <a id="6547" href="Peras.Chain.html#6547" class="Bound">y</a> <a id="6549" class="Symbol">-&gt;</a> <a id="6552" href="Haskell.Prim.Maybe.html#162" class="InductiveConstructor">Just</a> <a id="6557" class="Symbol">(</a><a id="6558" href="Haskell.Prim.html#1609" class="Function Operator">case</a> <a id="6563" href="Peras.Chain.html#6545" class="Bound">m</a> <a id="6565" href="Haskell.Prim.html#1609" class="Function Operator">of</a> <a id="6568" class="Symbol">λ</a> <a id="6570" class="Keyword">where</a>
                             <a id="6605" href="Haskell.Prim.Maybe.html#142" class="InductiveConstructor">Nothing</a> <a id="6613" class="Symbol">-&gt;</a> <a id="6616" href="Peras.Chain.html#6547" class="Bound">y</a>
                             <a id="6647" class="Symbol">(</a><a id="6648" href="Haskell.Prim.Maybe.html#162" class="InductiveConstructor">Just</a> <a id="6653" href="Peras.Chain.html#6653" class="Bound">x</a><a id="6654" class="Symbol">)</a>  <a id="6657" class="Symbol">-&gt;</a> <a id="6660" href="Peras.Chain.html#6527" class="Bound">f</a> <a id="6662" href="Peras.Chain.html#6653" class="Bound">x</a> <a id="6664" href="Peras.Chain.html#6547" class="Bound">y</a><a id="6665" class="Symbol">))</a>
        <a id="6676" href="Haskell.Prim.Maybe.html#142" class="InductiveConstructor">Nothing</a> <a id="6684" href="Peras.Chain.html#6529" class="Bound">xs</a>

<a id="6688" class="Symbol">{-#</a> <a id="6692" class="Keyword">COMPILE</a> <a id="6700" class="Keyword">AGDA2HS</a> <a id="6708" href="Peras.Chain.html#6451" class="Function">foldl1Maybe</a> <a id="6720" class="Symbol">#-}</a>

<a id="prefix"></a><a id="6725" href="Peras.Chain.html#6725" class="Function">prefix</a> <a id="6732" class="Symbol">:</a> <a id="6734" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6739" href="Peras.Block.html#2950" class="Record">Block</a> <a id="6745" class="Symbol">-&gt;</a> <a id="6748" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6753" href="Peras.Block.html#2950" class="Record">Block</a> <a id="6759" class="Symbol">-&gt;</a> <a id="6762" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6767" href="Peras.Block.html#2950" class="Record">Block</a> <a id="6773" class="Symbol">-&gt;</a> <a id="6776" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6781" href="Peras.Block.html#2950" class="Record">Block</a>
<a id="6787" href="Peras.Chain.html#6725" class="Function">prefix</a> <a id="6794" href="Peras.Chain.html#6794" class="Bound">acc</a> <a id="6798" class="Symbol">(</a><a id="6799" href="Peras.Chain.html#6799" class="Bound">x</a> <a id="6801" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6803" href="Peras.Chain.html#6803" class="Bound">xs</a><a id="6805" class="Symbol">)</a> <a id="6807" class="Symbol">(</a><a id="6808" href="Peras.Chain.html#6808" class="Bound">y</a> <a id="6810" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6812" href="Peras.Chain.html#6812" class="Bound">ys</a><a id="6814" class="Symbol">)</a> <a id="6816" class="Symbol">=</a>
  <a id="6820" href="Haskell.Prim.html#1713" class="Function Operator">if</a> <a id="6823" href="Peras.Chain.html#6799" class="Bound">x</a> <a id="6825" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="6828" href="Peras.Chain.html#6808" class="Bound">y</a>
   <a id="6833" href="Haskell.Prim.html#1713" class="Function Operator">then</a> <a id="6838" href="Peras.Chain.html#6725" class="Function">prefix</a> <a id="6845" class="Symbol">(</a><a id="6846" href="Peras.Chain.html#6799" class="Bound">x</a> <a id="6848" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6850" href="Peras.Chain.html#6794" class="Bound">acc</a><a id="6853" class="Symbol">)</a> <a id="6855" href="Peras.Chain.html#6803" class="Bound">xs</a> <a id="6858" href="Peras.Chain.html#6812" class="Bound">ys</a>
   <a id="6864" href="Haskell.Prim.html#1713" class="Function Operator">else</a> <a id="6869" href="Haskell.Prelude.html#3598" class="Function">reverse</a> <a id="6877" href="Peras.Chain.html#6794" class="Bound">acc</a>
<a id="6881" href="Peras.Chain.html#6725" class="CatchallClause Function">prefix</a><a id="6887" class="CatchallClause"> </a><a id="6888" href="Peras.Chain.html#6888" class="CatchallClause Bound">acc</a><a id="6891" class="CatchallClause"> </a><a id="6892" class="CatchallClause Symbol">_</a><a id="6893" class="CatchallClause"> </a><a id="6894" class="CatchallClause Symbol">_</a> <a id="6896" class="Symbol">=</a> <a id="6898" href="Haskell.Prelude.html#3598" class="Function">reverse</a> <a id="6906" href="Peras.Chain.html#6888" class="Bound">acc</a>

<a id="6911" class="Symbol">{-#</a> <a id="6915" class="Keyword">COMPILE</a> <a id="6923" class="Keyword">AGDA2HS</a> <a id="6931" href="Peras.Chain.html#6725" class="Function">prefix</a> <a id="6938" class="Symbol">#-}</a>

<a id="commonPrefix"></a><a id="6943" href="Peras.Chain.html#6943" class="Function">commonPrefix</a> <a id="6956" class="Symbol">:</a> <a id="6958" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6963" href="Peras.Chain.html#3842" class="Function">Chain</a> <a id="6969" class="Symbol">-&gt;</a> <a id="6972" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6977" href="Peras.Block.html#2950" class="Record">Block</a>
<a id="6983" href="Peras.Chain.html#6943" class="Function">commonPrefix</a> <a id="6996" href="Peras.Chain.html#6996" class="Bound">chains</a> <a id="7003" class="Symbol">=</a>
  <a id="7007" href="Haskell.Prim.html#1609" class="Function Operator">case</a> <a id="7012" href="Peras.Chain.html#7096" class="Function">listPrefix</a> <a id="7023" href="Haskell.Prim.html#1609" class="Function Operator">of</a> <a id="7026" class="Symbol">λ</a> <a id="7028" class="Keyword">where</a>
     <a id="7039" href="Haskell.Prim.Maybe.html#142" class="InductiveConstructor">Nothing</a> <a id="7047" class="Symbol">-&gt;</a> <a id="7050" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
     <a id="7058" class="Symbol">(</a><a id="7059" href="Haskell.Prim.Maybe.html#162" class="InductiveConstructor">Just</a> <a id="7064" href="Peras.Chain.html#7064" class="Bound">bs</a><a id="7066" class="Symbol">)</a> <a id="7068" class="Symbol">-&gt;</a> <a id="7071" href="Haskell.Prelude.html#3598" class="Function">reverse</a> <a id="7079" href="Peras.Chain.html#7064" class="Bound">bs</a>
   <a id="7085" class="Keyword">where</a>
     <a id="7096" href="Peras.Chain.html#7096" class="Function">listPrefix</a> <a id="7107" class="Symbol">:</a> <a id="7109" href="Haskell.Prim.Maybe.html#101" class="Datatype">Maybe</a> <a id="7115" class="Symbol">(</a><a id="7116" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7121" href="Peras.Block.html#2950" class="Record">Block</a><a id="7126" class="Symbol">)</a>
     <a id="7133" href="Peras.Chain.html#7096" class="Function">listPrefix</a> <a id="7144" class="Symbol">=</a> <a id="7146" href="Peras.Chain.html#6451" class="Function">foldl1Maybe</a> <a id="7158" class="Symbol">(</a><a id="7159" href="Peras.Chain.html#6725" class="Function">prefix</a> <a id="7166" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="7168" class="Symbol">)</a> <a id="7170" class="Symbol">(</a><a id="7171" href="Haskell.Prim.List.html#211" class="Function">map</a> <a id="7175" class="Symbol">(λ</a> <a id="7178" href="Peras.Chain.html#7178" class="Bound">l</a> <a id="7180" class="Symbol">-&gt;</a> <a id="7183" href="Haskell.Prelude.html#3598" class="Function">reverse</a> <a id="7191" href="Peras.Chain.html#7178" class="Bound">l</a><a id="7192" class="Symbol">)</a> <a id="7194" href="Peras.Chain.html#6996" class="Bound">chains</a><a id="7200" class="Symbol">)</a>

<a id="7203" class="Symbol">{-#</a> <a id="7207" class="Keyword">COMPILE</a> <a id="7215" class="Keyword">AGDA2HS</a> <a id="7223" href="Peras.Chain.html#6943" class="Function">commonPrefix</a> <a id="7236" class="Symbol">#-}</a>

<a id="7241" class="Comment">-- I wish I could prove that and translate it to a QC property in Haskell :)</a>
<a id="7318" class="Comment">-- commonPrefixEq : {t : Set } -&gt; ⦃ eqt : Eq t ⦄ -&gt; (c₁ c₂ : Chain t) -&gt; (c₁ ≡ c₂) -&gt; (commonPrefix (c₁ ∷ c₂ ∷ []) ≡ c₁)</a>
<a id="7439" class="Comment">-- commonPrefixEq = {!!}</a>

<a id="7465" class="Comment">{-
postulate
  verifyLeadershipProof : Block → Bool

  properlyLinked : Chain → Bool
  decreasingSlots : Chain → Bool
-}</a>

<a id="7587" class="Comment">{-
correctBlocks : Chain → Bool
correctBlocks (MkChain blocks _ _) =
  let bs = toList BlockO blocks
  in all verifyLeadershipProof bs
-}</a>
</pre>-->
</body>
</html>
