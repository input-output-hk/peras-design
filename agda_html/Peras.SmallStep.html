<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Peras.SmallStep</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="Agda.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre class="Agda"><a id="9" class="Keyword">module</a> <a id="16" href="Peras.SmallStep.html" class="Module">Peras.SmallStep</a> <a id="32" class="Keyword">where</a>
</pre>
<!--
<pre class="Agda"><a id="55" class="Keyword">open</a> <a id="60" class="Keyword">import</a> <a id="67" href="Prelude.AssocList.html" class="Module">Prelude.AssocList</a>
<a id="85" class="Keyword">open</a> <a id="90" class="Keyword">import</a> <a id="97" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a> <a id="111" class="Keyword">using</a> <a id="117" class="Symbol">(</a><a id="118" href="Prelude.DecEq.html#62" class="Record">DecEq</a><a id="123" class="Symbol">)</a>
<a id="125" class="Keyword">open</a> <a id="130" class="Keyword">import</a> <a id="137" href="Prelude.Default.html" class="Module">Prelude.Default</a> <a id="153" class="Keyword">using</a> <a id="159" class="Symbol">(</a><a id="160" href="Prelude.Default.html#100" class="Record">Default</a><a id="167" class="Symbol">)</a>
<a id="169" class="Keyword">open</a> <a id="174" href="Prelude.Default.html#100" class="Module">Default</a> <a id="182" class="Symbol">â¦ƒ...â¦„</a>

<a id="189" class="Keyword">open</a> <a id="194" class="Keyword">import</a> <a id="201" href="Prelude.InferenceRules.html" class="Module">Prelude.InferenceRules</a>
<a id="224" class="Keyword">open</a> <a id="229" class="Keyword">import</a> <a id="236" href="Prelude.Init.html" class="Module">Prelude.Init</a> <a id="249" class="Keyword">hiding</a> <a id="256" class="Symbol">(</a><a id="257" href="Data.List.Relation.Binary.Sublist.Setoid.html#1567" class="Function Operator">_âŠ†_</a><a id="260" class="Symbol">)</a>

<a id="263" class="Keyword">open</a> <a id="268" href="Prelude.Init.html#940" class="Module">Nat</a> <a id="272" class="Keyword">using</a> <a id="278" class="Symbol">(</a><a id="279" href="Data.Nat.Properties.html#3311" class="Function Operator">_â‰Ÿ_</a><a id="282" class="Symbol">;</a> <a id="284" href="Data.Nat.Properties.html#6146" class="Function Operator">_â‰¤?_</a><a id="288" class="Symbol">;</a> <a id="290" href="Data.Nat.Base.html#1477" class="Function Operator">_â‰¤áµ‡_</a><a id="294" class="Symbol">;</a> <a id="296" href="Data.Nat.Properties.html#6212" class="Function Operator">_â‰¥?_</a><a id="300" class="Symbol">;</a> <a id="302" href="Data.Nat.Base.html#7279" class="Function Operator">_%_</a><a id="305" class="Symbol">;</a> <a id="307" href="Data.Nat.Properties.html#10900" class="Function Operator">_&gt;?_</a><a id="311" class="Symbol">;</a> <a id="313" href="Data.Nat.Base.html#3260" class="Record">NonZero</a><a id="320" class="Symbol">)</a>
<a id="322" class="Keyword">open</a> <a id="327" href="Prelude.Init.html#2456" class="Module">L</a> <a id="329" class="Keyword">using</a> <a id="335" class="Symbol">(</a><a id="336" href="Data.List.Base.html#4538" class="Function">concat</a><a id="342" class="Symbol">)</a>
<a id="344" class="Keyword">open</a> <a id="349" href="Prelude.Init.html#2546" class="Module">L.All</a> <a id="355" class="Keyword">using</a> <a id="361" class="Symbol">(</a><a id="362" href="Data.List.Relation.Unary.All.html#1627" class="Datatype">All</a><a id="365" class="Symbol">)</a>
<a id="367" class="Keyword">open</a> <a id="372" href="Prelude.Init.html#2680" class="Module">L.Any</a> <a id="378" class="Keyword">using</a> <a id="384" class="Symbol">(</a><a id="385" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a><a id="388" class="Symbol">;</a> <a id="390" href="Data.List.Relation.Unary.Any.html#2138" class="Function Operator">_â”€_</a><a id="393" class="Symbol">;</a> <a id="395" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a><a id="399" class="Symbol">)</a> <a id="401" class="Keyword">renaming</a> <a id="410" class="Symbol">(</a><a id="411" href="Data.List.Relation.Unary.Any.html#2027" class="Function Operator">_âˆ·=_</a> <a id="416" class="Symbol">to</a> <a id="419" class="Function Operator">_âˆ·Ë¡=_</a><a id="424" class="Symbol">)</a>

<a id="427" class="Keyword">open</a> <a id="432" class="Keyword">import</a> <a id="439" href="Peras.Block.html" class="Module">Peras.Block</a>
<a id="451" class="Keyword">open</a> <a id="456" class="Keyword">import</a> <a id="463" href="Peras.Chain.html" class="Module">Peras.Chain</a>
<a id="475" class="Keyword">open</a> <a id="480" class="Keyword">import</a> <a id="487" href="Peras.Crypto.html" class="Module">Peras.Crypto</a>
<a id="500" class="Keyword">open</a> <a id="505" class="Keyword">import</a> <a id="512" href="Peras.Numbering.html" class="Module">Peras.Numbering</a>
<a id="528" class="Keyword">open</a> <a id="533" class="Keyword">import</a> <a id="540" href="Peras.Params.html" class="Module">Peras.Params</a>

<a id="554" class="Keyword">open</a> <a id="559" class="Keyword">import</a> <a id="566" href="Data.List.Relation.Binary.Subset.Propositional.html" class="Module">Data.List.Relation.Binary.Subset.Propositional</a> <a id="613" class="Symbol">{</a><a id="614" class="Argument">A</a> <a id="616" class="Symbol">=</a> <a id="618" href="Peras.Block.html#2807" class="Record">Block</a><a id="623" class="Symbol">}</a> <a id="625" class="Keyword">using</a> <a id="631" class="Symbol">(</a><a id="632" href="Data.List.Relation.Binary.Subset.Setoid.html#825" class="Function Operator">_âŠ†_</a><a id="635" class="Symbol">)</a>
<a id="637" class="Keyword">open</a> <a id="642" class="Keyword">import</a> <a id="649" href="Data.List.Relation.Binary.Subset.Propositional.html" class="Module">Data.List.Relation.Binary.Subset.Propositional</a> <a id="696" class="Symbol">{</a><a id="697" class="Argument">A</a> <a id="699" class="Symbol">=</a> <a id="701" href="Peras.Block.html#2849" class="Record">Certificate</a><a id="712" class="Symbol">}</a> <a id="714" class="Keyword">renaming</a> <a id="723" class="Symbol">(</a><a id="724" href="Data.List.Relation.Binary.Subset.Setoid.html#825" class="Function Operator">_âŠ†_</a> <a id="728" class="Symbol">to</a> <a id="731" class="Function Operator">_âŠ†á¶œ_</a><a id="735" class="Symbol">)</a>

<a id="738" class="Keyword">import</a> <a id="745" href="Haskell.Prelude.html" class="Module">Haskell.Prelude</a> <a id="761" class="Symbol">as</a> <a id="764" class="Module">H</a> <a id="766" class="Comment">-- TODO: drop agda2hs Prelude here</a>

<a id="802" class="Keyword">open</a> <a id="807" href="Peras.Block.html#1872" class="Module">Honesty</a> <a id="815" class="Keyword">public</a>
<a id="822" class="Keyword">open</a> <a id="827" href="Peras.Crypto.html#2161" class="Module">MembershipProof</a> <a id="843" class="Keyword">public</a>
<a id="850" class="Keyword">open</a> <a id="855" href="Peras.Crypto.html#3115" class="Module">Signature</a> <a id="865" class="Keyword">public</a>
<a id="872" class="Keyword">open</a> <a id="877" href="Peras.Numbering.html#1669" class="Module">RoundNumber</a> <a id="889" class="Keyword">public</a>
<a id="896" class="Keyword">open</a> <a id="901" href="Peras.Block.html#1448" class="Module">Party</a>
</pre>-->
<h1 id="small-step-semantics">Small-step semantics</h1>
<p>The small-step semantics of the <strong>Ouroboros Peras</strong>
protocol define the evolution of the global state of the system
modelling <em>honest</em> and <em>adversarial</em> parties. The number
of parties is fixed during the execution of the protocol and the list of
parties has to be provided as a module parameter. In addition the model
is parameterized by the lotteries (for slot leadership and voting
committee membership) as well as the type of the block tree. Furthermore
adversarial parties share generic, adversarial state.</p>
<p>References:</p>
<ul>
<li>Formalizing Nakamoto-Style Proof of Stake, SÃ¸ren Eller Thomsen and
Bas Spitters</li>
</ul>
<h3 id="parameters">Parameters</h3>
<p>The parameters for the <em>Peras</em> protocol and hash functions are
defined as instance arguments of the module.</p>
<pre class="Agda"><a id="1681" class="Keyword">module</a> <a id="1688" href="Peras.SmallStep.html#1688" class="Module">_</a> <a id="1690" class="Symbol">â¦ƒ</a> <a id="1692" href="Peras.SmallStep.html#1692" class="Bound">_</a> <a id="1694" class="Symbol">:</a> <a id="1696" href="Peras.Crypto.html#1994" class="Record">Hashable</a> <a id="1705" href="Peras.Block.html#2807" class="Record">Block</a> <a id="1711" class="Symbol">â¦„</a>
         <a id="1722" class="Symbol">â¦ƒ</a> <a id="1724" href="Peras.SmallStep.html#1724" class="Bound">_</a> <a id="1726" class="Symbol">:</a> <a id="1728" href="Peras.Crypto.html#1994" class="Record">Hashable</a> <a id="1737" class="Symbol">(</a><a id="1738" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1743" href="Peras.Block.html#2329" class="Function">Tx</a><a id="1745" class="Symbol">)</a> <a id="1747" class="Symbol">â¦„</a>
         <a id="1758" class="Symbol">â¦ƒ</a> <a id="1760" href="Peras.SmallStep.html#1760" class="Bound">_</a> <a id="1762" class="Symbol">:</a> <a id="1764" href="Peras.Params.html#166" class="Record">Params</a> <a id="1771" class="Symbol">â¦„</a>
         <a id="1782" class="Symbol">â¦ƒ</a> <a id="1784" href="Peras.SmallStep.html#1784" class="Bound">_</a> <a id="1786" class="Symbol">:</a> <a id="1788" href="Peras.Chain.html#2526" class="Record">Network</a> <a id="1796" class="Symbol">â¦„</a>
         <a id="1807" class="Symbol">â¦ƒ</a> <a id="1809" href="Peras.SmallStep.html#1809" class="Bound">_</a> <a id="1811" class="Symbol">:</a> <a id="1813" href="Peras.Chain.html#2260" class="Record">Postulates</a> <a id="1824" class="Symbol">â¦„</a>

         <a id="1836" class="Keyword">where</a>
</pre>
The block tree, resp. the validity of the chain is defined with respect
of the parameters.
<pre class="Agda">  <a id="1951" class="Keyword">open</a> <a id="1956" href="Peras.Crypto.html#1994" class="Module">Hashable</a> <a id="1965" class="Symbol">â¦ƒ...â¦„</a>
  <a id="1973" class="Keyword">open</a> <a id="1978" href="Peras.Params.html#166" class="Module">Params</a> <a id="1985" class="Symbol">â¦ƒ...â¦„</a>
  <a id="1993" class="Keyword">open</a> <a id="1998" href="Peras.Chain.html#2526" class="Module">Network</a> <a id="2006" class="Symbol">â¦ƒ...â¦„</a>
  <a id="2014" class="Keyword">open</a> <a id="2019" href="Peras.Chain.html#2260" class="Module">Postulates</a> <a id="2030" class="Symbol">â¦ƒ...â¦„</a>
</pre>
<h4 id="messages">Messages</h4>
Messages for sending and receiving chains and votes. Note, in the
<em>Peras</em> protocol certificates are not diffused explicitly.
<pre class="Agda">  <a id="2190" class="Keyword">data</a> <a id="2195" href="Peras.SmallStep.html#2195" class="Datatype">Message</a> <a id="2203" class="Symbol">:</a> <a id="2205" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2210" class="Keyword">where</a>
    <a id="2220" href="Peras.SmallStep.html#2220" class="InductiveConstructor">ChainMsg</a> <a id="2229" class="Symbol">:</a> <a id="2231" class="Symbol">{</a><a id="2232" href="Peras.SmallStep.html#2232" class="Bound">c</a> <a id="2234" class="Symbol">:</a> <a id="2236" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="2241" class="Symbol">}</a> <a id="2243" class="Symbol">â†’</a> <a id="2245" href="Peras.Chain.html#6113" class="Datatype">ValidChain</a> <a id="2256" href="Peras.SmallStep.html#2232" class="Bound">c</a> <a id="2258" class="Symbol">â†’</a> <a id="2260" href="Peras.SmallStep.html#2195" class="Datatype">Message</a>
    <a id="2272" href="Peras.SmallStep.html#2272" class="InductiveConstructor">VoteMsg</a> <a id="2280" class="Symbol">:</a> <a id="2282" class="Symbol">{</a><a id="2283" href="Peras.SmallStep.html#2283" class="Bound">v</a> <a id="2285" class="Symbol">:</a> <a id="2287" href="Peras.Chain.html#1472" class="Record">Vote</a><a id="2291" class="Symbol">}</a> <a id="2293" class="Symbol">â†’</a> <a id="2295" href="Peras.Chain.html#2648" class="Function">ValidVote</a> <a id="2305" href="Peras.SmallStep.html#2283" class="Bound">v</a> <a id="2307" class="Symbol">â†’</a> <a id="2309" href="Peras.SmallStep.html#2195" class="Datatype">Message</a>
</pre>
Messages can be delayed by a number of slots
<pre class="Agda">  <a id="2376" href="Peras.SmallStep.html#2376" class="Function">Delay</a> <a id="2382" class="Symbol">=</a> <a id="2384" href="Data.Fin.Base.html#1154" class="Datatype">Fin</a> <a id="2388" class="Symbol">(</a><a id="2389" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="2393" class="Symbol">(</a><a id="2394" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="2398" href="Peras.Chain.html#2559" class="Field">Î”</a><a id="2399" class="Symbol">))</a>

  <a id="2405" class="Keyword">pattern</a> <a id="2413" href="Peras.SmallStep.html#2413" class="InductiveConstructor">ğŸ˜</a> <a id="2415" class="Symbol">=</a> <a id="2417" href="Data.Fin.Base.html#1176" class="InductiveConstructor">fzero</a>
  <a id="2425" class="Keyword">pattern</a> <a id="2433" href="Peras.SmallStep.html#2433" class="InductiveConstructor">ğŸ™</a> <a id="2435" class="Symbol">=</a> <a id="2437" href="Data.Fin.Base.html#1197" class="InductiveConstructor">fsuc</a> <a id="2442" href="Data.Fin.Base.html#1176" class="InductiveConstructor">fzero</a>
  <a id="2450" class="Keyword">pattern</a> <a id="2458" href="Peras.SmallStep.html#2458" class="InductiveConstructor">ğŸš</a> <a id="2460" class="Symbol">=</a> <a id="2462" href="Data.Fin.Base.html#1197" class="InductiveConstructor">fsuc</a> <a id="2467" class="Symbol">(</a><a id="2468" href="Data.Fin.Base.html#1197" class="InductiveConstructor">fsuc</a> <a id="2473" href="Data.Fin.Base.html#1176" class="InductiveConstructor">fzero</a><a id="2478" class="Symbol">)</a>
</pre>
Messages are put into an envelope and assigned to a party. The message
can be delayed.
<pre class="Agda">  <a id="2581" class="Keyword">record</a> <a id="2588" href="Peras.SmallStep.html#2588" class="Record">Envelope</a> <a id="2597" class="Symbol">:</a> <a id="2599" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2604" class="Keyword">where</a>
    <a id="2614" class="Keyword">constructor</a> <a id="2626" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">â¦…_,_,_,_â¦†</a>
    <a id="2640" class="Keyword">field</a>
      <a id="2652" href="Peras.SmallStep.html#2652" class="Field">partyId</a> <a id="2660" class="Symbol">:</a> <a id="2662" href="Peras.Block.html#1264" class="Function">PartyId</a>
      <a id="2676" href="Peras.SmallStep.html#2676" class="Field">honesty</a> <a id="2684" class="Symbol">:</a> <a id="2686" href="Peras.Block.html#1872" class="Datatype">Honesty</a> <a id="2694" href="Peras.SmallStep.html#2652" class="Field">partyId</a>
      <a id="2708" href="Peras.SmallStep.html#2708" class="Field">message</a> <a id="2716" class="Symbol">:</a> <a id="2718" href="Peras.SmallStep.html#2195" class="Datatype">Message</a>
      <a id="2732" href="Peras.SmallStep.html#2732" class="Field">delay</a> <a id="2738" class="Symbol">:</a> <a id="2740" href="Peras.SmallStep.html#2376" class="Function">Delay</a>

  <a id="2749" class="Keyword">open</a> <a id="2754" href="Peras.SmallStep.html#2588" class="Module">Envelope</a>
</pre>
<h4 id="block-tree">Block-tree</h4>
A block-tree is defined by properties - an implementation of the
block-tree has to fulfil all the properties mentioned below:
<pre class="Agda">  <a id="2920" class="Keyword">record</a> <a id="2927" href="Peras.SmallStep.html#2927" class="Record">IsTreeType</a> <a id="2938" class="Symbol">{</a><a id="2939" href="Peras.SmallStep.html#2939" class="Bound">T</a> <a id="2941" class="Symbol">:</a> <a id="2943" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="2947" class="Symbol">}</a>
                    <a id="2969" class="Symbol">(</a><a id="2970" href="Peras.SmallStep.html#2970" class="Bound">treeâ‚€</a> <a id="2976" class="Symbol">:</a> <a id="2978" href="Peras.SmallStep.html#2939" class="Bound">T</a><a id="2979" class="Symbol">)</a>
                    <a id="3001" class="Symbol">(</a><a id="3002" href="Peras.SmallStep.html#3002" class="Bound">addChain</a> <a id="3011" class="Symbol">:</a> <a id="3013" href="Peras.SmallStep.html#2939" class="Bound">T</a> <a id="3015" class="Symbol">â†’</a> <a id="3017" class="Symbol">{</a><a id="3018" href="Peras.SmallStep.html#3018" class="Bound">c</a> <a id="3020" class="Symbol">:</a> <a id="3022" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="3027" class="Symbol">}</a> <a id="3029" class="Symbol">â†’</a> <a id="3031" href="Peras.Chain.html#6113" class="Datatype">ValidChain</a> <a id="3042" href="Peras.SmallStep.html#3018" class="Bound">c</a> <a id="3044" class="Symbol">â†’</a> <a id="3046" href="Peras.SmallStep.html#2939" class="Bound">T</a><a id="3047" class="Symbol">)</a>
                    <a id="3069" class="Symbol">(</a><a id="3070" href="Peras.SmallStep.html#3070" class="Bound">chains</a> <a id="3077" class="Symbol">:</a> <a id="3079" href="Peras.SmallStep.html#2939" class="Bound">T</a> <a id="3081" class="Symbol">â†’</a> <a id="3083" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3088" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="3093" class="Symbol">)</a>
                    <a id="3115" class="Symbol">(</a><a id="3116" href="Peras.SmallStep.html#3116" class="Bound">preferredChain</a> <a id="3131" class="Symbol">:</a> <a id="3133" href="Peras.SmallStep.html#2939" class="Bound">T</a> <a id="3135" class="Symbol">â†’</a> <a id="3137" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="3142" class="Symbol">)</a>
                    <a id="3164" class="Symbol">(</a><a id="3165" href="Peras.SmallStep.html#3165" class="Bound">addVote</a> <a id="3173" class="Symbol">:</a> <a id="3175" href="Peras.SmallStep.html#2939" class="Bound">T</a> <a id="3177" class="Symbol">â†’</a> <a id="3179" class="Symbol">{</a><a id="3180" href="Peras.SmallStep.html#3180" class="Bound">v</a> <a id="3182" class="Symbol">:</a> <a id="3184" href="Peras.Chain.html#1472" class="Record">Vote</a><a id="3188" class="Symbol">}</a> <a id="3190" class="Symbol">â†’</a> <a id="3192" href="Peras.Chain.html#2648" class="Function">ValidVote</a> <a id="3202" href="Peras.SmallStep.html#3180" class="Bound">v</a> <a id="3204" class="Symbol">â†’</a> <a id="3206" href="Peras.SmallStep.html#2939" class="Bound">T</a><a id="3207" class="Symbol">)</a>
                    <a id="3229" class="Symbol">(</a><a id="3230" href="Peras.SmallStep.html#3230" class="Bound">votes</a> <a id="3236" class="Symbol">:</a> <a id="3238" href="Peras.SmallStep.html#2939" class="Bound">T</a> <a id="3240" class="Symbol">â†’</a> <a id="3242" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3247" href="Peras.Chain.html#1472" class="Record">Vote</a><a id="3251" class="Symbol">)</a>
                    <a id="3273" class="Symbol">(</a><a id="3274" href="Peras.SmallStep.html#3274" class="Bound">certs</a> <a id="3280" class="Symbol">:</a> <a id="3282" href="Peras.SmallStep.html#2939" class="Bound">T</a> <a id="3284" class="Symbol">â†’</a> <a id="3286" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3291" href="Peras.Block.html#2849" class="Record">Certificate</a><a id="3302" class="Symbol">)</a>
                    <a id="3324" class="Symbol">(</a><a id="3325" href="Peras.SmallStep.html#3325" class="Bound">certâ‚€</a> <a id="3331" class="Symbol">:</a> <a id="3333" href="Peras.Block.html#2849" class="Record">Certificate</a><a id="3344" class="Symbol">)</a>
         <a id="3355" class="Symbol">:</a> <a id="3357" href="Agda.Primitive.html#388" class="Primitive">Typeâ‚</a> <a id="3363" class="Keyword">where</a>

    <a id="3374" class="Keyword">field</a>
</pre>
Properties that must hold with respect to chains, certificates and
votes.
<pre class="Agda">      <a id="3472" href="Peras.SmallStep.html#3472" class="Field">instantiated</a> <a id="3485" class="Symbol">:</a>
        <a id="3495" href="Peras.SmallStep.html#3116" class="Bound">preferredChain</a> <a id="3510" href="Peras.SmallStep.html#2970" class="Bound">treeâ‚€</a> <a id="3516" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="3518" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

      <a id="3528" href="Peras.SmallStep.html#3528" class="Field">instantiated-certs</a> <a id="3547" class="Symbol">:</a>
        <a id="3557" href="Peras.SmallStep.html#3274" class="Bound">certs</a> <a id="3563" href="Peras.SmallStep.html#2970" class="Bound">treeâ‚€</a> <a id="3569" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="3571" href="Peras.SmallStep.html#3325" class="Bound">certâ‚€</a> <a id="3577" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">âˆ·</a> <a id="3579" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

      <a id="3589" href="Peras.SmallStep.html#3589" class="Field">instantiated-votes</a> <a id="3608" class="Symbol">:</a>
        <a id="3618" href="Peras.SmallStep.html#3230" class="Bound">votes</a> <a id="3624" href="Peras.SmallStep.html#2970" class="Bound">treeâ‚€</a> <a id="3630" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="3632" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

      <a id="3642" href="Peras.SmallStep.html#3642" class="Field">extendable-chain</a> <a id="3659" class="Symbol">:</a> <a id="3661" class="Symbol">âˆ€</a> <a id="3663" class="Symbol">(</a><a id="3664" href="Peras.SmallStep.html#3664" class="Bound">t</a> <a id="3666" class="Symbol">:</a> <a id="3668" href="Peras.SmallStep.html#2939" class="Bound">T</a><a id="3669" class="Symbol">)</a> <a id="3671" class="Symbol">{</a><a id="3672" href="Peras.SmallStep.html#3672" class="Bound">c</a> <a id="3674" class="Symbol">:</a> <a id="3676" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="3681" class="Symbol">}</a> <a id="3683" class="Symbol">(</a><a id="3684" href="Peras.SmallStep.html#3684" class="Bound">vc</a> <a id="3687" class="Symbol">:</a> <a id="3689" href="Peras.Chain.html#6113" class="Datatype">ValidChain</a> <a id="3700" href="Peras.SmallStep.html#3672" class="Bound">c</a><a id="3701" class="Symbol">)</a>
        <a id="3711" class="Symbol">â†’</a> <a id="3713" href="Peras.SmallStep.html#3274" class="Bound">certs</a> <a id="3719" class="Symbol">(</a><a id="3720" href="Peras.SmallStep.html#3002" class="Bound">addChain</a> <a id="3729" href="Peras.SmallStep.html#3664" class="Bound">t</a> <a id="3731" href="Peras.SmallStep.html#3684" class="Bound">vc</a><a id="3733" class="Symbol">)</a> <a id="3735" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="3737" href="Haskell.Prim.Foldable.html#528" class="Field">H.foldr</a> <a id="3745" href="Peras.Chain.html#3286" class="Function">insertCert</a> <a id="3756" class="Symbol">(</a><a id="3757" href="Peras.SmallStep.html#3274" class="Bound">certs</a> <a id="3763" href="Peras.SmallStep.html#3664" class="Bound">t</a><a id="3764" class="Symbol">)</a> <a id="3766" class="Symbol">(</a><a id="3767" href="Peras.Chain.html#3194" class="Function">certsFromChain</a> <a id="3782" href="Peras.SmallStep.html#3672" class="Bound">c</a><a id="3783" class="Symbol">)</a>

      <a id="3792" href="Peras.SmallStep.html#3792" class="Field">valid</a> <a id="3798" class="Symbol">:</a> <a id="3800" class="Symbol">âˆ€</a> <a id="3802" class="Symbol">(</a><a id="3803" href="Peras.SmallStep.html#3803" class="Bound">t</a> <a id="3805" class="Symbol">:</a> <a id="3807" href="Peras.SmallStep.html#2939" class="Bound">T</a><a id="3808" class="Symbol">)</a>
        <a id="3818" class="Symbol">â†’</a> <a id="3820" href="Peras.Chain.html#6113" class="Datatype">ValidChain</a> <a id="3831" class="Symbol">(</a><a id="3832" href="Peras.SmallStep.html#3116" class="Bound">preferredChain</a> <a id="3847" href="Peras.SmallStep.html#3803" class="Bound">t</a><a id="3848" class="Symbol">)</a>

      <a id="3857" href="Peras.SmallStep.html#3857" class="Field">optimal</a> <a id="3865" class="Symbol">:</a> <a id="3867" class="Symbol">âˆ€</a> <a id="3869" class="Symbol">(</a><a id="3870" href="Peras.SmallStep.html#3870" class="Bound">c</a> <a id="3872" class="Symbol">:</a> <a id="3874" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="3879" class="Symbol">)</a> <a id="3881" class="Symbol">(</a><a id="3882" href="Peras.SmallStep.html#3882" class="Bound">t</a> <a id="3884" class="Symbol">:</a> <a id="3886" href="Peras.SmallStep.html#2939" class="Bound">T</a><a id="3887" class="Symbol">)</a>
        <a id="3897" class="Symbol">â†’</a> <a id="3899" class="Keyword">let</a>
            <a id="3915" href="Peras.SmallStep.html#3915" class="Bound">b</a> <a id="3917" class="Symbol">=</a> <a id="3919" href="Peras.SmallStep.html#3116" class="Bound">preferredChain</a> <a id="3934" href="Peras.SmallStep.html#3882" class="Bound">t</a>
            <a id="3948" href="Peras.SmallStep.html#3948" class="Bound">cts</a> <a id="3952" class="Symbol">=</a> <a id="3954" href="Peras.SmallStep.html#3274" class="Bound">certs</a> <a id="3960" href="Peras.SmallStep.html#3882" class="Bound">t</a>
          <a id="3972" class="Keyword">in</a>
          <a id="3985" href="Peras.Chain.html#6113" class="Datatype">ValidChain</a> <a id="3996" href="Peras.SmallStep.html#3870" class="Bound">c</a>
        <a id="4006" class="Symbol">â†’</a> <a id="4008" href="Peras.SmallStep.html#3870" class="Bound">c</a> <a id="4010" href="Data.List.Membership.Setoid.html#950" class="Function Operator">âˆˆ</a> <a id="4012" href="Peras.SmallStep.html#3070" class="Bound">chains</a> <a id="4019" href="Peras.SmallStep.html#3882" class="Bound">t</a>
        <a id="4029" class="Symbol">â†’</a> <a id="4031" href="Peras.Chain.html#5590" class="Function Operator">âˆ¥</a> <a id="4033" href="Peras.SmallStep.html#3870" class="Bound">c</a> <a id="4035" href="Peras.Chain.html#5590" class="Function Operator">âˆ¥</a> <a id="4037" href="Peras.SmallStep.html#3948" class="Bound">cts</a> <a id="4041" href="Data.Nat.Base.html#1691" class="Datatype Operator">â‰¤</a> <a id="4043" href="Peras.Chain.html#5590" class="Function Operator">âˆ¥</a> <a id="4045" href="Peras.SmallStep.html#3915" class="Bound">b</a> <a id="4047" href="Peras.Chain.html#5590" class="Function Operator">âˆ¥</a> <a id="4049" href="Peras.SmallStep.html#3948" class="Bound">cts</a>

      <a id="4060" href="Peras.SmallStep.html#4060" class="Field">self-contained</a> <a id="4075" class="Symbol">:</a> <a id="4077" class="Symbol">âˆ€</a> <a id="4079" class="Symbol">(</a><a id="4080" href="Peras.SmallStep.html#4080" class="Bound">t</a> <a id="4082" class="Symbol">:</a> <a id="4084" href="Peras.SmallStep.html#2939" class="Bound">T</a><a id="4085" class="Symbol">)</a>
        <a id="4095" class="Symbol">â†’</a> <a id="4097" href="Peras.SmallStep.html#3116" class="Bound">preferredChain</a> <a id="4112" href="Peras.SmallStep.html#4080" class="Bound">t</a> <a id="4114" href="Data.List.Membership.Setoid.html#950" class="Function Operator">âˆˆ</a> <a id="4116" href="Peras.SmallStep.html#3070" class="Bound">chains</a> <a id="4123" href="Peras.SmallStep.html#4080" class="Bound">t</a>

<a id="4126" class="Comment">{-
      valid-votes : âˆ€ (t : T)
        â†’ All ValidVote (votes t)
-}</a>

      <a id="4203" href="Peras.SmallStep.html#4203" class="Field">unique-votes</a> <a id="4216" class="Symbol">:</a> <a id="4218" class="Symbol">âˆ€</a> <a id="4220" class="Symbol">(</a><a id="4221" href="Peras.SmallStep.html#4221" class="Bound">t</a> <a id="4223" class="Symbol">:</a> <a id="4225" href="Peras.SmallStep.html#2939" class="Bound">T</a><a id="4226" class="Symbol">)</a> <a id="4228" class="Symbol">{</a><a id="4229" href="Peras.SmallStep.html#4229" class="Bound">v</a> <a id="4231" class="Symbol">:</a> <a id="4233" href="Peras.Chain.html#1472" class="Record">Vote</a><a id="4237" class="Symbol">}</a> <a id="4239" class="Symbol">(</a><a id="4240" href="Peras.SmallStep.html#4240" class="Bound">vv</a> <a id="4243" class="Symbol">:</a> <a id="4245" href="Peras.Chain.html#2648" class="Function">ValidVote</a> <a id="4255" href="Peras.SmallStep.html#4229" class="Bound">v</a><a id="4256" class="Symbol">)</a>
        <a id="4266" class="Symbol">â†’</a> <a id="4268" class="Keyword">let</a> <a id="4272" href="Peras.SmallStep.html#4272" class="Bound">vs</a> <a id="4275" class="Symbol">=</a> <a id="4277" href="Peras.SmallStep.html#3230" class="Bound">votes</a> <a id="4283" href="Peras.SmallStep.html#4221" class="Bound">t</a>
          <a id="4295" class="Keyword">in</a>
          <a id="4308" href="Peras.SmallStep.html#4229" class="Bound">v</a> <a id="4310" href="Data.List.Membership.Setoid.html#950" class="Function Operator">âˆˆ</a> <a id="4312" href="Peras.SmallStep.html#4272" class="Bound">vs</a>
        <a id="4323" class="Symbol">â†’</a> <a id="4325" href="Peras.SmallStep.html#4272" class="Bound">vs</a> <a id="4328" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="4330" href="Peras.SmallStep.html#3230" class="Bound">votes</a> <a id="4336" class="Symbol">(</a><a id="4337" href="Peras.SmallStep.html#3165" class="Bound">addVote</a> <a id="4345" href="Peras.SmallStep.html#4221" class="Bound">t</a> <a id="4347" href="Peras.SmallStep.html#4240" class="Bound">vv</a><a id="4349" class="Symbol">)</a>

      <a id="4358" href="Peras.SmallStep.html#4358" class="Field">no-equivocations</a> <a id="4375" class="Symbol">:</a> <a id="4377" class="Symbol">âˆ€</a> <a id="4379" class="Symbol">(</a><a id="4380" href="Peras.SmallStep.html#4380" class="Bound">t</a> <a id="4382" class="Symbol">:</a> <a id="4384" href="Peras.SmallStep.html#2939" class="Bound">T</a><a id="4385" class="Symbol">)</a> <a id="4387" class="Symbol">{</a><a id="4388" href="Peras.SmallStep.html#4388" class="Bound">v</a> <a id="4390" class="Symbol">:</a> <a id="4392" href="Peras.Chain.html#1472" class="Record">Vote</a><a id="4396" class="Symbol">}</a> <a id="4398" class="Symbol">(</a><a id="4399" href="Peras.SmallStep.html#4399" class="Bound">vv</a> <a id="4402" class="Symbol">:</a> <a id="4404" href="Peras.Chain.html#2648" class="Function">ValidVote</a> <a id="4414" href="Peras.SmallStep.html#4388" class="Bound">v</a><a id="4415" class="Symbol">)</a>
        <a id="4425" class="Symbol">â†’</a> <a id="4427" class="Keyword">let</a> <a id="4431" href="Peras.SmallStep.html#4431" class="Bound">vs</a> <a id="4434" class="Symbol">=</a> <a id="4436" href="Peras.SmallStep.html#3230" class="Bound">votes</a> <a id="4442" href="Peras.SmallStep.html#4380" class="Bound">t</a>
          <a id="4454" class="Keyword">in</a>
          <a id="4467" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="4471" class="Symbol">(</a><a id="4472" href="Peras.SmallStep.html#4388" class="Bound">v</a> <a id="4474" href="Peras.Chain.html#2931" class="Datatype Operator">âˆ»_</a><a id="4476" class="Symbol">)</a> <a id="4478" href="Peras.SmallStep.html#4431" class="Bound">vs</a>
        <a id="4489" class="Symbol">â†’</a> <a id="4491" href="Peras.SmallStep.html#4431" class="Bound">vs</a> <a id="4494" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="4496" href="Peras.SmallStep.html#3230" class="Bound">votes</a> <a id="4502" class="Symbol">(</a><a id="4503" href="Peras.SmallStep.html#3165" class="Bound">addVote</a> <a id="4511" href="Peras.SmallStep.html#4380" class="Bound">t</a> <a id="4513" href="Peras.SmallStep.html#4399" class="Bound">vv</a><a id="4515" class="Symbol">)</a>

      <a id="4524" href="Peras.SmallStep.html#4524" class="Field">quorum-cert</a> <a id="4536" class="Symbol">:</a> <a id="4538" class="Symbol">âˆ€</a> <a id="4540" class="Symbol">(</a><a id="4541" href="Peras.SmallStep.html#4541" class="Bound">t</a> <a id="4543" class="Symbol">:</a> <a id="4545" href="Peras.SmallStep.html#2939" class="Bound">T</a><a id="4546" class="Symbol">)</a> <a id="4548" class="Symbol">(</a><a id="4549" href="Peras.SmallStep.html#4549" class="Bound">b</a> <a id="4551" class="Symbol">:</a> <a id="4553" href="Peras.Block.html#2807" class="Record">Block</a><a id="4558" class="Symbol">)</a> <a id="4560" class="Symbol">(</a><a id="4561" href="Peras.SmallStep.html#4561" class="Bound">r</a> <a id="4563" class="Symbol">:</a> <a id="4565" href="Agda.Builtin.Nat.html#203" class="Datatype">â„•</a><a id="4566" class="Symbol">)</a>
        <a id="4576" class="Symbol">â†’</a> <a id="4578" href="Data.List.Base.html#5083" class="Function">length</a> <a id="4585" class="Symbol">(</a><a id="4586" href="Data.List.Base.html#10878" class="Function">filter</a> <a id="4593" class="Symbol">(Î»</a> <a id="4596" class="Symbol">{</a><a id="4597" href="Peras.SmallStep.html#4597" class="Bound">v</a> <a id="4599" class="Symbol">â†’</a>
                    <a id="4621" class="Symbol">(</a><a id="4622" href="Peras.Numbering.html#1729" class="Field">getRoundNumber</a> <a id="4637" class="Symbol">(</a><a id="4638" href="Peras.Chain.html#1518" class="Field">votingRound</a> <a id="4650" href="Peras.SmallStep.html#4597" class="Bound">v</a><a id="4651" class="Symbol">)</a> <a id="4653" href="Data.Nat.Properties.html#3311" class="Function Operator">â‰Ÿ</a> <a id="4655" href="Peras.SmallStep.html#4561" class="Bound">r</a><a id="4656" class="Symbol">)</a>
              <a id="4672" href="Relation.Nullary.Decidable.Core.html#2609" class="Function Operator">Ã—-dec</a> <a id="4678" class="Symbol">(</a><a id="4679" href="Peras.Chain.html#1620" class="Field">blockHash</a> <a id="4689" href="Peras.SmallStep.html#4597" class="Bound">v</a> <a id="4691" href="Peras.Block.html#3542" class="Function Operator">â‰Ÿ-BlockHash</a> <a id="4703" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="4708" href="Peras.SmallStep.html#4549" class="Bound">b</a><a id="4709" class="Symbol">)}</a>
            <a id="4724" class="Symbol">)</a> <a id="4726" class="Symbol">(</a><a id="4727" href="Peras.SmallStep.html#3230" class="Bound">votes</a> <a id="4733" href="Peras.SmallStep.html#4541" class="Bound">t</a><a id="4734" class="Symbol">))</a> <a id="4737" href="Data.Nat.Base.html#2259" class="Function Operator">â‰¥</a> <a id="4739" href="Peras.Params.html#263" class="Field">Ï„</a>
        <a id="4749" class="Symbol">â†’</a> <a id="4751" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="4755" class="Symbol">(Î»</a> <a id="4758" class="Symbol">{</a><a id="4759" href="Peras.SmallStep.html#4759" class="Bound">c</a> <a id="4761" class="Symbol">â†’</a>
            <a id="4775" class="Symbol">(</a><a id="4776" href="Peras.Numbering.html#1729" class="Field">getRoundNumber</a> <a id="4791" class="Symbol">(</a><a id="4792" href="Peras.Block.html#2948" class="Field">round</a> <a id="4798" href="Peras.SmallStep.html#4759" class="Bound">c</a><a id="4799" class="Symbol">)</a> <a id="4801" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="4803" href="Peras.SmallStep.html#4561" class="Bound">r</a><a id="4804" class="Symbol">)</a>
          <a id="4816" href="Data.Product.Base.html#1618" class="Function Operator">Ã—</a> <a id="4818" class="Symbol">(</a><a id="4819" href="Peras.Block.html#2976" class="Field">blockRef</a> <a id="4828" href="Peras.SmallStep.html#4759" class="Bound">c</a> <a id="4830" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="4832" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="4837" href="Peras.SmallStep.html#4549" class="Bound">b</a><a id="4838" class="Symbol">)</a> <a id="4840" class="Symbol">})</a> <a id="4843" class="Symbol">(</a><a id="4844" href="Peras.SmallStep.html#3274" class="Bound">certs</a> <a id="4850" href="Peras.SmallStep.html#4541" class="Bound">t</a><a id="4851" class="Symbol">)</a>
</pre>
In addition to chains the block-tree manages votes and certificates as
well. The block-tree type is defined as follows:
<pre class="Agda">  <a id="4987" class="Keyword">record</a> <a id="4994" href="Peras.SmallStep.html#4994" class="Record">TreeType</a> <a id="5003" class="Symbol">(</a><a id="5004" href="Peras.SmallStep.html#5004" class="Bound">T</a> <a id="5006" class="Symbol">:</a> <a id="5008" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="5012" class="Symbol">)</a> <a id="5014" class="Symbol">:</a> <a id="5016" href="Agda.Primitive.html#388" class="Primitive">Typeâ‚</a> <a id="5022" class="Keyword">where</a>

    <a id="5033" class="Keyword">field</a>
      <a id="5045" href="Peras.SmallStep.html#5045" class="Field">treeâ‚€</a> <a id="5051" class="Symbol">:</a> <a id="5053" href="Peras.SmallStep.html#5004" class="Bound">T</a>

      <a id="5062" href="Peras.SmallStep.html#5062" class="Field">addChain</a> <a id="5071" class="Symbol">:</a> <a id="5073" href="Peras.SmallStep.html#5004" class="Bound">T</a> <a id="5075" class="Symbol">â†’</a> <a id="5077" class="Symbol">{</a><a id="5078" href="Peras.SmallStep.html#5078" class="Bound">c</a> <a id="5080" class="Symbol">:</a> <a id="5082" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="5087" class="Symbol">}</a> <a id="5089" class="Symbol">â†’</a> <a id="5091" href="Peras.Chain.html#6113" class="Datatype">ValidChain</a> <a id="5102" href="Peras.SmallStep.html#5078" class="Bound">c</a> <a id="5104" class="Symbol">â†’</a> <a id="5106" href="Peras.SmallStep.html#5004" class="Bound">T</a>
      <a id="5114" href="Peras.SmallStep.html#5114" class="Field">chains</a> <a id="5121" class="Symbol">:</a> <a id="5123" href="Peras.SmallStep.html#5004" class="Bound">T</a> <a id="5125" class="Symbol">â†’</a> <a id="5127" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5132" href="Peras.Chain.html#3111" class="Function">Chain</a>
      <a id="5144" href="Peras.SmallStep.html#5144" class="Field">preferredChain</a> <a id="5159" class="Symbol">:</a> <a id="5161" href="Peras.SmallStep.html#5004" class="Bound">T</a> <a id="5163" class="Symbol">â†’</a> <a id="5165" href="Peras.Chain.html#3111" class="Function">Chain</a>

      <a id="5178" href="Peras.SmallStep.html#5178" class="Field">addVote</a> <a id="5186" class="Symbol">:</a> <a id="5188" href="Peras.SmallStep.html#5004" class="Bound">T</a> <a id="5190" class="Symbol">â†’</a> <a id="5192" class="Symbol">{</a><a id="5193" href="Peras.SmallStep.html#5193" class="Bound">v</a> <a id="5195" class="Symbol">:</a> <a id="5197" href="Peras.Chain.html#1472" class="Record">Vote</a><a id="5201" class="Symbol">}</a> <a id="5203" class="Symbol">â†’</a> <a id="5205" href="Peras.Chain.html#2648" class="Function">ValidVote</a> <a id="5215" href="Peras.SmallStep.html#5193" class="Bound">v</a> <a id="5217" class="Symbol">â†’</a> <a id="5219" href="Peras.SmallStep.html#5004" class="Bound">T</a>
      <a id="5227" href="Peras.SmallStep.html#5227" class="Field">votes</a> <a id="5233" class="Symbol">:</a> <a id="5235" href="Peras.SmallStep.html#5004" class="Bound">T</a> <a id="5237" class="Symbol">â†’</a> <a id="5239" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5244" href="Peras.Chain.html#1472" class="Record">Vote</a>

      <a id="5256" href="Peras.SmallStep.html#5256" class="Field">certs</a> <a id="5262" class="Symbol">:</a> <a id="5264" href="Peras.SmallStep.html#5004" class="Bound">T</a> <a id="5266" class="Symbol">â†’</a> <a id="5268" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5273" href="Peras.Block.html#2849" class="Record">Certificate</a>

    <a id="5290" href="Peras.SmallStep.html#5290" class="Function">certâ‚€</a> <a id="5296" class="Symbol">:</a> <a id="5298" href="Peras.Block.html#2849" class="Record">Certificate</a>
    <a id="5314" href="Peras.SmallStep.html#5290" class="Function">certâ‚€</a> <a id="5320" class="Symbol">=</a> <a id="5322" href="Peras.Block.html#2926" class="InductiveConstructor">MkCertificate</a> <a id="5336" class="Symbol">(</a><a id="5337" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="5351" class="Number">0</a><a id="5352" class="Symbol">)</a> <a id="5354" class="Symbol">(</a><a id="5355" href="Peras.Crypto.html#1583" class="InductiveConstructor">MkHash</a> <a id="5362" href="Peras.Crypto.html#676" class="Postulate">emptyBS</a><a id="5369" class="Symbol">)</a>

    <a id="5376" class="Keyword">field</a>
      <a id="5388" href="Peras.SmallStep.html#5388" class="Field">is-TreeType</a> <a id="5400" class="Symbol">:</a> <a id="5402" href="Peras.SmallStep.html#2927" class="Record">IsTreeType</a>
                      <a id="5435" href="Peras.SmallStep.html#5045" class="Field">treeâ‚€</a> <a id="5441" href="Peras.SmallStep.html#5062" class="Field">addChain</a> <a id="5450" href="Peras.SmallStep.html#5114" class="Field">chains</a> <a id="5457" href="Peras.SmallStep.html#5144" class="Field">preferredChain</a>
                      <a id="5494" href="Peras.SmallStep.html#5178" class="Field">addVote</a> <a id="5502" href="Peras.SmallStep.html#5227" class="Field">votes</a> <a id="5508" href="Peras.SmallStep.html#5256" class="Field">certs</a> <a id="5514" href="Peras.SmallStep.html#5290" class="Function">certâ‚€</a>

    <a id="5525" href="Peras.SmallStep.html#5525" class="Function">latestCertOnChain</a> <a id="5543" class="Symbol">:</a> <a id="5545" href="Peras.SmallStep.html#5004" class="Bound">T</a> <a id="5547" class="Symbol">â†’</a> <a id="5549" href="Peras.Block.html#2849" class="Record">Certificate</a>
    <a id="5565" href="Peras.SmallStep.html#5525" class="Function">latestCertOnChain</a> <a id="5583" class="Symbol">=</a>
      <a id="5591" href="Peras.Block.html#3080" class="Function">latestCert</a> <a id="5602" href="Peras.SmallStep.html#5290" class="Function">certâ‚€</a> <a id="5608" href="Function.Base.html#1115" class="Function Operator">âˆ˜</a> <a id="5610" href="Data.List.Base.html#1716" class="Function">L.mapMaybe</a> <a id="5621" href="Peras.Block.html#3326" class="Field">certificate</a> <a id="5633" href="Function.Base.html#1115" class="Function Operator">âˆ˜</a> <a id="5635" href="Peras.SmallStep.html#5144" class="Field">preferredChain</a>

    <a id="5655" href="Peras.SmallStep.html#5655" class="Function">latestCertSeen</a> <a id="5670" class="Symbol">:</a> <a id="5672" href="Peras.SmallStep.html#5004" class="Bound">T</a> <a id="5674" class="Symbol">â†’</a> <a id="5676" href="Peras.Block.html#2849" class="Record">Certificate</a>
    <a id="5692" href="Peras.SmallStep.html#5655" class="Function">latestCertSeen</a> <a id="5707" class="Symbol">=</a> <a id="5709" href="Peras.Block.html#3080" class="Function">latestCert</a> <a id="5720" href="Peras.SmallStep.html#5290" class="Function">certâ‚€</a> <a id="5726" href="Function.Base.html#1115" class="Function Operator">âˆ˜</a> <a id="5728" href="Peras.SmallStep.html#5256" class="Field">certs</a>

    <a id="5739" href="Peras.SmallStep.html#5739" class="Function">hasCert</a> <a id="5747" class="Symbol">:</a> <a id="5749" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="5761" class="Symbol">â†’</a> <a id="5763" href="Peras.SmallStep.html#5004" class="Bound">T</a> <a id="5765" class="Symbol">â†’</a> <a id="5767" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="5776" href="Peras.SmallStep.html#5739" class="Function">hasCert</a> <a id="5784" class="Symbol">(</a><a id="5785" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="5799" href="Peras.SmallStep.html#5799" class="Bound">r</a><a id="5800" class="Symbol">)</a> <a id="5802" class="Symbol">=</a> <a id="5804" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="5808" class="Symbol">((</a><a id="5810" href="Peras.SmallStep.html#5799" class="Bound">r</a> <a id="5812" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡_</a><a id="5814" class="Symbol">)</a> <a id="5816" href="Function.Base.html#1115" class="Function Operator">âˆ˜</a> <a id="5818" href="Peras.Block.html#3001" class="Function">roundNumber</a><a id="5829" class="Symbol">)</a> <a id="5831" href="Function.Base.html#1115" class="Function Operator">âˆ˜</a> <a id="5833" href="Peras.SmallStep.html#5256" class="Field">certs</a>

    <a id="5844" href="Peras.SmallStep.html#5844" class="Function">hasCert?</a> <a id="5853" class="Symbol">:</a> <a id="5855" class="Symbol">(</a><a id="5856" href="Peras.SmallStep.html#5856" class="Bound">r</a> <a id="5858" class="Symbol">:</a> <a id="5860" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a><a id="5871" class="Symbol">)</a> <a id="5873" class="Symbol">(</a><a id="5874" href="Peras.SmallStep.html#5874" class="Bound">t</a> <a id="5876" class="Symbol">:</a> <a id="5878" href="Peras.SmallStep.html#5004" class="Bound">T</a><a id="5879" class="Symbol">)</a> <a id="5881" class="Symbol">â†’</a> <a id="5883" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="5887" class="Symbol">(</a><a id="5888" href="Peras.SmallStep.html#5739" class="Function">hasCert</a> <a id="5896" href="Peras.SmallStep.html#5856" class="Bound">r</a> <a id="5898" href="Peras.SmallStep.html#5874" class="Bound">t</a><a id="5899" class="Symbol">)</a>
    <a id="5905" href="Peras.SmallStep.html#5844" class="Function">hasCert?</a> <a id="5914" class="Symbol">(</a><a id="5915" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="5929" href="Peras.SmallStep.html#5929" class="Bound">r</a><a id="5930" class="Symbol">)</a> <a id="5932" class="Symbol">=</a> <a id="5934" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a> <a id="5939" class="Symbol">((</a><a id="5941" href="Peras.SmallStep.html#5929" class="Bound">r</a> <a id="5943" href="Data.Nat.Properties.html#3311" class="Function Operator">â‰Ÿ_</a><a id="5945" class="Symbol">)</a> <a id="5947" href="Function.Base.html#1115" class="Function Operator">âˆ˜</a> <a id="5949" href="Peras.Block.html#3001" class="Function">roundNumber</a><a id="5960" class="Symbol">)</a> <a id="5962" href="Function.Base.html#1115" class="Function Operator">âˆ˜</a> <a id="5964" href="Peras.SmallStep.html#5256" class="Field">certs</a>

    <a id="5975" href="Peras.SmallStep.html#5975" class="Function">hasVote</a> <a id="5983" class="Symbol">:</a> <a id="5985" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="5997" class="Symbol">â†’</a> <a id="5999" href="Peras.SmallStep.html#5004" class="Bound">T</a> <a id="6001" class="Symbol">â†’</a> <a id="6003" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="6012" href="Peras.SmallStep.html#5975" class="Function">hasVote</a> <a id="6020" class="Symbol">(</a><a id="6021" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="6035" href="Peras.SmallStep.html#6035" class="Bound">r</a><a id="6036" class="Symbol">)</a> <a id="6038" class="Symbol">=</a> <a id="6040" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="6044" class="Symbol">((</a><a id="6046" href="Peras.SmallStep.html#6035" class="Bound">r</a> <a id="6048" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡_</a><a id="6050" class="Symbol">)</a> <a id="6052" href="Function.Base.html#1115" class="Function Operator">âˆ˜</a> <a id="6054" href="Peras.Chain.html#1680" class="Function">votingRound&#39;</a><a id="6066" class="Symbol">)</a> <a id="6068" href="Function.Base.html#1115" class="Function Operator">âˆ˜</a> <a id="6070" href="Peras.SmallStep.html#5227" class="Field">votes</a>

    <a id="6081" href="Peras.SmallStep.html#6081" class="Function">hasVote?</a> <a id="6090" class="Symbol">:</a> <a id="6092" class="Symbol">(</a><a id="6093" href="Peras.SmallStep.html#6093" class="Bound">r</a> <a id="6095" class="Symbol">:</a> <a id="6097" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a><a id="6108" class="Symbol">)</a> <a id="6110" class="Symbol">(</a><a id="6111" href="Peras.SmallStep.html#6111" class="Bound">t</a> <a id="6113" class="Symbol">:</a> <a id="6115" href="Peras.SmallStep.html#5004" class="Bound">T</a><a id="6116" class="Symbol">)</a> <a id="6118" class="Symbol">â†’</a> <a id="6120" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="6124" class="Symbol">(</a><a id="6125" href="Peras.SmallStep.html#5975" class="Function">hasVote</a> <a id="6133" href="Peras.SmallStep.html#6093" class="Bound">r</a> <a id="6135" href="Peras.SmallStep.html#6111" class="Bound">t</a><a id="6136" class="Symbol">)</a>
    <a id="6142" href="Peras.SmallStep.html#6081" class="Function">hasVote?</a> <a id="6151" class="Symbol">(</a><a id="6152" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="6166" href="Peras.SmallStep.html#6166" class="Bound">r</a><a id="6167" class="Symbol">)</a> <a id="6169" class="Symbol">=</a> <a id="6171" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a> <a id="6176" class="Symbol">((</a><a id="6178" href="Peras.SmallStep.html#6166" class="Bound">r</a> <a id="6180" href="Data.Nat.Properties.html#3311" class="Function Operator">â‰Ÿ_</a><a id="6182" class="Symbol">)</a> <a id="6184" href="Function.Base.html#1115" class="Function Operator">âˆ˜</a> <a id="6186" href="Peras.Chain.html#1680" class="Function">votingRound&#39;</a><a id="6198" class="Symbol">)</a> <a id="6200" href="Function.Base.html#1115" class="Function Operator">âˆ˜</a> <a id="6202" href="Peras.SmallStep.html#5227" class="Field">votes</a>

    <a id="6213" href="Peras.SmallStep.html#6213" class="Function">allBlocks</a> <a id="6223" class="Symbol">:</a> <a id="6225" href="Peras.SmallStep.html#5004" class="Bound">T</a> <a id="6227" class="Symbol">â†’</a> <a id="6229" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6234" href="Peras.Block.html#2807" class="Record">Block</a>
    <a id="6244" href="Peras.SmallStep.html#6213" class="Function">allBlocks</a> <a id="6254" class="Symbol">=</a> <a id="6256" href="Data.List.Base.html#4538" class="Function">concat</a> <a id="6263" href="Function.Base.html#1115" class="Function Operator">âˆ˜</a> <a id="6265" href="Peras.SmallStep.html#5114" class="Field">chains</a>
</pre>
<h3 id="additional-parameters">Additional parameters</h3>
<p>In order to define the semantics the following parameters are
required additionally:</p>
<ul>
<li>The type of the block-tree</li>
<li>adversarialStateâ‚€ is the initial adversarial state</li>
<li>Tx selection function per party and slot number</li>
<li>The list of parties</li>
</ul>
<pre class="Agda">  <a id="6562" class="Keyword">module</a> <a id="6569" href="Peras.SmallStep.html#6569" class="Module">Semantics</a>
           <a id="6590" class="Symbol">{</a><a id="6591" href="Peras.SmallStep.html#6591" class="Bound">T</a> <a id="6593" class="Symbol">:</a> <a id="6595" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="6599" class="Symbol">}</a> <a id="6601" class="Symbol">{</a><a id="6602" href="Peras.SmallStep.html#6602" class="Bound">blockTree</a> <a id="6612" class="Symbol">:</a> <a id="6614" href="Peras.SmallStep.html#4994" class="Record">TreeType</a> <a id="6623" href="Peras.SmallStep.html#6591" class="Bound">T</a><a id="6624" class="Symbol">}</a>
           <a id="6637" class="Symbol">{</a><a id="6638" href="Peras.SmallStep.html#6638" class="Bound">S</a> <a id="6640" class="Symbol">:</a> <a id="6642" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="6646" class="Symbol">}</a> <a id="6648" class="Symbol">{</a><a id="6649" href="Peras.SmallStep.html#6649" class="Bound">adversarialStateâ‚€</a> <a id="6667" class="Symbol">:</a> <a id="6669" href="Peras.SmallStep.html#6638" class="Bound">S</a><a id="6670" class="Symbol">}</a>
           <a id="6683" class="Symbol">{</a><a id="6684" href="Peras.SmallStep.html#6684" class="Bound">txSelection</a> <a id="6696" class="Symbol">:</a> <a id="6698" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="6709" class="Symbol">â†’</a> <a id="6711" href="Peras.Block.html#1264" class="Function">PartyId</a> <a id="6719" class="Symbol">â†’</a> <a id="6721" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6726" href="Peras.Block.html#2329" class="Function">Tx</a><a id="6728" class="Symbol">}</a>
           <a id="6741" class="Symbol">{</a><a id="6742" href="Peras.SmallStep.html#6742" class="Bound">parties</a> <a id="6750" class="Symbol">:</a> <a id="6752" href="Peras.Block.html#2033" class="Function">Parties</a><a id="6759" class="Symbol">}</a> <a id="6761" class="Comment">-- TODO: use parties from blockTrees</a>
                               <a id="6829" class="Comment">-- i.e. allow dynamic participation</a>
           <a id="6876" class="Keyword">where</a>

    <a id="6887" class="Keyword">open</a> <a id="6892" href="Peras.SmallStep.html#4994" class="Module">TreeType</a> <a id="6901" href="Peras.SmallStep.html#6602" class="Bound">blockTree</a>

    <a id="6916" class="Keyword">private</a>
      <a id="6930" class="Keyword">instance</a>
        <a id="6947" href="Peras.SmallStep.html#6947" class="Function">Default-T</a> <a id="6957" class="Symbol">:</a> <a id="6959" href="Prelude.Default.html#100" class="Record">Default</a> <a id="6967" href="Peras.SmallStep.html#6591" class="Bound">T</a>
        <a id="6977" href="Peras.SmallStep.html#6947" class="Function">Default-T</a> <a id="6987" class="Symbol">.</a><a id="6988" href="Prelude.Default.html#140" class="Field">def</a> <a id="6992" class="Symbol">=</a> <a id="6994" href="Peras.SmallStep.html#5045" class="Function">treeâ‚€</a>
</pre>
<h4 id="block-tree-update">Block-tree update</h4>
<p>Updating the block-tree upon receiving a message for vote and block
messages.</p>
<pre class="Agda">    <a id="7119" class="Keyword">data</a> <a id="7124" href="Peras.SmallStep.html#7124" class="Datatype Operator">_[_]â†’_</a> <a id="7131" class="Symbol">:</a> <a id="7133" href="Peras.SmallStep.html#6591" class="Bound">T</a> <a id="7135" class="Symbol">â†’</a> <a id="7137" href="Peras.SmallStep.html#2195" class="Datatype">Message</a> <a id="7145" class="Symbol">â†’</a> <a id="7147" href="Peras.SmallStep.html#6591" class="Bound">T</a> <a id="7149" class="Symbol">â†’</a> <a id="7151" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7156" class="Keyword">where</a>

      <a id="7169" href="Peras.SmallStep.html#7169" class="InductiveConstructor">VoteReceived</a> <a id="7182" class="Symbol">:</a> <a id="7184" class="Symbol">âˆ€</a> <a id="7186" class="Symbol">{</a><a id="7187" href="Peras.SmallStep.html#7187" class="Bound">v</a> <a id="7189" href="Peras.SmallStep.html#7189" class="Bound">vv</a> <a id="7192" href="Peras.SmallStep.html#7192" class="Bound">t</a><a id="7193" class="Symbol">}</a> <a id="7195" class="Symbol">â†’</a>
          <a id="7207" href="Prelude.InferenceRules.html#45702" class="Function Operator">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</a>
          <a id="7246" href="Peras.SmallStep.html#7192" class="Bound">t</a> <a id="7248" href="Peras.SmallStep.html#7124" class="Datatype Operator">[</a> <a id="7250" href="Peras.SmallStep.html#2272" class="InductiveConstructor">VoteMsg</a> <a id="7258" class="Symbol">{</a><a id="7259" href="Peras.SmallStep.html#7187" class="Bound">v</a><a id="7260" class="Symbol">}</a> <a id="7262" href="Peras.SmallStep.html#7189" class="Bound">vv</a> <a id="7265" href="Peras.SmallStep.html#7124" class="Datatype Operator">]â†’</a> <a id="7268" href="Peras.SmallStep.html#5178" class="Function">addVote</a> <a id="7276" href="Peras.SmallStep.html#7192" class="Bound">t</a> <a id="7278" href="Peras.SmallStep.html#7189" class="Bound">vv</a>

      <a id="7288" href="Peras.SmallStep.html#7288" class="InductiveConstructor">ChainReceived</a> <a id="7302" class="Symbol">:</a> <a id="7304" class="Symbol">âˆ€</a> <a id="7306" class="Symbol">{</a><a id="7307" href="Peras.SmallStep.html#7307" class="Bound">c</a> <a id="7309" href="Peras.SmallStep.html#7309" class="Bound">vc</a> <a id="7312" href="Peras.SmallStep.html#7312" class="Bound">t</a><a id="7313" class="Symbol">}</a> <a id="7315" class="Symbol">â†’</a>
          <a id="7327" href="Prelude.InferenceRules.html#45468" class="Function Operator">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</a>
          <a id="7368" href="Peras.SmallStep.html#7312" class="Bound">t</a> <a id="7370" href="Peras.SmallStep.html#7124" class="Datatype Operator">[</a> <a id="7372" href="Peras.SmallStep.html#2220" class="InductiveConstructor">ChainMsg</a> <a id="7381" class="Symbol">{</a><a id="7382" href="Peras.SmallStep.html#7307" class="Bound">c</a><a id="7383" class="Symbol">}</a> <a id="7385" href="Peras.SmallStep.html#7309" class="Bound">vc</a> <a id="7388" href="Peras.SmallStep.html#7124" class="Datatype Operator">]â†’</a> <a id="7391" href="Peras.SmallStep.html#5062" class="Function">addChain</a> <a id="7400" href="Peras.SmallStep.html#7312" class="Bound">t</a> <a id="7402" href="Peras.SmallStep.html#7309" class="Bound">vc</a>
</pre>
<h4 id="vote-in-round">Vote in round</h4>
<p>When does a party vote in a round? The protocol expects regular
voting, i.e.Â if in the previous round a quorum has been achieved or that
voting resumes after a cool-down phase.</p>
<h4 id="blockselection">BlockSelection</h4>
<pre class="Agda">    <a id="7639" href="Peras.SmallStep.html#7639" class="Function">BlockSelection&#39;</a> <a id="7655" class="Symbol">:</a> <a id="7657" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="7668" class="Symbol">â†’</a> <a id="7670" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="7676" class="Symbol">â†’</a> <a id="7678" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="7683" href="Peras.Block.html#2807" class="Record">Block</a>
    <a id="7693" href="Peras.SmallStep.html#7639" class="Function">BlockSelection&#39;</a> <a id="7709" class="Symbol">(</a><a id="7710" href="Peras.Numbering.html#779" class="InductiveConstructor">MkSlotNumber</a> <a id="7723" href="Peras.SmallStep.html#7723" class="Bound">s</a><a id="7724" class="Symbol">)</a> <a id="7726" class="Symbol">=</a>
      <a id="7734" href="Peras.Block.html#5471" class="Function">tipHash</a> <a id="7742" href="Function.Base.html#1115" class="Function Operator">âˆ˜</a> <a id="7744" href="Data.List.Base.html#10878" class="Function">filter</a> <a id="7751" class="Symbol">(Î»</a> <a id="7754" class="Symbol">{</a><a id="7755" href="Peras.SmallStep.html#7755" class="Bound">b</a> <a id="7757" class="Symbol">â†’</a> <a id="7759" class="Symbol">(</a><a id="7760" href="Peras.Block.html#3465" class="Function">slotNumber&#39;</a> <a id="7772" href="Peras.SmallStep.html#7755" class="Bound">b</a><a id="7773" class="Symbol">)</a> <a id="7775" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="7777" href="Peras.Params.html#235" class="Field">L</a> <a id="7779" href="Data.Nat.Properties.html#6146" class="Function Operator">â‰¤?</a> <a id="7782" href="Peras.SmallStep.html#7723" class="Bound">s</a><a id="7783" class="Symbol">})</a>

    <a id="7791" href="Peras.SmallStep.html#7791" class="Function">BlockSelection</a> <a id="7806" class="Symbol">:</a> <a id="7808" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="7819" class="Symbol">â†’</a> <a id="7821" href="Peras.SmallStep.html#6591" class="Bound">T</a> <a id="7823" class="Symbol">â†’</a> <a id="7825" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="7830" href="Peras.Block.html#2807" class="Record">Block</a>
    <a id="7840" href="Peras.SmallStep.html#7791" class="Function">BlockSelection</a> <a id="7855" href="Peras.SmallStep.html#7855" class="Bound">s</a> <a id="7857" class="Symbol">=</a> <a id="7859" href="Peras.SmallStep.html#7639" class="Function">BlockSelection&#39;</a> <a id="7875" href="Peras.SmallStep.html#7855" class="Bound">s</a> <a id="7877" href="Function.Base.html#1115" class="Function Operator">âˆ˜</a> <a id="7879" href="Peras.SmallStep.html#5144" class="Function">preferredChain</a>
</pre>
<h4 id="voting-rules">Voting rules</h4>
VR-1A: A party has seen a certificate cert-râˆ’1 for round râˆ’1
<pre class="Agda">    <a id="7990" href="Peras.SmallStep.html#7990" class="Function">VotingRule-1A</a> <a id="8004" class="Symbol">:</a> <a id="8006" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="8018" class="Symbol">â†’</a> <a id="8020" href="Peras.SmallStep.html#6591" class="Bound">T</a> <a id="8022" class="Symbol">â†’</a> <a id="8024" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="8033" href="Peras.SmallStep.html#7990" class="Function">VotingRule-1A</a> <a id="8047" class="Symbol">(</a><a id="8048" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="8062" href="Peras.SmallStep.html#8062" class="Bound">r</a><a id="8063" class="Symbol">)</a> <a id="8065" href="Peras.SmallStep.html#8065" class="Bound">t</a> <a id="8067" class="Symbol">=</a> <a id="8069" href="Peras.SmallStep.html#8062" class="Bound">r</a> <a id="8071" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="8073" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="8077" class="Symbol">(</a><a id="8078" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="8090" class="Symbol">(</a><a id="8091" href="Peras.SmallStep.html#5655" class="Function">latestCertSeen</a> <a id="8106" href="Peras.SmallStep.html#8065" class="Bound">t</a><a id="8107" class="Symbol">))</a>
</pre>
VR-1B: The extends the block certified by cert-râˆ’1,
<pre class="Agda">    <a id="8179" href="Peras.SmallStep.html#8179" class="Function">VotingRule-1B</a> <a id="8193" class="Symbol">:</a> <a id="8195" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="8206" class="Symbol">â†’</a> <a id="8208" href="Peras.SmallStep.html#6591" class="Bound">T</a> <a id="8210" class="Symbol">â†’</a> <a id="8212" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="8221" href="Peras.SmallStep.html#8179" class="Function">VotingRule-1B</a> <a id="8235" href="Peras.SmallStep.html#8235" class="Bound">s</a> <a id="8237" href="Peras.SmallStep.html#8237" class="Bound">t</a> <a id="8239" class="Symbol">=</a> <a id="8241" href="Peras.Chain.html#4442" class="Function">Extends</a> <a id="8249" class="Symbol">(</a><a id="8250" href="Peras.SmallStep.html#7791" class="Function">BlockSelection</a> <a id="8265" href="Peras.SmallStep.html#8235" class="Bound">s</a> <a id="8267" href="Peras.SmallStep.html#8237" class="Bound">t</a><a id="8268" class="Symbol">)</a> <a id="8270" class="Symbol">(</a><a id="8271" href="Peras.SmallStep.html#5655" class="Function">latestCertSeen</a> <a id="8286" href="Peras.SmallStep.html#8237" class="Bound">t</a><a id="8287" class="Symbol">)</a> <a id="8289" class="Symbol">(</a><a id="8290" href="Peras.SmallStep.html#5114" class="Function">chains</a> <a id="8297" href="Peras.SmallStep.html#8237" class="Bound">t</a><a id="8298" class="Symbol">)</a>
</pre>
VR-1: Both VR-1A and VR-1B hold
<pre class="Agda">    <a id="8348" href="Peras.SmallStep.html#8348" class="Function">VotingRule-1</a> <a id="8361" class="Symbol">:</a> <a id="8363" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="8374" class="Symbol">â†’</a> <a id="8376" href="Peras.SmallStep.html#6591" class="Bound">T</a> <a id="8378" class="Symbol">â†’</a> <a id="8380" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="8389" href="Peras.SmallStep.html#8348" class="Function">VotingRule-1</a> <a id="8402" href="Peras.SmallStep.html#8402" class="Bound">s</a> <a id="8404" href="Peras.SmallStep.html#8404" class="Bound">t</a> <a id="8406" class="Symbol">=</a>
        <a id="8416" href="Peras.SmallStep.html#7990" class="Function">VotingRule-1A</a> <a id="8430" class="Symbol">(</a><a id="8431" href="Peras.Chain.html#5472" class="Function">v-round</a> <a id="8439" href="Peras.SmallStep.html#8402" class="Bound">s</a><a id="8440" class="Symbol">)</a> <a id="8442" href="Peras.SmallStep.html#8404" class="Bound">t</a>
      <a id="8450" href="Data.Product.Base.html#1618" class="Function Operator">Ã—</a> <a id="8452" href="Peras.SmallStep.html#8179" class="Function">VotingRule-1B</a> <a id="8466" href="Peras.SmallStep.html#8402" class="Bound">s</a> <a id="8468" href="Peras.SmallStep.html#8404" class="Bound">t</a>
</pre>
VR-2A: The last certificate a party has seen is from a round at least R
rounds back
<pre class="Agda">    <a id="8570" href="Peras.SmallStep.html#8570" class="Function">VotingRule-2A</a> <a id="8584" class="Symbol">:</a> <a id="8586" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="8598" class="Symbol">â†’</a> <a id="8600" href="Peras.SmallStep.html#6591" class="Bound">T</a> <a id="8602" class="Symbol">â†’</a> <a id="8604" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="8613" href="Peras.SmallStep.html#8570" class="Function">VotingRule-2A</a> <a id="8627" class="Symbol">(</a><a id="8628" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="8642" href="Peras.SmallStep.html#8642" class="Bound">r</a><a id="8643" class="Symbol">)</a> <a id="8645" href="Peras.SmallStep.html#8645" class="Bound">t</a> <a id="8647" class="Symbol">=</a> <a id="8649" href="Peras.SmallStep.html#8642" class="Bound">r</a> <a id="8651" href="Data.Nat.Base.html#2259" class="Function Operator">â‰¥</a> <a id="8653" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="8665" class="Symbol">(</a><a id="8666" href="Peras.SmallStep.html#5655" class="Function">latestCertSeen</a> <a id="8681" href="Peras.SmallStep.html#8645" class="Bound">t</a><a id="8682" class="Symbol">)</a> <a id="8684" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="8686" href="Peras.Params.html#221" class="Field">R</a>
</pre>
VR-2B: The last certificate included in a partyâ€™s current chain is from
a round exactly câ‹†K rounds ago for some c : â„•, c â‰¥ 0 <!--
<pre class="Agda">    <a id="8834" href="Peras.SmallStep.html#8834" class="Function Operator">_mod_</a> <a id="8840" class="Symbol">:</a> <a id="8842" href="Agda.Builtin.Nat.html#203" class="Datatype">â„•</a> <a id="8844" class="Symbol">â†’</a> <a id="8846" class="Symbol">(</a><a id="8847" href="Peras.SmallStep.html#8847" class="Bound">n</a> <a id="8849" class="Symbol">:</a> <a id="8851" href="Agda.Builtin.Nat.html#203" class="Datatype">â„•</a><a id="8852" class="Symbol">)</a> <a id="8854" class="Symbol">â†’</a> <a id="8856" class="Symbol">â¦ƒ</a> <a id="8858" href="Data.Nat.Base.html#3260" class="Record">NonZero</a> <a id="8866" href="Peras.SmallStep.html#8847" class="Bound">n</a> <a id="8868" class="Symbol">â¦„</a> <a id="8870" class="Symbol">â†’</a> <a id="8872" href="Agda.Builtin.Nat.html#203" class="Datatype">â„•</a>
    <a id="8878" href="Peras.SmallStep.html#8834" class="Function Operator">_mod_</a> <a id="8884" href="Peras.SmallStep.html#8884" class="Bound">a</a> <a id="8886" href="Peras.SmallStep.html#8886" class="Bound">b</a> <a id="8888" class="Symbol">â¦ƒ</a> <a id="8890" href="Peras.SmallStep.html#8890" class="Bound">prf</a> <a id="8894" class="Symbol">â¦„</a> <a id="8896" class="Symbol">=</a> <a id="8898" href="Data.Nat.Base.html#7279" class="Function Operator">_%_</a> <a id="8902" href="Peras.SmallStep.html#8884" class="Bound">a</a> <a id="8904" href="Peras.SmallStep.html#8886" class="Bound">b</a> <a id="8906" class="Symbol">â¦ƒ</a> <a id="8908" href="Peras.SmallStep.html#8890" class="Bound">prf</a> <a id="8912" class="Symbol">â¦„</a>
</pre>-->
<pre class="Agda">    <a id="8934" href="Peras.SmallStep.html#8934" class="Function">VotingRule-2B</a> <a id="8948" class="Symbol">:</a> <a id="8950" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="8962" class="Symbol">â†’</a> <a id="8964" href="Peras.SmallStep.html#6591" class="Bound">T</a> <a id="8966" class="Symbol">â†’</a> <a id="8968" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="8977" href="Peras.SmallStep.html#8934" class="Function">VotingRule-2B</a> <a id="8991" class="Symbol">(</a><a id="8992" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="9006" href="Peras.SmallStep.html#9006" class="Bound">r</a><a id="9007" class="Symbol">)</a> <a id="9009" href="Peras.SmallStep.html#9009" class="Bound">t</a> <a id="9011" class="Symbol">=</a>
        <a id="9021" href="Peras.SmallStep.html#9006" class="Bound">r</a> <a id="9023" href="Data.Nat.Base.html#2289" class="Function Operator">&gt;</a> <a id="9025" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="9037" class="Symbol">(</a><a id="9038" href="Peras.SmallStep.html#5525" class="Function">latestCertOnChain</a> <a id="9056" href="Peras.SmallStep.html#9009" class="Bound">t</a><a id="9057" class="Symbol">)</a>
      <a id="9065" href="Data.Product.Base.html#1618" class="Function Operator">Ã—</a> <a id="9067" href="Peras.SmallStep.html#9006" class="Bound">r</a> <a id="9069" href="Peras.SmallStep.html#8834" class="Function Operator">mod</a> <a id="9073" href="Peras.Params.html#207" class="Field">K</a> <a id="9075" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="9077" class="Symbol">(</a><a id="9078" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="9090" class="Symbol">(</a><a id="9091" href="Peras.SmallStep.html#5525" class="Function">latestCertOnChain</a> <a id="9109" href="Peras.SmallStep.html#9009" class="Bound">t</a><a id="9110" class="Symbol">))</a> <a id="9113" href="Peras.SmallStep.html#8834" class="Function Operator">mod</a> <a id="9117" href="Peras.Params.html#207" class="Field">K</a>
</pre>
VR-2: Both VR-2A and VR-2B hold
<pre class="Agda">    <a id="9167" href="Peras.SmallStep.html#9167" class="Function">VotingRule-2</a> <a id="9180" class="Symbol">:</a> <a id="9182" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="9194" class="Symbol">â†’</a> <a id="9196" href="Peras.SmallStep.html#6591" class="Bound">T</a> <a id="9198" class="Symbol">â†’</a> <a id="9200" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="9209" href="Peras.SmallStep.html#9167" class="Function">VotingRule-2</a> <a id="9222" href="Peras.SmallStep.html#9222" class="Bound">r</a> <a id="9224" href="Peras.SmallStep.html#9224" class="Bound">t</a> <a id="9226" class="Symbol">=</a>
        <a id="9236" href="Peras.SmallStep.html#8570" class="Function">VotingRule-2A</a> <a id="9250" href="Peras.SmallStep.html#9222" class="Bound">r</a> <a id="9252" href="Peras.SmallStep.html#9224" class="Bound">t</a>
      <a id="9260" href="Data.Product.Base.html#1618" class="Function Operator">Ã—</a> <a id="9262" href="Peras.SmallStep.html#8934" class="Function">VotingRule-2B</a> <a id="9276" href="Peras.SmallStep.html#9222" class="Bound">r</a> <a id="9278" href="Peras.SmallStep.html#9224" class="Bound">t</a>
</pre>
If either VR-1A and VR-1B or VR-2A and VR-2B hold, voting is expected
<pre class="Agda">    <a id="9366" href="Peras.SmallStep.html#9366" class="Function">VotingRule</a> <a id="9377" class="Symbol">:</a> <a id="9379" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="9390" class="Symbol">â†’</a> <a id="9392" href="Peras.SmallStep.html#6591" class="Bound">T</a> <a id="9394" class="Symbol">â†’</a> <a id="9396" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="9405" href="Peras.SmallStep.html#9366" class="Function">VotingRule</a> <a id="9416" href="Peras.SmallStep.html#9416" class="Bound">s</a> <a id="9418" href="Peras.SmallStep.html#9418" class="Bound">t</a> <a id="9420" class="Symbol">=</a>
        <a id="9430" href="Peras.SmallStep.html#8348" class="Function">VotingRule-1</a> <a id="9443" href="Peras.SmallStep.html#9416" class="Bound">s</a> <a id="9445" href="Peras.SmallStep.html#9418" class="Bound">t</a>
      <a id="9453" href="Data.Sum.Base.html#625" class="Datatype Operator">âŠ</a> <a id="9455" href="Peras.SmallStep.html#9167" class="Function">VotingRule-2</a> <a id="9468" class="Symbol">(</a><a id="9469" href="Peras.Chain.html#5472" class="Function">v-round</a> <a id="9477" href="Peras.SmallStep.html#9416" class="Bound">s</a><a id="9478" class="Symbol">)</a> <a id="9480" href="Peras.SmallStep.html#9418" class="Bound">t</a>
</pre>
<h3 id="state">State</h3>
<p>The small-step semantics rely on a global state, which consists of
the following fields:</p>
<ul>
<li>Current slot of the system</li>
<li>Map with local state per party</li>
<li>All the messages that have been sent but not yet been delivered</li>
<li>All the messages that have been sent</li>
<li>Adversarial state</li>
</ul>
<pre class="Agda">    <a id="9787" class="Keyword">record</a> <a id="9794" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="9800" class="Symbol">:</a> <a id="9802" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="9807" class="Keyword">where</a>
      <a id="9819" class="Keyword">constructor</a> <a id="9831" href="Peras.SmallStep.html#9831" class="InductiveConstructor Operator">âŸ¦_,_,_,_,_âŸ§</a>
      <a id="9849" class="Keyword">field</a>
        <a id="9863" href="Peras.SmallStep.html#9863" class="Field">clock</a> <a id="9869" class="Symbol">:</a> <a id="9871" href="Peras.Numbering.html#742" class="Record">SlotNumber</a>
        <a id="9890" href="Peras.SmallStep.html#9890" class="Field">blockTrees</a> <a id="9901" class="Symbol">:</a> <a id="9903" href="Prelude.AssocList.html#211" class="Function">AssocList</a> <a id="9913" href="Peras.Block.html#1264" class="Function">PartyId</a> <a id="9921" href="Peras.SmallStep.html#6591" class="Bound">T</a>
        <a id="9931" href="Peras.SmallStep.html#9931" class="Field">messages</a> <a id="9940" class="Symbol">:</a> <a id="9942" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="9947" href="Peras.SmallStep.html#2588" class="Record">Envelope</a>
        <a id="9964" href="Peras.SmallStep.html#9964" class="Field">history</a> <a id="9972" class="Symbol">:</a> <a id="9974" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="9979" href="Peras.SmallStep.html#2195" class="Datatype">Message</a>
        <a id="9995" href="Peras.SmallStep.html#9995" class="Field">adversarialState</a> <a id="10012" class="Symbol">:</a> <a id="10014" href="Peras.SmallStep.html#6638" class="Bound">S</a>

      <a id="10023" href="Peras.SmallStep.html#10023" class="Function">blockTrees&#39;</a> <a id="10035" class="Symbol">:</a> <a id="10037" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="10042" href="Peras.SmallStep.html#6591" class="Bound">T</a>
      <a id="10050" href="Peras.SmallStep.html#10023" class="Function">blockTrees&#39;</a> <a id="10062" class="Symbol">=</a> <a id="10064" href="Data.List.Base.html#1631" class="Function">map</a> <a id="10068" href="Data.Product.Base.html#650" class="Field">projâ‚‚</a> <a id="10074" href="Peras.SmallStep.html#9890" class="Field">blockTrees</a>

      <a id="10092" href="Peras.SmallStep.html#10092" class="Function">v-rnd</a> <a id="10098" class="Symbol">:</a> <a id="10100" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a>
      <a id="10118" href="Peras.SmallStep.html#10092" class="Function">v-rnd</a> <a id="10124" class="Symbol">=</a> <a id="10126" href="Peras.Chain.html#5472" class="Function">v-round</a> <a id="10134" href="Peras.SmallStep.html#9863" class="Field">clock</a>

      <a id="10147" href="Peras.SmallStep.html#10147" class="Function">v-rnd&#39;</a> <a id="10154" class="Symbol">:</a> <a id="10156" href="Agda.Builtin.Nat.html#203" class="Datatype">â„•</a>
      <a id="10164" href="Peras.SmallStep.html#10147" class="Function">v-rnd&#39;</a> <a id="10171" class="Symbol">=</a> <a id="10173" href="Peras.Numbering.html#1729" class="Field">getRoundNumber</a> <a id="10188" href="Peras.SmallStep.html#10092" class="Function">v-rnd</a>
</pre>
<h4 id="progress">Progress</h4>
Rather than keeping track of progress, we introduce a predicate stating
that all messages that are not delayed have been delivered. This is a
precondition that must hold before transitioning to the next slot.
<pre class="Agda">    <a id="10434" href="Peras.SmallStep.html#10434" class="Function">Fetched</a> <a id="10442" class="Symbol">:</a> <a id="10444" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="10450" class="Symbol">â†’</a> <a id="10452" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="10461" href="Peras.SmallStep.html#10434" class="Function">Fetched</a> <a id="10469" class="Symbol">=</a> <a id="10471" href="Data.List.Relation.Unary.All.html#1627" class="Datatype">All</a> <a id="10475" class="Symbol">(Î»</a> <a id="10478" class="Symbol">{</a> <a id="10480" href="Peras.SmallStep.html#10480" class="Bound">z</a> <a id="10482" class="Symbol">â†’</a> <a id="10484" href="Peras.SmallStep.html#2732" class="Field">delay</a> <a id="10490" href="Peras.SmallStep.html#10480" class="Bound">z</a> <a id="10492" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">â‰¢</a> <a id="10494" href="Peras.SmallStep.html#2413" class="InductiveConstructor">ğŸ˜</a> <a id="10496" class="Symbol">})</a> <a id="10499" href="Function.Base.html#1115" class="Function Operator">âˆ˜</a> <a id="10501" href="Peras.SmallStep.html#9931" class="Field">messages</a>
      <a id="10516" class="Keyword">where</a> <a id="10522" class="Keyword">open</a> <a id="10527" href="Peras.SmallStep.html#9794" class="Module">State</a>
</pre>
Predicate for a global state stating that the current slot is the last
slot of a voting round.
<pre class="Agda">    <a id="10644" href="Peras.SmallStep.html#10644" class="Function">LastSlotInRound</a> <a id="10660" class="Symbol">:</a> <a id="10662" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="10668" class="Symbol">â†’</a> <a id="10670" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="10679" href="Peras.SmallStep.html#10644" class="Function">LastSlotInRound</a> <a id="10695" href="Peras.SmallStep.html#10695" class="Bound">M</a> <a id="10697" class="Symbol">=</a>
      <a id="10705" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="10709" class="Symbol">(</a><a id="10710" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="10714" class="Symbol">(</a><a id="10715" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="10729" href="Peras.SmallStep.html#9863" class="Field">clock</a><a id="10734" class="Symbol">))</a> <a id="10737" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="10739" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="10743" class="Symbol">(</a><a id="10744" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="10748" class="Symbol">(</a><a id="10749" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="10763" href="Peras.SmallStep.html#9863" class="Field">clock</a><a id="10768" class="Symbol">))</a>
      <a id="10777" class="Keyword">where</a> <a id="10783" class="Keyword">open</a> <a id="10788" href="Peras.SmallStep.html#9794" class="Module">State</a> <a id="10794" href="Peras.SmallStep.html#10695" class="Bound">M</a>
</pre>
<pre class="Agda">    <a id="10812" href="Peras.SmallStep.html#10812" class="Function">LastSlotInRound?</a> <a id="10829" class="Symbol">:</a> <a id="10831" class="Symbol">(</a><a id="10832" href="Peras.SmallStep.html#10832" class="Bound">s</a> <a id="10834" class="Symbol">:</a> <a id="10836" href="Peras.SmallStep.html#9794" class="Record">State</a><a id="10841" class="Symbol">)</a> <a id="10843" class="Symbol">â†’</a> <a id="10845" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="10849" class="Symbol">(</a><a id="10850" href="Peras.SmallStep.html#10644" class="Function">LastSlotInRound</a> <a id="10866" href="Peras.SmallStep.html#10832" class="Bound">s</a><a id="10867" class="Symbol">)</a>
    <a id="10873" href="Peras.SmallStep.html#10812" class="Function">LastSlotInRound?</a> <a id="10890" href="Peras.SmallStep.html#10890" class="Bound">M</a> <a id="10892" class="Symbol">=</a>
      <a id="10900" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="10904" class="Symbol">(</a><a id="10905" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="10909" class="Symbol">(</a><a id="10910" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="10924" href="Peras.SmallStep.html#9863" class="Field">clock</a><a id="10929" class="Symbol">))</a> <a id="10932" href="Data.Nat.Properties.html#3311" class="Function Operator">â‰Ÿ</a> <a id="10934" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="10938" class="Symbol">(</a><a id="10939" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="10943" class="Symbol">(</a><a id="10944" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="10958" href="Peras.SmallStep.html#9863" class="Field">clock</a><a id="10963" class="Symbol">))</a>
      <a id="10972" class="Keyword">where</a> <a id="10978" class="Keyword">open</a> <a id="10983" href="Peras.SmallStep.html#9794" class="Module">State</a> <a id="10989" href="Peras.SmallStep.html#10890" class="Bound">M</a>
</pre>
Predicate for a global state stating that the next slot will be in a new
voting round.
<pre class="Agda">    <a id="11094" href="Peras.SmallStep.html#11094" class="Function">NextSlotInSameRound</a> <a id="11114" class="Symbol">:</a> <a id="11116" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="11122" class="Symbol">â†’</a> <a id="11124" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="11133" href="Peras.SmallStep.html#11094" class="Function">NextSlotInSameRound</a> <a id="11153" href="Peras.SmallStep.html#11153" class="Bound">M</a> <a id="11155" class="Symbol">=</a>
      <a id="11163" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="11167" class="Symbol">(</a><a id="11168" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="11182" href="Peras.SmallStep.html#9863" class="Field">clock</a><a id="11187" class="Symbol">)</a> <a id="11189" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="11191" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="11195" class="Symbol">(</a><a id="11196" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="11200" class="Symbol">(</a><a id="11201" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="11215" href="Peras.SmallStep.html#9863" class="Field">clock</a><a id="11220" class="Symbol">))</a>
      <a id="11229" class="Keyword">where</a> <a id="11235" class="Keyword">open</a> <a id="11240" href="Peras.SmallStep.html#9794" class="Module">State</a> <a id="11246" href="Peras.SmallStep.html#11153" class="Bound">M</a>
</pre>
<pre class="Agda">    <a id="11264" href="Peras.SmallStep.html#11264" class="Function">NextSlotInSameRound?</a> <a id="11285" class="Symbol">:</a> <a id="11287" class="Symbol">(</a><a id="11288" href="Peras.SmallStep.html#11288" class="Bound">s</a> <a id="11290" class="Symbol">:</a> <a id="11292" href="Peras.SmallStep.html#9794" class="Record">State</a><a id="11297" class="Symbol">)</a> <a id="11299" class="Symbol">â†’</a> <a id="11301" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="11305" class="Symbol">(</a><a id="11306" href="Peras.SmallStep.html#11094" class="Function">NextSlotInSameRound</a> <a id="11326" href="Peras.SmallStep.html#11288" class="Bound">s</a><a id="11327" class="Symbol">)</a>
    <a id="11333" href="Peras.SmallStep.html#11264" class="Function">NextSlotInSameRound?</a> <a id="11354" href="Peras.SmallStep.html#11354" class="Bound">M</a> <a id="11356" class="Symbol">=</a>
      <a id="11364" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="11368" class="Symbol">(</a><a id="11369" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="11383" href="Peras.SmallStep.html#9863" class="Field">clock</a><a id="11388" class="Symbol">)</a> <a id="11390" href="Data.Nat.Properties.html#3311" class="Function Operator">â‰Ÿ</a> <a id="11392" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="11396" class="Symbol">(</a><a id="11397" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="11401" class="Symbol">(</a><a id="11402" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="11416" href="Peras.SmallStep.html#9863" class="Field">clock</a><a id="11421" class="Symbol">))</a>
      <a id="11430" class="Keyword">where</a> <a id="11436" class="Keyword">open</a> <a id="11441" href="Peras.SmallStep.html#9794" class="Module">State</a> <a id="11447" href="Peras.SmallStep.html#11354" class="Bound">M</a>
</pre>
Ticking the global clock increments the slot number and decrements the
delay of all the messages in the message buffer.
<pre class="Agda">    <a id="11585" href="Peras.SmallStep.html#11585" class="Function">tick</a> <a id="11590" class="Symbol">:</a> <a id="11592" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="11598" class="Symbol">â†’</a> <a id="11600" href="Peras.SmallStep.html#9794" class="Record">State</a>
    <a id="11610" href="Peras.SmallStep.html#11585" class="Function">tick</a> <a id="11615" href="Peras.SmallStep.html#11615" class="Bound">M</a> <a id="11617" class="Symbol">=</a>
      <a id="11625" class="Keyword">record</a> <a id="11632" href="Peras.SmallStep.html#11615" class="Bound">M</a>
        <a id="11642" class="Symbol">{</a> <a id="11644" href="Peras.SmallStep.html#9863" class="Field">clock</a> <a id="11650" class="Symbol">=</a> <a id="11652" href="Peras.Numbering.html#821" class="Function">next</a> <a id="11657" href="Peras.SmallStep.html#9863" class="Field">clock</a>
        <a id="11671" class="Symbol">;</a> <a id="11673" href="Peras.SmallStep.html#9931" class="Field">messages</a> <a id="11682" class="Symbol">=</a>
            <a id="11696" href="Data.List.Base.html#1631" class="Function">map</a> <a id="11700" class="Symbol">(Î»</a> <a id="11703" class="Keyword">where</a> <a id="11709" href="Peras.SmallStep.html#11709" class="Bound">e</a> <a id="11711" class="Symbol">â†’</a> <a id="11713" class="Keyword">record</a> <a id="11720" href="Peras.SmallStep.html#11709" class="Bound">e</a> <a id="11722" class="Symbol">{</a> <a id="11724" href="Peras.SmallStep.html#2732" class="Field">delay</a> <a id="11730" class="Symbol">=</a> <a id="11732" href="Data.Fin.Base.html#6461" class="Function">pred</a> <a id="11737" class="Symbol">(</a><a id="11738" href="Peras.SmallStep.html#2732" class="Field">delay</a> <a id="11744" href="Peras.SmallStep.html#11709" class="Bound">e</a><a id="11745" class="Symbol">)</a> <a id="11747" class="Symbol">})</a>
              <a id="11764" href="Peras.SmallStep.html#9931" class="Field">messages</a>
        <a id="11781" class="Symbol">}</a>
      <a id="11789" class="Keyword">where</a> <a id="11795" class="Keyword">open</a> <a id="11800" href="Peras.SmallStep.html#9794" class="Module">State</a> <a id="11806" href="Peras.SmallStep.html#11615" class="Bound">M</a>
</pre>
Updating the global state inserting the updated block-tree for a given
party, adding messages to the message buffer for the other parties and
appending the history
<pre class="Agda">    <a id="11988" href="Peras.SmallStep.html#11988" class="Function Operator">_,_â‡‘_</a> <a id="11994" class="Symbol">:</a> <a id="11996" href="Peras.SmallStep.html#2195" class="Datatype">Message</a> <a id="12004" class="Symbol">â†’</a> <a id="12006" href="Peras.SmallStep.html#2376" class="Function">Delay</a> <a id="12012" class="Symbol">â†’</a> <a id="12014" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="12020" class="Symbol">â†’</a> <a id="12022" href="Peras.SmallStep.html#9794" class="Record">State</a>
    <a id="12032" href="Peras.SmallStep.html#12032" class="Bound">m</a> <a id="12034" href="Peras.SmallStep.html#11988" class="Function Operator">,</a> <a id="12036" href="Peras.SmallStep.html#12036" class="Bound">d</a> <a id="12038" href="Peras.SmallStep.html#11988" class="Function Operator">â‡‘</a> <a id="12040" href="Peras.SmallStep.html#12040" class="Bound">M</a> <a id="12042" class="Symbol">=</a>
      <a id="12050" class="Keyword">record</a> <a id="12057" href="Peras.SmallStep.html#12040" class="Bound">M</a>
        <a id="12067" class="Symbol">{</a> <a id="12069" href="Peras.SmallStep.html#9931" class="Field">messages</a> <a id="12078" class="Symbol">=</a>
            <a id="12092" href="Data.List.Base.html#1631" class="Function">map</a> <a id="12096" class="Symbol">(</a><a id="12097" href="Data.Product.Base.html#3109" class="Function">uncurry</a> <a id="12105" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">â¦…_,_,</a> <a id="12111" href="Peras.SmallStep.html#12032" class="Bound">m</a> <a id="12113" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">,</a> <a id="12115" href="Peras.SmallStep.html#12036" class="Bound">d</a> <a id="12117" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">â¦†</a><a id="12118" class="Symbol">)</a> <a id="12120" href="Peras.SmallStep.html#6742" class="Bound">parties</a>
            <a id="12140" href="Data.List.Base.html#1954" class="Function Operator">++</a> <a id="12143" href="Peras.SmallStep.html#9931" class="Field">messages</a>
        <a id="12160" class="Symbol">;</a> <a id="12162" href="Peras.SmallStep.html#9964" class="Field">history</a> <a id="12170" class="Symbol">=</a> <a id="12172" href="Peras.SmallStep.html#12032" class="Bound">m</a> <a id="12174" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">âˆ·</a> <a id="12176" href="Peras.SmallStep.html#9964" class="Field">history</a>
        <a id="12192" class="Symbol">}</a>
      <a id="12200" class="Keyword">where</a> <a id="12206" class="Keyword">open</a> <a id="12211" href="Peras.SmallStep.html#9794" class="Module">State</a> <a id="12217" href="Peras.SmallStep.html#12040" class="Bound">M</a>

    <a id="12224" href="Peras.SmallStep.html#12224" class="Function Operator">add_diffuse_</a> <a id="12237" class="Symbol">:</a> <a id="12239" class="Symbol">(</a><a id="12240" href="Peras.SmallStep.html#2195" class="Datatype">Message</a> <a id="12248" href="Data.Product.Base.html#1618" class="Function Operator">Ã—</a> <a id="12250" href="Peras.SmallStep.html#2376" class="Function">Delay</a><a id="12255" class="Symbol">)</a> <a id="12257" class="Symbol">â†’</a> <a id="12259" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="12265" class="Symbol">â†’</a> <a id="12267" href="Peras.SmallStep.html#9794" class="Record">State</a>
    <a id="12277" href="Peras.SmallStep.html#12224" class="Function Operator">add</a> <a id="12281" class="Symbol">(</a><a id="12282" href="Peras.SmallStep.html#12282" class="Bound">m</a><a id="12283" class="Symbol">@(</a><a id="12285" href="Peras.SmallStep.html#2220" class="InductiveConstructor">ChainMsg</a> <a id="12294" href="Peras.SmallStep.html#12294" class="Bound">x</a><a id="12295" class="Symbol">)</a> <a id="12297" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12299" href="Peras.SmallStep.html#12299" class="Bound">d</a><a id="12300" class="Symbol">)</a> <a id="12302" href="Peras.SmallStep.html#12224" class="Function Operator">diffuse</a> <a id="12310" href="Peras.SmallStep.html#12310" class="Bound">M</a> <a id="12312" class="Symbol">=</a> <a id="12314" href="Peras.SmallStep.html#12282" class="Bound">m</a> <a id="12316" href="Peras.SmallStep.html#11988" class="Function Operator">,</a> <a id="12318" href="Peras.SmallStep.html#12299" class="Bound">d</a> <a id="12320" href="Peras.SmallStep.html#11988" class="Function Operator">â‡‘</a> <a id="12322" href="Peras.SmallStep.html#12310" class="Bound">M</a>
    <a id="12328" href="Peras.SmallStep.html#12224" class="Function Operator">add</a> <a id="12332" class="Symbol">(</a><a id="12333" href="Peras.SmallStep.html#12333" class="Bound">m</a><a id="12334" class="Symbol">@(</a><a id="12336" href="Peras.SmallStep.html#2272" class="InductiveConstructor">VoteMsg</a> <a id="12344" href="Peras.SmallStep.html#12344" class="Bound">x</a><a id="12345" class="Symbol">)</a> <a id="12347" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12349" href="Peras.SmallStep.html#12349" class="Bound">d</a><a id="12350" class="Symbol">)</a> <a id="12352" href="Peras.SmallStep.html#12224" class="Function Operator">diffuse</a> <a id="12360" href="Peras.SmallStep.html#12360" class="Bound">M</a> <a id="12362" class="Symbol">=</a> <a id="12364" href="Peras.SmallStep.html#12333" class="Bound">m</a> <a id="12366" href="Peras.SmallStep.html#11988" class="Function Operator">,</a> <a id="12368" href="Peras.SmallStep.html#12349" class="Bound">d</a> <a id="12370" href="Peras.SmallStep.html#11988" class="Function Operator">â‡‘</a> <a id="12372" href="Peras.SmallStep.html#12360" class="Bound">M</a>
</pre>
<h2 id="fetching">Fetching</h2>
<p>A party receives messages from the global state by fetching messages
assigned to the party, updating the local block tree and putting the
local state back into the global state.</p>
<pre class="Agda">    <a id="12582" class="Keyword">data</a> <a id="12587" href="Peras.SmallStep.html#12587" class="Datatype Operator">_âŠ¢_[_]â‡€_</a> <a id="12596" class="Symbol">:</a> <a id="12598" class="Symbol">{</a><a id="12599" href="Peras.SmallStep.html#12599" class="Bound">p</a> <a id="12601" class="Symbol">:</a> <a id="12603" href="Peras.Block.html#1264" class="Function">PartyId</a><a id="12610" class="Symbol">}</a> <a id="12612" class="Symbol">â†’</a> <a id="12614" href="Peras.Block.html#1872" class="Datatype">Honesty</a> <a id="12622" href="Peras.SmallStep.html#12599" class="Bound">p</a> <a id="12624" class="Symbol">â†’</a> <a id="12626" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="12632" class="Symbol">â†’</a> <a id="12634" href="Peras.SmallStep.html#2195" class="Datatype">Message</a> <a id="12642" class="Symbol">â†’</a> <a id="12644" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="12650" class="Symbol">â†’</a> <a id="12652" href="Agda.Primitive.html#388" class="Primitive">Type</a>
      <a id="12663" class="Keyword">where</a>
</pre>
An honest party consumes a message from the global message buffer and
updates the local state
<pre class="Agda">      <a id="12781" href="Peras.SmallStep.html#12781" class="InductiveConstructor">honest</a> <a id="12788" class="Symbol">:</a> <a id="12790" class="Symbol">âˆ€</a> <a id="12792" class="Symbol">{</a><a id="12793" href="Peras.SmallStep.html#12793" class="Bound">p</a><a id="12794" class="Symbol">}</a> <a id="12796" class="Symbol">{</a><a id="12797" href="Peras.SmallStep.html#12797" class="Bound">t</a> <a id="12799" href="Peras.SmallStep.html#12799" class="Bound">tâ€²</a><a id="12801" class="Symbol">}</a> <a id="12803" class="Symbol">{</a><a id="12804" href="Peras.SmallStep.html#12804" class="Bound">m</a><a id="12805" class="Symbol">}</a> <a id="12807" class="Symbol">{</a><a id="12808" href="Peras.SmallStep.html#12808" class="Bound">N</a><a id="12809" class="Symbol">}</a> <a id="12811" class="Symbol">â†’</a> <a id="12813" class="Keyword">let</a> <a id="12817" class="Keyword">open</a> <a id="12822" href="Peras.SmallStep.html#9794" class="Module">State</a> <a id="12828" href="Peras.SmallStep.html#12808" class="Bound">N</a> <a id="12830" class="Keyword">in</a>
          <a id="12843" href="Peras.SmallStep.html#9890" class="Field">blockTrees</a> <a id="12854" href="Prelude.AssocList.html#847" class="Function Operator">â‰</a> <a id="12856" href="Peras.SmallStep.html#12793" class="Bound">p</a> <a id="12858" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="12860" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="12865" href="Peras.SmallStep.html#12797" class="Bound">t</a>
        <a id="12875" class="Symbol">â†’</a> <a id="12877" class="Symbol">(</a><a id="12878" href="Peras.SmallStep.html#12878" class="Bound">mâˆˆms</a> <a id="12883" class="Symbol">:</a> <a id="12885" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">â¦…</a> <a id="12887" href="Peras.SmallStep.html#12793" class="Bound">p</a> <a id="12889" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">,</a> <a id="12891" href="Peras.Block.html#1905" class="InductiveConstructor">Honest</a> <a id="12898" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">,</a> <a id="12900" href="Peras.SmallStep.html#12804" class="Bound">m</a> <a id="12902" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">,</a> <a id="12904" href="Peras.SmallStep.html#2413" class="InductiveConstructor">ğŸ˜</a> <a id="12906" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">â¦†</a> <a id="12908" href="Data.List.Membership.Setoid.html#950" class="Function Operator">âˆˆ</a> <a id="12910" href="Peras.SmallStep.html#9931" class="Field">messages</a><a id="12918" class="Symbol">)</a>
        <a id="12928" class="Symbol">â†’</a> <a id="12930" href="Peras.SmallStep.html#12797" class="Bound">t</a> <a id="12932" href="Peras.SmallStep.html#7124" class="Datatype Operator">[</a> <a id="12934" href="Peras.SmallStep.html#12804" class="Bound">m</a> <a id="12936" href="Peras.SmallStep.html#7124" class="Datatype Operator">]â†’</a> <a id="12939" href="Peras.SmallStep.html#12799" class="Bound">tâ€²</a>
          <a id="12952" class="Comment">---------------------------------------------</a>
        <a id="13006" class="Symbol">â†’</a> <a id="13008" href="Peras.Block.html#1905" class="InductiveConstructor">Honest</a> <a id="13015" class="Symbol">{</a><a id="13016" href="Peras.SmallStep.html#12793" class="Bound">p</a><a id="13017" class="Symbol">}</a> <a id="13019" href="Peras.SmallStep.html#12587" class="Datatype Operator">âŠ¢</a>
          <a id="13031" href="Peras.SmallStep.html#12808" class="Bound">N</a> <a id="13033" href="Peras.SmallStep.html#12587" class="Datatype Operator">[</a> <a id="13035" href="Peras.SmallStep.html#12804" class="Bound">m</a> <a id="13037" href="Peras.SmallStep.html#12587" class="Datatype Operator">]â‡€</a> <a id="13040" class="Keyword">record</a> <a id="13047" href="Peras.SmallStep.html#12808" class="Bound">N</a>
            <a id="13061" class="Symbol">{</a> <a id="13063" href="Peras.SmallStep.html#9890" class="Field">blockTrees</a> <a id="13074" class="Symbol">=</a> <a id="13076" href="Prelude.AssocList.html#1398" class="Function">set</a> <a id="13080" href="Peras.SmallStep.html#12793" class="Bound">p</a> <a id="13082" href="Peras.SmallStep.html#12799" class="Bound">tâ€²</a> <a id="13085" href="Peras.SmallStep.html#9890" class="Field">blockTrees</a>
            <a id="13108" class="Symbol">;</a> <a id="13110" href="Peras.SmallStep.html#9931" class="Field">messages</a> <a id="13119" class="Symbol">=</a> <a id="13121" href="Peras.SmallStep.html#9931" class="Field">messages</a> <a id="13130" href="Data.List.Relation.Unary.Any.html#2138" class="Function Operator">â”€</a> <a id="13132" href="Peras.SmallStep.html#12878" class="Bound">mâˆˆms</a>
            <a id="13149" class="Symbol">}</a>
</pre>
An adversarial party might delay a message
<pre class="Agda">      <a id="13212" href="Peras.SmallStep.html#13212" class="InductiveConstructor">corrupt</a> <a id="13220" class="Symbol">:</a> <a id="13222" class="Symbol">âˆ€</a> <a id="13224" class="Symbol">{</a><a id="13225" href="Peras.SmallStep.html#13225" class="Bound">p</a><a id="13226" class="Symbol">}</a> <a id="13228" class="Symbol">{</a><a id="13229" href="Peras.SmallStep.html#13229" class="Bound">as</a><a id="13231" class="Symbol">}</a> <a id="13233" class="Symbol">{</a><a id="13234" href="Peras.SmallStep.html#13234" class="Bound">m</a><a id="13235" class="Symbol">}</a> <a id="13237" class="Symbol">{</a><a id="13238" href="Peras.SmallStep.html#13238" class="Bound">N</a><a id="13239" class="Symbol">}</a> <a id="13241" class="Symbol">â†’</a> <a id="13243" class="Keyword">let</a> <a id="13247" class="Keyword">open</a> <a id="13252" href="Peras.SmallStep.html#9794" class="Module">State</a> <a id="13258" href="Peras.SmallStep.html#13238" class="Bound">N</a> <a id="13260" class="Keyword">in</a>
          <a id="13273" class="Symbol">(</a><a id="13274" href="Peras.SmallStep.html#13274" class="Bound">mâˆˆms</a> <a id="13279" class="Symbol">:</a> <a id="13281" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">â¦…</a> <a id="13283" href="Peras.SmallStep.html#13225" class="Bound">p</a> <a id="13285" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">,</a> <a id="13287" href="Peras.Block.html#1949" class="InductiveConstructor">Corrupt</a> <a id="13295" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">,</a> <a id="13297" href="Peras.SmallStep.html#13234" class="Bound">m</a> <a id="13299" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">,</a> <a id="13301" href="Peras.SmallStep.html#2413" class="InductiveConstructor">ğŸ˜</a> <a id="13303" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">â¦†</a> <a id="13305" href="Data.List.Membership.Setoid.html#950" class="Function Operator">âˆˆ</a> <a id="13307" href="Peras.SmallStep.html#9931" class="Field">messages</a><a id="13315" class="Symbol">)</a>
          <a id="13327" class="Comment">----------------------------------------------</a>
        <a id="13382" class="Symbol">â†’</a> <a id="13384" href="Peras.Block.html#1949" class="InductiveConstructor">Corrupt</a> <a id="13392" class="Symbol">{</a><a id="13393" href="Peras.SmallStep.html#13225" class="Bound">p</a><a id="13394" class="Symbol">}</a> <a id="13396" href="Peras.SmallStep.html#12587" class="Datatype Operator">âŠ¢</a>
          <a id="13408" href="Peras.SmallStep.html#13238" class="Bound">N</a> <a id="13410" href="Peras.SmallStep.html#12587" class="Datatype Operator">[</a> <a id="13412" href="Peras.SmallStep.html#13234" class="Bound">m</a> <a id="13414" href="Peras.SmallStep.html#12587" class="Datatype Operator">]â‡€</a> <a id="13417" class="Keyword">record</a> <a id="13424" href="Peras.SmallStep.html#13238" class="Bound">N</a>
            <a id="13438" class="Symbol">{</a> <a id="13440" href="Peras.SmallStep.html#9931" class="Field">messages</a> <a id="13449" class="Symbol">=</a> <a id="13451" href="Peras.SmallStep.html#13274" class="Bound">mâˆˆms</a> <a id="13456" href="Peras.SmallStep.html#419" class="Function Operator">âˆ·Ë¡=</a> <a id="13460" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">â¦…</a> <a id="13462" href="Peras.SmallStep.html#13225" class="Bound">p</a> <a id="13464" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">,</a> <a id="13466" href="Peras.Block.html#1949" class="InductiveConstructor">Corrupt</a> <a id="13474" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">,</a> <a id="13476" href="Peras.SmallStep.html#13234" class="Bound">m</a> <a id="13478" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">,</a> <a id="13480" href="Peras.SmallStep.html#2433" class="InductiveConstructor">ğŸ™</a> <a id="13482" href="Peras.SmallStep.html#2626" class="InductiveConstructor Operator">â¦†</a>
            <a id="13496" class="Symbol">;</a> <a id="13498" href="Peras.SmallStep.html#9995" class="Field">adversarialState</a> <a id="13515" class="Symbol">=</a> <a id="13517" href="Peras.SmallStep.html#13229" class="Bound">as</a>
            <a id="13532" class="Symbol">}</a>
</pre>
<h2 id="voting">Voting</h2>
Helper function for creating a vote
<pre class="Agda">    <a id="13597" href="Peras.SmallStep.html#13597" class="Function">createVote</a> <a id="13608" class="Symbol">:</a> <a id="13610" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="13621" class="Symbol">â†’</a> <a id="13623" href="Peras.Block.html#1264" class="Function">PartyId</a> <a id="13631" class="Symbol">â†’</a> <a id="13633" href="Peras.Crypto.html#2161" class="Record">MembershipProof</a> <a id="13649" class="Symbol">â†’</a> <a id="13651" href="Peras.Crypto.html#3115" class="Record">Signature</a> <a id="13661" class="Symbol">â†’</a> <a id="13663" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="13668" href="Peras.Block.html#2807" class="Record">Block</a> <a id="13674" class="Symbol">â†’</a> <a id="13676" href="Peras.Chain.html#1472" class="Record">Vote</a>
    <a id="13685" href="Peras.SmallStep.html#13597" class="Function">createVote</a> <a id="13696" href="Peras.SmallStep.html#13696" class="Bound">s</a> <a id="13698" href="Peras.SmallStep.html#13698" class="Bound">p</a> <a id="13700" href="Peras.SmallStep.html#13700" class="Bound">prf</a> <a id="13704" href="Peras.SmallStep.html#13704" class="Bound">sig</a> <a id="13708" href="Peras.SmallStep.html#13708" class="Bound">hb</a> <a id="13711" class="Symbol">=</a>
      <a id="13719" class="Keyword">record</a>
        <a id="13734" class="Symbol">{</a> <a id="13736" href="Peras.Chain.html#1518" class="Field">votingRound</a> <a id="13748" class="Symbol">=</a> <a id="13750" href="Peras.Chain.html#5472" class="Function">v-round</a> <a id="13758" href="Peras.SmallStep.html#13696" class="Bound">s</a>
        <a id="13768" class="Symbol">;</a> <a id="13770" href="Peras.Chain.html#1552" class="Field">creatorId</a> <a id="13780" class="Symbol">=</a> <a id="13782" href="Peras.SmallStep.html#13698" class="Bound">p</a>
        <a id="13792" class="Symbol">;</a> <a id="13794" href="Peras.Chain.html#1582" class="Field">proofM</a> <a id="13801" class="Symbol">=</a> <a id="13803" href="Peras.SmallStep.html#13700" class="Bound">prf</a>
        <a id="13815" class="Symbol">;</a> <a id="13817" href="Peras.Chain.html#1620" class="Field">blockHash</a> <a id="13827" class="Symbol">=</a> <a id="13829" href="Peras.SmallStep.html#13708" class="Bound">hb</a>
        <a id="13840" class="Symbol">;</a> <a id="13842" href="Peras.Chain.html#1653" class="Field">signature</a> <a id="13852" class="Symbol">=</a> <a id="13854" href="Peras.SmallStep.html#13704" class="Bound">sig</a>
        <a id="13866" class="Symbol">}</a>
</pre>
<p>A party can vote for a block, if * the current slot is the first slot
in a voting round * the party is a member of the voting committee * the
chain is not in a cool-down phase</p>
Voting updates the partyâ€™s local state and for all other parties a
message is added to be consumed immediately.
<pre class="Agda">    <a id="14179" class="Keyword">infix</a> <a id="14185" class="Number">2</a> <a id="14187" href="Peras.SmallStep.html#14203" class="Datatype Operator">_âŠ¢_â‡‰_</a>

    <a id="14198" class="Keyword">data</a> <a id="14203" href="Peras.SmallStep.html#14203" class="Datatype Operator">_âŠ¢_â‡‰_</a> <a id="14209" class="Symbol">:</a> <a id="14211" class="Symbol">{</a><a id="14212" href="Peras.SmallStep.html#14212" class="Bound">p</a> <a id="14214" class="Symbol">:</a> <a id="14216" href="Peras.Block.html#1264" class="Function">PartyId</a><a id="14223" class="Symbol">}</a> <a id="14225" class="Symbol">â†’</a> <a id="14227" href="Peras.Block.html#1872" class="Datatype">Honesty</a> <a id="14235" href="Peras.SmallStep.html#14212" class="Bound">p</a> <a id="14237" class="Symbol">â†’</a> <a id="14239" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="14245" class="Symbol">â†’</a> <a id="14247" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="14253" class="Symbol">â†’</a> <a id="14255" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="14260" class="Keyword">where</a>

      <a id="14273" href="Peras.SmallStep.html#14273" class="InductiveConstructor">honest</a> <a id="14280" class="Symbol">:</a> <a id="14282" class="Symbol">âˆ€</a> <a id="14284" class="Symbol">{</a><a id="14285" href="Peras.SmallStep.html#14285" class="Bound">p</a><a id="14286" class="Symbol">}</a> <a id="14288" class="Symbol">{</a><a id="14289" href="Peras.SmallStep.html#14289" class="Bound">t</a><a id="14290" class="Symbol">}</a> <a id="14292" class="Symbol">{</a><a id="14293" href="Peras.SmallStep.html#14293" class="Bound">M</a><a id="14294" class="Symbol">}</a> <a id="14296" class="Symbol">{</a><a id="14297" href="Peras.SmallStep.html#14297" class="Bound">Ï€</a><a id="14298" class="Symbol">}</a> <a id="14300" class="Symbol">{</a><a id="14301" href="Peras.SmallStep.html#14301" class="Bound">Ïƒ</a><a id="14302" class="Symbol">}</a> <a id="14304" class="Symbol">{</a><a id="14305" href="Peras.SmallStep.html#14305" class="Bound">b</a><a id="14306" class="Symbol">}</a>
        <a id="14316" class="Symbol">â†’</a> <a id="14318" class="Keyword">let</a>
            <a id="14334" class="Keyword">open</a> <a id="14339" href="Peras.SmallStep.html#9794" class="Module">State</a>
            <a id="14357" href="Peras.SmallStep.html#14357" class="Bound">s</a> <a id="14359" class="Symbol">=</a> <a id="14361" href="Peras.SmallStep.html#9863" class="Field">clock</a> <a id="14367" href="Peras.SmallStep.html#14293" class="Bound">M</a>
            <a id="14381" href="Peras.SmallStep.html#14381" class="Bound">r</a> <a id="14383" class="Symbol">=</a> <a id="14385" href="Peras.Chain.html#5472" class="Function">v-round</a> <a id="14393" href="Peras.SmallStep.html#14357" class="Bound">s</a>
            <a id="14407" href="Peras.SmallStep.html#14407" class="Bound">v</a> <a id="14409" class="Symbol">=</a> <a id="14411" href="Peras.SmallStep.html#13597" class="Function">createVote</a> <a id="14422" href="Peras.SmallStep.html#14357" class="Bound">s</a> <a id="14424" href="Peras.SmallStep.html#14285" class="Bound">p</a> <a id="14426" href="Peras.SmallStep.html#14297" class="Bound">Ï€</a> <a id="14428" href="Peras.SmallStep.html#14301" class="Bound">Ïƒ</a> <a id="14430" href="Peras.SmallStep.html#14305" class="Bound">b</a>
          <a id="14442" class="Keyword">in</a>
          <a id="14455" href="Peras.SmallStep.html#7791" class="Function">BlockSelection</a> <a id="14470" href="Peras.SmallStep.html#14357" class="Bound">s</a> <a id="14472" href="Peras.SmallStep.html#14289" class="Bound">t</a> <a id="14474" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="14476" href="Peras.SmallStep.html#14305" class="Bound">b</a>
        <a id="14486" class="Symbol">â†’</a> <a id="14488" href="Peras.SmallStep.html#9890" class="Field">blockTrees</a> <a id="14499" href="Peras.SmallStep.html#14293" class="Bound">M</a> <a id="14501" href="Prelude.AssocList.html#847" class="Function Operator">â‰</a> <a id="14503" href="Peras.SmallStep.html#14285" class="Bound">p</a> <a id="14505" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="14507" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="14512" href="Peras.SmallStep.html#14289" class="Bound">t</a>
        <a id="14522" class="Symbol">â†’</a> <a id="14524" class="Symbol">(</a><a id="14525" href="Peras.SmallStep.html#14525" class="Bound">sig</a> <a id="14529" class="Symbol">:</a> <a id="14531" href="Peras.Chain.html#2477" class="Field">IsVoteSignature</a> <a id="14547" href="Peras.SmallStep.html#14407" class="Bound">v</a> <a id="14549" href="Peras.SmallStep.html#14301" class="Bound">Ïƒ</a><a id="14550" class="Symbol">)</a>
        <a id="14560" class="Symbol">â†’</a> <a id="14562" href="Peras.Chain.html#5127" class="Function">StartOfRound</a> <a id="14575" href="Peras.SmallStep.html#14357" class="Bound">s</a> <a id="14577" href="Peras.SmallStep.html#14381" class="Bound">r</a>
        <a id="14587" class="Symbol">â†’</a> <a id="14589" class="Symbol">(</a><a id="14590" href="Peras.SmallStep.html#14590" class="Bound">mem</a> <a id="14594" class="Symbol">:</a> <a id="14596" href="Peras.Chain.html#2360" class="Field">IsCommitteeMember</a> <a id="14614" href="Peras.SmallStep.html#14285" class="Bound">p</a> <a id="14616" href="Peras.SmallStep.html#14381" class="Bound">r</a> <a id="14618" href="Peras.SmallStep.html#14297" class="Bound">Ï€</a><a id="14619" class="Symbol">)</a>
        <a id="14629" class="Symbol">â†’</a> <a id="14631" href="Peras.SmallStep.html#9366" class="Function">VotingRule</a> <a id="14642" href="Peras.SmallStep.html#14357" class="Bound">s</a> <a id="14644" href="Peras.SmallStep.html#14289" class="Bound">t</a>
          <a id="14656" class="Comment">----------------------------------------------</a>
        <a id="14711" class="Symbol">â†’</a> <a id="14713" href="Peras.Block.html#1905" class="InductiveConstructor">Honest</a> <a id="14720" class="Symbol">{</a><a id="14721" href="Peras.SmallStep.html#14285" class="Bound">p</a><a id="14722" class="Symbol">}</a> <a id="14724" href="Peras.SmallStep.html#14203" class="Datatype Operator">âŠ¢</a>
            <a id="14738" href="Peras.SmallStep.html#14293" class="Bound">M</a> <a id="14740" href="Peras.SmallStep.html#14203" class="Datatype Operator">â‡‰</a> <a id="14742" href="Peras.SmallStep.html#12224" class="Function Operator">add</a> <a id="14746" class="Symbol">(</a><a id="14747" href="Peras.SmallStep.html#2272" class="InductiveConstructor">VoteMsg</a> <a id="14755" class="Symbol">(</a><a id="14756" href="Peras.SmallStep.html#14590" class="Bound">mem</a> <a id="14760" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="14762" href="Peras.SmallStep.html#14525" class="Bound">sig</a><a id="14765" class="Symbol">)</a> <a id="14767" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="14769" href="Peras.SmallStep.html#2413" class="InductiveConstructor">ğŸ˜</a><a id="14770" class="Symbol">)</a> <a id="14772" href="Peras.SmallStep.html#12224" class="Function Operator">diffuse</a> <a id="14780" href="Peras.SmallStep.html#14293" class="Bound">M</a>
</pre>
<p>Rather than creating a delayed vote, an adversary can honestly create
it and delay the message.</p>
<h2 id="block-creation">Block creation</h2>
<p>Certificates are conditionally added to a block. The following
function determines if there needs to be a certificate provided for a
given voting round and a local block-tree. The conditions are as
follows</p>
<ol type="a">
<li>There is no certificate from 2 rounds ago in certs</li>
<li>The last seen certificate is not expired</li>
<li>The last seen certificate is from a later round than the last
certificate on chain</li>
</ol>
<pre class="Agda">    <a id="15309" href="Peras.SmallStep.html#15309" class="Function">needCert</a> <a id="15318" class="Symbol">:</a> <a id="15320" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="15332" class="Symbol">â†’</a> <a id="15334" href="Peras.SmallStep.html#6591" class="Bound">T</a> <a id="15336" class="Symbol">â†’</a> <a id="15338" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="15344" href="Peras.Block.html#2849" class="Record">Certificate</a>
    <a id="15360" href="Peras.SmallStep.html#15309" class="Function">needCert</a> <a id="15369" class="Symbol">(</a><a id="15370" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="15384" href="Peras.SmallStep.html#15384" class="Bound">r</a><a id="15385" class="Symbol">)</a> <a id="15387" href="Peras.SmallStep.html#15387" class="Bound">t</a> <a id="15389" class="Symbol">=</a>
      <a id="15397" class="Keyword">let</a>
        <a id="15409" href="Peras.SmallStep.html#15409" class="Bound">certâ‹†</a> <a id="15415" class="Symbol">=</a> <a id="15417" href="Peras.SmallStep.html#5525" class="Function">latestCertOnChain</a> <a id="15435" href="Peras.SmallStep.html#15387" class="Bound">t</a>
        <a id="15445" href="Peras.SmallStep.html#15445" class="Bound">certâ€²</a> <a id="15451" class="Symbol">=</a> <a id="15453" href="Peras.SmallStep.html#5655" class="Function">latestCertSeen</a> <a id="15468" href="Peras.SmallStep.html#15387" class="Bound">t</a>
      <a id="15476" class="Keyword">in</a>
        <a id="15487" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="15490" href="Data.Bool.Base.html#941" class="Function">not</a> <a id="15494" class="Symbol">(</a><a id="15495" href="Data.List.Base.html#4896" class="Function">any</a> <a id="15499" class="Symbol">(Î»</a> <a id="15502" class="Symbol">{</a><a id="15503" href="Peras.SmallStep.html#15503" class="Bound">c</a> <a id="15505" class="Symbol">â†’</a> <a id="15507" href="Relation.Nullary.Decidable.Core.html#3623" class="Function Operator">âŒŠ</a> <a id="15509" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="15521" href="Peras.SmallStep.html#15503" class="Bound">c</a> <a id="15523" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="15525" class="Number">2</a> <a id="15527" href="Data.Nat.Properties.html#3311" class="Function Operator">â‰Ÿ</a> <a id="15529" href="Peras.SmallStep.html#15384" class="Bound">r</a> <a id="15531" href="Relation.Nullary.Decidable.Core.html#3623" class="Function Operator">âŒ‹</a><a id="15532" class="Symbol">})</a> <a id="15535" class="Symbol">(</a><a id="15536" href="Peras.SmallStep.html#5256" class="Function">certs</a> <a id="15542" href="Peras.SmallStep.html#15387" class="Bound">t</a><a id="15543" class="Symbol">))</a> <a id="15546" class="Comment">-- (a)</a>
           <a id="15564" href="Data.Bool.Base.html#995" class="Function Operator">âˆ§</a> <a id="15566" class="Symbol">(</a><a id="15567" href="Peras.SmallStep.html#15384" class="Bound">r</a> <a id="15569" href="Data.Nat.Base.html#1477" class="Function Operator">â‰¤áµ‡</a> <a id="15572" href="Peras.Params.html#249" class="Field">A</a> <a id="15574" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="15576" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="15588" href="Peras.SmallStep.html#15445" class="Bound">certâ€²</a><a id="15593" class="Symbol">)</a>                          <a id="15620" class="Comment">-- (b)</a>
           <a id="15638" href="Data.Bool.Base.html#995" class="Function Operator">âˆ§</a> <a id="15640" class="Symbol">(</a><a id="15641" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="15653" href="Peras.SmallStep.html#15409" class="Bound">certâ‹†</a> <a id="15659" href="Data.Nat.Base.html#1457" class="Primitive Operator">&lt;áµ‡</a> <a id="15662" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="15674" href="Peras.SmallStep.html#15445" class="Bound">certâ€²</a><a id="15679" class="Symbol">)</a>              <a id="15694" class="Comment">-- (c)</a>
        <a id="15709" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="15714" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="15719" href="Peras.SmallStep.html#15445" class="Bound">certâ€²</a>
        <a id="15733" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="15738" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
</pre>
Helper function for creating a block
<pre class="Agda">    <a id="15799" href="Peras.SmallStep.html#15799" class="Function">createBlock</a> <a id="15811" class="Symbol">:</a> <a id="15813" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="15824" class="Symbol">â†’</a> <a id="15826" href="Peras.Block.html#1264" class="Function">PartyId</a> <a id="15834" class="Symbol">â†’</a> <a id="15836" href="Peras.Crypto.html#2593" class="Record">LeadershipProof</a> <a id="15852" class="Symbol">â†’</a> <a id="15854" href="Peras.Crypto.html#3115" class="Record">Signature</a> <a id="15864" class="Symbol">â†’</a> <a id="15866" href="Peras.SmallStep.html#6591" class="Bound">T</a> <a id="15868" class="Symbol">â†’</a> <a id="15870" href="Peras.Block.html#2807" class="Record">Block</a>
    <a id="15880" href="Peras.SmallStep.html#15799" class="Function">createBlock</a> <a id="15892" href="Peras.SmallStep.html#15892" class="Bound">s</a> <a id="15894" href="Peras.SmallStep.html#15894" class="Bound">p</a> <a id="15896" href="Peras.SmallStep.html#15896" class="Bound">Ï€</a> <a id="15898" href="Peras.SmallStep.html#15898" class="Bound">Ïƒ</a> <a id="15900" href="Peras.SmallStep.html#15900" class="Bound">t</a> <a id="15902" class="Symbol">=</a>
      <a id="15910" class="Keyword">record</a>
        <a id="15925" class="Symbol">{</a> <a id="15927" href="Peras.Block.html#3233" class="Field">slotNumber</a> <a id="15938" class="Symbol">=</a> <a id="15940" href="Peras.SmallStep.html#15892" class="Bound">s</a>
        <a id="15950" class="Symbol">;</a> <a id="15952" href="Peras.Block.html#3265" class="Field">creatorId</a> <a id="15962" class="Symbol">=</a> <a id="15964" href="Peras.SmallStep.html#15894" class="Bound">p</a>
        <a id="15974" class="Symbol">;</a> <a id="15976" href="Peras.Block.html#3293" class="Field">parentBlock</a> <a id="15988" class="Symbol">=</a>
            <a id="16002" class="Keyword">let</a> <a id="16006" class="Keyword">open</a> <a id="16011" href="Peras.SmallStep.html#2927" class="Module">IsTreeType</a>
            <a id="16034" class="Keyword">in</a> <a id="16037" href="Peras.Block.html#5471" class="Function">tipHash</a> <a id="16045" class="Symbol">(</a><a id="16046" href="Peras.SmallStep.html#5144" class="Function">preferredChain</a> <a id="16061" href="Peras.SmallStep.html#15900" class="Bound">t</a><a id="16062" class="Symbol">)</a>
        <a id="16072" class="Symbol">;</a> <a id="16074" href="Peras.Block.html#3326" class="Field">certificate</a> <a id="16086" class="Symbol">=</a>
            <a id="16100" class="Keyword">let</a> <a id="16104" href="Peras.SmallStep.html#16104" class="Bound">r</a> <a id="16106" class="Symbol">=</a> <a id="16108" href="Peras.Chain.html#5472" class="Function">v-round</a> <a id="16116" href="Peras.SmallStep.html#15892" class="Bound">s</a>
            <a id="16130" class="Keyword">in</a> <a id="16133" href="Peras.SmallStep.html#15309" class="Function">needCert</a> <a id="16142" href="Peras.SmallStep.html#16104" class="Bound">r</a> <a id="16144" href="Peras.SmallStep.html#15900" class="Bound">t</a>
        <a id="16154" class="Symbol">;</a> <a id="16156" href="Peras.Block.html#3366" class="Field">leadershipProof</a> <a id="16172" class="Symbol">=</a> <a id="16174" href="Peras.SmallStep.html#15896" class="Bound">Ï€</a>
        <a id="16184" class="Symbol">;</a> <a id="16186" href="Peras.Block.html#3438" class="Field">bodyHash</a> <a id="16195" class="Symbol">=</a>
            <a id="16209" class="Keyword">let</a> <a id="16213" href="Peras.SmallStep.html#16213" class="Bound">txs</a> <a id="16217" class="Symbol">=</a> <a id="16219" href="Peras.SmallStep.html#6684" class="Bound">txSelection</a> <a id="16231" href="Peras.SmallStep.html#15892" class="Bound">s</a> <a id="16233" href="Peras.SmallStep.html#15894" class="Bound">p</a>
            <a id="16247" class="Keyword">in</a> <a id="16250" href="Peras.Block.html#3773" class="Field">blockHash</a>
                 <a id="16277" class="Keyword">record</a>
                   <a id="16303" class="Symbol">{</a> <a id="16305" href="Peras.Block.html#3773" class="Field">blockHash</a> <a id="16315" class="Symbol">=</a> <a id="16317" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="16322" href="Peras.SmallStep.html#16213" class="Bound">txs</a>
                   <a id="16345" class="Symbol">;</a> <a id="16347" href="Peras.Block.html#3806" class="Field">payload</a> <a id="16355" class="Symbol">=</a> <a id="16357" href="Peras.SmallStep.html#16213" class="Bound">txs</a>
                   <a id="16380" class="Symbol">}</a>
        <a id="16390" class="Symbol">;</a> <a id="16392" href="Peras.Block.html#3408" class="Field">signature</a> <a id="16402" class="Symbol">=</a> <a id="16404" href="Peras.SmallStep.html#15898" class="Bound">Ïƒ</a>
        <a id="16414" class="Symbol">}</a>
</pre>
<p>A party can create a new block by adding it to the local block tree
and diffuse the block creation messages to the other parties. Block
creation is possible, if as in <em>Praos</em></p>
<ul>
<li>the block signature is correct</li>
<li>the party is the slot leader</li>
</ul>
Block creation updates the partyâ€™s local state and for all other parties
a message is added to the message buffer
<pre class="Agda">    <a id="16791" class="Keyword">infix</a> <a id="16797" class="Number">2</a> <a id="16799" href="Peras.SmallStep.html#16815" class="Datatype Operator">_âŠ¢_â†·_</a>

    <a id="16810" class="Keyword">data</a> <a id="16815" href="Peras.SmallStep.html#16815" class="Datatype Operator">_âŠ¢_â†·_</a> <a id="16821" class="Symbol">:</a> <a id="16823" class="Symbol">{</a><a id="16824" href="Peras.SmallStep.html#16824" class="Bound">p</a> <a id="16826" class="Symbol">:</a> <a id="16828" href="Peras.Block.html#1264" class="Function">PartyId</a><a id="16835" class="Symbol">}</a> <a id="16837" class="Symbol">â†’</a> <a id="16839" href="Peras.Block.html#1872" class="Datatype">Honesty</a> <a id="16847" href="Peras.SmallStep.html#16824" class="Bound">p</a> <a id="16849" class="Symbol">â†’</a> <a id="16851" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="16857" class="Symbol">â†’</a> <a id="16859" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="16865" class="Symbol">â†’</a> <a id="16867" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="16872" class="Keyword">where</a>

      <a id="16885" href="Peras.SmallStep.html#16885" class="InductiveConstructor">honest</a> <a id="16892" class="Symbol">:</a> <a id="16894" class="Symbol">âˆ€</a> <a id="16896" class="Symbol">{</a><a id="16897" href="Peras.SmallStep.html#16897" class="Bound">p</a><a id="16898" class="Symbol">}</a> <a id="16900" class="Symbol">{</a><a id="16901" href="Peras.SmallStep.html#16901" class="Bound">t</a><a id="16902" class="Symbol">}</a> <a id="16904" class="Symbol">{</a><a id="16905" href="Peras.SmallStep.html#16905" class="Bound">M</a><a id="16906" class="Symbol">}</a> <a id="16908" class="Symbol">{</a><a id="16909" href="Peras.SmallStep.html#16909" class="Bound">Ï€</a><a id="16910" class="Symbol">}</a> <a id="16912" class="Symbol">{</a><a id="16913" href="Peras.SmallStep.html#16913" class="Bound">Ïƒ</a><a id="16914" class="Symbol">}</a>
        <a id="16924" class="Symbol">â†’</a> <a id="16926" class="Keyword">let</a>
            <a id="16942" class="Keyword">open</a> <a id="16947" href="Peras.SmallStep.html#9794" class="Module">State</a>
            <a id="16965" href="Peras.SmallStep.html#16965" class="Bound">s</a> <a id="16967" class="Symbol">=</a> <a id="16969" href="Peras.SmallStep.html#9863" class="Field">clock</a> <a id="16975" href="Peras.SmallStep.html#16905" class="Bound">M</a>
            <a id="16989" href="Peras.SmallStep.html#16989" class="Bound">b</a> <a id="16991" class="Symbol">=</a> <a id="16993" href="Peras.SmallStep.html#15799" class="Function">createBlock</a> <a id="17005" href="Peras.SmallStep.html#16965" class="Bound">s</a> <a id="17007" href="Peras.SmallStep.html#16897" class="Bound">p</a> <a id="17009" href="Peras.SmallStep.html#16909" class="Bound">Ï€</a> <a id="17011" href="Peras.SmallStep.html#16913" class="Bound">Ïƒ</a> <a id="17013" href="Peras.SmallStep.html#16901" class="Bound">t</a>
            <a id="17027" href="Peras.SmallStep.html#17027" class="Bound">pref</a> <a id="17032" class="Symbol">=</a> <a id="17034" href="Peras.SmallStep.html#5144" class="Function">preferredChain</a> <a id="17049" href="Peras.SmallStep.html#16901" class="Bound">t</a>
          <a id="17061" class="Keyword">in</a>
          <a id="17074" href="Peras.SmallStep.html#9890" class="Field">blockTrees</a> <a id="17085" href="Peras.SmallStep.html#16905" class="Bound">M</a> <a id="17087" href="Prelude.AssocList.html#847" class="Function Operator">â‰</a> <a id="17089" href="Peras.SmallStep.html#16897" class="Bound">p</a> <a id="17091" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">â‰¡</a> <a id="17093" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="17098" href="Peras.SmallStep.html#16901" class="Bound">t</a>
        <a id="17108" class="Symbol">â†’</a> <a id="17110" class="Symbol">(</a><a id="17111" href="Peras.SmallStep.html#17111" class="Bound">vc</a> <a id="17114" class="Symbol">:</a> <a id="17116" href="Peras.Chain.html#6113" class="Datatype">ValidChain</a> <a id="17127" class="Symbol">(</a><a id="17128" href="Peras.SmallStep.html#16989" class="Bound">b</a> <a id="17130" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">âˆ·</a> <a id="17132" href="Peras.SmallStep.html#17027" class="Bound">pref</a><a id="17136" class="Symbol">))</a>
          <a id="17149" class="Comment">----------------------------</a>
        <a id="17186" class="Symbol">â†’</a> <a id="17188" href="Peras.Block.html#1905" class="InductiveConstructor">Honest</a> <a id="17195" class="Symbol">{</a><a id="17196" href="Peras.SmallStep.html#16897" class="Bound">p</a><a id="17197" class="Symbol">}</a> <a id="17199" href="Peras.SmallStep.html#16815" class="Datatype Operator">âŠ¢</a>
            <a id="17213" href="Peras.SmallStep.html#16905" class="Bound">M</a> <a id="17215" href="Peras.SmallStep.html#16815" class="Datatype Operator">â†·</a> <a id="17217" href="Peras.SmallStep.html#12224" class="Function Operator">add</a> <a id="17221" class="Symbol">(</a>
                  <a id="17241" href="Peras.SmallStep.html#2220" class="InductiveConstructor">ChainMsg</a> <a id="17250" href="Peras.SmallStep.html#17111" class="Bound">vc</a>
                <a id="17269" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="17271" href="Peras.SmallStep.html#2413" class="InductiveConstructor">ğŸ˜</a><a id="17272" class="Symbol">)</a>
                <a id="17290" href="Peras.SmallStep.html#12224" class="Function Operator">diffuse</a> <a id="17298" href="Peras.SmallStep.html#16905" class="Bound">M</a>
</pre>
<h2 id="small-step-semantics-1">Small-step semantics</h2>
The small-step semantics describe the evolution of the global state.
<pre class="Agda">    <a id="17410" class="Keyword">variable</a>
      <a id="17425" href="Peras.SmallStep.html#17425" class="Generalizable">M</a> <a id="17427" href="Peras.SmallStep.html#17427" class="Generalizable">N</a> <a id="17429" href="Peras.SmallStep.html#17429" class="Generalizable">O</a> <a id="17431" class="Symbol">:</a> <a id="17433" href="Peras.SmallStep.html#9794" class="Record">State</a>
      <a id="17445" href="Peras.SmallStep.html#17445" class="Generalizable">p</a> <a id="17447" class="Symbol">:</a> <a id="17449" href="Peras.Block.html#1264" class="Function">PartyId</a>
      <a id="17463" href="Peras.SmallStep.html#17463" class="Generalizable">h</a> <a id="17465" class="Symbol">:</a> <a id="17467" href="Peras.Block.html#1872" class="Datatype">Honesty</a> <a id="17475" href="Peras.SmallStep.html#17445" class="Generalizable">p</a>
</pre>
<p>The relation allows</p>
<ul>
<li>Fetching messages at the beginning of each slot</li>
<li>Block creation</li>
<li>Voting</li>
<li>Transitioning to next slot in the same voting round</li>
<li>Transitioning to next slot in a new voting round</li>
</ul>
Note, when transitioning to the next slot we need to distinguish whether
the next slot is in the same or a new voting round. This is necessary in
order to detect adversarial behaviour with respect to voting
(adversarialy not voting in a voting round)
<pre class="Agda">    <a id="17947" class="Keyword">data</a> <a id="17952" href="Peras.SmallStep.html#17952" class="Datatype Operator">_â†_</a> <a id="17956" class="Symbol">:</a> <a id="17958" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="17964" class="Symbol">â†’</a> <a id="17966" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="17972" class="Symbol">â†’</a> <a id="17974" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="17979" class="Keyword">where</a>

      <a id="17992" href="Peras.SmallStep.html#17992" class="InductiveConstructor">Fetch</a> <a id="17998" class="Symbol">:</a> <a id="18000" class="Symbol">âˆ€</a> <a id="18002" class="Symbol">{</a><a id="18003" href="Peras.SmallStep.html#18003" class="Bound">m</a><a id="18004" class="Symbol">}</a> <a id="18006" class="Symbol">â†’</a>
        <a id="18016" href="Prelude.InferenceRules.html#56074" class="Function Operator">âˆ™</a> <a id="18018" href="Peras.SmallStep.html#17463" class="Generalizable">h</a> <a id="18020" href="Peras.SmallStep.html#12587" class="Datatype Operator">âŠ¢</a> <a id="18022" href="Peras.SmallStep.html#17425" class="Generalizable">M</a> <a id="18024" href="Peras.SmallStep.html#12587" class="Datatype Operator">[</a> <a id="18026" href="Peras.SmallStep.html#18003" class="Bound">m</a> <a id="18028" href="Peras.SmallStep.html#12587" class="Datatype Operator">]â‡€</a> <a id="18031" href="Peras.SmallStep.html#17427" class="Generalizable">N</a>
          <a id="18043" href="Prelude.InferenceRules.html#14206" class="Function Operator">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</a>
          <a id="18068" href="Peras.SmallStep.html#17425" class="Generalizable">M</a> <a id="18070" href="Peras.SmallStep.html#17952" class="Datatype Operator">â†</a> <a id="18072" href="Peras.SmallStep.html#17427" class="Generalizable">N</a>

      <a id="18081" href="Peras.SmallStep.html#18081" class="InductiveConstructor">CreateVote</a> <a id="18092" class="Symbol">:</a>
        <a id="18102" href="Prelude.InferenceRules.html#56074" class="Function Operator">âˆ™</a> <a id="18104" href="Peras.SmallStep.html#10434" class="Function">Fetched</a> <a id="18112" href="Peras.SmallStep.html#17425" class="Generalizable">M</a>
        <a id="18122" href="Prelude.InferenceRules.html#56005" class="Function Operator">âˆ™</a> <a id="18124" href="Peras.SmallStep.html#17463" class="Generalizable">h</a> <a id="18126" href="Peras.SmallStep.html#14203" class="Datatype Operator">âŠ¢</a> <a id="18128" href="Peras.SmallStep.html#17425" class="Generalizable">M</a> <a id="18130" href="Peras.SmallStep.html#14203" class="Datatype Operator">â‡‰</a> <a id="18132" href="Peras.SmallStep.html#17427" class="Generalizable">N</a>
          <a id="18144" href="Prelude.InferenceRules.html#14291" class="Function Operator">â”€â”€â”€â”€â”€â”€â”€â”€â”€</a>
          <a id="18164" href="Peras.SmallStep.html#17425" class="Generalizable">M</a> <a id="18166" href="Peras.SmallStep.html#17952" class="Datatype Operator">â†</a> <a id="18168" href="Peras.SmallStep.html#17427" class="Generalizable">N</a>

      <a id="18177" href="Peras.SmallStep.html#18177" class="InductiveConstructor">CreateBlock</a> <a id="18189" class="Symbol">:</a>
        <a id="18199" href="Prelude.InferenceRules.html#56074" class="Function Operator">âˆ™</a> <a id="18201" href="Peras.SmallStep.html#10434" class="Function">Fetched</a> <a id="18209" href="Peras.SmallStep.html#17425" class="Generalizable">M</a>
        <a id="18219" href="Prelude.InferenceRules.html#56005" class="Function Operator">âˆ™</a> <a id="18221" href="Peras.SmallStep.html#17463" class="Generalizable">h</a> <a id="18223" href="Peras.SmallStep.html#16815" class="Datatype Operator">âŠ¢</a> <a id="18225" href="Peras.SmallStep.html#17425" class="Generalizable">M</a> <a id="18227" href="Peras.SmallStep.html#16815" class="Datatype Operator">â†·</a> <a id="18229" href="Peras.SmallStep.html#17427" class="Generalizable">N</a>
          <a id="18241" href="Prelude.InferenceRules.html#14291" class="Function Operator">â”€â”€â”€â”€â”€â”€â”€â”€â”€</a>
          <a id="18261" href="Peras.SmallStep.html#17425" class="Generalizable">M</a> <a id="18263" href="Peras.SmallStep.html#17952" class="Datatype Operator">â†</a> <a id="18265" href="Peras.SmallStep.html#17427" class="Generalizable">N</a>

      <a id="18274" href="Peras.SmallStep.html#18274" class="InductiveConstructor">NextSlot</a> <a id="18283" class="Symbol">:</a>
        <a id="18293" href="Prelude.InferenceRules.html#56074" class="Function Operator">âˆ™</a> <a id="18295" href="Peras.SmallStep.html#10434" class="Function">Fetched</a> <a id="18303" href="Peras.SmallStep.html#17425" class="Generalizable">M</a>
          <a id="18315" href="Prelude.InferenceRules.html#14276" class="Function Operator">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</a>
          <a id="18336" href="Peras.SmallStep.html#17425" class="Generalizable">M</a> <a id="18338" href="Peras.SmallStep.html#17952" class="Datatype Operator">â†</a> <a id="18340" href="Peras.SmallStep.html#11585" class="Function">tick</a> <a id="18345" href="Peras.SmallStep.html#17425" class="Generalizable">M</a>
</pre>
<h4 id="reflexive-transitive-closure">Reflexive, transitive closure</h4>
List-like structure for defining execution paths.
<pre class="Agda">    <a id="18448" class="Keyword">infix</a>  <a id="18455" class="Number">2</a> <a id="18457" href="Peras.SmallStep.html#18504" class="Datatype Operator">_â†â‹†_</a>
    <a id="18466" class="Keyword">infixr</a> <a id="18473" class="Number">2</a> <a id="18475" href="Peras.SmallStep.html#18561" class="InductiveConstructor Operator">_â†£_</a>
    <a id="18483" class="Keyword">infix</a>  <a id="18490" class="Number">3</a> <a id="18492" href="Peras.SmallStep.html#18544" class="InductiveConstructor">âˆ</a>

    <a id="18499" class="Keyword">data</a> <a id="18504" href="Peras.SmallStep.html#18504" class="Datatype Operator">_â†â‹†_</a> <a id="18509" class="Symbol">:</a> <a id="18511" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="18517" class="Symbol">â†’</a> <a id="18519" href="Peras.SmallStep.html#9794" class="Record">State</a> <a id="18525" class="Symbol">â†’</a> <a id="18527" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="18532" class="Keyword">where</a>
      <a id="18544" href="Peras.SmallStep.html#18544" class="InductiveConstructor">âˆ</a> <a id="18546" class="Symbol">:</a> <a id="18548" href="Peras.SmallStep.html#17425" class="Generalizable">M</a> <a id="18550" href="Peras.SmallStep.html#18504" class="Datatype Operator">â†â‹†</a> <a id="18553" href="Peras.SmallStep.html#17425" class="Generalizable">M</a>
      <a id="18561" href="Peras.SmallStep.html#18561" class="InductiveConstructor Operator">_â†£_</a> <a id="18565" class="Symbol">:</a> <a id="18567" href="Peras.SmallStep.html#17425" class="Generalizable">M</a> <a id="18569" href="Peras.SmallStep.html#17952" class="Datatype Operator">â†</a> <a id="18571" href="Peras.SmallStep.html#17427" class="Generalizable">N</a> <a id="18573" class="Symbol">â†’</a> <a id="18575" href="Peras.SmallStep.html#17427" class="Generalizable">N</a> <a id="18577" href="Peras.SmallStep.html#18504" class="Datatype Operator">â†â‹†</a> <a id="18580" href="Peras.SmallStep.html#17429" class="Generalizable">O</a> <a id="18582" class="Symbol">â†’</a> <a id="18584" href="Peras.SmallStep.html#17425" class="Generalizable">M</a> <a id="18586" href="Peras.SmallStep.html#18504" class="Datatype Operator">â†â‹†</a> <a id="18589" href="Peras.SmallStep.html#17429" class="Generalizable">O</a>
</pre>
<pre class="Agda">    <a id="18607" class="Keyword">infixr</a> <a id="18614" class="Number">2</a> <a id="18616" href="Peras.SmallStep.html#18627" class="Function Operator">_++&#39;_</a>

    <a id="18627" href="Peras.SmallStep.html#18627" class="Function Operator">_++&#39;_</a> <a id="18633" class="Symbol">:</a>
        <a id="18643" href="Peras.SmallStep.html#17425" class="Generalizable">M</a> <a id="18645" href="Peras.SmallStep.html#18504" class="Datatype Operator">â†â‹†</a> <a id="18648" href="Peras.SmallStep.html#17427" class="Generalizable">N</a>
      <a id="18656" class="Symbol">â†’</a> <a id="18658" href="Peras.SmallStep.html#17427" class="Generalizable">N</a> <a id="18660" href="Peras.SmallStep.html#18504" class="Datatype Operator">â†â‹†</a> <a id="18663" href="Peras.SmallStep.html#17429" class="Generalizable">O</a>
      <a id="18671" class="Symbol">â†’</a> <a id="18673" href="Peras.SmallStep.html#17425" class="Generalizable">M</a> <a id="18675" href="Peras.SmallStep.html#18504" class="Datatype Operator">â†â‹†</a> <a id="18678" href="Peras.SmallStep.html#17429" class="Generalizable">O</a>
    <a id="18684" href="Peras.SmallStep.html#18544" class="InductiveConstructor">âˆ</a> <a id="18686" href="Peras.SmallStep.html#18627" class="Function Operator">++&#39;</a> <a id="18690" href="Peras.SmallStep.html#18690" class="Bound">Mâ†â‹†O</a> <a id="18695" class="Symbol">=</a> <a id="18697" href="Peras.SmallStep.html#18690" class="Bound">Mâ†â‹†O</a>
    <a id="18706" class="Symbol">(</a><a id="18707" href="Peras.SmallStep.html#18707" class="Bound">Mâ†Mâ‚</a> <a id="18712" href="Peras.SmallStep.html#18561" class="InductiveConstructor Operator">â†£</a> <a id="18714" href="Peras.SmallStep.html#18714" class="Bound">Mâ‚â†â‹†N</a><a id="18719" class="Symbol">)</a> <a id="18721" href="Peras.SmallStep.html#18627" class="Function Operator">++&#39;</a> <a id="18725" href="Peras.SmallStep.html#18725" class="Bound">Nâ†â‹†O</a> <a id="18730" class="Symbol">=</a> <a id="18732" href="Peras.SmallStep.html#18707" class="Bound">Mâ†Mâ‚</a> <a id="18737" href="Peras.SmallStep.html#18561" class="InductiveConstructor Operator">â†£</a> <a id="18739" href="Peras.SmallStep.html#18714" class="Bound">Mâ‚â†â‹†N</a> <a id="18745" href="Peras.SmallStep.html#18627" class="Function Operator">++&#39;</a> <a id="18749" href="Peras.SmallStep.html#18725" class="Bound">Nâ†â‹†O</a>
</pre>
<pre class="Agda">  <a id="18768" class="Keyword">open</a> <a id="18773" href="Peras.SmallStep.html#6569" class="Module">Semantics</a> <a id="18783" class="Keyword">public</a>
</pre>
</body>
</html>
