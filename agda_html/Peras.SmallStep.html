<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Peras.SmallStep</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="Agda.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre class="Agda"><a id="9" class="Keyword">module</a> <a id="16" href="Peras.SmallStep.html" class="Module">Peras.SmallStep</a> <a id="32" class="Keyword">where</a>
</pre>
<!--
<pre class="Agda"><a id="55" class="Keyword">open</a> <a id="60" class="Keyword">import</a> <a id="67" href="Prelude.AssocList.html" class="Module">Prelude.AssocList</a>
<a id="85" class="Keyword">open</a> <a id="90" class="Keyword">import</a> <a id="97" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a> <a id="111" class="Keyword">using</a> <a id="117" class="Symbol">(</a><a id="118" href="Prelude.DecEq.html#62" class="Record">DecEq</a><a id="123" class="Symbol">)</a>
<a id="125" class="Keyword">open</a> <a id="130" class="Keyword">import</a> <a id="137" href="Prelude.Default.html" class="Module">Prelude.Default</a> <a id="153" class="Keyword">using</a> <a id="159" class="Symbol">(</a><a id="160" href="Prelude.Default.html#100" class="Record">Default</a><a id="167" class="Symbol">)</a>
<a id="169" class="Keyword">open</a> <a id="174" href="Prelude.Default.html#100" class="Module">Default</a> <a id="182" class="Symbol">⦃...⦄</a>

<a id="189" class="Keyword">open</a> <a id="194" class="Keyword">import</a> <a id="201" href="Prelude.InferenceRules.html" class="Module">Prelude.InferenceRules</a>
<a id="224" class="Keyword">open</a> <a id="229" class="Keyword">import</a> <a id="236" href="Prelude.Init.html" class="Module">Prelude.Init</a> <a id="249" class="Keyword">hiding</a> <a id="256" class="Symbol">(</a><a id="257" href="Data.List.Relation.Binary.Sublist.Setoid.html#1567" class="Function Operator">_⊆_</a><a id="260" class="Symbol">)</a>

<a id="263" class="Keyword">open</a> <a id="268" href="Prelude.Init.html#940" class="Module">Nat</a> <a id="272" class="Keyword">using</a> <a id="278" class="Symbol">(</a><a id="279" href="Data.Nat.Properties.html#3311" class="Function Operator">_≟_</a><a id="282" class="Symbol">;</a> <a id="284" href="Data.Nat.Properties.html#6146" class="Function Operator">_≤?_</a><a id="288" class="Symbol">;</a> <a id="290" href="Data.Nat.Base.html#1477" class="Function Operator">_≤ᵇ_</a><a id="294" class="Symbol">;</a> <a id="296" href="Data.Nat.Properties.html#6212" class="Function Operator">_≥?_</a><a id="300" class="Symbol">;</a> <a id="302" href="Data.Nat.Base.html#7279" class="Function Operator">_%_</a><a id="305" class="Symbol">;</a> <a id="307" href="Data.Nat.Properties.html#10900" class="Function Operator">_&gt;?_</a><a id="311" class="Symbol">;</a> <a id="313" href="Data.Nat.Base.html#3260" class="Record">NonZero</a><a id="320" class="Symbol">)</a>
<a id="322" class="Keyword">open</a> <a id="327" href="Prelude.Init.html#2456" class="Module">L</a> <a id="329" class="Keyword">using</a> <a id="335" class="Symbol">(</a><a id="336" href="Data.List.Base.html#4538" class="Function">concat</a><a id="342" class="Symbol">)</a>
<a id="344" class="Keyword">open</a> <a id="349" href="Prelude.Init.html#2546" class="Module">L.All</a> <a id="355" class="Keyword">using</a> <a id="361" class="Symbol">(</a><a id="362" href="Data.List.Relation.Unary.All.html#1627" class="Datatype">All</a><a id="365" class="Symbol">)</a>
<a id="367" class="Keyword">open</a> <a id="372" href="Prelude.Init.html#2680" class="Module">L.Any</a> <a id="378" class="Keyword">using</a> <a id="384" class="Symbol">(</a><a id="385" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a><a id="388" class="Symbol">;</a> <a id="390" href="Data.List.Relation.Unary.Any.html#2138" class="Function Operator">_─_</a><a id="393" class="Symbol">;</a> <a id="395" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a><a id="399" class="Symbol">)</a> <a id="401" class="Keyword">renaming</a> <a id="410" class="Symbol">(</a><a id="411" href="Data.List.Relation.Unary.Any.html#2027" class="Function Operator">_∷=_</a> <a id="416" class="Symbol">to</a> <a id="419" class="Function Operator">_∷ˡ=_</a><a id="424" class="Symbol">)</a>

<a id="427" class="Keyword">open</a> <a id="432" class="Keyword">import</a> <a id="439" href="Peras.Block.html" class="Module">Peras.Block</a>
<a id="451" class="Keyword">open</a> <a id="456" class="Keyword">import</a> <a id="463" href="Peras.Chain.html" class="Module">Peras.Chain</a>
<a id="475" class="Keyword">open</a> <a id="480" class="Keyword">import</a> <a id="487" href="Peras.Crypto.html" class="Module">Peras.Crypto</a>
<a id="500" class="Keyword">open</a> <a id="505" class="Keyword">import</a> <a id="512" href="Peras.Numbering.html" class="Module">Peras.Numbering</a>
<a id="528" class="Keyword">open</a> <a id="533" class="Keyword">import</a> <a id="540" href="Peras.Params.html" class="Module">Peras.Params</a>

<a id="554" class="Keyword">open</a> <a id="559" class="Keyword">import</a> <a id="566" href="Data.List.Relation.Binary.Subset.Propositional.html" class="Module">Data.List.Relation.Binary.Subset.Propositional</a> <a id="613" class="Symbol">{</a><a id="614" class="Argument">A</a> <a id="616" class="Symbol">=</a> <a id="618" href="Peras.Block.html#2807" class="Record">Block</a><a id="623" class="Symbol">}</a> <a id="625" class="Keyword">using</a> <a id="631" class="Symbol">(</a><a id="632" href="Data.List.Relation.Binary.Subset.Setoid.html#825" class="Function Operator">_⊆_</a><a id="635" class="Symbol">)</a>
<a id="637" class="Keyword">open</a> <a id="642" class="Keyword">import</a> <a id="649" href="Data.List.Relation.Binary.Subset.Propositional.html" class="Module">Data.List.Relation.Binary.Subset.Propositional</a> <a id="696" class="Symbol">{</a><a id="697" class="Argument">A</a> <a id="699" class="Symbol">=</a> <a id="701" href="Peras.Block.html#2849" class="Record">Certificate</a><a id="712" class="Symbol">}</a> <a id="714" class="Keyword">renaming</a> <a id="723" class="Symbol">(</a><a id="724" href="Data.List.Relation.Binary.Subset.Setoid.html#825" class="Function Operator">_⊆_</a> <a id="728" class="Symbol">to</a> <a id="731" class="Function Operator">_⊆ᶜ_</a><a id="735" class="Symbol">)</a>

<a id="738" class="Keyword">import</a> <a id="745" href="Haskell.Prelude.html" class="Module">Haskell.Prelude</a> <a id="761" class="Symbol">as</a> <a id="764" class="Module">H</a> <a id="766" class="Comment">-- TODO: drop agda2hs Prelude here</a>

<a id="802" class="Keyword">open</a> <a id="807" href="Peras.Block.html#1872" class="Module">Honesty</a> <a id="815" class="Keyword">public</a>
<a id="822" class="Keyword">open</a> <a id="827" href="Peras.Crypto.html#2161" class="Module">MembershipProof</a> <a id="843" class="Keyword">public</a>
<a id="850" class="Keyword">open</a> <a id="855" href="Peras.Crypto.html#3115" class="Module">Signature</a> <a id="865" class="Keyword">public</a>
<a id="872" class="Keyword">open</a> <a id="877" href="Peras.Numbering.html#1669" class="Module">RoundNumber</a> <a id="889" class="Keyword">public</a>
<a id="896" class="Keyword">open</a> <a id="901" href="Peras.Block.html#1448" class="Module">Party</a>
</pre>-->
<h1 id="small-step-semantics">Small-step semantics</h1>
<p>The small-step semantics of the <strong>Ouroboros Peras</strong>
protocol define the evolution of the global state of the system
modelling <em>honest</em> and <em>adversarial</em> parties. The number
of parties is fixed during the execution of the protocol and the list of
parties has to be provided as a module parameter. In addition the model
is parameterized by the lotteries (for slot leadership and voting
committee membership) as well as the type of the block tree. Furthermore
adversarial parties share generic, adversarial state.</p>
<p>References:</p>
<ul>
<li>Formalizing Nakamoto-Style Proof of Stake, Søren Eller Thomsen and
Bas Spitters</li>
</ul>
<h3 id="parameters">Parameters</h3>
<p>The parameters for the <em>Peras</em> protocol and hash functions are
defined as instance arguments of the module.</p>
<pre class="Agda"><a id="1681" class="Keyword">module</a> <a id="1688" href="Peras.SmallStep.html#1688" class="Module">_</a> <a id="1690" class="Symbol">⦃</a> <a id="1692" href="Peras.SmallStep.html#1692" class="Bound">_</a> <a id="1694" class="Symbol">:</a> <a id="1696" href="Peras.Crypto.html#1994" class="Record">Hashable</a> <a id="1705" href="Peras.Block.html#2807" class="Record">Block</a> <a id="1711" class="Symbol">⦄</a>
         <a id="1722" class="Symbol">⦃</a> <a id="1724" href="Peras.SmallStep.html#1724" class="Bound">_</a> <a id="1726" class="Symbol">:</a> <a id="1728" href="Peras.Crypto.html#1994" class="Record">Hashable</a> <a id="1737" class="Symbol">(</a><a id="1738" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1743" href="Peras.Block.html#2329" class="Function">Tx</a><a id="1745" class="Symbol">)</a> <a id="1747" class="Symbol">⦄</a>
         <a id="1758" class="Symbol">⦃</a> <a id="1760" href="Peras.SmallStep.html#1760" class="Bound">_</a> <a id="1762" class="Symbol">:</a> <a id="1764" href="Peras.Params.html#166" class="Record">Params</a> <a id="1771" class="Symbol">⦄</a>
         <a id="1782" class="Symbol">⦃</a> <a id="1784" href="Peras.SmallStep.html#1784" class="Bound">_</a> <a id="1786" class="Symbol">:</a> <a id="1788" href="Peras.Chain.html#2526" class="Record">Network</a> <a id="1796" class="Symbol">⦄</a>
         <a id="1807" class="Symbol">⦃</a> <a id="1809" href="Peras.SmallStep.html#1809" class="Bound">_</a> <a id="1811" class="Symbol">:</a> <a id="1813" href="Peras.Chain.html#2260" class="Record">Postulates</a> <a id="1824" class="Symbol">⦄</a>

         <a id="1836" class="Keyword">where</a>
</pre>
The block tree, resp. the validity of the chain is defined with respect
of the parameters.
<pre class="Agda">  <a id="1951" class="Keyword">open</a> <a id="1956" href="Peras.Crypto.html#1994" class="Module">Hashable</a> <a id="1965" class="Symbol">⦃...⦄</a>
  <a id="1973" class="Keyword">open</a> <a id="1978" href="Peras.Params.html#166" class="Module">Params</a> <a id="1985" class="Symbol">⦃...⦄</a>
  <a id="1993" class="Keyword">open</a> <a id="1998" href="Peras.Chain.html#2526" class="Module">Network</a> <a id="2006" class="Symbol">⦃...⦄</a>
  <a id="2014" class="Keyword">open</a> <a id="2019" href="Peras.Chain.html#2260" class="Module">Postulates</a> <a id="2030" class="Symbol">⦃...⦄</a>
</pre>
<h4 id="messages">Messages</h4>
Messages for sending and receiving chains and votes. Note, in the
<em>Peras</em> protocol certificates are not diffused explicitly.
<pre class="Agda">  <a id="2190" class="Keyword">data</a> <a id="2195" href="Peras.SmallStep.html#2195" class="Datatype">Message</a> <a id="2203" class="Symbol">:</a> <a id="2205" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2210" class="Keyword">where</a>
    <a id="2220" href="Peras.SmallStep.html#2220" class="InductiveConstructor">ChainMsg</a> <a id="2229" class="Symbol">:</a> <a id="2231" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="2237" class="Symbol">→</a> <a id="2239" href="Peras.SmallStep.html#2195" class="Datatype">Message</a>
    <a id="2251" href="Peras.SmallStep.html#2251" class="InductiveConstructor">VoteMsg</a> <a id="2259" class="Symbol">:</a> <a id="2261" href="Peras.Chain.html#1472" class="Record">Vote</a> <a id="2266" class="Symbol">→</a> <a id="2268" href="Peras.SmallStep.html#2195" class="Datatype">Message</a>
</pre>
Messages can be delayed by a number of slots
<pre class="Agda">  <a id="2335" href="Peras.SmallStep.html#2335" class="Function">Delay</a> <a id="2341" class="Symbol">=</a> <a id="2343" href="Data.Fin.Base.html#1154" class="Datatype">Fin</a> <a id="2347" class="Symbol">(</a><a id="2348" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="2352" class="Symbol">(</a><a id="2353" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="2357" href="Peras.Chain.html#2559" class="Field">Δ</a><a id="2358" class="Symbol">))</a>

  <a id="2364" class="Keyword">pattern</a> <a id="2372" href="Peras.SmallStep.html#2372" class="InductiveConstructor">𝟘</a> <a id="2374" class="Symbol">=</a> <a id="2376" href="Data.Fin.Base.html#1176" class="InductiveConstructor">fzero</a>
  <a id="2384" class="Keyword">pattern</a> <a id="2392" href="Peras.SmallStep.html#2392" class="InductiveConstructor">𝟙</a> <a id="2394" class="Symbol">=</a> <a id="2396" href="Data.Fin.Base.html#1197" class="InductiveConstructor">fsuc</a> <a id="2401" href="Data.Fin.Base.html#1176" class="InductiveConstructor">fzero</a>
  <a id="2409" class="Keyword">pattern</a> <a id="2417" href="Peras.SmallStep.html#2417" class="InductiveConstructor">𝟚</a> <a id="2419" class="Symbol">=</a> <a id="2421" href="Data.Fin.Base.html#1197" class="InductiveConstructor">fsuc</a> <a id="2426" class="Symbol">(</a><a id="2427" href="Data.Fin.Base.html#1197" class="InductiveConstructor">fsuc</a> <a id="2432" href="Data.Fin.Base.html#1176" class="InductiveConstructor">fzero</a><a id="2437" class="Symbol">)</a>
</pre>
Messages are put into an envelope and assigned to a party. The message
can be delayed.
<pre class="Agda">  <a id="2540" class="Keyword">record</a> <a id="2547" href="Peras.SmallStep.html#2547" class="Record">Envelope</a> <a id="2556" class="Symbol">:</a> <a id="2558" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2563" class="Keyword">where</a>
    <a id="2573" class="Keyword">constructor</a> <a id="2585" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">⦅_,_,_,_⦆</a>
    <a id="2599" class="Keyword">field</a>
      <a id="2611" href="Peras.SmallStep.html#2611" class="Field">partyId</a> <a id="2619" class="Symbol">:</a> <a id="2621" href="Peras.Block.html#1264" class="Function">PartyId</a>
      <a id="2635" href="Peras.SmallStep.html#2635" class="Field">honesty</a> <a id="2643" class="Symbol">:</a> <a id="2645" href="Peras.Block.html#1872" class="Datatype">Honesty</a> <a id="2653" href="Peras.SmallStep.html#2611" class="Field">partyId</a>
      <a id="2667" href="Peras.SmallStep.html#2667" class="Field">message</a> <a id="2675" class="Symbol">:</a> <a id="2677" href="Peras.SmallStep.html#2195" class="Datatype">Message</a>
      <a id="2691" href="Peras.SmallStep.html#2691" class="Field">delay</a> <a id="2697" class="Symbol">:</a> <a id="2699" href="Peras.SmallStep.html#2335" class="Function">Delay</a>

  <a id="2708" class="Keyword">open</a> <a id="2713" href="Peras.SmallStep.html#2547" class="Module">Envelope</a>
</pre>
<h4 id="block-tree">Block-tree</h4>
A block-tree is defined by properties - an implementation of the
block-tree has to fulfil all the properties mentioned below:
<pre class="Agda">  <a id="2879" class="Keyword">record</a> <a id="2886" href="Peras.SmallStep.html#2886" class="Record">IsTreeType</a> <a id="2897" class="Symbol">{</a><a id="2898" href="Peras.SmallStep.html#2898" class="Bound">T</a> <a id="2900" class="Symbol">:</a> <a id="2902" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="2906" class="Symbol">}</a>
                    <a id="2928" class="Symbol">(</a><a id="2929" href="Peras.SmallStep.html#2929" class="Bound">tree₀</a> <a id="2935" class="Symbol">:</a> <a id="2937" href="Peras.SmallStep.html#2898" class="Bound">T</a><a id="2938" class="Symbol">)</a>
                    <a id="2960" class="Symbol">(</a><a id="2961" href="Peras.SmallStep.html#2961" class="Bound">newChain</a> <a id="2970" class="Symbol">:</a> <a id="2972" href="Peras.SmallStep.html#2898" class="Bound">T</a> <a id="2974" class="Symbol">→</a> <a id="2976" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="2982" class="Symbol">→</a> <a id="2984" href="Peras.SmallStep.html#2898" class="Bound">T</a><a id="2985" class="Symbol">)</a>
                    <a id="3007" class="Symbol">(</a><a id="3008" href="Peras.SmallStep.html#3008" class="Bound">allChains</a> <a id="3018" class="Symbol">:</a> <a id="3020" href="Peras.SmallStep.html#2898" class="Bound">T</a> <a id="3022" class="Symbol">→</a> <a id="3024" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3029" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="3034" class="Symbol">)</a>
                    <a id="3056" class="Symbol">(</a><a id="3057" href="Peras.SmallStep.html#3057" class="Bound">preferredChain</a> <a id="3072" class="Symbol">:</a> <a id="3074" href="Peras.SmallStep.html#2898" class="Bound">T</a> <a id="3076" class="Symbol">→</a> <a id="3078" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="3083" class="Symbol">)</a>
                    <a id="3105" class="Symbol">(</a><a id="3106" href="Peras.SmallStep.html#3106" class="Bound">addVote</a> <a id="3114" class="Symbol">:</a> <a id="3116" href="Peras.SmallStep.html#2898" class="Bound">T</a> <a id="3118" class="Symbol">→</a> <a id="3120" href="Peras.Chain.html#1472" class="Record">Vote</a> <a id="3125" class="Symbol">→</a> <a id="3127" href="Peras.SmallStep.html#2898" class="Bound">T</a><a id="3128" class="Symbol">)</a>
                    <a id="3150" class="Symbol">(</a><a id="3151" href="Peras.SmallStep.html#3151" class="Bound">votes</a> <a id="3157" class="Symbol">:</a> <a id="3159" href="Peras.SmallStep.html#2898" class="Bound">T</a> <a id="3161" class="Symbol">→</a> <a id="3163" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3168" href="Peras.Chain.html#1472" class="Record">Vote</a><a id="3172" class="Symbol">)</a>
                    <a id="3194" class="Symbol">(</a><a id="3195" href="Peras.SmallStep.html#3195" class="Bound">certs</a> <a id="3201" class="Symbol">:</a> <a id="3203" href="Peras.SmallStep.html#2898" class="Bound">T</a> <a id="3205" class="Symbol">→</a> <a id="3207" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3212" href="Peras.Block.html#2849" class="Record">Certificate</a><a id="3223" class="Symbol">)</a>
                    <a id="3245" class="Symbol">(</a><a id="3246" href="Peras.SmallStep.html#3246" class="Bound">cert₀</a> <a id="3252" class="Symbol">:</a> <a id="3254" href="Peras.Block.html#2849" class="Record">Certificate</a><a id="3265" class="Symbol">)</a>
         <a id="3276" class="Symbol">:</a> <a id="3278" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="3284" class="Keyword">where</a>

    <a id="3295" class="Keyword">field</a>
</pre>
Properties that must hold with respect to chains, certificates and
votes.
<pre class="Agda">      <a id="3393" href="Peras.SmallStep.html#3393" class="Field">instantiated</a> <a id="3406" class="Symbol">:</a>
        <a id="3416" href="Peras.SmallStep.html#3057" class="Bound">preferredChain</a> <a id="3431" href="Peras.SmallStep.html#2929" class="Bound">tree₀</a> <a id="3437" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3439" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

      <a id="3449" href="Peras.SmallStep.html#3449" class="Field">instantiated-certs</a> <a id="3468" class="Symbol">:</a>
        <a id="3478" href="Peras.SmallStep.html#3195" class="Bound">certs</a> <a id="3484" href="Peras.SmallStep.html#2929" class="Bound">tree₀</a> <a id="3490" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3492" href="Peras.SmallStep.html#3246" class="Bound">cert₀</a> <a id="3498" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3500" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

      <a id="3510" href="Peras.SmallStep.html#3510" class="Field">instantiated-votes</a> <a id="3529" class="Symbol">:</a>
        <a id="3539" href="Peras.SmallStep.html#3151" class="Bound">votes</a> <a id="3545" href="Peras.SmallStep.html#2929" class="Bound">tree₀</a> <a id="3551" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3553" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

      <a id="3563" href="Peras.SmallStep.html#3563" class="Field">extendable-chain</a> <a id="3580" class="Symbol">:</a> <a id="3582" class="Symbol">∀</a> <a id="3584" class="Symbol">(</a><a id="3585" href="Peras.SmallStep.html#3585" class="Bound">t</a> <a id="3587" class="Symbol">:</a> <a id="3589" href="Peras.SmallStep.html#2898" class="Bound">T</a><a id="3590" class="Symbol">)</a> <a id="3592" class="Symbol">(</a><a id="3593" href="Peras.SmallStep.html#3593" class="Bound">c</a> <a id="3595" class="Symbol">:</a> <a id="3597" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="3602" class="Symbol">)</a>
        <a id="3612" class="Symbol">→</a> <a id="3614" href="Peras.SmallStep.html#3195" class="Bound">certs</a> <a id="3620" class="Symbol">(</a><a id="3621" href="Peras.SmallStep.html#2961" class="Bound">newChain</a> <a id="3630" href="Peras.SmallStep.html#3585" class="Bound">t</a> <a id="3632" href="Peras.SmallStep.html#3593" class="Bound">c</a><a id="3633" class="Symbol">)</a> <a id="3635" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3637" href="Haskell.Prim.Foldable.html#528" class="Field">H.foldr</a> <a id="3645" href="Peras.Chain.html#3286" class="Function">insertCert</a> <a id="3656" class="Symbol">(</a><a id="3657" href="Peras.SmallStep.html#3195" class="Bound">certs</a> <a id="3663" href="Peras.SmallStep.html#3585" class="Bound">t</a><a id="3664" class="Symbol">)</a> <a id="3666" class="Symbol">(</a><a id="3667" href="Peras.Chain.html#3194" class="Function">certsFromChain</a> <a id="3682" href="Peras.SmallStep.html#3593" class="Bound">c</a><a id="3683" class="Symbol">)</a>

      <a id="3692" href="Peras.SmallStep.html#3692" class="Field">valid</a> <a id="3698" class="Symbol">:</a> <a id="3700" class="Symbol">∀</a> <a id="3702" class="Symbol">(</a><a id="3703" href="Peras.SmallStep.html#3703" class="Bound">t</a> <a id="3705" class="Symbol">:</a> <a id="3707" href="Peras.SmallStep.html#2898" class="Bound">T</a><a id="3708" class="Symbol">)</a>
        <a id="3718" class="Symbol">→</a> <a id="3720" href="Peras.Chain.html#6113" class="Datatype">ValidChain</a> <a id="3731" class="Symbol">(</a><a id="3732" href="Peras.SmallStep.html#3057" class="Bound">preferredChain</a> <a id="3747" href="Peras.SmallStep.html#3703" class="Bound">t</a><a id="3748" class="Symbol">)</a>

      <a id="3757" href="Peras.SmallStep.html#3757" class="Field">optimal</a> <a id="3765" class="Symbol">:</a> <a id="3767" class="Symbol">∀</a> <a id="3769" class="Symbol">(</a><a id="3770" href="Peras.SmallStep.html#3770" class="Bound">c</a> <a id="3772" class="Symbol">:</a> <a id="3774" href="Peras.Chain.html#3111" class="Function">Chain</a><a id="3779" class="Symbol">)</a> <a id="3781" class="Symbol">(</a><a id="3782" href="Peras.SmallStep.html#3782" class="Bound">t</a> <a id="3784" class="Symbol">:</a> <a id="3786" href="Peras.SmallStep.html#2898" class="Bound">T</a><a id="3787" class="Symbol">)</a>
        <a id="3797" class="Symbol">→</a> <a id="3799" class="Keyword">let</a>
            <a id="3815" href="Peras.SmallStep.html#3815" class="Bound">b</a> <a id="3817" class="Symbol">=</a> <a id="3819" href="Peras.SmallStep.html#3057" class="Bound">preferredChain</a> <a id="3834" href="Peras.SmallStep.html#3782" class="Bound">t</a>
            <a id="3848" href="Peras.SmallStep.html#3848" class="Bound">cts</a> <a id="3852" class="Symbol">=</a> <a id="3854" href="Peras.SmallStep.html#3195" class="Bound">certs</a> <a id="3860" href="Peras.SmallStep.html#3782" class="Bound">t</a>
          <a id="3872" class="Keyword">in</a>
          <a id="3885" href="Peras.Chain.html#6113" class="Datatype">ValidChain</a> <a id="3896" href="Peras.SmallStep.html#3770" class="Bound">c</a>
        <a id="3906" class="Symbol">→</a> <a id="3908" href="Peras.SmallStep.html#3770" class="Bound">c</a> <a id="3910" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="3912" href="Peras.SmallStep.html#3008" class="Bound">allChains</a> <a id="3922" href="Peras.SmallStep.html#3782" class="Bound">t</a>
        <a id="3932" class="Symbol">→</a> <a id="3934" href="Peras.Chain.html#5590" class="Function Operator">∥</a> <a id="3936" href="Peras.SmallStep.html#3770" class="Bound">c</a> <a id="3938" href="Peras.Chain.html#5590" class="Function Operator">∥</a> <a id="3940" href="Peras.SmallStep.html#3848" class="Bound">cts</a> <a id="3944" href="Data.Nat.Base.html#1691" class="Datatype Operator">≤</a> <a id="3946" href="Peras.Chain.html#5590" class="Function Operator">∥</a> <a id="3948" href="Peras.SmallStep.html#3815" class="Bound">b</a> <a id="3950" href="Peras.Chain.html#5590" class="Function Operator">∥</a> <a id="3952" href="Peras.SmallStep.html#3848" class="Bound">cts</a>

      <a id="3963" href="Peras.SmallStep.html#3963" class="Field">self-contained</a> <a id="3978" class="Symbol">:</a> <a id="3980" class="Symbol">∀</a> <a id="3982" class="Symbol">(</a><a id="3983" href="Peras.SmallStep.html#3983" class="Bound">t</a> <a id="3985" class="Symbol">:</a> <a id="3987" href="Peras.SmallStep.html#2898" class="Bound">T</a><a id="3988" class="Symbol">)</a>
        <a id="3998" class="Symbol">→</a> <a id="4000" href="Peras.SmallStep.html#3057" class="Bound">preferredChain</a> <a id="4015" href="Peras.SmallStep.html#3983" class="Bound">t</a> <a id="4017" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="4019" href="Peras.SmallStep.html#3008" class="Bound">allChains</a> <a id="4029" href="Peras.SmallStep.html#3983" class="Bound">t</a>

      <a id="4038" href="Peras.SmallStep.html#4038" class="Field">valid-votes</a> <a id="4050" class="Symbol">:</a> <a id="4052" class="Symbol">∀</a> <a id="4054" class="Symbol">(</a><a id="4055" href="Peras.SmallStep.html#4055" class="Bound">t</a> <a id="4057" class="Symbol">:</a> <a id="4059" href="Peras.SmallStep.html#2898" class="Bound">T</a><a id="4060" class="Symbol">)</a>
        <a id="4070" class="Symbol">→</a> <a id="4072" href="Data.List.Relation.Unary.All.html#1627" class="Datatype">All</a> <a id="4076" href="Peras.Chain.html#2648" class="Function">ValidVote</a> <a id="4086" class="Symbol">(</a><a id="4087" href="Peras.SmallStep.html#3151" class="Bound">votes</a> <a id="4093" href="Peras.SmallStep.html#4055" class="Bound">t</a><a id="4094" class="Symbol">)</a>

      <a id="4103" href="Peras.SmallStep.html#4103" class="Field">unique-votes</a> <a id="4116" class="Symbol">:</a> <a id="4118" class="Symbol">∀</a> <a id="4120" class="Symbol">(</a><a id="4121" href="Peras.SmallStep.html#4121" class="Bound">t</a> <a id="4123" class="Symbol">:</a> <a id="4125" href="Peras.SmallStep.html#2898" class="Bound">T</a><a id="4126" class="Symbol">)</a> <a id="4128" class="Symbol">(</a><a id="4129" href="Peras.SmallStep.html#4129" class="Bound">v</a> <a id="4131" class="Symbol">:</a> <a id="4133" href="Peras.Chain.html#1472" class="Record">Vote</a><a id="4137" class="Symbol">)</a>
        <a id="4147" class="Symbol">→</a> <a id="4149" class="Keyword">let</a> <a id="4153" href="Peras.SmallStep.html#4153" class="Bound">vs</a> <a id="4156" class="Symbol">=</a> <a id="4158" href="Peras.SmallStep.html#3151" class="Bound">votes</a> <a id="4164" href="Peras.SmallStep.html#4121" class="Bound">t</a>
          <a id="4176" class="Keyword">in</a>
          <a id="4189" href="Peras.SmallStep.html#4129" class="Bound">v</a> <a id="4191" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="4193" href="Peras.SmallStep.html#4153" class="Bound">vs</a>
        <a id="4204" class="Symbol">→</a> <a id="4206" href="Peras.SmallStep.html#4153" class="Bound">vs</a> <a id="4209" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="4211" href="Peras.SmallStep.html#3151" class="Bound">votes</a> <a id="4217" class="Symbol">(</a><a id="4218" href="Peras.SmallStep.html#3106" class="Bound">addVote</a> <a id="4226" href="Peras.SmallStep.html#4121" class="Bound">t</a> <a id="4228" href="Peras.SmallStep.html#4129" class="Bound">v</a><a id="4229" class="Symbol">)</a>

      <a id="4238" href="Peras.SmallStep.html#4238" class="Field">no-equivocations</a> <a id="4255" class="Symbol">:</a> <a id="4257" class="Symbol">∀</a> <a id="4259" class="Symbol">(</a><a id="4260" href="Peras.SmallStep.html#4260" class="Bound">t</a> <a id="4262" class="Symbol">:</a> <a id="4264" href="Peras.SmallStep.html#2898" class="Bound">T</a><a id="4265" class="Symbol">)</a> <a id="4267" class="Symbol">(</a><a id="4268" href="Peras.SmallStep.html#4268" class="Bound">v</a> <a id="4270" class="Symbol">:</a> <a id="4272" href="Peras.Chain.html#1472" class="Record">Vote</a><a id="4276" class="Symbol">)</a>
        <a id="4286" class="Symbol">→</a> <a id="4288" class="Keyword">let</a> <a id="4292" href="Peras.SmallStep.html#4292" class="Bound">vs</a> <a id="4295" class="Symbol">=</a> <a id="4297" href="Peras.SmallStep.html#3151" class="Bound">votes</a> <a id="4303" href="Peras.SmallStep.html#4260" class="Bound">t</a>
          <a id="4315" class="Keyword">in</a>
          <a id="4328" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="4332" class="Symbol">(</a><a id="4333" href="Peras.SmallStep.html#4268" class="Bound">v</a> <a id="4335" href="Peras.Chain.html#2931" class="Datatype Operator">∻_</a><a id="4337" class="Symbol">)</a> <a id="4339" href="Peras.SmallStep.html#4292" class="Bound">vs</a>
        <a id="4350" class="Symbol">→</a> <a id="4352" href="Peras.SmallStep.html#4292" class="Bound">vs</a> <a id="4355" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="4357" href="Peras.SmallStep.html#3151" class="Bound">votes</a> <a id="4363" class="Symbol">(</a><a id="4364" href="Peras.SmallStep.html#3106" class="Bound">addVote</a> <a id="4372" href="Peras.SmallStep.html#4260" class="Bound">t</a> <a id="4374" href="Peras.SmallStep.html#4268" class="Bound">v</a><a id="4375" class="Symbol">)</a>

      <a id="4384" href="Peras.SmallStep.html#4384" class="Field">quorum-cert</a> <a id="4396" class="Symbol">:</a> <a id="4398" class="Symbol">∀</a> <a id="4400" class="Symbol">(</a><a id="4401" href="Peras.SmallStep.html#4401" class="Bound">t</a> <a id="4403" class="Symbol">:</a> <a id="4405" href="Peras.SmallStep.html#2898" class="Bound">T</a><a id="4406" class="Symbol">)</a> <a id="4408" class="Symbol">(</a><a id="4409" href="Peras.SmallStep.html#4409" class="Bound">b</a> <a id="4411" class="Symbol">:</a> <a id="4413" href="Peras.Block.html#2807" class="Record">Block</a><a id="4418" class="Symbol">)</a> <a id="4420" class="Symbol">(</a><a id="4421" href="Peras.SmallStep.html#4421" class="Bound">r</a> <a id="4423" class="Symbol">:</a> <a id="4425" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="4426" class="Symbol">)</a>
        <a id="4436" class="Symbol">→</a> <a id="4438" href="Data.List.Base.html#5083" class="Function">length</a> <a id="4445" class="Symbol">(</a><a id="4446" href="Data.List.Base.html#10878" class="Function">filter</a> <a id="4453" class="Symbol">(λ</a> <a id="4456" class="Symbol">{</a><a id="4457" href="Peras.SmallStep.html#4457" class="Bound">v</a> <a id="4459" class="Symbol">→</a>
                    <a id="4481" class="Symbol">(</a><a id="4482" href="Peras.Numbering.html#1729" class="Field">getRoundNumber</a> <a id="4497" class="Symbol">(</a><a id="4498" href="Peras.Chain.html#1518" class="Field">votingRound</a> <a id="4510" href="Peras.SmallStep.html#4457" class="Bound">v</a><a id="4511" class="Symbol">)</a> <a id="4513" href="Data.Nat.Properties.html#3311" class="Function Operator">≟</a> <a id="4515" href="Peras.SmallStep.html#4421" class="Bound">r</a><a id="4516" class="Symbol">)</a>
              <a id="4532" href="Relation.Nullary.Decidable.Core.html#2609" class="Function Operator">×-dec</a> <a id="4538" class="Symbol">(</a><a id="4539" href="Peras.Chain.html#1620" class="Field">blockHash</a> <a id="4549" href="Peras.SmallStep.html#4457" class="Bound">v</a> <a id="4551" href="Peras.Block.html#3542" class="Function Operator">≟-BlockHash</a> <a id="4563" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="4568" href="Peras.SmallStep.html#4409" class="Bound">b</a><a id="4569" class="Symbol">)}</a>
            <a id="4584" class="Symbol">)</a> <a id="4586" class="Symbol">(</a><a id="4587" href="Peras.SmallStep.html#3151" class="Bound">votes</a> <a id="4593" href="Peras.SmallStep.html#4401" class="Bound">t</a><a id="4594" class="Symbol">))</a> <a id="4597" href="Data.Nat.Base.html#2259" class="Function Operator">≥</a> <a id="4599" href="Peras.Params.html#263" class="Field">τ</a>
        <a id="4609" class="Symbol">→</a> <a id="4611" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="4615" class="Symbol">(λ</a> <a id="4618" class="Symbol">{</a><a id="4619" href="Peras.SmallStep.html#4619" class="Bound">c</a> <a id="4621" class="Symbol">→</a>
            <a id="4635" class="Symbol">(</a><a id="4636" href="Peras.Numbering.html#1729" class="Field">getRoundNumber</a> <a id="4651" class="Symbol">(</a><a id="4652" href="Peras.Block.html#2948" class="Field">round</a> <a id="4658" href="Peras.SmallStep.html#4619" class="Bound">c</a><a id="4659" class="Symbol">)</a> <a id="4661" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="4663" href="Peras.SmallStep.html#4421" class="Bound">r</a><a id="4664" class="Symbol">)</a>
          <a id="4676" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4678" class="Symbol">(</a><a id="4679" href="Peras.Block.html#2976" class="Field">blockRef</a> <a id="4688" href="Peras.SmallStep.html#4619" class="Bound">c</a> <a id="4690" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="4692" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="4697" href="Peras.SmallStep.html#4409" class="Bound">b</a><a id="4698" class="Symbol">)</a> <a id="4700" class="Symbol">})</a> <a id="4703" class="Symbol">(</a><a id="4704" href="Peras.SmallStep.html#3195" class="Bound">certs</a> <a id="4710" href="Peras.SmallStep.html#4401" class="Bound">t</a><a id="4711" class="Symbol">)</a>
</pre>
In addition to chains the block-tree manages votes and certificates as
well. The block-tree type is defined as follows:
<pre class="Agda">  <a id="4847" class="Keyword">record</a> <a id="4854" href="Peras.SmallStep.html#4854" class="Record">TreeType</a> <a id="4863" class="Symbol">(</a><a id="4864" href="Peras.SmallStep.html#4864" class="Bound">T</a> <a id="4866" class="Symbol">:</a> <a id="4868" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="4872" class="Symbol">)</a> <a id="4874" class="Symbol">:</a> <a id="4876" href="Agda.Primitive.html#388" class="Primitive">Type₁</a> <a id="4882" class="Keyword">where</a>

    <a id="4893" class="Keyword">field</a>
      <a id="4905" href="Peras.SmallStep.html#4905" class="Field">tree₀</a> <a id="4911" class="Symbol">:</a> <a id="4913" href="Peras.SmallStep.html#4864" class="Bound">T</a>

      <a id="4922" href="Peras.SmallStep.html#4922" class="Field">addChain</a> <a id="4931" class="Symbol">:</a> <a id="4933" href="Peras.SmallStep.html#4864" class="Bound">T</a> <a id="4935" class="Symbol">→</a> <a id="4937" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="4943" class="Symbol">→</a> <a id="4945" href="Peras.SmallStep.html#4864" class="Bound">T</a>
      <a id="4953" href="Peras.SmallStep.html#4953" class="Field">chains</a> <a id="4960" class="Symbol">:</a> <a id="4962" href="Peras.SmallStep.html#4864" class="Bound">T</a> <a id="4964" class="Symbol">→</a> <a id="4966" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4971" href="Peras.Chain.html#3111" class="Function">Chain</a>
      <a id="4983" href="Peras.SmallStep.html#4983" class="Field">preferredChain</a> <a id="4998" class="Symbol">:</a> <a id="5000" href="Peras.SmallStep.html#4864" class="Bound">T</a> <a id="5002" class="Symbol">→</a> <a id="5004" href="Peras.Chain.html#3111" class="Function">Chain</a>

      <a id="5017" href="Peras.SmallStep.html#5017" class="Field">addVote</a> <a id="5025" class="Symbol">:</a> <a id="5027" href="Peras.SmallStep.html#4864" class="Bound">T</a> <a id="5029" class="Symbol">→</a> <a id="5031" href="Peras.Chain.html#1472" class="Record">Vote</a> <a id="5036" class="Symbol">→</a> <a id="5038" href="Peras.SmallStep.html#4864" class="Bound">T</a>
      <a id="5046" href="Peras.SmallStep.html#5046" class="Field">votes</a> <a id="5052" class="Symbol">:</a> <a id="5054" href="Peras.SmallStep.html#4864" class="Bound">T</a> <a id="5056" class="Symbol">→</a> <a id="5058" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5063" href="Peras.Chain.html#1472" class="Record">Vote</a>

      <a id="5075" href="Peras.SmallStep.html#5075" class="Field">certs</a> <a id="5081" class="Symbol">:</a> <a id="5083" href="Peras.SmallStep.html#4864" class="Bound">T</a> <a id="5085" class="Symbol">→</a> <a id="5087" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5092" href="Peras.Block.html#2849" class="Record">Certificate</a>

    <a id="5109" href="Peras.SmallStep.html#5109" class="Function">cert₀</a> <a id="5115" class="Symbol">:</a> <a id="5117" href="Peras.Block.html#2849" class="Record">Certificate</a>
    <a id="5133" href="Peras.SmallStep.html#5109" class="Function">cert₀</a> <a id="5139" class="Symbol">=</a> <a id="5141" href="Peras.Block.html#2926" class="InductiveConstructor">MkCertificate</a> <a id="5155" class="Symbol">(</a><a id="5156" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="5170" class="Number">0</a><a id="5171" class="Symbol">)</a> <a id="5173" class="Symbol">(</a><a id="5174" href="Peras.Crypto.html#1583" class="InductiveConstructor">MkHash</a> <a id="5181" href="Peras.Crypto.html#676" class="Postulate">emptyBS</a><a id="5188" class="Symbol">)</a>

    <a id="5195" class="Keyword">field</a>
      <a id="5207" href="Peras.SmallStep.html#5207" class="Field">is-TreeType</a> <a id="5219" class="Symbol">:</a> <a id="5221" href="Peras.SmallStep.html#2886" class="Record">IsTreeType</a>
                      <a id="5254" href="Peras.SmallStep.html#4905" class="Field">tree₀</a> <a id="5260" href="Peras.SmallStep.html#4922" class="Field">addChain</a> <a id="5269" href="Peras.SmallStep.html#4953" class="Field">chains</a> <a id="5276" href="Peras.SmallStep.html#4983" class="Field">preferredChain</a>
                      <a id="5313" href="Peras.SmallStep.html#5017" class="Field">addVote</a> <a id="5321" href="Peras.SmallStep.html#5046" class="Field">votes</a> <a id="5327" href="Peras.SmallStep.html#5075" class="Field">certs</a> <a id="5333" href="Peras.SmallStep.html#5109" class="Function">cert₀</a>

    <a id="5344" href="Peras.SmallStep.html#5344" class="Function">latestCertOnChain</a> <a id="5362" class="Symbol">:</a> <a id="5364" href="Peras.SmallStep.html#4864" class="Bound">T</a> <a id="5366" class="Symbol">→</a> <a id="5368" href="Peras.Block.html#2849" class="Record">Certificate</a>
    <a id="5384" href="Peras.SmallStep.html#5344" class="Function">latestCertOnChain</a> <a id="5402" class="Symbol">=</a>
      <a id="5410" href="Peras.Block.html#3080" class="Function">latestCert</a> <a id="5421" href="Peras.SmallStep.html#5109" class="Function">cert₀</a> <a id="5427" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="5429" href="Data.List.Base.html#1716" class="Function">L.mapMaybe</a> <a id="5440" href="Peras.Block.html#3326" class="Field">certificate</a> <a id="5452" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="5454" href="Peras.SmallStep.html#4983" class="Field">preferredChain</a>

    <a id="5474" href="Peras.SmallStep.html#5474" class="Function">latestCertSeen</a> <a id="5489" class="Symbol">:</a> <a id="5491" href="Peras.SmallStep.html#4864" class="Bound">T</a> <a id="5493" class="Symbol">→</a> <a id="5495" href="Peras.Block.html#2849" class="Record">Certificate</a>
    <a id="5511" href="Peras.SmallStep.html#5474" class="Function">latestCertSeen</a> <a id="5526" class="Symbol">=</a> <a id="5528" href="Peras.Block.html#3080" class="Function">latestCert</a> <a id="5539" href="Peras.SmallStep.html#5109" class="Function">cert₀</a> <a id="5545" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="5547" href="Peras.SmallStep.html#5075" class="Field">certs</a>

    <a id="5558" href="Peras.SmallStep.html#5558" class="Function">hasCert</a> <a id="5566" class="Symbol">:</a> <a id="5568" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="5580" class="Symbol">→</a> <a id="5582" href="Peras.SmallStep.html#4864" class="Bound">T</a> <a id="5584" class="Symbol">→</a> <a id="5586" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="5595" href="Peras.SmallStep.html#5558" class="Function">hasCert</a> <a id="5603" class="Symbol">(</a><a id="5604" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="5618" href="Peras.SmallStep.html#5618" class="Bound">r</a><a id="5619" class="Symbol">)</a> <a id="5621" class="Symbol">=</a> <a id="5623" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="5627" class="Symbol">((</a><a id="5629" href="Peras.SmallStep.html#5618" class="Bound">r</a> <a id="5631" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡_</a><a id="5633" class="Symbol">)</a> <a id="5635" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="5637" href="Peras.Block.html#3001" class="Function">roundNumber</a><a id="5648" class="Symbol">)</a> <a id="5650" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="5652" href="Peras.SmallStep.html#5075" class="Field">certs</a>

    <a id="5663" href="Peras.SmallStep.html#5663" class="Function">hasCert?</a> <a id="5672" class="Symbol">:</a> <a id="5674" class="Symbol">(</a><a id="5675" href="Peras.SmallStep.html#5675" class="Bound">r</a> <a id="5677" class="Symbol">:</a> <a id="5679" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a><a id="5690" class="Symbol">)</a> <a id="5692" class="Symbol">(</a><a id="5693" href="Peras.SmallStep.html#5693" class="Bound">t</a> <a id="5695" class="Symbol">:</a> <a id="5697" href="Peras.SmallStep.html#4864" class="Bound">T</a><a id="5698" class="Symbol">)</a> <a id="5700" class="Symbol">→</a> <a id="5702" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="5706" class="Symbol">(</a><a id="5707" href="Peras.SmallStep.html#5558" class="Function">hasCert</a> <a id="5715" href="Peras.SmallStep.html#5675" class="Bound">r</a> <a id="5717" href="Peras.SmallStep.html#5693" class="Bound">t</a><a id="5718" class="Symbol">)</a>
    <a id="5724" href="Peras.SmallStep.html#5663" class="Function">hasCert?</a> <a id="5733" class="Symbol">(</a><a id="5734" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="5748" href="Peras.SmallStep.html#5748" class="Bound">r</a><a id="5749" class="Symbol">)</a> <a id="5751" class="Symbol">=</a> <a id="5753" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a> <a id="5758" class="Symbol">((</a><a id="5760" href="Peras.SmallStep.html#5748" class="Bound">r</a> <a id="5762" href="Data.Nat.Properties.html#3311" class="Function Operator">≟_</a><a id="5764" class="Symbol">)</a> <a id="5766" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="5768" href="Peras.Block.html#3001" class="Function">roundNumber</a><a id="5779" class="Symbol">)</a> <a id="5781" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="5783" href="Peras.SmallStep.html#5075" class="Field">certs</a>

    <a id="5794" href="Peras.SmallStep.html#5794" class="Function">hasVote</a> <a id="5802" class="Symbol">:</a> <a id="5804" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="5816" class="Symbol">→</a> <a id="5818" href="Peras.SmallStep.html#4864" class="Bound">T</a> <a id="5820" class="Symbol">→</a> <a id="5822" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="5831" href="Peras.SmallStep.html#5794" class="Function">hasVote</a> <a id="5839" class="Symbol">(</a><a id="5840" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="5854" href="Peras.SmallStep.html#5854" class="Bound">r</a><a id="5855" class="Symbol">)</a> <a id="5857" class="Symbol">=</a> <a id="5859" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="5863" class="Symbol">((</a><a id="5865" href="Peras.SmallStep.html#5854" class="Bound">r</a> <a id="5867" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡_</a><a id="5869" class="Symbol">)</a> <a id="5871" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="5873" href="Peras.Chain.html#1680" class="Function">votingRound&#39;</a><a id="5885" class="Symbol">)</a> <a id="5887" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="5889" href="Peras.SmallStep.html#5046" class="Field">votes</a>

    <a id="5900" href="Peras.SmallStep.html#5900" class="Function">hasVote?</a> <a id="5909" class="Symbol">:</a> <a id="5911" class="Symbol">(</a><a id="5912" href="Peras.SmallStep.html#5912" class="Bound">r</a> <a id="5914" class="Symbol">:</a> <a id="5916" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a><a id="5927" class="Symbol">)</a> <a id="5929" class="Symbol">(</a><a id="5930" href="Peras.SmallStep.html#5930" class="Bound">t</a> <a id="5932" class="Symbol">:</a> <a id="5934" href="Peras.SmallStep.html#4864" class="Bound">T</a><a id="5935" class="Symbol">)</a> <a id="5937" class="Symbol">→</a> <a id="5939" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="5943" class="Symbol">(</a><a id="5944" href="Peras.SmallStep.html#5794" class="Function">hasVote</a> <a id="5952" href="Peras.SmallStep.html#5912" class="Bound">r</a> <a id="5954" href="Peras.SmallStep.html#5930" class="Bound">t</a><a id="5955" class="Symbol">)</a>
    <a id="5961" href="Peras.SmallStep.html#5900" class="Function">hasVote?</a> <a id="5970" class="Symbol">(</a><a id="5971" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="5985" href="Peras.SmallStep.html#5985" class="Bound">r</a><a id="5986" class="Symbol">)</a> <a id="5988" class="Symbol">=</a> <a id="5990" href="Data.List.Relation.Unary.Any.html#2694" class="Function">any?</a> <a id="5995" class="Symbol">((</a><a id="5997" href="Peras.SmallStep.html#5985" class="Bound">r</a> <a id="5999" href="Data.Nat.Properties.html#3311" class="Function Operator">≟_</a><a id="6001" class="Symbol">)</a> <a id="6003" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="6005" href="Peras.Chain.html#1680" class="Function">votingRound&#39;</a><a id="6017" class="Symbol">)</a> <a id="6019" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="6021" href="Peras.SmallStep.html#5046" class="Field">votes</a>

    <a id="6032" href="Peras.SmallStep.html#6032" class="Function">allBlocks</a> <a id="6042" class="Symbol">:</a> <a id="6044" href="Peras.SmallStep.html#4864" class="Bound">T</a> <a id="6046" class="Symbol">→</a> <a id="6048" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6053" href="Peras.Block.html#2807" class="Record">Block</a>
    <a id="6063" href="Peras.SmallStep.html#6032" class="Function">allBlocks</a> <a id="6073" class="Symbol">=</a> <a id="6075" href="Data.List.Base.html#4538" class="Function">concat</a> <a id="6082" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="6084" href="Peras.SmallStep.html#4953" class="Field">chains</a>
</pre>
<h3 id="additional-parameters">Additional parameters</h3>
<p>In order to define the semantics the following parameters are
required additionally:</p>
<ul>
<li>The type of the block-tree</li>
<li>adversarialState₀ is the initial adversarial state</li>
<li>Tx selection function per party and slot number</li>
<li>The list of parties</li>
</ul>
<pre class="Agda">  <a id="6381" class="Keyword">module</a> <a id="6388" href="Peras.SmallStep.html#6388" class="Module">Semantics</a>
           <a id="6409" class="Symbol">{</a><a id="6410" href="Peras.SmallStep.html#6410" class="Bound">T</a> <a id="6412" class="Symbol">:</a> <a id="6414" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="6418" class="Symbol">}</a> <a id="6420" class="Symbol">{</a><a id="6421" href="Peras.SmallStep.html#6421" class="Bound">blockTree</a> <a id="6431" class="Symbol">:</a> <a id="6433" href="Peras.SmallStep.html#4854" class="Record">TreeType</a> <a id="6442" href="Peras.SmallStep.html#6410" class="Bound">T</a><a id="6443" class="Symbol">}</a>
           <a id="6456" class="Symbol">{</a><a id="6457" href="Peras.SmallStep.html#6457" class="Bound">S</a> <a id="6459" class="Symbol">:</a> <a id="6461" href="Agda.Primitive.html#388" class="Primitive">Type</a><a id="6465" class="Symbol">}</a> <a id="6467" class="Symbol">{</a><a id="6468" href="Peras.SmallStep.html#6468" class="Bound">adversarialState₀</a> <a id="6486" class="Symbol">:</a> <a id="6488" href="Peras.SmallStep.html#6457" class="Bound">S</a><a id="6489" class="Symbol">}</a>
           <a id="6502" class="Symbol">{</a><a id="6503" href="Peras.SmallStep.html#6503" class="Bound">txSelection</a> <a id="6515" class="Symbol">:</a> <a id="6517" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="6528" class="Symbol">→</a> <a id="6530" href="Peras.Block.html#1264" class="Function">PartyId</a> <a id="6538" class="Symbol">→</a> <a id="6540" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6545" href="Peras.Block.html#2329" class="Function">Tx</a><a id="6547" class="Symbol">}</a>
           <a id="6560" class="Symbol">{</a><a id="6561" href="Peras.SmallStep.html#6561" class="Bound">parties</a> <a id="6569" class="Symbol">:</a> <a id="6571" href="Peras.Block.html#2033" class="Function">Parties</a><a id="6578" class="Symbol">}</a> <a id="6580" class="Comment">-- TODO: use parties from blockTrees</a>
                               <a id="6648" class="Comment">-- i.e. allow dynamic participation</a>
           <a id="6695" class="Keyword">where</a>

    <a id="6706" class="Keyword">open</a> <a id="6711" href="Peras.SmallStep.html#4854" class="Module">TreeType</a> <a id="6720" href="Peras.SmallStep.html#6421" class="Bound">blockTree</a>

    <a id="6735" class="Keyword">private</a>
      <a id="6749" class="Keyword">instance</a>
        <a id="6766" href="Peras.SmallStep.html#6766" class="Function">Default-T</a> <a id="6776" class="Symbol">:</a> <a id="6778" href="Prelude.Default.html#100" class="Record">Default</a> <a id="6786" href="Peras.SmallStep.html#6410" class="Bound">T</a>
        <a id="6796" href="Peras.SmallStep.html#6766" class="Function">Default-T</a> <a id="6806" class="Symbol">.</a><a id="6807" href="Prelude.Default.html#140" class="Field">def</a> <a id="6811" class="Symbol">=</a> <a id="6813" href="Peras.SmallStep.html#4905" class="Function">tree₀</a>
</pre>
<h4 id="block-tree-update">Block-tree update</h4>
<p>Updating the block-tree upon receiving a message for vote and block
messages.</p>
<pre class="Agda">    <a id="6938" class="Keyword">data</a> <a id="6943" href="Peras.SmallStep.html#6943" class="Datatype Operator">_[_]→_</a> <a id="6950" class="Symbol">:</a> <a id="6952" href="Peras.SmallStep.html#6410" class="Bound">T</a> <a id="6954" class="Symbol">→</a> <a id="6956" href="Peras.SmallStep.html#2195" class="Datatype">Message</a> <a id="6964" class="Symbol">→</a> <a id="6966" href="Peras.SmallStep.html#6410" class="Bound">T</a> <a id="6968" class="Symbol">→</a> <a id="6970" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="6975" class="Keyword">where</a>

      <a id="6988" href="Peras.SmallStep.html#6988" class="InductiveConstructor">VoteReceived</a> <a id="7001" class="Symbol">:</a> <a id="7003" class="Symbol">∀</a> <a id="7005" class="Symbol">{</a><a id="7006" href="Peras.SmallStep.html#7006" class="Bound">v</a> <a id="7008" href="Peras.SmallStep.html#7008" class="Bound">t</a><a id="7009" class="Symbol">}</a> <a id="7011" class="Symbol">→</a>
          <a id="7023" href="Prelude.InferenceRules.html#45702" class="Function Operator">────────────────────────────</a>
          <a id="7062" href="Peras.SmallStep.html#7008" class="Bound">t</a> <a id="7064" href="Peras.SmallStep.html#6943" class="Datatype Operator">[</a> <a id="7066" href="Peras.SmallStep.html#2251" class="InductiveConstructor">VoteMsg</a> <a id="7074" href="Peras.SmallStep.html#7006" class="Bound">v</a> <a id="7076" href="Peras.SmallStep.html#6943" class="Datatype Operator">]→</a> <a id="7079" href="Peras.SmallStep.html#5017" class="Function">addVote</a> <a id="7087" href="Peras.SmallStep.html#7008" class="Bound">t</a> <a id="7089" href="Peras.SmallStep.html#7006" class="Bound">v</a>

      <a id="7098" href="Peras.SmallStep.html#7098" class="InductiveConstructor">ChainReceived</a> <a id="7112" class="Symbol">:</a> <a id="7114" class="Symbol">∀</a> <a id="7116" class="Symbol">{</a><a id="7117" href="Peras.SmallStep.html#7117" class="Bound">c</a> <a id="7119" href="Peras.SmallStep.html#7119" class="Bound">t</a><a id="7120" class="Symbol">}</a> <a id="7122" class="Symbol">→</a>
          <a id="7134" href="Prelude.InferenceRules.html#45468" class="Function Operator">──────────────────────────────</a>
          <a id="7175" href="Peras.SmallStep.html#7119" class="Bound">t</a> <a id="7177" href="Peras.SmallStep.html#6943" class="Datatype Operator">[</a> <a id="7179" href="Peras.SmallStep.html#2220" class="InductiveConstructor">ChainMsg</a> <a id="7188" href="Peras.SmallStep.html#7117" class="Bound">c</a> <a id="7190" href="Peras.SmallStep.html#6943" class="Datatype Operator">]→</a> <a id="7193" href="Peras.SmallStep.html#4922" class="Function">addChain</a> <a id="7202" href="Peras.SmallStep.html#7119" class="Bound">t</a> <a id="7204" href="Peras.SmallStep.html#7117" class="Bound">c</a>
</pre>
<h4 id="vote-in-round">Vote in round</h4>
<p>When does a party vote in a round? The protocol expects regular
voting, i.e. if in the previous round a quorum has been achieved or that
voting resumes after a cool-down phase.</p>
<h4 id="blockselection">BlockSelection</h4>
<pre class="Agda">    <a id="7440" href="Peras.SmallStep.html#7440" class="Function">BlockSelection&#39;</a> <a id="7456" class="Symbol">:</a> <a id="7458" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="7469" class="Symbol">→</a> <a id="7471" href="Peras.Chain.html#3111" class="Function">Chain</a> <a id="7477" class="Symbol">→</a> <a id="7479" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="7484" href="Peras.Block.html#2807" class="Record">Block</a>
    <a id="7494" href="Peras.SmallStep.html#7440" class="Function">BlockSelection&#39;</a> <a id="7510" class="Symbol">(</a><a id="7511" href="Peras.Numbering.html#779" class="InductiveConstructor">MkSlotNumber</a> <a id="7524" href="Peras.SmallStep.html#7524" class="Bound">s</a><a id="7525" class="Symbol">)</a> <a id="7527" class="Symbol">=</a>
      <a id="7535" href="Peras.Block.html#5471" class="Function">tipHash</a> <a id="7543" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="7545" href="Data.List.Base.html#10878" class="Function">filter</a> <a id="7552" class="Symbol">(λ</a> <a id="7555" class="Symbol">{</a><a id="7556" href="Peras.SmallStep.html#7556" class="Bound">b</a> <a id="7558" class="Symbol">→</a> <a id="7560" class="Symbol">(</a><a id="7561" href="Peras.Block.html#3465" class="Function">slotNumber&#39;</a> <a id="7573" href="Peras.SmallStep.html#7556" class="Bound">b</a><a id="7574" class="Symbol">)</a> <a id="7576" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="7578" href="Peras.Params.html#235" class="Field">L</a> <a id="7580" href="Data.Nat.Properties.html#6146" class="Function Operator">≤?</a> <a id="7583" href="Peras.SmallStep.html#7524" class="Bound">s</a><a id="7584" class="Symbol">})</a>

    <a id="7592" href="Peras.SmallStep.html#7592" class="Function">BlockSelection</a> <a id="7607" class="Symbol">:</a> <a id="7609" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="7620" class="Symbol">→</a> <a id="7622" href="Peras.SmallStep.html#6410" class="Bound">T</a> <a id="7624" class="Symbol">→</a> <a id="7626" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="7631" href="Peras.Block.html#2807" class="Record">Block</a>
    <a id="7641" href="Peras.SmallStep.html#7592" class="Function">BlockSelection</a> <a id="7656" href="Peras.SmallStep.html#7656" class="Bound">s</a> <a id="7658" class="Symbol">=</a> <a id="7660" href="Peras.SmallStep.html#7440" class="Function">BlockSelection&#39;</a> <a id="7676" href="Peras.SmallStep.html#7656" class="Bound">s</a> <a id="7678" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="7680" href="Peras.SmallStep.html#4983" class="Function">preferredChain</a>
</pre>
<h4 id="voting-rules">Voting rules</h4>
VR-1A: A party has seen a certificate cert-r−1 for round r−1
<pre class="Agda">    <a id="7791" href="Peras.SmallStep.html#7791" class="Function">VotingRule-1A</a> <a id="7805" class="Symbol">:</a> <a id="7807" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="7819" class="Symbol">→</a> <a id="7821" href="Peras.SmallStep.html#6410" class="Bound">T</a> <a id="7823" class="Symbol">→</a> <a id="7825" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="7834" href="Peras.SmallStep.html#7791" class="Function">VotingRule-1A</a> <a id="7848" class="Symbol">(</a><a id="7849" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="7863" href="Peras.SmallStep.html#7863" class="Bound">r</a><a id="7864" class="Symbol">)</a> <a id="7866" href="Peras.SmallStep.html#7866" class="Bound">t</a> <a id="7868" class="Symbol">=</a> <a id="7870" href="Peras.SmallStep.html#7863" class="Bound">r</a> <a id="7872" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7874" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="7878" class="Symbol">(</a><a id="7879" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="7891" class="Symbol">(</a><a id="7892" href="Peras.SmallStep.html#5474" class="Function">latestCertSeen</a> <a id="7907" href="Peras.SmallStep.html#7866" class="Bound">t</a><a id="7908" class="Symbol">))</a>
</pre>
VR-1B: The extends the block certified by cert-r−1,
<pre class="Agda">    <a id="7980" href="Peras.SmallStep.html#7980" class="Function">VotingRule-1B</a> <a id="7994" class="Symbol">:</a> <a id="7996" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="8007" class="Symbol">→</a> <a id="8009" href="Peras.SmallStep.html#6410" class="Bound">T</a> <a id="8011" class="Symbol">→</a> <a id="8013" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="8022" href="Peras.SmallStep.html#7980" class="Function">VotingRule-1B</a> <a id="8036" href="Peras.SmallStep.html#8036" class="Bound">s</a> <a id="8038" href="Peras.SmallStep.html#8038" class="Bound">t</a> <a id="8040" class="Symbol">=</a> <a id="8042" href="Peras.Chain.html#4442" class="Function">Extends</a> <a id="8050" class="Symbol">(</a><a id="8051" href="Peras.SmallStep.html#7592" class="Function">BlockSelection</a> <a id="8066" href="Peras.SmallStep.html#8036" class="Bound">s</a> <a id="8068" href="Peras.SmallStep.html#8038" class="Bound">t</a><a id="8069" class="Symbol">)</a> <a id="8071" class="Symbol">(</a><a id="8072" href="Peras.SmallStep.html#5474" class="Function">latestCertSeen</a> <a id="8087" href="Peras.SmallStep.html#8038" class="Bound">t</a><a id="8088" class="Symbol">)</a> <a id="8090" class="Symbol">(</a><a id="8091" href="Peras.SmallStep.html#4953" class="Function">chains</a> <a id="8098" href="Peras.SmallStep.html#8038" class="Bound">t</a><a id="8099" class="Symbol">)</a>
</pre>
VR-1: Both VR-1A and VR-1B hold
<pre class="Agda">    <a id="8149" href="Peras.SmallStep.html#8149" class="Function">VotingRule-1</a> <a id="8162" class="Symbol">:</a> <a id="8164" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="8175" class="Symbol">→</a> <a id="8177" href="Peras.SmallStep.html#6410" class="Bound">T</a> <a id="8179" class="Symbol">→</a> <a id="8181" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="8190" href="Peras.SmallStep.html#8149" class="Function">VotingRule-1</a> <a id="8203" href="Peras.SmallStep.html#8203" class="Bound">s</a> <a id="8205" href="Peras.SmallStep.html#8205" class="Bound">t</a> <a id="8207" class="Symbol">=</a>
        <a id="8217" href="Peras.SmallStep.html#7791" class="Function">VotingRule-1A</a> <a id="8231" class="Symbol">(</a><a id="8232" href="Peras.Chain.html#5472" class="Function">v-round</a> <a id="8240" href="Peras.SmallStep.html#8203" class="Bound">s</a><a id="8241" class="Symbol">)</a> <a id="8243" href="Peras.SmallStep.html#8205" class="Bound">t</a>
      <a id="8251" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="8253" href="Peras.SmallStep.html#7980" class="Function">VotingRule-1B</a> <a id="8267" href="Peras.SmallStep.html#8203" class="Bound">s</a> <a id="8269" href="Peras.SmallStep.html#8205" class="Bound">t</a>
</pre>
VR-2A: The last certificate a party has seen is from a round at least R
rounds back
<pre class="Agda">    <a id="8371" href="Peras.SmallStep.html#8371" class="Function">VotingRule-2A</a> <a id="8385" class="Symbol">:</a> <a id="8387" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="8399" class="Symbol">→</a> <a id="8401" href="Peras.SmallStep.html#6410" class="Bound">T</a> <a id="8403" class="Symbol">→</a> <a id="8405" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="8414" href="Peras.SmallStep.html#8371" class="Function">VotingRule-2A</a> <a id="8428" class="Symbol">(</a><a id="8429" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="8443" href="Peras.SmallStep.html#8443" class="Bound">r</a><a id="8444" class="Symbol">)</a> <a id="8446" href="Peras.SmallStep.html#8446" class="Bound">t</a> <a id="8448" class="Symbol">=</a> <a id="8450" href="Peras.SmallStep.html#8443" class="Bound">r</a> <a id="8452" href="Data.Nat.Base.html#2259" class="Function Operator">≥</a> <a id="8454" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="8466" class="Symbol">(</a><a id="8467" href="Peras.SmallStep.html#5474" class="Function">latestCertSeen</a> <a id="8482" href="Peras.SmallStep.html#8446" class="Bound">t</a><a id="8483" class="Symbol">)</a> <a id="8485" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="8487" href="Peras.Params.html#221" class="Field">R</a>
</pre>
VR-2B: The last certificate included in a party’s current chain is from
a round exactly c⋆K rounds ago for some c : ℕ, c ≥ 0 <!--
<pre class="Agda">    <a id="8635" href="Peras.SmallStep.html#8635" class="Function Operator">_mod_</a> <a id="8641" class="Symbol">:</a> <a id="8643" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="8645" class="Symbol">→</a> <a id="8647" class="Symbol">(</a><a id="8648" href="Peras.SmallStep.html#8648" class="Bound">n</a> <a id="8650" class="Symbol">:</a> <a id="8652" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="8653" class="Symbol">)</a> <a id="8655" class="Symbol">→</a> <a id="8657" class="Symbol">⦃</a> <a id="8659" href="Data.Nat.Base.html#3260" class="Record">NonZero</a> <a id="8667" href="Peras.SmallStep.html#8648" class="Bound">n</a> <a id="8669" class="Symbol">⦄</a> <a id="8671" class="Symbol">→</a> <a id="8673" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
    <a id="8679" href="Peras.SmallStep.html#8635" class="Function Operator">_mod_</a> <a id="8685" href="Peras.SmallStep.html#8685" class="Bound">a</a> <a id="8687" href="Peras.SmallStep.html#8687" class="Bound">b</a> <a id="8689" class="Symbol">⦃</a> <a id="8691" href="Peras.SmallStep.html#8691" class="Bound">prf</a> <a id="8695" class="Symbol">⦄</a> <a id="8697" class="Symbol">=</a> <a id="8699" href="Data.Nat.Base.html#7279" class="Function Operator">_%_</a> <a id="8703" href="Peras.SmallStep.html#8685" class="Bound">a</a> <a id="8705" href="Peras.SmallStep.html#8687" class="Bound">b</a> <a id="8707" class="Symbol">⦃</a> <a id="8709" href="Peras.SmallStep.html#8691" class="Bound">prf</a> <a id="8713" class="Symbol">⦄</a>
</pre>-->
<pre class="Agda">    <a id="8735" href="Peras.SmallStep.html#8735" class="Function">VotingRule-2B</a> <a id="8749" class="Symbol">:</a> <a id="8751" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="8763" class="Symbol">→</a> <a id="8765" href="Peras.SmallStep.html#6410" class="Bound">T</a> <a id="8767" class="Symbol">→</a> <a id="8769" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="8778" href="Peras.SmallStep.html#8735" class="Function">VotingRule-2B</a> <a id="8792" class="Symbol">(</a><a id="8793" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="8807" href="Peras.SmallStep.html#8807" class="Bound">r</a><a id="8808" class="Symbol">)</a> <a id="8810" href="Peras.SmallStep.html#8810" class="Bound">t</a> <a id="8812" class="Symbol">=</a>
        <a id="8822" href="Peras.SmallStep.html#8807" class="Bound">r</a> <a id="8824" href="Data.Nat.Base.html#2289" class="Function Operator">&gt;</a> <a id="8826" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="8838" class="Symbol">(</a><a id="8839" href="Peras.SmallStep.html#5344" class="Function">latestCertOnChain</a> <a id="8857" href="Peras.SmallStep.html#8810" class="Bound">t</a><a id="8858" class="Symbol">)</a>
      <a id="8866" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="8868" href="Peras.SmallStep.html#8807" class="Bound">r</a> <a id="8870" href="Peras.SmallStep.html#8635" class="Function Operator">mod</a> <a id="8874" href="Peras.Params.html#207" class="Field">K</a> <a id="8876" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="8878" class="Symbol">(</a><a id="8879" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="8891" class="Symbol">(</a><a id="8892" href="Peras.SmallStep.html#5344" class="Function">latestCertOnChain</a> <a id="8910" href="Peras.SmallStep.html#8810" class="Bound">t</a><a id="8911" class="Symbol">))</a> <a id="8914" href="Peras.SmallStep.html#8635" class="Function Operator">mod</a> <a id="8918" href="Peras.Params.html#207" class="Field">K</a>
</pre>
VR-2: Both VR-2A and VR-2B hold
<pre class="Agda">    <a id="8968" href="Peras.SmallStep.html#8968" class="Function">VotingRule-2</a> <a id="8981" class="Symbol">:</a> <a id="8983" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="8995" class="Symbol">→</a> <a id="8997" href="Peras.SmallStep.html#6410" class="Bound">T</a> <a id="8999" class="Symbol">→</a> <a id="9001" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="9010" href="Peras.SmallStep.html#8968" class="Function">VotingRule-2</a> <a id="9023" href="Peras.SmallStep.html#9023" class="Bound">r</a> <a id="9025" href="Peras.SmallStep.html#9025" class="Bound">t</a> <a id="9027" class="Symbol">=</a>
        <a id="9037" href="Peras.SmallStep.html#8371" class="Function">VotingRule-2A</a> <a id="9051" href="Peras.SmallStep.html#9023" class="Bound">r</a> <a id="9053" href="Peras.SmallStep.html#9025" class="Bound">t</a>
      <a id="9061" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="9063" href="Peras.SmallStep.html#8735" class="Function">VotingRule-2B</a> <a id="9077" href="Peras.SmallStep.html#9023" class="Bound">r</a> <a id="9079" href="Peras.SmallStep.html#9025" class="Bound">t</a>
</pre>
If either VR-1A and VR-1B or VR-2A and VR-2B hold, voting is expected
<pre class="Agda">    <a id="9167" href="Peras.SmallStep.html#9167" class="Function">VotingRule</a> <a id="9178" class="Symbol">:</a> <a id="9180" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="9191" class="Symbol">→</a> <a id="9193" href="Peras.SmallStep.html#6410" class="Bound">T</a> <a id="9195" class="Symbol">→</a> <a id="9197" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="9206" href="Peras.SmallStep.html#9167" class="Function">VotingRule</a> <a id="9217" href="Peras.SmallStep.html#9217" class="Bound">s</a> <a id="9219" href="Peras.SmallStep.html#9219" class="Bound">t</a> <a id="9221" class="Symbol">=</a>
        <a id="9231" href="Peras.SmallStep.html#8149" class="Function">VotingRule-1</a> <a id="9244" href="Peras.SmallStep.html#9217" class="Bound">s</a> <a id="9246" href="Peras.SmallStep.html#9219" class="Bound">t</a>
      <a id="9254" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="9256" href="Peras.SmallStep.html#8968" class="Function">VotingRule-2</a> <a id="9269" class="Symbol">(</a><a id="9270" href="Peras.Chain.html#5472" class="Function">v-round</a> <a id="9278" href="Peras.SmallStep.html#9217" class="Bound">s</a><a id="9279" class="Symbol">)</a> <a id="9281" href="Peras.SmallStep.html#9219" class="Bound">t</a>
</pre>
<h3 id="state">State</h3>
<p>The small-step semantics rely on a global state, which consists of
the following fields:</p>
<ul>
<li>Current slot of the system</li>
<li>Map with local state per party</li>
<li>All the messages that have been sent but not yet been delivered</li>
<li>All the messages that have been sent</li>
<li>Adversarial state</li>
</ul>
<pre class="Agda">    <a id="9588" class="Keyword">record</a> <a id="9595" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="9601" class="Symbol">:</a> <a id="9603" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="9608" class="Keyword">where</a>
      <a id="9620" class="Keyword">constructor</a> <a id="9632" href="Peras.SmallStep.html#9632" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧</a>
      <a id="9650" class="Keyword">field</a>
        <a id="9664" href="Peras.SmallStep.html#9664" class="Field">clock</a> <a id="9670" class="Symbol">:</a> <a id="9672" href="Peras.Numbering.html#742" class="Record">SlotNumber</a>
        <a id="9691" href="Peras.SmallStep.html#9691" class="Field">blockTrees</a> <a id="9702" class="Symbol">:</a> <a id="9704" href="Prelude.AssocList.html#211" class="Function">AssocList</a> <a id="9714" href="Peras.Block.html#1264" class="Function">PartyId</a> <a id="9722" href="Peras.SmallStep.html#6410" class="Bound">T</a>
        <a id="9732" href="Peras.SmallStep.html#9732" class="Field">messages</a> <a id="9741" class="Symbol">:</a> <a id="9743" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="9748" href="Peras.SmallStep.html#2547" class="Record">Envelope</a>
        <a id="9765" href="Peras.SmallStep.html#9765" class="Field">history</a> <a id="9773" class="Symbol">:</a> <a id="9775" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="9780" href="Peras.SmallStep.html#2195" class="Datatype">Message</a>
        <a id="9796" href="Peras.SmallStep.html#9796" class="Field">adversarialState</a> <a id="9813" class="Symbol">:</a> <a id="9815" href="Peras.SmallStep.html#6457" class="Bound">S</a>

      <a id="9824" href="Peras.SmallStep.html#9824" class="Function">blockTrees&#39;</a> <a id="9836" class="Symbol">:</a> <a id="9838" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="9843" href="Peras.SmallStep.html#6410" class="Bound">T</a>
      <a id="9851" href="Peras.SmallStep.html#9824" class="Function">blockTrees&#39;</a> <a id="9863" class="Symbol">=</a> <a id="9865" href="Data.List.Base.html#1631" class="Function">map</a> <a id="9869" href="Data.Product.Base.html#650" class="Field">proj₂</a> <a id="9875" href="Peras.SmallStep.html#9691" class="Field">blockTrees</a>

      <a id="9893" href="Peras.SmallStep.html#9893" class="Function">v-rnd</a> <a id="9899" class="Symbol">:</a> <a id="9901" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a>
      <a id="9919" href="Peras.SmallStep.html#9893" class="Function">v-rnd</a> <a id="9925" class="Symbol">=</a> <a id="9927" href="Peras.Chain.html#5472" class="Function">v-round</a> <a id="9935" href="Peras.SmallStep.html#9664" class="Field">clock</a>

      <a id="9948" href="Peras.SmallStep.html#9948" class="Function">v-rnd&#39;</a> <a id="9955" class="Symbol">:</a> <a id="9957" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
      <a id="9965" href="Peras.SmallStep.html#9948" class="Function">v-rnd&#39;</a> <a id="9972" class="Symbol">=</a> <a id="9974" href="Peras.Numbering.html#1729" class="Field">getRoundNumber</a> <a id="9989" href="Peras.SmallStep.html#9893" class="Function">v-rnd</a>
</pre>
<h4 id="progress">Progress</h4>
Rather than keeping track of progress, we introduce a predicate stating
that all messages that are not delayed have been delivered. This is a
precondition that must hold before transitioning to the next slot.
<pre class="Agda">    <a id="10235" href="Peras.SmallStep.html#10235" class="Function">Fetched</a> <a id="10243" class="Symbol">:</a> <a id="10245" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="10251" class="Symbol">→</a> <a id="10253" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="10262" href="Peras.SmallStep.html#10235" class="Function">Fetched</a> <a id="10270" class="Symbol">=</a> <a id="10272" href="Data.List.Relation.Unary.All.html#1627" class="Datatype">All</a> <a id="10276" class="Symbol">(λ</a> <a id="10279" class="Symbol">{</a> <a id="10281" href="Peras.SmallStep.html#10281" class="Bound">z</a> <a id="10283" class="Symbol">→</a> <a id="10285" href="Peras.SmallStep.html#2691" class="Field">delay</a> <a id="10291" href="Peras.SmallStep.html#10281" class="Bound">z</a> <a id="10293" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="10295" href="Peras.SmallStep.html#2372" class="InductiveConstructor">𝟘</a> <a id="10297" class="Symbol">})</a> <a id="10300" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="10302" href="Peras.SmallStep.html#9732" class="Field">messages</a>
      <a id="10317" class="Keyword">where</a> <a id="10323" class="Keyword">open</a> <a id="10328" href="Peras.SmallStep.html#9595" class="Module">State</a>
</pre>
Predicate for a global state stating that the current slot is the last
slot of a voting round.
<pre class="Agda">    <a id="10445" href="Peras.SmallStep.html#10445" class="Function">LastSlotInRound</a> <a id="10461" class="Symbol">:</a> <a id="10463" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="10469" class="Symbol">→</a> <a id="10471" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="10480" href="Peras.SmallStep.html#10445" class="Function">LastSlotInRound</a> <a id="10496" href="Peras.SmallStep.html#10496" class="Bound">M</a> <a id="10498" class="Symbol">=</a>
      <a id="10506" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="10510" class="Symbol">(</a><a id="10511" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="10515" class="Symbol">(</a><a id="10516" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="10530" href="Peras.SmallStep.html#9664" class="Field">clock</a><a id="10535" class="Symbol">))</a> <a id="10538" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="10540" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="10544" class="Symbol">(</a><a id="10545" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="10549" class="Symbol">(</a><a id="10550" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="10564" href="Peras.SmallStep.html#9664" class="Field">clock</a><a id="10569" class="Symbol">))</a>
      <a id="10578" class="Keyword">where</a> <a id="10584" class="Keyword">open</a> <a id="10589" href="Peras.SmallStep.html#9595" class="Module">State</a> <a id="10595" href="Peras.SmallStep.html#10496" class="Bound">M</a>
</pre>
<pre class="Agda">    <a id="10613" href="Peras.SmallStep.html#10613" class="Function">LastSlotInRound?</a> <a id="10630" class="Symbol">:</a> <a id="10632" class="Symbol">(</a><a id="10633" href="Peras.SmallStep.html#10633" class="Bound">s</a> <a id="10635" class="Symbol">:</a> <a id="10637" href="Peras.SmallStep.html#9595" class="Record">State</a><a id="10642" class="Symbol">)</a> <a id="10644" class="Symbol">→</a> <a id="10646" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="10650" class="Symbol">(</a><a id="10651" href="Peras.SmallStep.html#10445" class="Function">LastSlotInRound</a> <a id="10667" href="Peras.SmallStep.html#10633" class="Bound">s</a><a id="10668" class="Symbol">)</a>
    <a id="10674" href="Peras.SmallStep.html#10613" class="Function">LastSlotInRound?</a> <a id="10691" href="Peras.SmallStep.html#10691" class="Bound">M</a> <a id="10693" class="Symbol">=</a>
      <a id="10701" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="10705" class="Symbol">(</a><a id="10706" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="10710" class="Symbol">(</a><a id="10711" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="10725" href="Peras.SmallStep.html#9664" class="Field">clock</a><a id="10730" class="Symbol">))</a> <a id="10733" href="Data.Nat.Properties.html#3311" class="Function Operator">≟</a> <a id="10735" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="10739" class="Symbol">(</a><a id="10740" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="10744" class="Symbol">(</a><a id="10745" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="10759" href="Peras.SmallStep.html#9664" class="Field">clock</a><a id="10764" class="Symbol">))</a>
      <a id="10773" class="Keyword">where</a> <a id="10779" class="Keyword">open</a> <a id="10784" href="Peras.SmallStep.html#9595" class="Module">State</a> <a id="10790" href="Peras.SmallStep.html#10691" class="Bound">M</a>
</pre>
Predicate for a global state stating that the next slot will be in a new
voting round.
<pre class="Agda">    <a id="10895" href="Peras.SmallStep.html#10895" class="Function">NextSlotInSameRound</a> <a id="10915" class="Symbol">:</a> <a id="10917" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="10923" class="Symbol">→</a> <a id="10925" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="10934" href="Peras.SmallStep.html#10895" class="Function">NextSlotInSameRound</a> <a id="10954" href="Peras.SmallStep.html#10954" class="Bound">M</a> <a id="10956" class="Symbol">=</a>
      <a id="10964" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="10968" class="Symbol">(</a><a id="10969" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="10983" href="Peras.SmallStep.html#9664" class="Field">clock</a><a id="10988" class="Symbol">)</a> <a id="10990" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="10992" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="10996" class="Symbol">(</a><a id="10997" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="11001" class="Symbol">(</a><a id="11002" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="11016" href="Peras.SmallStep.html#9664" class="Field">clock</a><a id="11021" class="Symbol">))</a>
      <a id="11030" class="Keyword">where</a> <a id="11036" class="Keyword">open</a> <a id="11041" href="Peras.SmallStep.html#9595" class="Module">State</a> <a id="11047" href="Peras.SmallStep.html#10954" class="Bound">M</a>
</pre>
<pre class="Agda">    <a id="11065" href="Peras.SmallStep.html#11065" class="Function">NextSlotInSameRound?</a> <a id="11086" class="Symbol">:</a> <a id="11088" class="Symbol">(</a><a id="11089" href="Peras.SmallStep.html#11089" class="Bound">s</a> <a id="11091" class="Symbol">:</a> <a id="11093" href="Peras.SmallStep.html#9595" class="Record">State</a><a id="11098" class="Symbol">)</a> <a id="11100" class="Symbol">→</a> <a id="11102" href="Relation.Nullary.Decidable.Core.html#1485" class="Record">Dec</a> <a id="11106" class="Symbol">(</a><a id="11107" href="Peras.SmallStep.html#10895" class="Function">NextSlotInSameRound</a> <a id="11127" href="Peras.SmallStep.html#11089" class="Bound">s</a><a id="11128" class="Symbol">)</a>
    <a id="11134" href="Peras.SmallStep.html#11065" class="Function">NextSlotInSameRound?</a> <a id="11155" href="Peras.SmallStep.html#11155" class="Bound">M</a> <a id="11157" class="Symbol">=</a>
      <a id="11165" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="11169" class="Symbol">(</a><a id="11170" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="11184" href="Peras.SmallStep.html#9664" class="Field">clock</a><a id="11189" class="Symbol">)</a> <a id="11191" href="Data.Nat.Properties.html#3311" class="Function Operator">≟</a> <a id="11193" href="Peras.Chain.html#5410" class="Function">rnd</a> <a id="11197" class="Symbol">(</a><a id="11198" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="11202" class="Symbol">(</a><a id="11203" href="Peras.Numbering.html#800" class="Field">getSlotNumber</a> <a id="11217" href="Peras.SmallStep.html#9664" class="Field">clock</a><a id="11222" class="Symbol">))</a>
      <a id="11231" class="Keyword">where</a> <a id="11237" class="Keyword">open</a> <a id="11242" href="Peras.SmallStep.html#9595" class="Module">State</a> <a id="11248" href="Peras.SmallStep.html#11155" class="Bound">M</a>
</pre>
<p>Predicate for a global state asserting that parties of the voting
committee for a the current voting round have voted. This is needed as a
condition when transitioning from one voting round to another.</p>
<strong>TODO</strong>: Properly define the condition for required votes
<pre class="Agda">    <a id="11528" href="Peras.SmallStep.html#11528" class="Function">RequiredVotes</a> <a id="11542" class="Symbol">:</a> <a id="11544" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="11550" class="Symbol">→</a> <a id="11552" href="Agda.Primitive.html#388" class="Primitive">Type</a>
    <a id="11561" href="Peras.SmallStep.html#11528" class="Function">RequiredVotes</a> <a id="11575" href="Peras.SmallStep.html#11575" class="Bound">M</a> <a id="11577" class="Symbol">=</a>
         <a id="11588" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="11592" class="Symbol">(</a><a id="11593" href="Peras.SmallStep.html#9167" class="Function">VotingRule</a> <a id="11604" href="Peras.SmallStep.html#9664" class="Field">clock</a> <a id="11610" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="11612" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="11617" class="Symbol">)</a> <a id="11619" href="Peras.SmallStep.html#9691" class="Field">blockTrees</a>
       <a id="11637" class="Symbol">→</a> <a id="11639" href="Data.List.Relation.Unary.Any.html#1163" class="Datatype">Any</a> <a id="11643" class="Symbol">(</a><a id="11644" href="Peras.SmallStep.html#5794" class="Function">hasVote</a> <a id="11652" class="Symbol">(</a><a id="11653" href="Peras.Chain.html#5472" class="Function">v-round</a> <a id="11661" href="Peras.SmallStep.html#9664" class="Field">clock</a><a id="11666" class="Symbol">)</a> <a id="11668" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="11670" href="Data.Product.Base.html#650" class="Field">proj₂</a><a id="11675" class="Symbol">)</a> <a id="11677" href="Peras.SmallStep.html#9691" class="Field">blockTrees</a>
      <a id="11694" class="Keyword">where</a> <a id="11700" class="Keyword">open</a> <a id="11705" href="Peras.SmallStep.html#9595" class="Module">State</a> <a id="11711" href="Peras.SmallStep.html#11575" class="Bound">M</a>
</pre>
Ticking the global clock increments the slot number and decrements the
delay of all the messages in the message buffer.
<pre class="Agda">    <a id="11849" href="Peras.SmallStep.html#11849" class="Function">tick</a> <a id="11854" class="Symbol">:</a> <a id="11856" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="11862" class="Symbol">→</a> <a id="11864" href="Peras.SmallStep.html#9595" class="Record">State</a>
    <a id="11874" href="Peras.SmallStep.html#11849" class="Function">tick</a> <a id="11879" href="Peras.SmallStep.html#11879" class="Bound">M</a> <a id="11881" class="Symbol">=</a>
      <a id="11889" class="Keyword">record</a> <a id="11896" href="Peras.SmallStep.html#11879" class="Bound">M</a>
        <a id="11906" class="Symbol">{</a> <a id="11908" href="Peras.SmallStep.html#9664" class="Field">clock</a> <a id="11914" class="Symbol">=</a> <a id="11916" href="Peras.Numbering.html#821" class="Function">next</a> <a id="11921" href="Peras.SmallStep.html#9664" class="Field">clock</a>
        <a id="11935" class="Symbol">;</a> <a id="11937" href="Peras.SmallStep.html#9732" class="Field">messages</a> <a id="11946" class="Symbol">=</a>
            <a id="11960" href="Data.List.Base.html#1631" class="Function">map</a> <a id="11964" class="Symbol">(λ</a> <a id="11967" class="Keyword">where</a> <a id="11973" href="Peras.SmallStep.html#11973" class="Bound">e</a> <a id="11975" class="Symbol">→</a> <a id="11977" class="Keyword">record</a> <a id="11984" href="Peras.SmallStep.html#11973" class="Bound">e</a> <a id="11986" class="Symbol">{</a> <a id="11988" href="Peras.SmallStep.html#2691" class="Field">delay</a> <a id="11994" class="Symbol">=</a> <a id="11996" href="Data.Fin.Base.html#6461" class="Function">pred</a> <a id="12001" class="Symbol">(</a><a id="12002" href="Peras.SmallStep.html#2691" class="Field">delay</a> <a id="12008" href="Peras.SmallStep.html#11973" class="Bound">e</a><a id="12009" class="Symbol">)</a> <a id="12011" class="Symbol">})</a>
              <a id="12028" href="Peras.SmallStep.html#9732" class="Field">messages</a>
        <a id="12045" class="Symbol">}</a>
      <a id="12053" class="Keyword">where</a> <a id="12059" class="Keyword">open</a> <a id="12064" href="Peras.SmallStep.html#9595" class="Module">State</a> <a id="12070" href="Peras.SmallStep.html#11879" class="Bound">M</a>
</pre>
Updating the global state inserting the updated block-tree for a given
party, adding messages to the message buffer for the other parties and
appending the history
<pre class="Agda">    <a id="12252" href="Peras.SmallStep.html#12252" class="Function Operator">_,_,_,_⇑_</a> <a id="12262" class="Symbol">:</a> <a id="12264" href="Peras.SmallStep.html#2195" class="Datatype">Message</a> <a id="12272" class="Symbol">→</a> <a id="12274" href="Peras.SmallStep.html#2335" class="Function">Delay</a> <a id="12280" class="Symbol">→</a> <a id="12282" href="Peras.Block.html#1264" class="Function">PartyId</a> <a id="12290" class="Symbol">→</a> <a id="12292" href="Peras.SmallStep.html#6410" class="Bound">T</a> <a id="12294" class="Symbol">→</a> <a id="12296" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="12302" class="Symbol">→</a> <a id="12304" href="Peras.SmallStep.html#9595" class="Record">State</a>
    <a id="12314" href="Peras.SmallStep.html#12314" class="Bound">m</a> <a id="12316" href="Peras.SmallStep.html#12252" class="Function Operator">,</a> <a id="12318" href="Peras.SmallStep.html#12318" class="Bound">d</a> <a id="12320" href="Peras.SmallStep.html#12252" class="Function Operator">,</a> <a id="12322" href="Peras.SmallStep.html#12322" class="Bound">p</a> <a id="12324" href="Peras.SmallStep.html#12252" class="Function Operator">,</a> <a id="12326" href="Peras.SmallStep.html#12326" class="Bound">l</a> <a id="12328" href="Peras.SmallStep.html#12252" class="Function Operator">⇑</a> <a id="12330" href="Peras.SmallStep.html#12330" class="Bound">M</a> <a id="12332" class="Symbol">=</a>
      <a id="12340" class="Keyword">record</a> <a id="12347" href="Peras.SmallStep.html#12330" class="Bound">M</a>
        <a id="12357" class="Symbol">{</a> <a id="12359" href="Peras.SmallStep.html#9691" class="Field">blockTrees</a> <a id="12370" class="Symbol">=</a> <a id="12372" href="Prelude.AssocList.html#1398" class="Function">set</a> <a id="12376" href="Peras.SmallStep.html#12322" class="Bound">p</a> <a id="12378" href="Peras.SmallStep.html#12326" class="Bound">l</a> <a id="12380" href="Peras.SmallStep.html#9691" class="Field">blockTrees</a>
        <a id="12399" class="Symbol">;</a> <a id="12401" href="Peras.SmallStep.html#9732" class="Field">messages</a> <a id="12410" class="Symbol">=</a>
            <a id="12424" href="Data.List.Base.html#1631" class="Function">map</a> <a id="12428" class="Symbol">(</a><a id="12429" href="Data.Product.Base.html#3109" class="Function">uncurry</a> <a id="12437" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">⦅_,_,</a> <a id="12443" href="Peras.SmallStep.html#12314" class="Bound">m</a> <a id="12445" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">,</a> <a id="12447" href="Peras.SmallStep.html#12318" class="Bound">d</a> <a id="12449" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">⦆</a><a id="12450" class="Symbol">)</a>
              <a id="12466" class="Symbol">(</a><a id="12467" href="Data.List.Base.html#10878" class="Function">filter</a> <a id="12474" class="Symbol">(</a><a id="12475" href="Relation.Nullary.Decidable.Core.html#2517" class="Function">¬?</a> <a id="12478" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="12480" class="Symbol">(</a><a id="12481" href="Peras.SmallStep.html#12322" class="Bound">p</a> <a id="12483" href="Data.Nat.Properties.html#3311" class="Function Operator">≟_</a><a id="12485" class="Symbol">)</a> <a id="12487" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="12489" href="Data.Product.Base.html#636" class="Field">proj₁</a><a id="12494" class="Symbol">)</a> <a id="12496" href="Peras.SmallStep.html#6561" class="Bound">parties</a><a id="12503" class="Symbol">)</a>
            <a id="12517" href="Data.List.Base.html#1954" class="Function Operator">++</a> <a id="12520" href="Peras.SmallStep.html#9732" class="Field">messages</a>
        <a id="12537" class="Symbol">;</a> <a id="12539" href="Peras.SmallStep.html#9765" class="Field">history</a> <a id="12547" class="Symbol">=</a> <a id="12549" href="Peras.SmallStep.html#12314" class="Bound">m</a> <a id="12551" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="12553" href="Peras.SmallStep.html#9765" class="Field">history</a>
        <a id="12569" class="Symbol">}</a>
      <a id="12577" class="Keyword">where</a> <a id="12583" class="Keyword">open</a> <a id="12588" href="Peras.SmallStep.html#9595" class="Module">State</a> <a id="12594" href="Peras.SmallStep.html#12330" class="Bound">M</a>

    <a id="12601" href="Peras.SmallStep.html#12601" class="Function Operator">add_to_diffuse_</a> <a id="12617" class="Symbol">:</a> <a id="12619" class="Symbol">(</a><a id="12620" href="Peras.SmallStep.html#2195" class="Datatype">Message</a> <a id="12628" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="12630" href="Peras.SmallStep.html#2335" class="Function">Delay</a> <a id="12636" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="12638" href="Peras.Block.html#1264" class="Function">PartyId</a><a id="12645" class="Symbol">)</a> <a id="12647" class="Symbol">→</a> <a id="12649" href="Peras.SmallStep.html#6410" class="Bound">T</a> <a id="12651" class="Symbol">→</a> <a id="12653" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="12659" class="Symbol">→</a> <a id="12661" href="Peras.SmallStep.html#9595" class="Record">State</a>
    <a id="12671" href="Peras.SmallStep.html#12601" class="Function Operator">add</a> <a id="12675" class="Symbol">(</a><a id="12676" href="Peras.SmallStep.html#12676" class="Bound">m</a><a id="12677" class="Symbol">@(</a><a id="12679" href="Peras.SmallStep.html#2220" class="InductiveConstructor">ChainMsg</a> <a id="12688" href="Peras.SmallStep.html#12688" class="Bound">x</a><a id="12689" class="Symbol">)</a> <a id="12691" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12693" href="Peras.SmallStep.html#12693" class="Bound">d</a> <a id="12695" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12697" href="Peras.SmallStep.html#12697" class="Bound">p</a><a id="12698" class="Symbol">)</a> <a id="12700" href="Peras.SmallStep.html#12601" class="Function Operator">to</a> <a id="12703" href="Peras.SmallStep.html#12703" class="Bound">t</a> <a id="12705" href="Peras.SmallStep.html#12601" class="Function Operator">diffuse</a> <a id="12713" href="Peras.SmallStep.html#12713" class="Bound">M</a> <a id="12715" class="Symbol">=</a> <a id="12717" href="Peras.SmallStep.html#12676" class="Bound">m</a> <a id="12719" href="Peras.SmallStep.html#12252" class="Function Operator">,</a> <a id="12721" href="Peras.SmallStep.html#12693" class="Bound">d</a> <a id="12723" href="Peras.SmallStep.html#12252" class="Function Operator">,</a> <a id="12725" href="Peras.SmallStep.html#12697" class="Bound">p</a> <a id="12727" href="Peras.SmallStep.html#12252" class="Function Operator">,</a> <a id="12729" href="Peras.SmallStep.html#4922" class="Function">addChain</a> <a id="12738" href="Peras.SmallStep.html#12703" class="Bound">t</a> <a id="12740" href="Peras.SmallStep.html#12688" class="Bound">x</a> <a id="12742" href="Peras.SmallStep.html#12252" class="Function Operator">⇑</a> <a id="12744" href="Peras.SmallStep.html#12713" class="Bound">M</a>
    <a id="12750" href="Peras.SmallStep.html#12601" class="Function Operator">add</a> <a id="12754" class="Symbol">(</a><a id="12755" href="Peras.SmallStep.html#12755" class="Bound">m</a><a id="12756" class="Symbol">@(</a><a id="12758" href="Peras.SmallStep.html#2251" class="InductiveConstructor">VoteMsg</a> <a id="12766" href="Peras.SmallStep.html#12766" class="Bound">x</a><a id="12767" class="Symbol">)</a> <a id="12769" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12771" href="Peras.SmallStep.html#12771" class="Bound">d</a> <a id="12773" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="12775" href="Peras.SmallStep.html#12775" class="Bound">p</a><a id="12776" class="Symbol">)</a> <a id="12778" href="Peras.SmallStep.html#12601" class="Function Operator">to</a> <a id="12781" href="Peras.SmallStep.html#12781" class="Bound">t</a> <a id="12783" href="Peras.SmallStep.html#12601" class="Function Operator">diffuse</a> <a id="12791" href="Peras.SmallStep.html#12791" class="Bound">M</a> <a id="12793" class="Symbol">=</a> <a id="12795" href="Peras.SmallStep.html#12755" class="Bound">m</a> <a id="12797" href="Peras.SmallStep.html#12252" class="Function Operator">,</a> <a id="12799" href="Peras.SmallStep.html#12771" class="Bound">d</a> <a id="12801" href="Peras.SmallStep.html#12252" class="Function Operator">,</a> <a id="12803" href="Peras.SmallStep.html#12775" class="Bound">p</a> <a id="12805" href="Peras.SmallStep.html#12252" class="Function Operator">,</a> <a id="12807" href="Peras.SmallStep.html#5017" class="Function">addVote</a> <a id="12815" href="Peras.SmallStep.html#12781" class="Bound">t</a> <a id="12817" href="Peras.SmallStep.html#12766" class="Bound">x</a> <a id="12819" href="Peras.SmallStep.html#12252" class="Function Operator">⇑</a> <a id="12821" href="Peras.SmallStep.html#12791" class="Bound">M</a>
</pre>
<h2 id="fetching">Fetching</h2>
<p>A party receives messages from the global state by fetching messages
assigned to the party, updating the local block tree and putting the
local state back into the global state.</p>
<pre class="Agda">    <a id="13031" class="Keyword">data</a> <a id="13036" href="Peras.SmallStep.html#13036" class="Datatype Operator">_⊢_[_]⇀_</a> <a id="13045" class="Symbol">:</a> <a id="13047" class="Symbol">{</a><a id="13048" href="Peras.SmallStep.html#13048" class="Bound">p</a> <a id="13050" class="Symbol">:</a> <a id="13052" href="Peras.Block.html#1264" class="Function">PartyId</a><a id="13059" class="Symbol">}</a> <a id="13061" class="Symbol">→</a> <a id="13063" href="Peras.Block.html#1872" class="Datatype">Honesty</a> <a id="13071" href="Peras.SmallStep.html#13048" class="Bound">p</a> <a id="13073" class="Symbol">→</a> <a id="13075" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="13081" class="Symbol">→</a> <a id="13083" href="Peras.SmallStep.html#2195" class="Datatype">Message</a> <a id="13091" class="Symbol">→</a> <a id="13093" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="13099" class="Symbol">→</a> <a id="13101" href="Agda.Primitive.html#388" class="Primitive">Type</a>
      <a id="13112" class="Keyword">where</a>
</pre>
An honest party consumes a message from the global message buffer and
updates the local state
<pre class="Agda">      <a id="13230" href="Peras.SmallStep.html#13230" class="InductiveConstructor">honest</a> <a id="13237" class="Symbol">:</a> <a id="13239" class="Symbol">∀</a> <a id="13241" class="Symbol">{</a><a id="13242" href="Peras.SmallStep.html#13242" class="Bound">p</a><a id="13243" class="Symbol">}</a> <a id="13245" class="Symbol">{</a><a id="13246" href="Peras.SmallStep.html#13246" class="Bound">t</a> <a id="13248" href="Peras.SmallStep.html#13248" class="Bound">t′</a><a id="13250" class="Symbol">}</a> <a id="13252" class="Symbol">{</a><a id="13253" href="Peras.SmallStep.html#13253" class="Bound">m</a><a id="13254" class="Symbol">}</a> <a id="13256" class="Symbol">{</a><a id="13257" href="Peras.SmallStep.html#13257" class="Bound">N</a><a id="13258" class="Symbol">}</a> <a id="13260" class="Symbol">→</a> <a id="13262" class="Keyword">let</a> <a id="13266" class="Keyword">open</a> <a id="13271" href="Peras.SmallStep.html#9595" class="Module">State</a> <a id="13277" href="Peras.SmallStep.html#13257" class="Bound">N</a> <a id="13279" class="Keyword">in</a>
          <a id="13292" href="Peras.SmallStep.html#9691" class="Field">blockTrees</a> <a id="13303" href="Prelude.AssocList.html#847" class="Function Operator">⁉</a> <a id="13305" href="Peras.SmallStep.html#13242" class="Bound">p</a> <a id="13307" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="13309" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="13314" href="Peras.SmallStep.html#13246" class="Bound">t</a>
        <a id="13324" class="Symbol">→</a> <a id="13326" class="Symbol">(</a><a id="13327" href="Peras.SmallStep.html#13327" class="Bound">m∈ms</a> <a id="13332" class="Symbol">:</a> <a id="13334" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">⦅</a> <a id="13336" href="Peras.SmallStep.html#13242" class="Bound">p</a> <a id="13338" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">,</a> <a id="13340" href="Peras.Block.html#1905" class="InductiveConstructor">Honest</a> <a id="13347" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">,</a> <a id="13349" href="Peras.SmallStep.html#13253" class="Bound">m</a> <a id="13351" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">,</a> <a id="13353" href="Peras.SmallStep.html#2372" class="InductiveConstructor">𝟘</a> <a id="13355" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">⦆</a> <a id="13357" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="13359" href="Peras.SmallStep.html#9732" class="Field">messages</a><a id="13367" class="Symbol">)</a>
        <a id="13377" class="Symbol">→</a> <a id="13379" href="Peras.SmallStep.html#13246" class="Bound">t</a> <a id="13381" href="Peras.SmallStep.html#6943" class="Datatype Operator">[</a> <a id="13383" href="Peras.SmallStep.html#13253" class="Bound">m</a> <a id="13385" href="Peras.SmallStep.html#6943" class="Datatype Operator">]→</a> <a id="13388" href="Peras.SmallStep.html#13248" class="Bound">t′</a>
          <a id="13401" class="Comment">---------------------------------------------</a>
        <a id="13455" class="Symbol">→</a> <a id="13457" href="Peras.Block.html#1905" class="InductiveConstructor">Honest</a> <a id="13464" class="Symbol">{</a><a id="13465" href="Peras.SmallStep.html#13242" class="Bound">p</a><a id="13466" class="Symbol">}</a> <a id="13468" href="Peras.SmallStep.html#13036" class="Datatype Operator">⊢</a>
          <a id="13480" href="Peras.SmallStep.html#13257" class="Bound">N</a> <a id="13482" href="Peras.SmallStep.html#13036" class="Datatype Operator">[</a> <a id="13484" href="Peras.SmallStep.html#13253" class="Bound">m</a> <a id="13486" href="Peras.SmallStep.html#13036" class="Datatype Operator">]⇀</a> <a id="13489" class="Keyword">record</a> <a id="13496" href="Peras.SmallStep.html#13257" class="Bound">N</a>
            <a id="13510" class="Symbol">{</a> <a id="13512" href="Peras.SmallStep.html#9691" class="Field">blockTrees</a> <a id="13523" class="Symbol">=</a> <a id="13525" href="Prelude.AssocList.html#1398" class="Function">set</a> <a id="13529" href="Peras.SmallStep.html#13242" class="Bound">p</a> <a id="13531" href="Peras.SmallStep.html#13248" class="Bound">t′</a> <a id="13534" href="Peras.SmallStep.html#9691" class="Field">blockTrees</a>
            <a id="13557" class="Symbol">;</a> <a id="13559" href="Peras.SmallStep.html#9732" class="Field">messages</a> <a id="13568" class="Symbol">=</a> <a id="13570" href="Peras.SmallStep.html#9732" class="Field">messages</a> <a id="13579" href="Data.List.Relation.Unary.Any.html#2138" class="Function Operator">─</a> <a id="13581" href="Peras.SmallStep.html#13327" class="Bound">m∈ms</a>
            <a id="13598" class="Symbol">}</a>
</pre>
An adversarial party might delay a message
<pre class="Agda">      <a id="13661" href="Peras.SmallStep.html#13661" class="InductiveConstructor">corrupt</a> <a id="13669" class="Symbol">:</a> <a id="13671" class="Symbol">∀</a> <a id="13673" class="Symbol">{</a><a id="13674" href="Peras.SmallStep.html#13674" class="Bound">p</a><a id="13675" class="Symbol">}</a> <a id="13677" class="Symbol">{</a><a id="13678" href="Peras.SmallStep.html#13678" class="Bound">as</a><a id="13680" class="Symbol">}</a> <a id="13682" class="Symbol">{</a><a id="13683" href="Peras.SmallStep.html#13683" class="Bound">m</a><a id="13684" class="Symbol">}</a> <a id="13686" class="Symbol">{</a><a id="13687" href="Peras.SmallStep.html#13687" class="Bound">N</a><a id="13688" class="Symbol">}</a> <a id="13690" class="Symbol">→</a> <a id="13692" class="Keyword">let</a> <a id="13696" class="Keyword">open</a> <a id="13701" href="Peras.SmallStep.html#9595" class="Module">State</a> <a id="13707" href="Peras.SmallStep.html#13687" class="Bound">N</a> <a id="13709" class="Keyword">in</a>
          <a id="13722" class="Symbol">(</a><a id="13723" href="Peras.SmallStep.html#13723" class="Bound">m∈ms</a> <a id="13728" class="Symbol">:</a> <a id="13730" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">⦅</a> <a id="13732" href="Peras.SmallStep.html#13674" class="Bound">p</a> <a id="13734" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">,</a> <a id="13736" href="Peras.Block.html#1949" class="InductiveConstructor">Corrupt</a> <a id="13744" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">,</a> <a id="13746" href="Peras.SmallStep.html#13683" class="Bound">m</a> <a id="13748" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">,</a> <a id="13750" href="Peras.SmallStep.html#2372" class="InductiveConstructor">𝟘</a> <a id="13752" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">⦆</a> <a id="13754" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="13756" href="Peras.SmallStep.html#9732" class="Field">messages</a><a id="13764" class="Symbol">)</a>
          <a id="13776" class="Comment">----------------------------------------------</a>
        <a id="13831" class="Symbol">→</a> <a id="13833" href="Peras.Block.html#1949" class="InductiveConstructor">Corrupt</a> <a id="13841" class="Symbol">{</a><a id="13842" href="Peras.SmallStep.html#13674" class="Bound">p</a><a id="13843" class="Symbol">}</a> <a id="13845" href="Peras.SmallStep.html#13036" class="Datatype Operator">⊢</a>
          <a id="13857" href="Peras.SmallStep.html#13687" class="Bound">N</a> <a id="13859" href="Peras.SmallStep.html#13036" class="Datatype Operator">[</a> <a id="13861" href="Peras.SmallStep.html#13683" class="Bound">m</a> <a id="13863" href="Peras.SmallStep.html#13036" class="Datatype Operator">]⇀</a> <a id="13866" class="Keyword">record</a> <a id="13873" href="Peras.SmallStep.html#13687" class="Bound">N</a>
            <a id="13887" class="Symbol">{</a> <a id="13889" href="Peras.SmallStep.html#9732" class="Field">messages</a> <a id="13898" class="Symbol">=</a> <a id="13900" href="Peras.SmallStep.html#13723" class="Bound">m∈ms</a> <a id="13905" href="Peras.SmallStep.html#419" class="Function Operator">∷ˡ=</a> <a id="13909" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">⦅</a> <a id="13911" href="Peras.SmallStep.html#13674" class="Bound">p</a> <a id="13913" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">,</a> <a id="13915" href="Peras.Block.html#1949" class="InductiveConstructor">Corrupt</a> <a id="13923" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">,</a> <a id="13925" href="Peras.SmallStep.html#13683" class="Bound">m</a> <a id="13927" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">,</a> <a id="13929" href="Peras.SmallStep.html#2392" class="InductiveConstructor">𝟙</a> <a id="13931" href="Peras.SmallStep.html#2585" class="InductiveConstructor Operator">⦆</a>
            <a id="13945" class="Symbol">;</a> <a id="13947" href="Peras.SmallStep.html#9796" class="Field">adversarialState</a> <a id="13964" class="Symbol">=</a> <a id="13966" href="Peras.SmallStep.html#13678" class="Bound">as</a>
            <a id="13981" class="Symbol">}</a>
</pre>
<h2 id="voting">Voting</h2>
Helper function for creating a vote
<pre class="Agda">    <a id="14046" href="Peras.SmallStep.html#14046" class="Function">createVote</a> <a id="14057" class="Symbol">:</a> <a id="14059" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="14070" class="Symbol">→</a> <a id="14072" href="Peras.Block.html#1264" class="Function">PartyId</a> <a id="14080" class="Symbol">→</a> <a id="14082" href="Peras.Crypto.html#2161" class="Record">MembershipProof</a> <a id="14098" class="Symbol">→</a> <a id="14100" href="Peras.Crypto.html#3115" class="Record">Signature</a> <a id="14110" class="Symbol">→</a> <a id="14112" href="Peras.Crypto.html#1542" class="Record">Hash</a> <a id="14117" href="Peras.Block.html#2807" class="Record">Block</a> <a id="14123" class="Symbol">→</a> <a id="14125" href="Peras.Chain.html#1472" class="Record">Vote</a>
    <a id="14134" href="Peras.SmallStep.html#14046" class="Function">createVote</a> <a id="14145" href="Peras.SmallStep.html#14145" class="Bound">s</a> <a id="14147" href="Peras.SmallStep.html#14147" class="Bound">p</a> <a id="14149" href="Peras.SmallStep.html#14149" class="Bound">prf</a> <a id="14153" href="Peras.SmallStep.html#14153" class="Bound">sig</a> <a id="14157" href="Peras.SmallStep.html#14157" class="Bound">hb</a> <a id="14160" class="Symbol">=</a>
      <a id="14168" class="Keyword">record</a>
        <a id="14183" class="Symbol">{</a> <a id="14185" href="Peras.Chain.html#1518" class="Field">votingRound</a> <a id="14197" class="Symbol">=</a> <a id="14199" href="Peras.Chain.html#5472" class="Function">v-round</a> <a id="14207" href="Peras.SmallStep.html#14145" class="Bound">s</a>
        <a id="14217" class="Symbol">;</a> <a id="14219" href="Peras.Chain.html#1552" class="Field">creatorId</a> <a id="14229" class="Symbol">=</a> <a id="14231" href="Peras.SmallStep.html#14147" class="Bound">p</a>
        <a id="14241" class="Symbol">;</a> <a id="14243" href="Peras.Chain.html#1582" class="Field">proofM</a> <a id="14250" class="Symbol">=</a> <a id="14252" href="Peras.SmallStep.html#14149" class="Bound">prf</a>
        <a id="14264" class="Symbol">;</a> <a id="14266" href="Peras.Chain.html#1620" class="Field">blockHash</a> <a id="14276" class="Symbol">=</a> <a id="14278" href="Peras.SmallStep.html#14157" class="Bound">hb</a>
        <a id="14289" class="Symbol">;</a> <a id="14291" href="Peras.Chain.html#1653" class="Field">signature</a> <a id="14301" class="Symbol">=</a> <a id="14303" href="Peras.SmallStep.html#14153" class="Bound">sig</a>
        <a id="14315" class="Symbol">}</a>
</pre>
<p>A party can vote for a block, if * the current slot is the first slot
in a voting round * the party is a member of the voting committee * the
chain is not in a cool-down phase</p>
Voting updates the party’s local state and for all other parties a
message is added to be consumed immediately.
<pre class="Agda">    <a id="14628" class="Keyword">infix</a> <a id="14634" class="Number">2</a> <a id="14636" href="Peras.SmallStep.html#14652" class="Datatype Operator">_⊢_⇉_</a>

    <a id="14647" class="Keyword">data</a> <a id="14652" href="Peras.SmallStep.html#14652" class="Datatype Operator">_⊢_⇉_</a> <a id="14658" class="Symbol">:</a> <a id="14660" class="Symbol">{</a><a id="14661" href="Peras.SmallStep.html#14661" class="Bound">p</a> <a id="14663" class="Symbol">:</a> <a id="14665" href="Peras.Block.html#1264" class="Function">PartyId</a><a id="14672" class="Symbol">}</a> <a id="14674" class="Symbol">→</a> <a id="14676" href="Peras.Block.html#1872" class="Datatype">Honesty</a> <a id="14684" href="Peras.SmallStep.html#14661" class="Bound">p</a> <a id="14686" class="Symbol">→</a> <a id="14688" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="14694" class="Symbol">→</a> <a id="14696" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="14702" class="Symbol">→</a> <a id="14704" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="14709" class="Keyword">where</a>

      <a id="14722" href="Peras.SmallStep.html#14722" class="InductiveConstructor">honest</a> <a id="14729" class="Symbol">:</a> <a id="14731" class="Symbol">∀</a> <a id="14733" class="Symbol">{</a><a id="14734" href="Peras.SmallStep.html#14734" class="Bound">p</a><a id="14735" class="Symbol">}</a> <a id="14737" class="Symbol">{</a><a id="14738" href="Peras.SmallStep.html#14738" class="Bound">t</a><a id="14739" class="Symbol">}</a> <a id="14741" class="Symbol">{</a><a id="14742" href="Peras.SmallStep.html#14742" class="Bound">M</a><a id="14743" class="Symbol">}</a> <a id="14745" class="Symbol">{</a><a id="14746" href="Peras.SmallStep.html#14746" class="Bound">π</a><a id="14747" class="Symbol">}</a> <a id="14749" class="Symbol">{</a><a id="14750" href="Peras.SmallStep.html#14750" class="Bound">σ</a><a id="14751" class="Symbol">}</a> <a id="14753" class="Symbol">{</a><a id="14754" href="Peras.SmallStep.html#14754" class="Bound">b</a><a id="14755" class="Symbol">}</a>
        <a id="14765" class="Symbol">→</a> <a id="14767" class="Keyword">let</a>
            <a id="14783" class="Keyword">open</a> <a id="14788" href="Peras.SmallStep.html#9595" class="Module">State</a>
            <a id="14806" href="Peras.SmallStep.html#14806" class="Bound">s</a> <a id="14808" class="Symbol">=</a> <a id="14810" href="Peras.SmallStep.html#9664" class="Field">clock</a> <a id="14816" href="Peras.SmallStep.html#14742" class="Bound">M</a>
            <a id="14830" href="Peras.SmallStep.html#14830" class="Bound">r</a> <a id="14832" class="Symbol">=</a> <a id="14834" href="Peras.Chain.html#5472" class="Function">v-round</a> <a id="14842" href="Peras.SmallStep.html#14806" class="Bound">s</a>
            <a id="14856" href="Peras.SmallStep.html#14856" class="Bound">v</a> <a id="14858" class="Symbol">=</a> <a id="14860" href="Peras.SmallStep.html#14046" class="Function">createVote</a> <a id="14871" href="Peras.SmallStep.html#14806" class="Bound">s</a> <a id="14873" href="Peras.SmallStep.html#14734" class="Bound">p</a> <a id="14875" href="Peras.SmallStep.html#14746" class="Bound">π</a> <a id="14877" href="Peras.SmallStep.html#14750" class="Bound">σ</a> <a id="14879" href="Peras.SmallStep.html#14754" class="Bound">b</a>
          <a id="14891" class="Keyword">in</a>
        <a id="14902" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="14904" href="Peras.SmallStep.html#7592" class="Function">BlockSelection</a> <a id="14919" href="Peras.SmallStep.html#14806" class="Bound">s</a> <a id="14921" href="Peras.SmallStep.html#14738" class="Bound">t</a> <a id="14923" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="14925" href="Peras.SmallStep.html#14754" class="Bound">b</a>
        <a id="14935" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="14937" href="Peras.SmallStep.html#9691" class="Field">blockTrees</a> <a id="14948" href="Peras.SmallStep.html#14742" class="Bound">M</a> <a id="14950" href="Prelude.AssocList.html#847" class="Function Operator">⁉</a> <a id="14952" href="Peras.SmallStep.html#14734" class="Bound">p</a> <a id="14954" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="14956" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="14961" href="Peras.SmallStep.html#14738" class="Bound">t</a>
        <a id="14971" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="14973" href="Peras.Chain.html#2477" class="Field">IsVoteSignature</a> <a id="14989" href="Peras.SmallStep.html#14856" class="Bound">v</a> <a id="14991" href="Peras.SmallStep.html#14750" class="Bound">σ</a>
        <a id="15001" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="15003" href="Peras.Chain.html#5127" class="Function">StartOfRound</a> <a id="15016" href="Peras.SmallStep.html#14806" class="Bound">s</a> <a id="15018" href="Peras.SmallStep.html#14830" class="Bound">r</a>
        <a id="15028" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="15030" href="Peras.Chain.html#2360" class="Field">IsCommitteeMember</a> <a id="15048" href="Peras.SmallStep.html#14734" class="Bound">p</a> <a id="15050" href="Peras.SmallStep.html#14830" class="Bound">r</a> <a id="15052" href="Peras.SmallStep.html#14746" class="Bound">π</a>
        <a id="15062" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="15064" href="Peras.SmallStep.html#9167" class="Function">VotingRule</a> <a id="15075" href="Peras.SmallStep.html#14806" class="Bound">s</a> <a id="15077" href="Peras.SmallStep.html#14738" class="Bound">t</a>
          <a id="15089" href="Prelude.InferenceRules.html#13576" class="Function Operator">───────────────────────────────────</a>
          <a id="15135" href="Peras.Block.html#1905" class="InductiveConstructor">Honest</a> <a id="15142" class="Symbol">{</a><a id="15143" href="Peras.SmallStep.html#14734" class="Bound">p</a><a id="15144" class="Symbol">}</a> <a id="15146" href="Peras.SmallStep.html#14652" class="Datatype Operator">⊢</a>
            <a id="15160" href="Peras.SmallStep.html#14742" class="Bound">M</a> <a id="15162" href="Peras.SmallStep.html#14652" class="Datatype Operator">⇉</a> <a id="15164" href="Peras.SmallStep.html#12601" class="Function Operator">add</a> <a id="15168" class="Symbol">(</a><a id="15169" href="Peras.SmallStep.html#2251" class="InductiveConstructor">VoteMsg</a> <a id="15177" href="Peras.SmallStep.html#14856" class="Bound">v</a> <a id="15179" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15181" href="Peras.SmallStep.html#2372" class="InductiveConstructor">𝟘</a> <a id="15183" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="15185" href="Peras.SmallStep.html#14734" class="Bound">p</a><a id="15186" class="Symbol">)</a> <a id="15188" href="Peras.SmallStep.html#12601" class="Function Operator">to</a> <a id="15191" href="Peras.SmallStep.html#14738" class="Bound">t</a>
                <a id="15209" href="Peras.SmallStep.html#12601" class="Function Operator">diffuse</a> <a id="15217" href="Peras.SmallStep.html#14742" class="Bound">M</a>
</pre>
<p>Rather than creating a delayed vote, an adversary can honestly create
it and delay the message.</p>
<h2 id="block-creation">Block creation</h2>
<p>Certificates are conditionally added to a block. The following
function determines if there needs to be a certificate provided for a
given voting round and a local block-tree. The conditions are as
follows</p>
<ol type="a">
<li>There is no certificate from 2 rounds ago in certs</li>
<li>The last seen certificate is not expired</li>
<li>The last seen certificate is from a later round than the last
certificate on chain</li>
</ol>
<pre class="Agda">    <a id="15746" href="Peras.SmallStep.html#15746" class="Function">needCert</a> <a id="15755" class="Symbol">:</a> <a id="15757" href="Peras.Numbering.html#1669" class="Record">RoundNumber</a> <a id="15769" class="Symbol">→</a> <a id="15771" href="Peras.SmallStep.html#6410" class="Bound">T</a> <a id="15773" class="Symbol">→</a> <a id="15775" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="15781" href="Peras.Block.html#2849" class="Record">Certificate</a>
    <a id="15797" href="Peras.SmallStep.html#15746" class="Function">needCert</a> <a id="15806" class="Symbol">(</a><a id="15807" href="Peras.Numbering.html#1707" class="InductiveConstructor">MkRoundNumber</a> <a id="15821" href="Peras.SmallStep.html#15821" class="Bound">r</a><a id="15822" class="Symbol">)</a> <a id="15824" href="Peras.SmallStep.html#15824" class="Bound">t</a> <a id="15826" class="Symbol">=</a>
      <a id="15834" class="Keyword">let</a>
        <a id="15846" href="Peras.SmallStep.html#15846" class="Bound">cert⋆</a> <a id="15852" class="Symbol">=</a> <a id="15854" href="Peras.SmallStep.html#5344" class="Function">latestCertOnChain</a> <a id="15872" href="Peras.SmallStep.html#15824" class="Bound">t</a>
        <a id="15882" href="Peras.SmallStep.html#15882" class="Bound">cert′</a> <a id="15888" class="Symbol">=</a> <a id="15890" href="Peras.SmallStep.html#5474" class="Function">latestCertSeen</a> <a id="15905" href="Peras.SmallStep.html#15824" class="Bound">t</a>
      <a id="15913" class="Keyword">in</a>
        <a id="15924" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="15927" href="Data.Bool.Base.html#941" class="Function">not</a> <a id="15931" class="Symbol">(</a><a id="15932" href="Data.List.Base.html#4896" class="Function">any</a> <a id="15936" class="Symbol">(λ</a> <a id="15939" class="Symbol">{</a><a id="15940" href="Peras.SmallStep.html#15940" class="Bound">c</a> <a id="15942" class="Symbol">→</a> <a id="15944" href="Relation.Nullary.Decidable.Core.html#3623" class="Function Operator">⌊</a> <a id="15946" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="15958" href="Peras.SmallStep.html#15940" class="Bound">c</a> <a id="15960" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="15962" class="Number">2</a> <a id="15964" href="Data.Nat.Properties.html#3311" class="Function Operator">≟</a> <a id="15966" href="Peras.SmallStep.html#15821" class="Bound">r</a> <a id="15968" href="Relation.Nullary.Decidable.Core.html#3623" class="Function Operator">⌋</a><a id="15969" class="Symbol">})</a> <a id="15972" class="Symbol">(</a><a id="15973" href="Peras.SmallStep.html#5075" class="Function">certs</a> <a id="15979" href="Peras.SmallStep.html#15824" class="Bound">t</a><a id="15980" class="Symbol">))</a> <a id="15983" class="Comment">-- (a)</a>
           <a id="16001" href="Data.Bool.Base.html#995" class="Function Operator">∧</a> <a id="16003" class="Symbol">(</a><a id="16004" href="Peras.SmallStep.html#15821" class="Bound">r</a> <a id="16006" href="Data.Nat.Base.html#1477" class="Function Operator">≤ᵇ</a> <a id="16009" href="Peras.Params.html#249" class="Field">A</a> <a id="16011" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="16013" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="16025" href="Peras.SmallStep.html#15882" class="Bound">cert′</a><a id="16030" class="Symbol">)</a>                          <a id="16057" class="Comment">-- (b)</a>
           <a id="16075" href="Data.Bool.Base.html#995" class="Function Operator">∧</a> <a id="16077" class="Symbol">(</a><a id="16078" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="16090" href="Peras.SmallStep.html#15846" class="Bound">cert⋆</a> <a id="16096" href="Data.Nat.Base.html#1457" class="Primitive Operator">&lt;ᵇ</a> <a id="16099" href="Peras.Block.html#3001" class="Function">roundNumber</a> <a id="16111" href="Peras.SmallStep.html#15882" class="Bound">cert′</a><a id="16116" class="Symbol">)</a>              <a id="16131" class="Comment">-- (c)</a>
        <a id="16146" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="16151" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="16156" href="Peras.SmallStep.html#15882" class="Bound">cert′</a>
        <a id="16170" href="Data.Bool.Base.html#1505" class="Function Operator">else</a> <a id="16175" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a>
</pre>
Helper function for creating a block
<pre class="Agda">    <a id="16236" href="Peras.SmallStep.html#16236" class="Function">createBlock</a> <a id="16248" class="Symbol">:</a> <a id="16250" href="Peras.Numbering.html#742" class="Record">SlotNumber</a> <a id="16261" class="Symbol">→</a> <a id="16263" href="Peras.Block.html#1264" class="Function">PartyId</a> <a id="16271" class="Symbol">→</a> <a id="16273" href="Peras.Crypto.html#2593" class="Record">LeadershipProof</a> <a id="16289" class="Symbol">→</a> <a id="16291" href="Peras.Crypto.html#3115" class="Record">Signature</a> <a id="16301" class="Symbol">→</a> <a id="16303" href="Peras.SmallStep.html#6410" class="Bound">T</a> <a id="16305" class="Symbol">→</a> <a id="16307" href="Peras.Block.html#2807" class="Record">Block</a>
    <a id="16317" href="Peras.SmallStep.html#16236" class="Function">createBlock</a> <a id="16329" href="Peras.SmallStep.html#16329" class="Bound">s</a> <a id="16331" href="Peras.SmallStep.html#16331" class="Bound">p</a> <a id="16333" href="Peras.SmallStep.html#16333" class="Bound">π</a> <a id="16335" href="Peras.SmallStep.html#16335" class="Bound">σ</a> <a id="16337" href="Peras.SmallStep.html#16337" class="Bound">t</a> <a id="16339" class="Symbol">=</a>
      <a id="16347" class="Keyword">record</a>
        <a id="16362" class="Symbol">{</a> <a id="16364" href="Peras.Block.html#3233" class="Field">slotNumber</a> <a id="16375" class="Symbol">=</a> <a id="16377" href="Peras.SmallStep.html#16329" class="Bound">s</a>
        <a id="16387" class="Symbol">;</a> <a id="16389" href="Peras.Block.html#3265" class="Field">creatorId</a> <a id="16399" class="Symbol">=</a> <a id="16401" href="Peras.SmallStep.html#16331" class="Bound">p</a>
        <a id="16411" class="Symbol">;</a> <a id="16413" href="Peras.Block.html#3293" class="Field">parentBlock</a> <a id="16425" class="Symbol">=</a>
            <a id="16439" class="Keyword">let</a> <a id="16443" class="Keyword">open</a> <a id="16448" href="Peras.SmallStep.html#2886" class="Module">IsTreeType</a>
            <a id="16471" class="Keyword">in</a> <a id="16474" href="Peras.Block.html#5471" class="Function">tipHash</a> <a id="16482" class="Symbol">(</a><a id="16483" href="Peras.SmallStep.html#4983" class="Function">preferredChain</a> <a id="16498" href="Peras.SmallStep.html#16337" class="Bound">t</a><a id="16499" class="Symbol">)</a>
        <a id="16509" class="Symbol">;</a> <a id="16511" href="Peras.Block.html#3326" class="Field">certificate</a> <a id="16523" class="Symbol">=</a>
            <a id="16537" class="Keyword">let</a> <a id="16541" href="Peras.SmallStep.html#16541" class="Bound">r</a> <a id="16543" class="Symbol">=</a> <a id="16545" href="Peras.Chain.html#5472" class="Function">v-round</a> <a id="16553" href="Peras.SmallStep.html#16329" class="Bound">s</a>
            <a id="16567" class="Keyword">in</a> <a id="16570" href="Peras.SmallStep.html#15746" class="Function">needCert</a> <a id="16579" href="Peras.SmallStep.html#16541" class="Bound">r</a> <a id="16581" href="Peras.SmallStep.html#16337" class="Bound">t</a>
        <a id="16591" class="Symbol">;</a> <a id="16593" href="Peras.Block.html#3366" class="Field">leadershipProof</a> <a id="16609" class="Symbol">=</a> <a id="16611" href="Peras.SmallStep.html#16333" class="Bound">π</a>
        <a id="16621" class="Symbol">;</a> <a id="16623" href="Peras.Block.html#3438" class="Field">bodyHash</a> <a id="16632" class="Symbol">=</a>
            <a id="16646" class="Keyword">let</a> <a id="16650" href="Peras.SmallStep.html#16650" class="Bound">txs</a> <a id="16654" class="Symbol">=</a> <a id="16656" href="Peras.SmallStep.html#6503" class="Bound">txSelection</a> <a id="16668" href="Peras.SmallStep.html#16329" class="Bound">s</a> <a id="16670" href="Peras.SmallStep.html#16331" class="Bound">p</a>
            <a id="16684" class="Keyword">in</a> <a id="16687" href="Peras.Block.html#3773" class="Field">blockHash</a>
                 <a id="16714" class="Keyword">record</a>
                   <a id="16740" class="Symbol">{</a> <a id="16742" href="Peras.Block.html#3773" class="Field">blockHash</a> <a id="16752" class="Symbol">=</a> <a id="16754" href="Peras.Crypto.html#2033" class="Field">hash</a> <a id="16759" href="Peras.SmallStep.html#16650" class="Bound">txs</a>
                   <a id="16782" class="Symbol">;</a> <a id="16784" href="Peras.Block.html#3806" class="Field">payload</a> <a id="16792" class="Symbol">=</a> <a id="16794" href="Peras.SmallStep.html#16650" class="Bound">txs</a>
                   <a id="16817" class="Symbol">}</a>
        <a id="16827" class="Symbol">;</a> <a id="16829" href="Peras.Block.html#3408" class="Field">signature</a> <a id="16839" class="Symbol">=</a> <a id="16841" href="Peras.SmallStep.html#16335" class="Bound">σ</a>
        <a id="16851" class="Symbol">}</a>
</pre>
<p>A party can create a new block by adding it to the local block tree
and diffuse the block creation messages to the other parties. Block
creation is possible, if as in <em>Praos</em></p>
<ul>
<li>the block signature is correct</li>
<li>the party is the slot leader</li>
</ul>
Block creation updates the party’s local state and for all other parties
a message is added to the message buffer
<pre class="Agda">    <a id="17228" class="Keyword">infix</a> <a id="17234" class="Number">2</a> <a id="17236" href="Peras.SmallStep.html#17252" class="Datatype Operator">_⊢_↷_</a>

    <a id="17247" class="Keyword">data</a> <a id="17252" href="Peras.SmallStep.html#17252" class="Datatype Operator">_⊢_↷_</a> <a id="17258" class="Symbol">:</a> <a id="17260" class="Symbol">{</a><a id="17261" href="Peras.SmallStep.html#17261" class="Bound">p</a> <a id="17263" class="Symbol">:</a> <a id="17265" href="Peras.Block.html#1264" class="Function">PartyId</a><a id="17272" class="Symbol">}</a> <a id="17274" class="Symbol">→</a> <a id="17276" href="Peras.Block.html#1872" class="Datatype">Honesty</a> <a id="17284" href="Peras.SmallStep.html#17261" class="Bound">p</a> <a id="17286" class="Symbol">→</a> <a id="17288" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="17294" class="Symbol">→</a> <a id="17296" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="17302" class="Symbol">→</a> <a id="17304" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="17309" class="Keyword">where</a>

      <a id="17322" href="Peras.SmallStep.html#17322" class="InductiveConstructor">honest</a> <a id="17329" class="Symbol">:</a> <a id="17331" class="Symbol">∀</a> <a id="17333" class="Symbol">{</a><a id="17334" href="Peras.SmallStep.html#17334" class="Bound">p</a><a id="17335" class="Symbol">}</a> <a id="17337" class="Symbol">{</a><a id="17338" href="Peras.SmallStep.html#17338" class="Bound">t</a><a id="17339" class="Symbol">}</a> <a id="17341" class="Symbol">{</a><a id="17342" href="Peras.SmallStep.html#17342" class="Bound">M</a><a id="17343" class="Symbol">}</a> <a id="17345" class="Symbol">{</a><a id="17346" href="Peras.SmallStep.html#17346" class="Bound">π</a><a id="17347" class="Symbol">}</a> <a id="17349" class="Symbol">{</a><a id="17350" href="Peras.SmallStep.html#17350" class="Bound">σ</a><a id="17351" class="Symbol">}</a>
        <a id="17361" class="Symbol">→</a> <a id="17363" class="Keyword">let</a>
            <a id="17379" class="Keyword">open</a> <a id="17384" href="Peras.SmallStep.html#9595" class="Module">State</a>
            <a id="17402" href="Peras.SmallStep.html#17402" class="Bound">s</a> <a id="17404" class="Symbol">=</a> <a id="17406" href="Peras.SmallStep.html#9664" class="Field">clock</a> <a id="17412" href="Peras.SmallStep.html#17342" class="Bound">M</a>
            <a id="17426" href="Peras.SmallStep.html#17426" class="Bound">b</a> <a id="17428" class="Symbol">=</a> <a id="17430" href="Peras.SmallStep.html#16236" class="Function">createBlock</a> <a id="17442" href="Peras.SmallStep.html#17402" class="Bound">s</a> <a id="17444" href="Peras.SmallStep.html#17334" class="Bound">p</a> <a id="17446" href="Peras.SmallStep.html#17346" class="Bound">π</a> <a id="17448" href="Peras.SmallStep.html#17350" class="Bound">σ</a> <a id="17450" href="Peras.SmallStep.html#17338" class="Bound">t</a>
            <a id="17464" href="Peras.SmallStep.html#17464" class="Bound">pref</a> <a id="17469" class="Symbol">=</a> <a id="17471" href="Peras.SmallStep.html#4983" class="Function">preferredChain</a> <a id="17486" href="Peras.SmallStep.html#17338" class="Bound">t</a>
          <a id="17498" class="Keyword">in</a>
        <a id="17509" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="17511" href="Peras.SmallStep.html#9691" class="Field">blockTrees</a> <a id="17522" href="Peras.SmallStep.html#17342" class="Bound">M</a> <a id="17524" href="Prelude.AssocList.html#847" class="Function Operator">⁉</a> <a id="17526" href="Peras.SmallStep.html#17334" class="Bound">p</a> <a id="17528" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="17530" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="17535" href="Peras.SmallStep.html#17338" class="Bound">t</a>
        <a id="17545" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="17547" href="Peras.Chain.html#6113" class="Datatype">ValidChain</a> <a id="17558" class="Symbol">(</a><a id="17559" href="Peras.SmallStep.html#17426" class="Bound">b</a> <a id="17561" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="17563" href="Peras.SmallStep.html#17464" class="Bound">pref</a><a id="17567" class="Symbol">)</a>
          <a id="17579" href="Prelude.InferenceRules.html#13868" class="Function Operator">───────────────────────────</a>
          <a id="17617" href="Peras.Block.html#1905" class="InductiveConstructor">Honest</a> <a id="17624" class="Symbol">{</a><a id="17625" href="Peras.SmallStep.html#17334" class="Bound">p</a><a id="17626" class="Symbol">}</a> <a id="17628" href="Peras.SmallStep.html#17252" class="Datatype Operator">⊢</a>
            <a id="17642" href="Peras.SmallStep.html#17342" class="Bound">M</a> <a id="17644" href="Peras.SmallStep.html#17252" class="Datatype Operator">↷</a> <a id="17646" href="Peras.SmallStep.html#12601" class="Function Operator">add</a> <a id="17650" class="Symbol">(</a>
                  <a id="17670" href="Peras.SmallStep.html#2220" class="InductiveConstructor">ChainMsg</a> <a id="17679" class="Symbol">(</a><a id="17680" href="Peras.SmallStep.html#17426" class="Bound">b</a> <a id="17682" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="17684" href="Peras.SmallStep.html#17464" class="Bound">pref</a><a id="17688" class="Symbol">)</a>
                <a id="17706" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="17708" href="Peras.SmallStep.html#2372" class="InductiveConstructor">𝟘</a>
                <a id="17726" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="17728" href="Peras.SmallStep.html#17334" class="Bound">p</a><a id="17729" class="Symbol">)</a> <a id="17731" href="Peras.SmallStep.html#12601" class="Function Operator">to</a> <a id="17734" href="Peras.SmallStep.html#17338" class="Bound">t</a>
                <a id="17752" href="Peras.SmallStep.html#12601" class="Function Operator">diffuse</a> <a id="17760" href="Peras.SmallStep.html#17342" class="Bound">M</a>
</pre>
<h2 id="small-step-semantics-1">Small-step semantics</h2>
The small-step semantics describe the evolution of the global state.
<pre class="Agda">    <a id="17872" class="Keyword">variable</a>
      <a id="17887" href="Peras.SmallStep.html#17887" class="Generalizable">M</a> <a id="17889" href="Peras.SmallStep.html#17889" class="Generalizable">N</a> <a id="17891" href="Peras.SmallStep.html#17891" class="Generalizable">O</a> <a id="17893" class="Symbol">:</a> <a id="17895" href="Peras.SmallStep.html#9595" class="Record">State</a>
      <a id="17907" href="Peras.SmallStep.html#17907" class="Generalizable">p</a> <a id="17909" class="Symbol">:</a> <a id="17911" href="Peras.Block.html#1264" class="Function">PartyId</a>
      <a id="17925" href="Peras.SmallStep.html#17925" class="Generalizable">h</a> <a id="17927" class="Symbol">:</a> <a id="17929" href="Peras.Block.html#1872" class="Datatype">Honesty</a> <a id="17937" href="Peras.SmallStep.html#17907" class="Generalizable">p</a>
</pre>
<p>The relation allows</p>
<ul>
<li>Fetching messages at the beginning of each slot</li>
<li>Block creation</li>
<li>Voting</li>
<li>Transitioning to next slot in the same voting round</li>
<li>Transitioning to next slot in a new voting round</li>
</ul>
Note, when transitioning to the next slot we need to distinguish whether
the next slot is in the same or a new voting round. This is necessary in
order to detect adversarial behaviour with respect to voting
(adversarialy not voting in a voting round)
<pre class="Agda">    <a id="18409" class="Keyword">data</a> <a id="18414" href="Peras.SmallStep.html#18414" class="Datatype Operator">_↝_</a> <a id="18418" class="Symbol">:</a> <a id="18420" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="18426" class="Symbol">→</a> <a id="18428" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="18434" class="Symbol">→</a> <a id="18436" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="18441" class="Keyword">where</a>

      <a id="18454" href="Peras.SmallStep.html#18454" class="InductiveConstructor">Fetch</a> <a id="18460" class="Symbol">:</a> <a id="18462" class="Symbol">∀</a> <a id="18464" class="Symbol">{</a><a id="18465" href="Peras.SmallStep.html#18465" class="Bound">m</a><a id="18466" class="Symbol">}</a> <a id="18468" class="Symbol">→</a>
        <a id="18478" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="18480" href="Peras.SmallStep.html#17925" class="Generalizable">h</a> <a id="18482" href="Peras.SmallStep.html#13036" class="Datatype Operator">⊢</a> <a id="18484" href="Peras.SmallStep.html#17887" class="Generalizable">M</a> <a id="18486" href="Peras.SmallStep.html#13036" class="Datatype Operator">[</a> <a id="18488" href="Peras.SmallStep.html#18465" class="Bound">m</a> <a id="18490" href="Peras.SmallStep.html#13036" class="Datatype Operator">]⇀</a> <a id="18493" href="Peras.SmallStep.html#17889" class="Generalizable">N</a>
          <a id="18505" href="Prelude.InferenceRules.html#14206" class="Function Operator">──────────────</a>
          <a id="18530" href="Peras.SmallStep.html#17887" class="Generalizable">M</a> <a id="18532" href="Peras.SmallStep.html#18414" class="Datatype Operator">↝</a> <a id="18534" href="Peras.SmallStep.html#17889" class="Generalizable">N</a>

      <a id="18543" href="Peras.SmallStep.html#18543" class="InductiveConstructor">CreateVote</a> <a id="18554" class="Symbol">:</a>
        <a id="18564" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="18566" href="Peras.SmallStep.html#10235" class="Function">Fetched</a> <a id="18574" href="Peras.SmallStep.html#17887" class="Generalizable">M</a>
        <a id="18584" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="18586" href="Peras.SmallStep.html#17925" class="Generalizable">h</a> <a id="18588" href="Peras.SmallStep.html#14652" class="Datatype Operator">⊢</a> <a id="18590" href="Peras.SmallStep.html#17887" class="Generalizable">M</a> <a id="18592" href="Peras.SmallStep.html#14652" class="Datatype Operator">⇉</a> <a id="18594" href="Peras.SmallStep.html#17889" class="Generalizable">N</a>
          <a id="18606" href="Prelude.InferenceRules.html#14291" class="Function Operator">─────────</a>
          <a id="18626" href="Peras.SmallStep.html#17887" class="Generalizable">M</a> <a id="18628" href="Peras.SmallStep.html#18414" class="Datatype Operator">↝</a> <a id="18630" href="Peras.SmallStep.html#17889" class="Generalizable">N</a>

      <a id="18639" href="Peras.SmallStep.html#18639" class="InductiveConstructor">CreateBlock</a> <a id="18651" class="Symbol">:</a>
        <a id="18661" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="18663" href="Peras.SmallStep.html#10235" class="Function">Fetched</a> <a id="18671" href="Peras.SmallStep.html#17887" class="Generalizable">M</a>
        <a id="18681" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="18683" href="Peras.SmallStep.html#17925" class="Generalizable">h</a> <a id="18685" href="Peras.SmallStep.html#17252" class="Datatype Operator">⊢</a> <a id="18687" href="Peras.SmallStep.html#17887" class="Generalizable">M</a> <a id="18689" href="Peras.SmallStep.html#17252" class="Datatype Operator">↷</a> <a id="18691" href="Peras.SmallStep.html#17889" class="Generalizable">N</a>
          <a id="18703" href="Prelude.InferenceRules.html#14291" class="Function Operator">─────────</a>
          <a id="18723" href="Peras.SmallStep.html#17887" class="Generalizable">M</a> <a id="18725" href="Peras.SmallStep.html#18414" class="Datatype Operator">↝</a> <a id="18727" href="Peras.SmallStep.html#17889" class="Generalizable">N</a>

      <a id="18736" href="Peras.SmallStep.html#18736" class="InductiveConstructor">NextSlot</a> <a id="18745" class="Symbol">:</a>
        <a id="18755" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="18757" href="Peras.SmallStep.html#10235" class="Function">Fetched</a> <a id="18765" href="Peras.SmallStep.html#17887" class="Generalizable">M</a>
        <a id="18775" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="18777" href="Peras.SmallStep.html#10895" class="Function">NextSlotInSameRound</a> <a id="18797" href="Peras.SmallStep.html#17887" class="Generalizable">M</a>
          <a id="18809" href="Prelude.InferenceRules.html#14045" class="Function Operator">─────────────────────</a>
          <a id="18841" href="Peras.SmallStep.html#17887" class="Generalizable">M</a> <a id="18843" href="Peras.SmallStep.html#18414" class="Datatype Operator">↝</a> <a id="18845" href="Peras.SmallStep.html#11849" class="Function">tick</a> <a id="18850" href="Peras.SmallStep.html#17887" class="Generalizable">M</a>

      <a id="18859" href="Peras.SmallStep.html#18859" class="InductiveConstructor">NextSlotNewRound</a> <a id="18876" class="Symbol">:</a>
        <a id="18886" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="18888" href="Peras.SmallStep.html#10235" class="Function">Fetched</a> <a id="18896" href="Peras.SmallStep.html#17887" class="Generalizable">M</a>
        <a id="18906" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="18908" href="Peras.SmallStep.html#10445" class="Function">LastSlotInRound</a> <a id="18924" href="Peras.SmallStep.html#17887" class="Generalizable">M</a>
        <a id="18934" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="18936" href="Peras.SmallStep.html#11528" class="Function">RequiredVotes</a> <a id="18950" href="Peras.SmallStep.html#17887" class="Generalizable">M</a>
          <a id="18962" href="Prelude.InferenceRules.html#14143" class="Function Operator">─────────────────</a>
          <a id="18990" href="Peras.SmallStep.html#17887" class="Generalizable">M</a> <a id="18992" href="Peras.SmallStep.html#18414" class="Datatype Operator">↝</a> <a id="18994" href="Peras.SmallStep.html#11849" class="Function">tick</a> <a id="18999" href="Peras.SmallStep.html#17887" class="Generalizable">M</a>
</pre>
<h4 id="reflexive-transitive-closure">Reflexive, transitive closure</h4>
List-like structure for defining execution paths.
<pre class="Agda">    <a id="19102" class="Keyword">infix</a>  <a id="19109" class="Number">2</a> <a id="19111" href="Peras.SmallStep.html#19158" class="Datatype Operator">_↝⋆_</a>
    <a id="19120" class="Keyword">infixr</a> <a id="19127" class="Number">2</a> <a id="19129" href="Peras.SmallStep.html#19215" class="InductiveConstructor Operator">_↣_</a>
    <a id="19137" class="Keyword">infix</a>  <a id="19144" class="Number">3</a> <a id="19146" href="Peras.SmallStep.html#19198" class="InductiveConstructor">∎</a>

    <a id="19153" class="Keyword">data</a> <a id="19158" href="Peras.SmallStep.html#19158" class="Datatype Operator">_↝⋆_</a> <a id="19163" class="Symbol">:</a> <a id="19165" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="19171" class="Symbol">→</a> <a id="19173" href="Peras.SmallStep.html#9595" class="Record">State</a> <a id="19179" class="Symbol">→</a> <a id="19181" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="19186" class="Keyword">where</a>
      <a id="19198" href="Peras.SmallStep.html#19198" class="InductiveConstructor">∎</a> <a id="19200" class="Symbol">:</a> <a id="19202" href="Peras.SmallStep.html#17887" class="Generalizable">M</a> <a id="19204" href="Peras.SmallStep.html#19158" class="Datatype Operator">↝⋆</a> <a id="19207" href="Peras.SmallStep.html#17887" class="Generalizable">M</a>
      <a id="19215" href="Peras.SmallStep.html#19215" class="InductiveConstructor Operator">_↣_</a> <a id="19219" class="Symbol">:</a> <a id="19221" href="Peras.SmallStep.html#17887" class="Generalizable">M</a> <a id="19223" href="Peras.SmallStep.html#18414" class="Datatype Operator">↝</a> <a id="19225" href="Peras.SmallStep.html#17889" class="Generalizable">N</a> <a id="19227" class="Symbol">→</a> <a id="19229" href="Peras.SmallStep.html#17889" class="Generalizable">N</a> <a id="19231" href="Peras.SmallStep.html#19158" class="Datatype Operator">↝⋆</a> <a id="19234" href="Peras.SmallStep.html#17891" class="Generalizable">O</a> <a id="19236" class="Symbol">→</a> <a id="19238" href="Peras.SmallStep.html#17887" class="Generalizable">M</a> <a id="19240" href="Peras.SmallStep.html#19158" class="Datatype Operator">↝⋆</a> <a id="19243" href="Peras.SmallStep.html#17891" class="Generalizable">O</a>
</pre>
<h2 id="properties">Properties</h2>
<pre class="Agda">    <a id="19275" class="Keyword">open</a> <a id="19280" href="Peras.SmallStep.html#9595" class="Module">State</a>
</pre>
<h3 id="valid-messages">Valid messages</h3>
<pre class="Agda">    <a id="19317" class="Keyword">data</a> <a id="19322" href="Peras.SmallStep.html#19322" class="Datatype">ValidMessages</a> <a id="19336" class="Symbol">(</a><a id="19337" href="Peras.SmallStep.html#19337" class="Bound">N</a> <a id="19339" class="Symbol">:</a> <a id="19341" href="Peras.SmallStep.html#9595" class="Record">State</a><a id="19346" class="Symbol">)</a> <a id="19348" class="Symbol">:</a> <a id="19350" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="19355" class="Keyword">where</a>

      <a id="19368" href="Peras.SmallStep.html#19368" class="InductiveConstructor">valid-messages</a> <a id="19383" class="Symbol">:</a>
          <a id="19395" href="Data.List.Relation.Unary.All.html#1627" class="Datatype">All</a> <a id="19399" class="Symbol">(λ</a> <a id="19402" class="Symbol">{</a> <a id="19404" class="Symbol">(</a><a id="19405" href="Peras.SmallStep.html#2220" class="InductiveConstructor">ChainMsg</a> <a id="19414" href="Peras.SmallStep.html#19414" class="Bound">c</a><a id="19415" class="Symbol">)</a> <a id="19417" class="Symbol">→</a> <a id="19419" href="Peras.Chain.html#6113" class="Datatype">ValidChain</a> <a id="19430" href="Peras.SmallStep.html#19414" class="Bound">c</a>
                 <a id="19449" class="Symbol">;</a> <a id="19451" class="Symbol">(</a><a id="19452" href="Peras.SmallStep.html#2251" class="InductiveConstructor">VoteMsg</a> <a id="19460" href="Peras.SmallStep.html#19460" class="Bound">v</a><a id="19461" class="Symbol">)</a> <a id="19463" class="Symbol">→</a> <a id="19465" href="Peras.Chain.html#2648" class="Function">ValidVote</a> <a id="19475" href="Peras.SmallStep.html#19460" class="Bound">v</a><a id="19476" class="Symbol">})</a>
            <a id="19491" class="Symbol">(</a><a id="19492" href="Peras.SmallStep.html#9765" class="Field">history</a> <a id="19500" href="Peras.SmallStep.html#19337" class="Bound">N</a><a id="19501" class="Symbol">)</a>
        <a id="19511" class="Symbol">→</a> <a id="19513" href="Peras.SmallStep.html#19322" class="Datatype">ValidMessages</a> <a id="19527" href="Peras.SmallStep.html#19337" class="Bound">N</a>
</pre>
<pre class="Agda">    <a id="19545" href="Peras.SmallStep.html#19545" class="Function">⇀-valid-messages</a> <a id="19562" class="Symbol">:</a> <a id="19564" class="Symbol">∀</a> <a id="19566" class="Symbol">{</a><a id="19567" href="Peras.SmallStep.html#19567" class="Bound">M</a> <a id="19569" href="Peras.SmallStep.html#19569" class="Bound">N</a> <a id="19571" href="Peras.SmallStep.html#19571" class="Bound">p</a><a id="19572" class="Symbol">}</a> <a id="19574" class="Symbol">{</a><a id="19575" href="Peras.SmallStep.html#19575" class="Bound">h</a> <a id="19577" class="Symbol">:</a> <a id="19579" href="Peras.Block.html#1872" class="Datatype">Honesty</a> <a id="19587" href="Peras.SmallStep.html#19571" class="Bound">p</a><a id="19588" class="Symbol">}</a> <a id="19590" class="Symbol">{</a><a id="19591" href="Peras.SmallStep.html#19591" class="Bound">m</a><a id="19592" class="Symbol">}</a>
      <a id="19600" class="Symbol">→</a> <a id="19602" href="Peras.SmallStep.html#19322" class="Datatype">ValidMessages</a> <a id="19616" href="Peras.SmallStep.html#19567" class="Bound">M</a>
      <a id="19624" class="Symbol">→</a> <a id="19626" href="Peras.SmallStep.html#19575" class="Bound">h</a> <a id="19628" href="Peras.SmallStep.html#13036" class="Datatype Operator">⊢</a> <a id="19630" href="Peras.SmallStep.html#19567" class="Bound">M</a> <a id="19632" href="Peras.SmallStep.html#13036" class="Datatype Operator">[</a> <a id="19634" href="Peras.SmallStep.html#19591" class="Bound">m</a> <a id="19636" href="Peras.SmallStep.html#13036" class="Datatype Operator">]⇀</a> <a id="19639" href="Peras.SmallStep.html#19569" class="Bound">N</a>
      <a id="19647" class="Symbol">→</a> <a id="19649" href="Peras.SmallStep.html#19322" class="Datatype">ValidMessages</a> <a id="19663" href="Peras.SmallStep.html#19569" class="Bound">N</a>
    <a id="19669" href="Peras.SmallStep.html#19545" class="Function">⇀-valid-messages</a> <a id="19686" class="Symbol">(</a><a id="19687" href="Peras.SmallStep.html#19368" class="InductiveConstructor">valid-messages</a> <a id="19702" href="Peras.SmallStep.html#19702" class="Bound">x</a><a id="19703" class="Symbol">)</a> <a id="19705" class="Symbol">(</a><a id="19706" href="Peras.SmallStep.html#13230" class="InductiveConstructor">honest</a> <a id="19713" class="Symbol">_</a> <a id="19715" class="Symbol">_</a> <a id="19717" class="Symbol">_)</a> <a id="19720" class="Symbol">=</a> <a id="19722" href="Peras.SmallStep.html#19368" class="InductiveConstructor">valid-messages</a> <a id="19737" href="Peras.SmallStep.html#19702" class="Bound">x</a>
    <a id="19743" href="Peras.SmallStep.html#19545" class="Function">⇀-valid-messages</a> <a id="19760" class="Symbol">(</a><a id="19761" href="Peras.SmallStep.html#19368" class="InductiveConstructor">valid-messages</a> <a id="19776" href="Peras.SmallStep.html#19776" class="Bound">x</a><a id="19777" class="Symbol">)</a> <a id="19779" class="Symbol">(</a><a id="19780" href="Peras.SmallStep.html#13661" class="InductiveConstructor">corrupt</a> <a id="19788" class="Symbol">_)</a> <a id="19791" class="Symbol">=</a> <a id="19793" href="Peras.SmallStep.html#19368" class="InductiveConstructor">valid-messages</a> <a id="19808" href="Peras.SmallStep.html#19776" class="Bound">x</a>

    <a id="19815" href="Peras.SmallStep.html#19815" class="Function">↷-valid-messages</a> <a id="19832" class="Symbol">:</a> <a id="19834" class="Symbol">∀</a> <a id="19836" class="Symbol">{</a><a id="19837" href="Peras.SmallStep.html#19837" class="Bound">M</a> <a id="19839" href="Peras.SmallStep.html#19839" class="Bound">N</a> <a id="19841" href="Peras.SmallStep.html#19841" class="Bound">p</a><a id="19842" class="Symbol">}</a> <a id="19844" class="Symbol">{</a><a id="19845" href="Peras.SmallStep.html#19845" class="Bound">h</a> <a id="19847" class="Symbol">:</a> <a id="19849" href="Peras.Block.html#1872" class="Datatype">Honesty</a> <a id="19857" href="Peras.SmallStep.html#19841" class="Bound">p</a><a id="19858" class="Symbol">}</a>
      <a id="19866" class="Symbol">→</a> <a id="19868" href="Peras.SmallStep.html#19322" class="Datatype">ValidMessages</a> <a id="19882" href="Peras.SmallStep.html#19837" class="Bound">M</a>
      <a id="19890" class="Symbol">→</a> <a id="19892" href="Peras.SmallStep.html#19845" class="Bound">h</a> <a id="19894" href="Peras.SmallStep.html#17252" class="Datatype Operator">⊢</a> <a id="19896" href="Peras.SmallStep.html#19837" class="Bound">M</a> <a id="19898" href="Peras.SmallStep.html#17252" class="Datatype Operator">↷</a> <a id="19900" href="Peras.SmallStep.html#19839" class="Bound">N</a>
      <a id="19908" class="Symbol">→</a> <a id="19910" href="Peras.SmallStep.html#19322" class="Datatype">ValidMessages</a> <a id="19924" href="Peras.SmallStep.html#19839" class="Bound">N</a>
    <a id="19930" href="Peras.SmallStep.html#19815" class="Function">↷-valid-messages</a> <a id="19947" class="Symbol">(</a><a id="19948" href="Peras.SmallStep.html#19368" class="InductiveConstructor">valid-messages</a> <a id="19963" href="Peras.SmallStep.html#19963" class="Bound">x</a><a id="19964" class="Symbol">)</a> <a id="19966" class="Symbol">(</a><a id="19967" href="Peras.SmallStep.html#17322" class="InductiveConstructor">honest</a> <a id="19974" class="Symbol">_</a> <a id="19976" href="Peras.SmallStep.html#19976" class="Bound">y</a><a id="19977" class="Symbol">)</a> <a id="19979" class="Symbol">=</a> <a id="19981" href="Peras.SmallStep.html#19368" class="InductiveConstructor">valid-messages</a> <a id="19996" class="Symbol">(</a><a id="19997" href="Peras.SmallStep.html#19976" class="Bound">y</a> <a id="19999" href="Data.List.Relation.Unary.All.html#1707" class="InductiveConstructor Operator">∷</a> <a id="20001" href="Peras.SmallStep.html#19963" class="Bound">x</a><a id="20002" class="Symbol">)</a>

    <a id="20009" href="Peras.SmallStep.html#20009" class="Function">⇉-valid-messages</a> <a id="20026" class="Symbol">:</a> <a id="20028" class="Symbol">∀</a> <a id="20030" class="Symbol">{</a><a id="20031" href="Peras.SmallStep.html#20031" class="Bound">M</a> <a id="20033" href="Peras.SmallStep.html#20033" class="Bound">N</a> <a id="20035" href="Peras.SmallStep.html#20035" class="Bound">p</a><a id="20036" class="Symbol">}</a> <a id="20038" class="Symbol">{</a><a id="20039" href="Peras.SmallStep.html#20039" class="Bound">h</a> <a id="20041" class="Symbol">:</a> <a id="20043" href="Peras.Block.html#1872" class="Datatype">Honesty</a> <a id="20051" href="Peras.SmallStep.html#20035" class="Bound">p</a><a id="20052" class="Symbol">}</a>
      <a id="20060" class="Symbol">→</a> <a id="20062" href="Peras.SmallStep.html#19322" class="Datatype">ValidMessages</a> <a id="20076" href="Peras.SmallStep.html#20031" class="Bound">M</a>
      <a id="20084" class="Symbol">→</a> <a id="20086" href="Peras.SmallStep.html#20039" class="Bound">h</a> <a id="20088" href="Peras.SmallStep.html#14652" class="Datatype Operator">⊢</a> <a id="20090" href="Peras.SmallStep.html#20031" class="Bound">M</a> <a id="20092" href="Peras.SmallStep.html#14652" class="Datatype Operator">⇉</a> <a id="20094" href="Peras.SmallStep.html#20033" class="Bound">N</a>
      <a id="20102" class="Symbol">→</a> <a id="20104" href="Peras.SmallStep.html#19322" class="Datatype">ValidMessages</a> <a id="20118" href="Peras.SmallStep.html#20033" class="Bound">N</a>
    <a id="20124" href="Peras.SmallStep.html#20009" class="Function">⇉-valid-messages</a> <a id="20141" class="Symbol">(</a><a id="20142" href="Peras.SmallStep.html#19368" class="InductiveConstructor">valid-messages</a> <a id="20157" href="Peras.SmallStep.html#20157" class="Bound">x</a><a id="20158" class="Symbol">)</a> <a id="20160" class="Symbol">(</a><a id="20161" href="Peras.SmallStep.html#14722" class="InductiveConstructor">honest</a> <a id="20168" class="Symbol">_</a> <a id="20170" class="Symbol">_</a> <a id="20172" href="Peras.SmallStep.html#20172" class="Bound">x₃</a> <a id="20175" class="Symbol">_</a> <a id="20177" href="Peras.SmallStep.html#20177" class="Bound">x₅</a> <a id="20180" class="Symbol">_)</a> <a id="20183" class="Symbol">=</a> <a id="20185" href="Peras.SmallStep.html#19368" class="InductiveConstructor">valid-messages</a> <a id="20200" class="Symbol">((</a><a id="20202" href="Peras.SmallStep.html#20177" class="Bound">x₅</a> <a id="20205" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="20207" href="Peras.SmallStep.html#20172" class="Bound">x₃</a><a id="20209" class="Symbol">)</a> <a id="20211" href="Data.List.Relation.Unary.All.html#1707" class="InductiveConstructor Operator">∷</a> <a id="20213" href="Peras.SmallStep.html#20157" class="Bound">x</a><a id="20214" class="Symbol">)</a>

    <a id="20221" href="Peras.SmallStep.html#20221" class="Function">tick-valid-messages</a> <a id="20241" class="Symbol">:</a> <a id="20243" class="Symbol">∀</a> <a id="20245" class="Symbol">{</a><a id="20246" href="Peras.SmallStep.html#20246" class="Bound">M</a><a id="20247" class="Symbol">}</a>
      <a id="20255" class="Symbol">→</a> <a id="20257" href="Peras.SmallStep.html#19322" class="Datatype">ValidMessages</a> <a id="20271" href="Peras.SmallStep.html#20246" class="Bound">M</a>
      <a id="20279" class="Symbol">→</a> <a id="20281" href="Peras.SmallStep.html#19322" class="Datatype">ValidMessages</a> <a id="20295" class="Symbol">(</a><a id="20296" href="Peras.SmallStep.html#11849" class="Function">tick</a> <a id="20301" href="Peras.SmallStep.html#20246" class="Bound">M</a><a id="20302" class="Symbol">)</a>
    <a id="20308" href="Peras.SmallStep.html#20221" class="Function">tick-valid-messages</a> <a id="20328" class="Symbol">(</a><a id="20329" href="Peras.SmallStep.html#19368" class="InductiveConstructor">valid-messages</a> <a id="20344" href="Peras.SmallStep.html#20344" class="Bound">x</a><a id="20345" class="Symbol">)</a> <a id="20347" class="Symbol">=</a> <a id="20349" href="Peras.SmallStep.html#19368" class="InductiveConstructor">valid-messages</a> <a id="20364" href="Peras.SmallStep.html#20344" class="Bound">x</a>
</pre>
<pre class="Agda">    <a id="20382" href="Peras.SmallStep.html#20382" class="Function">↝-valid-messages</a> <a id="20399" class="Symbol">:</a>
      <a id="20407" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="20409" href="Peras.SmallStep.html#19322" class="Datatype">ValidMessages</a> <a id="20423" href="Peras.SmallStep.html#17887" class="Generalizable">M</a>
      <a id="20431" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="20433" href="Peras.SmallStep.html#17887" class="Generalizable">M</a> <a id="20435" href="Peras.SmallStep.html#18414" class="Datatype Operator">↝</a> <a id="20437" href="Peras.SmallStep.html#17889" class="Generalizable">N</a>
        <a id="20447" href="Prelude.InferenceRules.html#14243" class="Function Operator">────────────</a>
        <a id="20468" href="Peras.SmallStep.html#19322" class="Datatype">ValidMessages</a> <a id="20482" href="Peras.SmallStep.html#17889" class="Generalizable">N</a>
    <a id="20488" href="Peras.SmallStep.html#20382" class="Function">↝-valid-messages</a> <a id="20505" href="Peras.SmallStep.html#20505" class="Bound">x</a> <a id="20507" class="Symbol">(</a><a id="20508" href="Peras.SmallStep.html#18454" class="InductiveConstructor">Fetch</a> <a id="20514" href="Peras.SmallStep.html#20514" class="Bound">y</a><a id="20515" class="Symbol">)</a> <a id="20517" class="Symbol">=</a> <a id="20519" href="Peras.SmallStep.html#19545" class="Function">⇀-valid-messages</a> <a id="20536" href="Peras.SmallStep.html#20505" class="Bound">x</a> <a id="20538" href="Peras.SmallStep.html#20514" class="Bound">y</a>
    <a id="20544" href="Peras.SmallStep.html#20382" class="Function">↝-valid-messages</a> <a id="20561" href="Peras.SmallStep.html#20561" class="Bound">x</a> <a id="20563" class="Symbol">(</a><a id="20564" href="Peras.SmallStep.html#18543" class="InductiveConstructor">CreateVote</a> <a id="20575" class="Symbol">_</a> <a id="20577" href="Peras.SmallStep.html#20577" class="Bound">y</a><a id="20578" class="Symbol">)</a> <a id="20580" class="Symbol">=</a> <a id="20582" href="Peras.SmallStep.html#20009" class="Function">⇉-valid-messages</a> <a id="20599" href="Peras.SmallStep.html#20561" class="Bound">x</a> <a id="20601" href="Peras.SmallStep.html#20577" class="Bound">y</a>
    <a id="20607" href="Peras.SmallStep.html#20382" class="Function">↝-valid-messages</a> <a id="20624" href="Peras.SmallStep.html#20624" class="Bound">x</a> <a id="20626" class="Symbol">(</a><a id="20627" href="Peras.SmallStep.html#18639" class="InductiveConstructor">CreateBlock</a> <a id="20639" class="Symbol">_</a> <a id="20641" href="Peras.SmallStep.html#20641" class="Bound">y</a><a id="20642" class="Symbol">)</a> <a id="20644" class="Symbol">=</a> <a id="20646" href="Peras.SmallStep.html#19815" class="Function">↷-valid-messages</a> <a id="20663" href="Peras.SmallStep.html#20624" class="Bound">x</a> <a id="20665" href="Peras.SmallStep.html#20641" class="Bound">y</a>
    <a id="20671" href="Peras.SmallStep.html#20382" class="Function">↝-valid-messages</a> <a id="20688" href="Peras.SmallStep.html#20688" class="Bound">x</a> <a id="20690" class="Symbol">(</a><a id="20691" href="Peras.SmallStep.html#18736" class="InductiveConstructor">NextSlot</a> <a id="20700" class="Symbol">_</a> <a id="20702" class="Symbol">_)</a> <a id="20705" class="Symbol">=</a> <a id="20707" href="Peras.SmallStep.html#20221" class="Function">tick-valid-messages</a> <a id="20727" href="Peras.SmallStep.html#20688" class="Bound">x</a>
    <a id="20733" href="Peras.SmallStep.html#20382" class="Function">↝-valid-messages</a> <a id="20750" href="Peras.SmallStep.html#20750" class="Bound">x</a> <a id="20752" class="Symbol">(</a><a id="20753" href="Peras.SmallStep.html#18859" class="InductiveConstructor">NextSlotNewRound</a> <a id="20770" class="Symbol">_</a> <a id="20772" class="Symbol">_</a> <a id="20774" class="Symbol">_)</a> <a id="20777" class="Symbol">=</a> <a id="20779" href="Peras.SmallStep.html#20221" class="Function">tick-valid-messages</a> <a id="20799" href="Peras.SmallStep.html#20750" class="Bound">x</a>
</pre>
<pre class="Agda">    <a id="20817" href="Peras.SmallStep.html#20817" class="Function">↝⋆-valid-messages</a> <a id="20835" class="Symbol">:</a>
      <a id="20843" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="20845" href="Peras.SmallStep.html#19322" class="Datatype">ValidMessages</a> <a id="20859" href="Peras.SmallStep.html#17887" class="Generalizable">M</a>
      <a id="20867" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="20869" href="Peras.SmallStep.html#17887" class="Generalizable">M</a> <a id="20871" href="Peras.SmallStep.html#19158" class="Datatype Operator">↝⋆</a> <a id="20874" href="Peras.SmallStep.html#17889" class="Generalizable">N</a>
        <a id="20884" href="Prelude.InferenceRules.html#14243" class="Function Operator">────────────</a>
        <a id="20905" href="Peras.SmallStep.html#19322" class="Datatype">ValidMessages</a> <a id="20919" href="Peras.SmallStep.html#17889" class="Generalizable">N</a>
    <a id="20925" href="Peras.SmallStep.html#20817" class="Function">↝⋆-valid-messages</a> <a id="20943" href="Peras.SmallStep.html#20943" class="Bound">x</a> <a id="20945" href="Peras.SmallStep.html#19198" class="InductiveConstructor">∎</a> <a id="20947" class="Symbol">=</a> <a id="20949" href="Peras.SmallStep.html#20943" class="Bound">x</a>
    <a id="20955" href="Peras.SmallStep.html#20817" class="Function">↝⋆-valid-messages</a> <a id="20973" href="Peras.SmallStep.html#20973" class="Bound">x</a> <a id="20975" class="Symbol">(</a><a id="20976" href="Peras.SmallStep.html#20976" class="Bound">x₁</a> <a id="20979" href="Peras.SmallStep.html#19215" class="InductiveConstructor Operator">↣</a> <a id="20981" href="Peras.SmallStep.html#20981" class="Bound">x₂</a><a id="20983" class="Symbol">)</a> <a id="20985" class="Symbol">=</a>
      <a id="20993" href="Peras.SmallStep.html#20817" class="Function">↝⋆-valid-messages</a> <a id="21011" class="Symbol">(</a><a id="21012" href="Peras.SmallStep.html#20382" class="Function">↝-valid-messages</a> <a id="21029" href="Peras.SmallStep.html#20973" class="Bound">x</a> <a id="21031" href="Peras.SmallStep.html#20976" class="Bound">x₁</a><a id="21033" class="Symbol">)</a> <a id="21035" href="Peras.SmallStep.html#20981" class="Bound">x₂</a>
</pre>
<pre class="Agda">  <a id="21052" class="Keyword">open</a> <a id="21057" href="Peras.SmallStep.html#6388" class="Module">Semantics</a> <a id="21067" class="Keyword">public</a>
</pre>
</body>
</html>
