<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Peras.SmallStep</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="Agda.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre class="Agda"><a id="9" class="Keyword">module</a> <a id="16" href="Peras.SmallStep.html" class="Module">Peras.SmallStep</a> <a id="32" class="Keyword">where</a>
</pre>
<!--
<pre class="Agda"><a id="55" class="Keyword">open</a> <a id="60" class="Keyword">import</a> <a id="67" href="Prelude.AssocList.html" class="Module">Prelude.AssocList</a>
<a id="85" class="Keyword">open</a> <a id="90" class="Keyword">import</a> <a id="97" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a> <a id="111" class="Keyword">using</a> <a id="117" class="Symbol">(</a><a id="118" href="Prelude.DecEq.html#62" class="Record">DecEq</a><a id="123" class="Symbol">)</a>
<a id="125" class="Keyword">open</a> <a id="130" class="Keyword">import</a> <a id="137" href="Prelude.Default.html" class="Module">Prelude.Default</a> <a id="153" class="Keyword">using</a> <a id="159" class="Symbol">(</a><a id="160" href="Prelude.Default.html#100" class="Record">Default</a><a id="167" class="Symbol">)</a>
<a id="169" class="Keyword">open</a> <a id="174" href="Prelude.Default.html#100" class="Module">Default</a> <a id="182" class="Symbol">⦃...⦄</a>
<a id="188" class="Keyword">open</a> <a id="193" class="Keyword">import</a> <a id="200" href="Prelude.InferenceRules.html" class="Module">Prelude.InferenceRules</a>

<a id="224" class="Keyword">open</a> <a id="229" class="Keyword">import</a> <a id="236" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="247" class="Keyword">using</a> <a id="253" class="Symbol">(</a><a id="254" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a><a id="258" class="Symbol">;</a> <a id="260" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="267" class="Symbol">)</a>
<a id="269" class="Keyword">import</a> <a id="276" href="Data.List.html" class="Module">Data.List</a> <a id="286" class="Symbol">as</a> <a id="289" class="Module">L</a>
<a id="291" class="Keyword">open</a> <a id="296" class="Keyword">import</a> <a id="303" href="Data.List.Relation.Unary.Any.html" class="Module">Data.List.Relation.Unary.Any</a> <a id="332" class="Keyword">using</a> <a id="338" class="Symbol">()</a> <a id="341" class="Keyword">renaming</a> <a id="350" class="Symbol">(</a><a id="351" href="Data.List.Relation.Unary.Any.html#2027" class="Function Operator">_∷=_</a> <a id="356" class="Symbol">to</a> <a id="359" class="Function Operator">_∷ˡ=_</a><a id="364" class="Symbol">)</a>
<a id="366" class="Keyword">open</a> <a id="371" class="Keyword">import</a> <a id="378" href="Data.List.Membership.Propositional.html" class="Module">Data.List.Membership.Propositional</a>
<a id="413" class="Keyword">open</a> <a id="418" class="Keyword">import</a> <a id="425" href="Data.Fin.html" class="Module">Data.Fin</a> <a id="434" class="Keyword">using</a> <a id="440" class="Symbol">(</a><a id="441" href="Data.Fin.Base.html#1154" class="Datatype">Fin</a><a id="444" class="Symbol">)</a> <a id="446" class="Keyword">renaming</a> <a id="455" class="Symbol">(</a><a id="456" href="Data.Fin.Base.html#1176" class="InductiveConstructor">zero</a> <a id="461" class="Symbol">to</a> <a id="464" class="InductiveConstructor">fzero</a><a id="469" class="Symbol">;</a> <a id="471" href="Data.Fin.Base.html#1197" class="InductiveConstructor">suc</a> <a id="475" class="Symbol">to</a> <a id="478" class="InductiveConstructor">fsuc</a><a id="482" class="Symbol">)</a>
<a id="484" class="Keyword">open</a> <a id="489" class="Keyword">import</a> <a id="496" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="505" class="Keyword">using</a> <a id="511" class="Symbol">(</a><a id="512" href="Data.Nat.Base.html#7279" class="Function Operator">_%_</a><a id="515" class="Symbol">;</a> <a id="517" href="Data.Nat.Base.html#2259" class="Function Operator">_≥_</a><a id="520" class="Symbol">;</a> <a id="522" href="Data.Nat.Base.html#2289" class="Function Operator">_&gt;_</a><a id="525" class="Symbol">;</a> <a id="527" href="Data.Nat.Base.html#1691" class="Datatype Operator">_≤_</a><a id="530" class="Symbol">;</a> <a id="532" href="Data.Nat.Base.html#3260" class="Record">NonZero</a><a id="539" class="Symbol">)</a>
<a id="541" class="Keyword">open</a> <a id="546" class="Keyword">import</a> <a id="553" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="591" class="Keyword">using</a> <a id="597" class="Symbol">(</a><a id="598" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">_≡_</a><a id="601" class="Symbol">;</a> <a id="603" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">_≢_</a><a id="606" class="Symbol">)</a>
<a id="608" class="Keyword">open</a> <a id="613" class="Keyword">import</a> <a id="620" href="Data.Product.html" class="Module">Data.Product</a> <a id="633" class="Keyword">using</a> <a id="639" class="Symbol">()</a> <a id="642" class="Keyword">renaming</a> <a id="651" class="Symbol">(</a><a id="652" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,_</a> <a id="656" class="Symbol">to</a> <a id="659" class="InductiveConstructor Operator">_,ᵖ_</a><a id="663" class="Symbol">)</a>

<a id="666" class="Keyword">open</a> <a id="671" class="Keyword">import</a> <a id="678" href="Haskell.Prelude.html" class="Module">Haskell.Prelude</a> <a id="694" class="Keyword">hiding</a> <a id="701" class="Symbol">(</a><a id="702" href="Haskell.Prim.Ord.html#1096" class="Field Operator">_&gt;_</a><a id="705" class="Symbol">)</a>
<a id="707" class="Keyword">open</a> <a id="712" class="Keyword">import</a> <a id="719" href="Haskell.Extra.Dec.html" class="Module">Haskell.Extra.Dec</a>

<a id="738" class="Keyword">open</a> <a id="743" class="Keyword">import</a> <a id="750" href="Peras.Block.html" class="Module">Peras.Block</a>
<a id="762" class="Keyword">open</a> <a id="767" class="Keyword">import</a> <a id="774" href="Peras.Chain.html" class="Module">Peras.Chain</a>
<a id="786" class="Keyword">open</a> <a id="791" class="Keyword">import</a> <a id="798" href="Peras.Crypto.html" class="Module">Peras.Crypto</a>
<a id="811" class="Keyword">open</a> <a id="816" class="Keyword">import</a> <a id="823" href="Peras.Numbering.html" class="Module">Peras.Numbering</a>
<a id="839" class="Keyword">open</a> <a id="844" class="Keyword">import</a> <a id="851" href="Peras.Params.html" class="Module">Peras.Params</a>
<a id="864" class="Keyword">open</a> <a id="869" class="Keyword">import</a> <a id="876" href="Peras.Util.html" class="Module">Peras.Util</a>

<a id="888" class="Keyword">open</a> <a id="893" href="Peras.Block.html#1406" class="Module">Honesty</a> <a id="901" class="Keyword">public</a>
<a id="908" class="Keyword">open</a> <a id="913" href="Peras.Crypto.html#2454" class="Module">MembershipProof</a> <a id="929" class="Keyword">public</a>
<a id="936" class="Keyword">open</a> <a id="941" href="Peras.Crypto.html#3408" class="Module">Signature</a> <a id="951" class="Keyword">public</a>
<a id="958" class="Keyword">open</a> <a id="963" href="Peras.Numbering.html#1962" class="Module">RoundNumber</a> <a id="975" class="Keyword">public</a>
<a id="982" class="Keyword">open</a> <a id="987" href="Peras.Block.html#1006" class="Module">Party</a>
</pre>-->
<h1 id="small-step-semantics">Small-step semantics</h1>
<p>The small-step semantics of the <strong>Ouroboros Peras</strong>
protocol define the evolution of the global state of the system
modelling <em>honest</em> and <em>adversarial</em> parties. The number
of parties is fixed during the execution of the protocol and the list of
parties has to be provided as a module parameter. In addition the model
is parameterized by the lotteries (for slot leadership and voting
committee membership) as well as the type of the block tree. Furthermore
adversarial parties share generic, adversarial state.</p>
<p>References:</p>
<ul>
<li>Formalizing Nakamoto-Style Proof of Stake, Søren Eller Thomsen and
Bas Spitters</li>
</ul>
<h3 id="parameters">Parameters</h3>
<p>The parameters for the <em>Peras</em> protocol and hash functions are
defined as instance arguments of the module.</p>
<pre class="Agda"><a id="1767" class="Keyword">module</a> <a id="1774" href="Peras.SmallStep.html#1774" class="Module">_</a> <a id="1776" class="Symbol">⦃</a> <a id="1778" href="Peras.SmallStep.html#1778" class="Bound">_</a> <a id="1780" class="Symbol">:</a> <a id="1782" href="Peras.Crypto.html#2287" class="Record">Hashable</a> <a id="1791" href="Peras.Block.html#2100" class="Record">Block</a> <a id="1797" class="Symbol">⦄</a>
         <a id="1808" class="Symbol">⦃</a> <a id="1810" href="Peras.SmallStep.html#1810" class="Bound">_</a> <a id="1812" class="Symbol">:</a> <a id="1814" href="Peras.Crypto.html#2287" class="Record">Hashable</a> <a id="1823" class="Symbol">(</a><a id="1824" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1829" href="Peras.Block.html#1622" class="Function">Tx</a><a id="1831" class="Symbol">)</a> <a id="1833" class="Symbol">⦄</a>
         <a id="1844" class="Symbol">⦃</a> <a id="1846" href="Peras.SmallStep.html#1846" class="Bound">_</a> <a id="1848" class="Symbol">:</a> <a id="1850" href="Peras.Params.html#166" class="Record">Params</a> <a id="1857" class="Symbol">⦄</a>
         <a id="1868" class="Symbol">⦃</a> <a id="1870" href="Peras.SmallStep.html#1870" class="Bound">_</a> <a id="1872" class="Symbol">:</a> <a id="1874" href="Peras.Chain.html#1945" class="Record">Network</a> <a id="1882" class="Symbol">⦄</a>
         <a id="1893" class="Symbol">⦃</a> <a id="1895" href="Peras.SmallStep.html#1895" class="Bound">_</a> <a id="1897" class="Symbol">:</a> <a id="1899" href="Peras.Chain.html#1679" class="Record">Postulates</a> <a id="1910" class="Symbol">⦄</a>

         <a id="1922" class="Keyword">where</a>
</pre>
The block tree, resp. the validity of the chain is defined with respect
of the parameters.
<pre class="Agda">  <a id="2037" class="Keyword">open</a> <a id="2042" href="Peras.Crypto.html#2287" class="Module">Hashable</a> <a id="2051" class="Symbol">⦃...⦄</a>
  <a id="2059" class="Keyword">open</a> <a id="2064" href="Peras.Params.html#166" class="Module">Params</a> <a id="2071" class="Symbol">⦃...⦄</a>
  <a id="2079" class="Keyword">open</a> <a id="2084" href="Peras.Chain.html#1945" class="Module">Network</a> <a id="2092" class="Symbol">⦃...⦄</a>
  <a id="2100" class="Keyword">open</a> <a id="2105" href="Peras.Chain.html#1679" class="Module">Postulates</a> <a id="2116" class="Symbol">⦃...⦄</a>
</pre>
<h4 id="messages">Messages</h4>
Messages for sending and receiving chains and votes. Note, in the
<em>Peras</em> protocol certificates are not diffused explicitly.
<pre class="Agda">  <a id="2276" class="Keyword">data</a> <a id="2281" href="Peras.SmallStep.html#2281" class="Datatype">Message</a> <a id="2289" class="Symbol">:</a> <a id="2291" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="2295" class="Keyword">where</a>
    <a id="2305" href="Peras.SmallStep.html#2305" class="InductiveConstructor">ChainMsg</a> <a id="2314" class="Symbol">:</a> <a id="2316" class="Symbol">{</a><a id="2317" href="Peras.SmallStep.html#2317" class="Bound">c</a> <a id="2319" class="Symbol">:</a> <a id="2321" href="Peras.Chain.html#2532" class="Function">Chain</a><a id="2326" class="Symbol">}</a> <a id="2328" class="Symbol">→</a> <a id="2330" href="Peras.Chain.html#4844" class="Datatype">ValidChain</a> <a id="2341" href="Peras.SmallStep.html#2317" class="Bound">c</a> <a id="2343" class="Symbol">→</a> <a id="2345" href="Peras.SmallStep.html#2281" class="Datatype">Message</a>
    <a id="2357" href="Peras.SmallStep.html#2357" class="InductiveConstructor">VoteMsg</a> <a id="2365" class="Symbol">:</a> <a id="2367" class="Symbol">{</a><a id="2368" href="Peras.SmallStep.html#2368" class="Bound">v</a> <a id="2370" class="Symbol">:</a> <a id="2372" href="Peras.Chain.html#899" class="Record">Vote</a><a id="2376" class="Symbol">}</a> <a id="2378" class="Symbol">→</a> <a id="2380" href="Peras.Chain.html#2069" class="Function">ValidVote</a> <a id="2390" href="Peras.SmallStep.html#2368" class="Bound">v</a> <a id="2392" class="Symbol">→</a> <a id="2394" href="Peras.SmallStep.html#2281" class="Datatype">Message</a>
</pre>
Messages can be delayed by a number of slots
<pre class="Agda">  <a id="2461" href="Peras.SmallStep.html#2461" class="Function">Delay</a> <a id="2467" class="Symbol">=</a> <a id="2469" href="Data.Fin.Base.html#1154" class="Datatype">Fin</a> <a id="2473" class="Symbol">(</a><a id="2474" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="2478" class="Symbol">(</a><a id="2479" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="2483" href="Peras.Chain.html#1978" class="Field">Δ</a><a id="2484" class="Symbol">))</a>

  <a id="2490" class="Keyword">pattern</a> <a id="2498" href="Peras.SmallStep.html#2498" class="InductiveConstructor">𝟘</a> <a id="2500" class="Symbol">=</a> <a id="2502" href="Peras.SmallStep.html#464" class="InductiveConstructor">fzero</a>
  <a id="2510" class="Keyword">pattern</a> <a id="2518" href="Peras.SmallStep.html#2518" class="InductiveConstructor">𝟙</a> <a id="2520" class="Symbol">=</a> <a id="2522" href="Peras.SmallStep.html#478" class="InductiveConstructor">fsuc</a> <a id="2527" href="Peras.SmallStep.html#464" class="InductiveConstructor">fzero</a>
  <a id="2535" class="Keyword">pattern</a> <a id="2543" href="Peras.SmallStep.html#2543" class="InductiveConstructor">𝟚</a> <a id="2545" class="Symbol">=</a> <a id="2547" href="Peras.SmallStep.html#478" class="InductiveConstructor">fsuc</a> <a id="2552" class="Symbol">(</a><a id="2553" href="Peras.SmallStep.html#478" class="InductiveConstructor">fsuc</a> <a id="2558" href="Peras.SmallStep.html#464" class="InductiveConstructor">fzero</a><a id="2563" class="Symbol">)</a>
</pre>
Messages are put into an envelope and assigned to a party. The message
can be delayed.
<pre class="Agda">  <a id="2666" class="Keyword">record</a> <a id="2673" href="Peras.SmallStep.html#2673" class="Record">Envelope</a> <a id="2682" class="Symbol">:</a> <a id="2684" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="2688" class="Keyword">where</a>
    <a id="2698" class="Keyword">constructor</a> <a id="2710" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">⦅_,_,_,_⦆</a>
    <a id="2724" class="Keyword">field</a>
      <a id="2736" href="Peras.SmallStep.html#2736" class="Field">partyId</a> <a id="2744" class="Symbol">:</a> <a id="2746" href="Peras.Block.html#842" class="Function">PartyId</a>
      <a id="2760" href="Peras.SmallStep.html#2760" class="Field">honesty</a> <a id="2768" class="Symbol">:</a> <a id="2770" href="Peras.Block.html#1406" class="Datatype">Honesty</a> <a id="2778" href="Peras.SmallStep.html#2736" class="Field">partyId</a>
      <a id="2792" href="Peras.SmallStep.html#2792" class="Field">message</a> <a id="2800" class="Symbol">:</a> <a id="2802" href="Peras.SmallStep.html#2281" class="Datatype">Message</a>
      <a id="2816" href="Peras.SmallStep.html#2816" class="Field">delay</a> <a id="2822" class="Symbol">:</a> <a id="2824" href="Peras.SmallStep.html#2461" class="Function">Delay</a>

  <a id="2833" class="Keyword">open</a> <a id="2838" href="Peras.SmallStep.html#2673" class="Module">Envelope</a>
</pre>
<h4 id="block-tree">Block-tree</h4>
A block-tree is defined by properties - an implementation of the
block-tree has to fulfil all the properties mentioned below:
<pre class="Agda">  <a id="3004" class="Keyword">record</a> <a id="3011" href="Peras.SmallStep.html#3011" class="Record">IsTreeType</a> <a id="3022" class="Symbol">{</a><a id="3023" href="Peras.SmallStep.html#3023" class="Bound">T</a> <a id="3025" class="Symbol">:</a> <a id="3027" href="Agda.Primitive.html#388" class="Primitive">Set</a><a id="3030" class="Symbol">}</a>
                    <a id="3052" class="Symbol">(</a><a id="3053" href="Peras.SmallStep.html#3053" class="Bound">tree₀</a> <a id="3059" class="Symbol">:</a> <a id="3061" href="Peras.SmallStep.html#3023" class="Bound">T</a><a id="3062" class="Symbol">)</a>
                    <a id="3084" class="Symbol">(</a><a id="3085" href="Peras.SmallStep.html#3085" class="Bound">addChain</a> <a id="3094" class="Symbol">:</a> <a id="3096" href="Peras.SmallStep.html#3023" class="Bound">T</a> <a id="3098" class="Symbol">→</a> <a id="3100" class="Symbol">{</a><a id="3101" href="Peras.SmallStep.html#3101" class="Bound">c</a> <a id="3103" class="Symbol">:</a> <a id="3105" href="Peras.Chain.html#2532" class="Function">Chain</a><a id="3110" class="Symbol">}</a> <a id="3112" class="Symbol">→</a> <a id="3114" href="Peras.Chain.html#4844" class="Datatype">ValidChain</a> <a id="3125" href="Peras.SmallStep.html#3101" class="Bound">c</a> <a id="3127" class="Symbol">→</a> <a id="3129" href="Peras.SmallStep.html#3023" class="Bound">T</a><a id="3130" class="Symbol">)</a>
                    <a id="3152" class="Symbol">(</a><a id="3153" href="Peras.SmallStep.html#3153" class="Bound">chains</a> <a id="3160" class="Symbol">:</a> <a id="3162" href="Peras.SmallStep.html#3023" class="Bound">T</a> <a id="3164" class="Symbol">→</a> <a id="3166" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3171" href="Peras.Chain.html#2532" class="Function">Chain</a><a id="3176" class="Symbol">)</a> <a id="3178" class="Comment">-- TODO: use Set instead of List</a>
                    <a id="3231" class="Symbol">(</a><a id="3232" href="Peras.SmallStep.html#3232" class="Bound">preferredChain</a> <a id="3247" class="Symbol">:</a> <a id="3249" href="Peras.SmallStep.html#3023" class="Bound">T</a> <a id="3251" class="Symbol">→</a> <a id="3253" href="Peras.Chain.html#2532" class="Function">Chain</a><a id="3258" class="Symbol">)</a>
                    <a id="3280" class="Symbol">(</a><a id="3281" href="Peras.SmallStep.html#3281" class="Bound">addVote</a> <a id="3289" class="Symbol">:</a> <a id="3291" href="Peras.SmallStep.html#3023" class="Bound">T</a> <a id="3293" class="Symbol">→</a> <a id="3295" class="Symbol">{</a><a id="3296" href="Peras.SmallStep.html#3296" class="Bound">v</a> <a id="3298" class="Symbol">:</a> <a id="3300" href="Peras.Chain.html#899" class="Record">Vote</a><a id="3304" class="Symbol">}</a> <a id="3306" class="Symbol">→</a> <a id="3308" href="Peras.Chain.html#2069" class="Function">ValidVote</a> <a id="3318" href="Peras.SmallStep.html#3296" class="Bound">v</a> <a id="3320" class="Symbol">→</a> <a id="3322" href="Peras.SmallStep.html#3023" class="Bound">T</a><a id="3323" class="Symbol">)</a>
                    <a id="3345" class="Symbol">(</a><a id="3346" href="Peras.SmallStep.html#3346" class="Bound">votes</a> <a id="3352" class="Symbol">:</a> <a id="3354" href="Peras.SmallStep.html#3023" class="Bound">T</a> <a id="3356" class="Symbol">→</a> <a id="3358" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3363" href="Peras.Chain.html#899" class="Record">Vote</a><a id="3367" class="Symbol">)</a> <a id="3369" class="Comment">-- TODO: use Set instead of List</a>
                    <a id="3422" class="Symbol">(</a><a id="3423" href="Peras.SmallStep.html#3423" class="Bound">certs</a> <a id="3429" class="Symbol">:</a> <a id="3431" href="Peras.SmallStep.html#3023" class="Bound">T</a> <a id="3433" class="Symbol">→</a> <a id="3435" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="3440" href="Peras.Block.html#2142" class="Record">Certificate</a><a id="3451" class="Symbol">)</a> <a id="3453" class="Comment">-- TODO: use Set instead of List</a>
                    <a id="3506" class="Symbol">(</a><a id="3507" href="Peras.SmallStep.html#3507" class="Bound">cert₀</a> <a id="3513" class="Symbol">:</a> <a id="3515" href="Peras.Block.html#2142" class="Record">Certificate</a><a id="3526" class="Symbol">)</a>
         <a id="3537" class="Symbol">:</a> <a id="3539" href="Agda.Primitive.html#388" class="Primitive">Set₁</a> <a id="3544" class="Keyword">where</a>

    <a id="3555" class="Keyword">field</a>
</pre>
Properties that must hold with respect to chains, certificates and
votes.
<pre class="Agda">      <a id="3653" href="Peras.SmallStep.html#3653" class="Field">instantiated</a> <a id="3666" class="Symbol">:</a>
        <a id="3676" href="Peras.SmallStep.html#3232" class="Bound">preferredChain</a> <a id="3691" href="Peras.SmallStep.html#3053" class="Bound">tree₀</a> <a id="3697" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3699" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

      <a id="3709" href="Peras.SmallStep.html#3709" class="Field">instantiated-certs</a> <a id="3728" class="Symbol">:</a>
        <a id="3738" href="Peras.SmallStep.html#3423" class="Bound">certs</a> <a id="3744" href="Peras.SmallStep.html#3053" class="Bound">tree₀</a> <a id="3750" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3752" href="Peras.SmallStep.html#3507" class="Bound">cert₀</a> <a id="3758" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3760" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

      <a id="3770" href="Peras.SmallStep.html#3770" class="Field">instantiated-votes</a> <a id="3789" class="Symbol">:</a>
        <a id="3799" href="Peras.SmallStep.html#3346" class="Bound">votes</a> <a id="3805" href="Peras.SmallStep.html#3053" class="Bound">tree₀</a> <a id="3811" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3813" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

      <a id="3823" href="Peras.SmallStep.html#3823" class="Field">extendable-votes</a> <a id="3840" class="Symbol">:</a> <a id="3842" class="Symbol">∀</a> <a id="3844" class="Symbol">(</a><a id="3845" href="Peras.SmallStep.html#3845" class="Bound">t</a> <a id="3847" class="Symbol">:</a> <a id="3849" href="Peras.SmallStep.html#3023" class="Bound">T</a><a id="3850" class="Symbol">)</a> <a id="3852" class="Symbol">{</a><a id="3853" href="Peras.SmallStep.html#3853" class="Bound">v</a> <a id="3855" class="Symbol">:</a> <a id="3857" href="Peras.Chain.html#899" class="Record">Vote</a><a id="3861" class="Symbol">}</a> <a id="3863" class="Symbol">(</a><a id="3864" href="Peras.SmallStep.html#3864" class="Bound">vv</a> <a id="3867" class="Symbol">:</a> <a id="3869" href="Peras.Chain.html#2069" class="Function">ValidVote</a> <a id="3879" href="Peras.SmallStep.html#3853" class="Bound">v</a><a id="3880" class="Symbol">)</a>
        <a id="3890" class="Symbol">→</a> <a id="3892" href="Peras.SmallStep.html#3853" class="Bound">v</a> <a id="3894" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="3896" href="Peras.SmallStep.html#3346" class="Bound">votes</a> <a id="3902" class="Symbol">(</a><a id="3903" href="Peras.SmallStep.html#3281" class="Bound">addVote</a> <a id="3911" href="Peras.SmallStep.html#3845" class="Bound">t</a> <a id="3913" href="Peras.SmallStep.html#3864" class="Bound">vv</a><a id="3915" class="Symbol">)</a>

      <a id="3924" href="Peras.SmallStep.html#3924" class="Field">extendable-chain</a> <a id="3941" class="Symbol">:</a> <a id="3943" class="Symbol">∀</a> <a id="3945" class="Symbol">(</a><a id="3946" href="Peras.SmallStep.html#3946" class="Bound">t</a> <a id="3948" class="Symbol">:</a> <a id="3950" href="Peras.SmallStep.html#3023" class="Bound">T</a><a id="3951" class="Symbol">)</a> <a id="3953" class="Symbol">{</a><a id="3954" href="Peras.SmallStep.html#3954" class="Bound">c</a> <a id="3956" class="Symbol">:</a> <a id="3958" href="Peras.Chain.html#2532" class="Function">Chain</a><a id="3963" class="Symbol">}</a> <a id="3965" class="Symbol">(</a><a id="3966" href="Peras.SmallStep.html#3966" class="Bound">vc</a> <a id="3969" class="Symbol">:</a> <a id="3971" href="Peras.Chain.html#4844" class="Datatype">ValidChain</a> <a id="3982" href="Peras.SmallStep.html#3954" class="Bound">c</a><a id="3983" class="Symbol">)</a>
        <a id="3993" class="Symbol">→</a> <a id="3995" href="Peras.SmallStep.html#3423" class="Bound">certs</a> <a id="4001" class="Symbol">(</a><a id="4002" href="Peras.SmallStep.html#3085" class="Bound">addChain</a> <a id="4011" href="Peras.SmallStep.html#3946" class="Bound">t</a> <a id="4013" href="Peras.SmallStep.html#3966" class="Bound">vc</a><a id="4015" class="Symbol">)</a> <a id="4017" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="4019" href="Haskell.Prim.Foldable.html#528" class="Field">foldr</a> <a id="4025" href="Peras.Chain.html#2726" class="Function">insertCert</a> <a id="4036" class="Symbol">(</a><a id="4037" href="Peras.SmallStep.html#3423" class="Bound">certs</a> <a id="4043" href="Peras.SmallStep.html#3946" class="Bound">t</a><a id="4044" class="Symbol">)</a> <a id="4046" class="Symbol">(</a><a id="4047" href="Peras.Chain.html#2594" class="Function">certsFromChain</a> <a id="4062" href="Peras.SmallStep.html#3954" class="Bound">c</a><a id="4063" class="Symbol">)</a>

      <a id="4072" href="Peras.SmallStep.html#4072" class="Field">self-contained-certs</a> <a id="4093" class="Symbol">:</a> <a id="4095" class="Symbol">∀</a> <a id="4097" class="Symbol">(</a><a id="4098" href="Peras.SmallStep.html#4098" class="Bound">t</a> <a id="4100" class="Symbol">:</a> <a id="4102" href="Peras.SmallStep.html#3023" class="Bound">T</a><a id="4103" class="Symbol">)</a> <a id="4105" class="Symbol">{</a><a id="4106" href="Peras.SmallStep.html#4106" class="Bound">c</a> <a id="4108" class="Symbol">:</a> <a id="4110" href="Peras.Chain.html#2532" class="Function">Chain</a><a id="4115" class="Symbol">}</a>
        <a id="4125" class="Symbol">→</a> <a id="4127" href="Peras.SmallStep.html#4106" class="Bound">c</a> <a id="4129" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="4131" href="Peras.SmallStep.html#3153" class="Bound">chains</a> <a id="4138" href="Peras.SmallStep.html#4098" class="Bound">t</a>
        <a id="4148" class="Symbol">→</a> <a id="4150" href="Peras.SmallStep.html#3423" class="Bound">certs</a> <a id="4156" href="Peras.SmallStep.html#4098" class="Bound">t</a> <a id="4158" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="4160" href="Haskell.Prim.Foldable.html#528" class="Field">foldr</a> <a id="4166" href="Peras.Chain.html#2726" class="Function">insertCert</a> <a id="4177" class="Symbol">(</a><a id="4178" href="Peras.SmallStep.html#3423" class="Bound">certs</a> <a id="4184" href="Peras.SmallStep.html#4098" class="Bound">t</a><a id="4185" class="Symbol">)</a> <a id="4187" class="Symbol">(</a><a id="4188" href="Peras.Chain.html#2594" class="Function">certsFromChain</a> <a id="4203" href="Peras.SmallStep.html#4106" class="Bound">c</a><a id="4204" class="Symbol">)</a>

      <a id="4213" href="Peras.SmallStep.html#4213" class="Field">valid</a> <a id="4219" class="Symbol">:</a> <a id="4221" class="Symbol">∀</a> <a id="4223" class="Symbol">(</a><a id="4224" href="Peras.SmallStep.html#4224" class="Bound">t</a> <a id="4226" class="Symbol">:</a> <a id="4228" href="Peras.SmallStep.html#3023" class="Bound">T</a><a id="4229" class="Symbol">)</a>
        <a id="4239" class="Symbol">→</a> <a id="4241" href="Peras.Chain.html#4844" class="Datatype">ValidChain</a> <a id="4252" class="Symbol">(</a><a id="4253" href="Peras.SmallStep.html#3232" class="Bound">preferredChain</a> <a id="4268" href="Peras.SmallStep.html#4224" class="Bound">t</a><a id="4269" class="Symbol">)</a>

      <a id="4278" href="Peras.SmallStep.html#4278" class="Field">optimal</a> <a id="4286" class="Symbol">:</a> <a id="4288" class="Symbol">∀</a> <a id="4290" class="Symbol">(</a><a id="4291" href="Peras.SmallStep.html#4291" class="Bound">c</a> <a id="4293" class="Symbol">:</a> <a id="4295" href="Peras.Chain.html#2532" class="Function">Chain</a><a id="4300" class="Symbol">)</a> <a id="4302" class="Symbol">(</a><a id="4303" href="Peras.SmallStep.html#4303" class="Bound">t</a> <a id="4305" class="Symbol">:</a> <a id="4307" href="Peras.SmallStep.html#3023" class="Bound">T</a><a id="4308" class="Symbol">)</a>
        <a id="4318" class="Symbol">→</a> <a id="4320" href="Peras.SmallStep.html#4291" class="Bound">c</a> <a id="4322" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="4324" href="Peras.SmallStep.html#3153" class="Bound">chains</a> <a id="4331" href="Peras.SmallStep.html#4303" class="Bound">t</a>
        <a id="4341" class="Symbol">→</a> <a id="4343" href="Peras.Chain.html#4185" class="Function">weight</a> <a id="4350" href="Peras.SmallStep.html#4291" class="Bound">c</a> <a id="4352" class="Symbol">(</a><a id="4353" href="Peras.SmallStep.html#3423" class="Bound">certs</a> <a id="4359" href="Peras.SmallStep.html#4303" class="Bound">t</a><a id="4360" class="Symbol">)</a> <a id="4362" href="Data.Nat.Base.html#1691" class="Datatype Operator">≤</a> <a id="4364" href="Peras.Chain.html#4185" class="Function">weight</a> <a id="4371" class="Symbol">(</a><a id="4372" href="Peras.SmallStep.html#3232" class="Bound">preferredChain</a> <a id="4387" href="Peras.SmallStep.html#4303" class="Bound">t</a><a id="4388" class="Symbol">)</a> <a id="4390" class="Symbol">(</a><a id="4391" href="Peras.SmallStep.html#3423" class="Bound">certs</a> <a id="4397" href="Peras.SmallStep.html#4303" class="Bound">t</a><a id="4398" class="Symbol">)</a>

      <a id="4407" href="Peras.SmallStep.html#4407" class="Field">self-contained</a> <a id="4422" class="Symbol">:</a> <a id="4424" class="Symbol">∀</a> <a id="4426" class="Symbol">(</a><a id="4427" href="Peras.SmallStep.html#4427" class="Bound">t</a> <a id="4429" class="Symbol">:</a> <a id="4431" href="Peras.SmallStep.html#3023" class="Bound">T</a><a id="4432" class="Symbol">)</a>
        <a id="4442" class="Symbol">→</a> <a id="4444" href="Peras.SmallStep.html#3232" class="Bound">preferredChain</a> <a id="4459" href="Peras.SmallStep.html#4427" class="Bound">t</a> <a id="4461" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="4463" href="Peras.SmallStep.html#3153" class="Bound">chains</a> <a id="4470" href="Peras.SmallStep.html#4427" class="Bound">t</a>
<a id="4472" class="Comment">{-
      -- TODO: use Set instead of List for votes
      unique-votes : ∀ (t : T) {v : Vote} (vv : ValidVote v)
        → v ∈ votes t
        → votes t ≡ votes (addVote t vv)

      -- TODO: use Set with `equivocation` as equivalence relation for votes
      no-equivocations : ∀ (t : T) {v : Vote} (vv : ValidVote v)
        → Any (v ∻_) (votes t)
        → votes t ≡ votes (addVote t vv)
-}</a>
      <a id="4872" href="Peras.SmallStep.html#4872" class="Field">quorum-cert</a> <a id="4884" class="Symbol">:</a> <a id="4886" class="Symbol">∀</a> <a id="4888" class="Symbol">(</a><a id="4889" href="Peras.SmallStep.html#4889" class="Bound">t</a> <a id="4891" class="Symbol">:</a> <a id="4893" href="Peras.SmallStep.html#3023" class="Bound">T</a><a id="4894" class="Symbol">)</a> <a id="4896" class="Symbol">(</a><a id="4897" href="Peras.SmallStep.html#4897" class="Bound">b</a> <a id="4899" class="Symbol">:</a> <a id="4901" href="Peras.Block.html#2100" class="Record">Block</a><a id="4906" class="Symbol">)</a> <a id="4908" class="Symbol">(</a><a id="4909" href="Peras.SmallStep.html#4909" class="Bound">r</a> <a id="4911" class="Symbol">:</a> <a id="4913" href="Agda.Builtin.Nat.html#203" class="Datatype">Nat</a><a id="4916" class="Symbol">)</a>
        <a id="4926" class="Symbol">→</a> <a id="4928" href="Data.List.Base.html#5083" class="Function">L.length</a>
            <a id="4949" class="Symbol">(</a><a id="4950" href="Haskell.Prim.List.html#419" class="Function">filter</a> <a id="4957" class="Symbol">(λ</a> <a id="4960" class="Symbol">{</a><a id="4961" href="Peras.SmallStep.html#4961" class="Bound">v</a> <a id="4963" class="Symbol">→</a>
                    <a id="4985" class="Symbol">(</a><a id="4986" href="Peras.Numbering.html#2022" class="Field">getRoundNumber</a> <a id="5001" class="Symbol">(</a><a id="5002" href="Peras.Chain.html#945" class="Field">votingRound</a> <a id="5014" href="Peras.SmallStep.html#4961" class="Bound">v</a><a id="5015" class="Symbol">)</a> <a id="5017" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="5020" href="Peras.SmallStep.html#4909" class="Bound">r</a><a id="5021" class="Symbol">)</a>
                 <a id="5040" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="5043" class="Symbol">(</a><a id="5044" href="Peras.Chain.html#1047" class="Field">blockHash</a> <a id="5054" href="Peras.SmallStep.html#4961" class="Bound">v</a> <a id="5056" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="5059" href="Peras.Crypto.html#2326" class="Field">hash</a> <a id="5064" href="Peras.SmallStep.html#4897" class="Bound">b</a><a id="5065" class="Symbol">)}</a>
            <a id="5080" class="Symbol">)</a> <a id="5082" class="Symbol">(</a><a id="5083" href="Peras.SmallStep.html#3346" class="Bound">votes</a> <a id="5089" href="Peras.SmallStep.html#4889" class="Bound">t</a><a id="5090" class="Symbol">))</a> <a id="5093" href="Data.Nat.Base.html#2259" class="Function Operator">≥</a> <a id="5095" href="Peras.Params.html#263" class="Field">τ</a>
        <a id="5105" class="Symbol">→</a> <a id="5107" href="Haskell.Prim.html#2981" class="Datatype">Any</a> <a id="5111" class="Symbol">(λ</a> <a id="5114" class="Symbol">{</a><a id="5115" href="Peras.SmallStep.html#5115" class="Bound">c</a> <a id="5117" class="Symbol">→</a>
            <a id="5131" class="Symbol">(</a><a id="5132" href="Peras.Numbering.html#2022" class="Field">getRoundNumber</a> <a id="5147" class="Symbol">(</a><a id="5148" href="Peras.Block.html#2251" class="Field">round</a> <a id="5154" href="Peras.SmallStep.html#5115" class="Bound">c</a><a id="5155" class="Symbol">)</a> <a id="5157" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5159" href="Peras.SmallStep.html#4909" class="Bound">r</a><a id="5160" class="Symbol">)</a>
          <a id="5172" href="Haskell.Prim.Tuple.html#169" class="Record Operator">×</a> <a id="5174" class="Symbol">(</a><a id="5175" href="Peras.Block.html#2279" class="Field">blockRef</a> <a id="5184" href="Peras.SmallStep.html#5115" class="Bound">c</a> <a id="5186" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5188" href="Peras.Crypto.html#2326" class="Field">hash</a> <a id="5193" href="Peras.SmallStep.html#4897" class="Bound">b</a><a id="5194" class="Symbol">)</a> <a id="5196" class="Symbol">})</a> <a id="5199" class="Symbol">(</a><a id="5200" href="Peras.SmallStep.html#3423" class="Bound">certs</a> <a id="5206" href="Peras.SmallStep.html#4889" class="Bound">t</a><a id="5207" class="Symbol">)</a>
</pre>
In addition to chains the block-tree manages votes and certificates as
well. The block-tree type is defined as follows:
<pre class="Agda">  <a id="5343" class="Keyword">record</a> <a id="5350" href="Peras.SmallStep.html#5350" class="Record">TreeType</a> <a id="5359" class="Symbol">(</a><a id="5360" href="Peras.SmallStep.html#5360" class="Bound">T</a> <a id="5362" class="Symbol">:</a> <a id="5364" href="Agda.Primitive.html#388" class="Primitive">Set</a><a id="5367" class="Symbol">)</a> <a id="5369" class="Symbol">:</a> <a id="5371" href="Agda.Primitive.html#388" class="Primitive">Set₁</a> <a id="5376" class="Keyword">where</a>

    <a id="5387" class="Keyword">field</a>
      <a id="5399" href="Peras.SmallStep.html#5399" class="Field">tree₀</a> <a id="5405" class="Symbol">:</a> <a id="5407" href="Peras.SmallStep.html#5360" class="Bound">T</a>

      <a id="5416" href="Peras.SmallStep.html#5416" class="Field">addChain</a> <a id="5425" class="Symbol">:</a> <a id="5427" href="Peras.SmallStep.html#5360" class="Bound">T</a> <a id="5429" class="Symbol">→</a> <a id="5431" class="Symbol">{</a><a id="5432" href="Peras.SmallStep.html#5432" class="Bound">c</a> <a id="5434" class="Symbol">:</a> <a id="5436" href="Peras.Chain.html#2532" class="Function">Chain</a><a id="5441" class="Symbol">}</a> <a id="5443" class="Symbol">→</a> <a id="5445" href="Peras.Chain.html#4844" class="Datatype">ValidChain</a> <a id="5456" href="Peras.SmallStep.html#5432" class="Bound">c</a> <a id="5458" class="Symbol">→</a> <a id="5460" href="Peras.SmallStep.html#5360" class="Bound">T</a>
      <a id="5468" href="Peras.SmallStep.html#5468" class="Field">chains</a> <a id="5475" class="Symbol">:</a> <a id="5477" href="Peras.SmallStep.html#5360" class="Bound">T</a> <a id="5479" class="Symbol">→</a> <a id="5481" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5486" href="Peras.Chain.html#2532" class="Function">Chain</a>
      <a id="5498" href="Peras.SmallStep.html#5498" class="Field">preferredChain</a> <a id="5513" class="Symbol">:</a> <a id="5515" href="Peras.SmallStep.html#5360" class="Bound">T</a> <a id="5517" class="Symbol">→</a> <a id="5519" href="Peras.Chain.html#2532" class="Function">Chain</a>

      <a id="5532" href="Peras.SmallStep.html#5532" class="Field">addVote</a> <a id="5540" class="Symbol">:</a> <a id="5542" href="Peras.SmallStep.html#5360" class="Bound">T</a> <a id="5544" class="Symbol">→</a> <a id="5546" class="Symbol">{</a><a id="5547" href="Peras.SmallStep.html#5547" class="Bound">v</a> <a id="5549" class="Symbol">:</a> <a id="5551" href="Peras.Chain.html#899" class="Record">Vote</a><a id="5555" class="Symbol">}</a> <a id="5557" class="Symbol">→</a> <a id="5559" href="Peras.Chain.html#2069" class="Function">ValidVote</a> <a id="5569" href="Peras.SmallStep.html#5547" class="Bound">v</a> <a id="5571" class="Symbol">→</a> <a id="5573" href="Peras.SmallStep.html#5360" class="Bound">T</a>
      <a id="5581" href="Peras.SmallStep.html#5581" class="Field">votes</a> <a id="5587" class="Symbol">:</a> <a id="5589" href="Peras.SmallStep.html#5360" class="Bound">T</a> <a id="5591" class="Symbol">→</a> <a id="5593" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5598" href="Peras.Chain.html#899" class="Record">Vote</a>

      <a id="5610" href="Peras.SmallStep.html#5610" class="Field">certs</a> <a id="5616" class="Symbol">:</a> <a id="5618" href="Peras.SmallStep.html#5360" class="Bound">T</a> <a id="5620" class="Symbol">→</a> <a id="5622" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5627" href="Peras.Block.html#2142" class="Record">Certificate</a>

      <a id="5646" href="Peras.SmallStep.html#5646" class="Field">is-TreeType</a> <a id="5658" class="Symbol">:</a> <a id="5660" href="Peras.SmallStep.html#3011" class="Record">IsTreeType</a>
                      <a id="5693" href="Peras.SmallStep.html#5399" class="Field">tree₀</a> <a id="5699" href="Peras.SmallStep.html#5416" class="Field">addChain</a> <a id="5708" href="Peras.SmallStep.html#5468" class="Field">chains</a> <a id="5715" href="Peras.SmallStep.html#5498" class="Field">preferredChain</a>
                      <a id="5752" href="Peras.SmallStep.html#5532" class="Field">addVote</a> <a id="5760" href="Peras.SmallStep.html#5581" class="Field">votes</a> <a id="5766" href="Peras.SmallStep.html#5610" class="Field">certs</a> <a id="5772" href="Peras.Chain.html#3222" class="Function">cert₀</a>

    <a id="5783" href="Peras.SmallStep.html#5783" class="Function">latestCertOnChain</a> <a id="5801" class="Symbol">:</a> <a id="5803" href="Peras.SmallStep.html#5360" class="Bound">T</a> <a id="5805" class="Symbol">→</a> <a id="5807" href="Peras.Block.html#2142" class="Record">Certificate</a>
    <a id="5823" href="Peras.SmallStep.html#5783" class="Function">latestCertOnChain</a> <a id="5841" class="Symbol">=</a>
      <a id="5849" href="Peras.Block.html#2385" class="Function">latestCert</a> <a id="5860" href="Peras.Chain.html#3222" class="Function">cert₀</a> <a id="5866" href="Haskell.Prim.html#1330" class="Function Operator">∘</a> <a id="5868" href="Peras.Util.html#1416" class="Function">mapMaybe</a> <a id="5877" href="Peras.Block.html#2631" class="Field">certificate</a> <a id="5889" href="Haskell.Prim.html#1330" class="Function Operator">∘</a> <a id="5891" href="Peras.SmallStep.html#5498" class="Field">preferredChain</a>

    <a id="5911" href="Peras.SmallStep.html#5911" class="Function">latestCertSeen</a> <a id="5926" class="Symbol">:</a> <a id="5928" href="Peras.SmallStep.html#5360" class="Bound">T</a> <a id="5930" class="Symbol">→</a> <a id="5932" href="Peras.Block.html#2142" class="Record">Certificate</a>
    <a id="5948" href="Peras.SmallStep.html#5911" class="Function">latestCertSeen</a> <a id="5963" class="Symbol">=</a> <a id="5965" href="Peras.Block.html#2385" class="Function">latestCert</a> <a id="5976" href="Peras.Chain.html#3222" class="Function">cert₀</a> <a id="5982" href="Haskell.Prim.html#1330" class="Function Operator">∘</a> <a id="5984" href="Peras.SmallStep.html#5610" class="Field">certs</a>

    <a id="5995" href="Peras.SmallStep.html#5995" class="Function">hasCert</a> <a id="6003" class="Symbol">:</a> <a id="6005" href="Peras.Numbering.html#1962" class="Record">RoundNumber</a> <a id="6017" class="Symbol">→</a> <a id="6019" href="Peras.SmallStep.html#5360" class="Bound">T</a> <a id="6021" class="Symbol">→</a> <a id="6023" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="6031" href="Peras.SmallStep.html#5995" class="Function">hasCert</a> <a id="6039" class="Symbol">(</a><a id="6040" href="Peras.Numbering.html#2000" class="InductiveConstructor">MkRoundNumber</a> <a id="6054" href="Peras.SmallStep.html#6054" class="Bound">r</a><a id="6055" class="Symbol">)</a> <a id="6057" href="Peras.SmallStep.html#6057" class="Bound">t</a> <a id="6059" class="Symbol">=</a> <a id="6061" href="Haskell.Prim.html#2981" class="Datatype">Any</a> <a id="6065" class="Symbol">(λ</a> <a id="6068" href="Peras.SmallStep.html#6068" class="Bound">c</a> <a id="6070" class="Symbol">→</a> <a id="6072" href="Peras.SmallStep.html#6054" class="Bound">r</a> <a id="6074" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6076" href="Peras.Block.html#2304" class="Function">roundNumber</a> <a id="6088" href="Peras.SmallStep.html#6068" class="Bound">c</a><a id="6089" class="Symbol">)</a> <a id="6091" class="Symbol">(</a><a id="6092" href="Peras.SmallStep.html#5610" class="Field">certs</a> <a id="6098" href="Peras.SmallStep.html#6057" class="Bound">t</a><a id="6099" class="Symbol">)</a>

    <a id="6106" href="Peras.SmallStep.html#6106" class="Function">hasVote</a> <a id="6114" class="Symbol">:</a> <a id="6116" href="Peras.Numbering.html#1962" class="Record">RoundNumber</a> <a id="6128" class="Symbol">→</a> <a id="6130" href="Peras.SmallStep.html#5360" class="Bound">T</a> <a id="6132" class="Symbol">→</a> <a id="6134" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="6142" href="Peras.SmallStep.html#6106" class="Function">hasVote</a> <a id="6150" class="Symbol">(</a><a id="6151" href="Peras.Numbering.html#2000" class="InductiveConstructor">MkRoundNumber</a> <a id="6165" href="Peras.SmallStep.html#6165" class="Bound">r</a><a id="6166" class="Symbol">)</a> <a id="6168" href="Peras.SmallStep.html#6168" class="Bound">t</a> <a id="6170" class="Symbol">=</a> <a id="6172" href="Haskell.Prim.html#2981" class="Datatype">Any</a> <a id="6176" class="Symbol">(λ</a> <a id="6179" href="Peras.SmallStep.html#6179" class="Bound">v</a> <a id="6181" class="Symbol">→</a> <a id="6183" href="Peras.SmallStep.html#6165" class="Bound">r</a> <a id="6185" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6187" href="Peras.Chain.html#1107" class="Function">votingRound&#39;</a> <a id="6200" href="Peras.SmallStep.html#6179" class="Bound">v</a><a id="6201" class="Symbol">)</a> <a id="6203" class="Symbol">(</a><a id="6204" href="Peras.SmallStep.html#5581" class="Field">votes</a> <a id="6210" href="Peras.SmallStep.html#6168" class="Bound">t</a><a id="6211" class="Symbol">)</a>

    <a id="6218" href="Peras.SmallStep.html#6218" class="Function">allBlocks</a> <a id="6228" class="Symbol">:</a> <a id="6230" href="Peras.SmallStep.html#5360" class="Bound">T</a> <a id="6232" class="Symbol">→</a> <a id="6234" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6239" href="Peras.Block.html#2100" class="Record">Block</a>
    <a id="6249" href="Peras.SmallStep.html#6218" class="Function">allBlocks</a> <a id="6259" class="Symbol">=</a> <a id="6261" href="Haskell.Prim.Foldable.html#741" class="Field">concat</a> <a id="6268" href="Haskell.Prim.html#1330" class="Function Operator">∘</a> <a id="6270" href="Peras.SmallStep.html#5468" class="Field">chains</a>

    <a id="6282" class="Keyword">postulate</a> <a id="6292" class="Comment">-- TODO: any t is constructed based on tree₀</a>
              <a id="6351" class="Comment">--       using addVote, addChain and tree₀</a>
              <a id="6408" class="Comment">--       contains cert₀ (see instantiated-certs above)</a>
      <a id="6469" href="Peras.SmallStep.html#6469" class="Postulate">latestCertSeen∈certs</a> <a id="6490" class="Symbol">:</a> <a id="6492" class="Symbol">∀</a> <a id="6494" href="Peras.SmallStep.html#6494" class="Bound">t</a> <a id="6496" class="Symbol">→</a> <a id="6498" href="Peras.SmallStep.html#5911" class="Function">latestCertSeen</a> <a id="6513" href="Peras.SmallStep.html#6494" class="Bound">t</a> <a id="6515" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="6517" href="Peras.SmallStep.html#5610" class="Field">certs</a> <a id="6523" href="Peras.SmallStep.html#6494" class="Bound">t</a>
</pre>
<h3 id="additional-parameters">Additional parameters</h3>
<p>In order to define the semantics the following parameters are
required additionally:</p>
<ul>
<li>The type of the block-tree</li>
<li>adversarialState₀ is the initial adversarial state</li>
<li>Tx selection function per party and slot number</li>
<li>The list of parties
<pre class="Agda">  <a id="6814" class="Keyword">module</a> <a id="6821" href="Peras.SmallStep.html#6821" class="Module">Semantics</a>
       <a id="6842" class="Symbol">{</a><a id="6843" href="Peras.SmallStep.html#6843" class="Bound">T</a> <a id="6845" class="Symbol">:</a> <a id="6847" href="Agda.Primitive.html#388" class="Primitive">Set</a><a id="6850" class="Symbol">}</a> <a id="6852" class="Symbol">{</a><a id="6853" href="Peras.SmallStep.html#6853" class="Bound">blockTree</a> <a id="6863" class="Symbol">:</a> <a id="6865" href="Peras.SmallStep.html#5350" class="Record">TreeType</a> <a id="6874" href="Peras.SmallStep.html#6843" class="Bound">T</a><a id="6875" class="Symbol">}</a>
       <a id="6888" class="Symbol">{</a><a id="6889" href="Peras.SmallStep.html#6889" class="Bound">S</a> <a id="6891" class="Symbol">:</a> <a id="6893" href="Agda.Primitive.html#388" class="Primitive">Set</a><a id="6896" class="Symbol">}</a> <a id="6898" class="Symbol">{</a><a id="6899" href="Peras.SmallStep.html#6899" class="Bound">adversarialState₀</a> <a id="6917" class="Symbol">:</a> <a id="6919" href="Peras.SmallStep.html#6889" class="Bound">S</a><a id="6920" class="Symbol">}</a>
       <a id="6933" class="Symbol">{</a><a id="6934" href="Peras.SmallStep.html#6934" class="Bound">txSelection</a> <a id="6946" class="Symbol">:</a> <a id="6948" href="Peras.Numbering.html#1035" class="Record">SlotNumber</a> <a id="6959" class="Symbol">→</a> <a id="6961" href="Peras.Block.html#842" class="Function">PartyId</a> <a id="6969" class="Symbol">→</a> <a id="6971" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="6976" href="Peras.Block.html#1622" class="Function">Tx</a><a id="6978" class="Symbol">}</a>
       <a id="6991" class="Symbol">{</a><a id="6992" href="Peras.SmallStep.html#6992" class="Bound">parties</a> <a id="7000" class="Symbol">:</a> <a id="7002" href="Peras.Block.html#1568" class="Function">Parties</a><a id="7009" class="Symbol">}</a> <a id="7011" class="Comment">-- TODO: use parties from blockTrees</a>
                           <a id="7079" class="Comment">-- i.e. allow dynamic participation</a>
       <a id="7126" class="Keyword">where</a>

<a id="7137" class="Keyword">open</a> <a id="7142" href="Peras.SmallStep.html#5350" class="Module">TreeType</a> <a id="7151" href="Peras.SmallStep.html#6853" class="Bound">blockTree</a>

<a id="7166" class="Keyword">private</a>
  <a id="7180" class="Keyword">instance</a>
    <a id="7197" href="Peras.SmallStep.html#7197" class="Function">Default-T</a> <a id="7207" class="Symbol">:</a> <a id="7209" href="Prelude.Default.html#100" class="Record">Default</a> <a id="7217" href="Peras.SmallStep.html#6843" class="Bound">T</a>
    <a id="7227" href="Peras.SmallStep.html#7197" class="Function">Default-T</a> <a id="7237" class="Symbol">.</a><a id="7238" href="Prelude.Default.html#140" class="Field">def</a> <a id="7242" class="Symbol">=</a> <a id="7244" href="Peras.SmallStep.html#5399" class="Function">tree₀</a>
</pre>
<h4 id="block-tree-update">Block-tree update</h4></li>
</ul>
<p>Updating the block-tree upon receiving a message for vote and chain
messages.</p>
<pre class="Agda">    <a id="7369" class="Keyword">data</a> <a id="7374" href="Peras.SmallStep.html#7374" class="Datatype Operator">_[_]→_</a> <a id="7381" class="Symbol">:</a> <a id="7383" href="Peras.SmallStep.html#6843" class="Bound">T</a> <a id="7385" class="Symbol">→</a> <a id="7387" href="Peras.SmallStep.html#2281" class="Datatype">Message</a> <a id="7395" class="Symbol">→</a> <a id="7397" href="Peras.SmallStep.html#6843" class="Bound">T</a> <a id="7399" class="Symbol">→</a> <a id="7401" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="7405" class="Keyword">where</a>

      <a id="7418" href="Peras.SmallStep.html#7418" class="InductiveConstructor">VoteReceived</a> <a id="7431" class="Symbol">:</a> <a id="7433" class="Symbol">∀</a> <a id="7435" class="Symbol">{</a><a id="7436" href="Peras.SmallStep.html#7436" class="Bound">v</a> <a id="7438" href="Peras.SmallStep.html#7438" class="Bound">vv</a> <a id="7441" href="Peras.SmallStep.html#7441" class="Bound">t</a><a id="7442" class="Symbol">}</a> <a id="7444" class="Symbol">→</a>
          <a id="7456" href="Prelude.InferenceRules.html#45702" class="Function Operator">────────────────────────────</a>
          <a id="7495" href="Peras.SmallStep.html#7441" class="Bound">t</a> <a id="7497" href="Peras.SmallStep.html#7374" class="Datatype Operator">[</a> <a id="7499" href="Peras.SmallStep.html#2357" class="InductiveConstructor">VoteMsg</a> <a id="7507" class="Symbol">{</a><a id="7508" href="Peras.SmallStep.html#7436" class="Bound">v</a><a id="7509" class="Symbol">}</a> <a id="7511" href="Peras.SmallStep.html#7438" class="Bound">vv</a> <a id="7514" href="Peras.SmallStep.html#7374" class="Datatype Operator">]→</a> <a id="7517" href="Peras.SmallStep.html#5532" class="Function">addVote</a> <a id="7525" href="Peras.SmallStep.html#7441" class="Bound">t</a> <a id="7527" href="Peras.SmallStep.html#7438" class="Bound">vv</a>

      <a id="7537" href="Peras.SmallStep.html#7537" class="InductiveConstructor">ChainReceived</a> <a id="7551" class="Symbol">:</a> <a id="7553" class="Symbol">∀</a> <a id="7555" class="Symbol">{</a><a id="7556" href="Peras.SmallStep.html#7556" class="Bound">c</a> <a id="7558" href="Peras.SmallStep.html#7558" class="Bound">vc</a> <a id="7561" href="Peras.SmallStep.html#7561" class="Bound">t</a><a id="7562" class="Symbol">}</a> <a id="7564" class="Symbol">→</a>
          <a id="7576" href="Prelude.InferenceRules.html#45468" class="Function Operator">──────────────────────────────</a>
          <a id="7617" href="Peras.SmallStep.html#7561" class="Bound">t</a> <a id="7619" href="Peras.SmallStep.html#7374" class="Datatype Operator">[</a> <a id="7621" href="Peras.SmallStep.html#2305" class="InductiveConstructor">ChainMsg</a> <a id="7630" class="Symbol">{</a><a id="7631" href="Peras.SmallStep.html#7556" class="Bound">c</a><a id="7632" class="Symbol">}</a> <a id="7634" href="Peras.SmallStep.html#7558" class="Bound">vc</a> <a id="7637" href="Peras.SmallStep.html#7374" class="Datatype Operator">]→</a> <a id="7640" href="Peras.SmallStep.html#5416" class="Function">addChain</a> <a id="7649" href="Peras.SmallStep.html#7561" class="Bound">t</a> <a id="7651" href="Peras.SmallStep.html#7558" class="Bound">vc</a>
</pre>
<h4 id="vote-in-round">Vote in round</h4>
<p>When does a party vote in a round? The protocol expects regular
voting, i.e. if in the previous round a quorum has been achieved or that
voting resumes after a cool-down phase.</p>
<h4 id="blockselection">BlockSelection</h4>
Block selection is to decide on which block to vote for.
<pre class="Agda">    <a id="7946" href="Peras.SmallStep.html#7946" class="Function">BlockSelection&#39;</a> <a id="7962" class="Symbol">:</a> <a id="7964" href="Peras.Numbering.html#1035" class="Record">SlotNumber</a> <a id="7975" class="Symbol">→</a> <a id="7977" href="Peras.Chain.html#2532" class="Function">Chain</a> <a id="7983" class="Symbol">→</a> <a id="7985" href="Peras.Crypto.html#1835" class="Record">Hash</a> <a id="7990" href="Peras.Block.html#2100" class="Record">Block</a>
    <a id="8000" href="Peras.SmallStep.html#7946" class="Function">BlockSelection&#39;</a> <a id="8016" class="Symbol">(</a><a id="8017" href="Peras.Numbering.html#1072" class="InductiveConstructor">MkSlotNumber</a> <a id="8030" href="Peras.SmallStep.html#8030" class="Bound">s</a><a id="8031" class="Symbol">)</a> <a id="8033" class="Symbol">=</a> <a id="8035" href="Peras.Block.html#4809" class="Function">tipHash</a> <a id="8043" href="Haskell.Prim.html#1330" class="Function Operator">∘</a> <a id="8045" href="Haskell.Prim.List.html#419" class="Function">filter</a> <a id="8052" class="Symbol">(λ</a> <a id="8055" class="Symbol">{</a><a id="8056" href="Peras.SmallStep.html#8056" class="Bound">b</a> <a id="8058" class="Symbol">→</a> <a id="8060" class="Symbol">(</a><a id="8061" href="Peras.Block.html#2770" class="Function">slotNumber&#39;</a> <a id="8073" href="Peras.SmallStep.html#8056" class="Bound">b</a><a id="8074" class="Symbol">)</a> <a id="8076" href="Haskell.Prim.Num.html#547" class="Field Operator">+</a> <a id="8078" href="Peras.Params.html#235" class="Field">L</a> <a id="8080" href="Haskell.Prim.Ord.html#1144" class="Field Operator">&lt;=</a> <a id="8083" href="Peras.SmallStep.html#8030" class="Bound">s</a><a id="8084" class="Symbol">})</a>

    <a id="8092" href="Peras.SmallStep.html#8092" class="Function">BlockSelection</a> <a id="8107" class="Symbol">:</a> <a id="8109" href="Peras.Numbering.html#1035" class="Record">SlotNumber</a> <a id="8120" class="Symbol">→</a> <a id="8122" href="Peras.SmallStep.html#6843" class="Bound">T</a> <a id="8124" class="Symbol">→</a> <a id="8126" href="Peras.Crypto.html#1835" class="Record">Hash</a> <a id="8131" href="Peras.Block.html#2100" class="Record">Block</a>
    <a id="8141" href="Peras.SmallStep.html#8092" class="Function">BlockSelection</a> <a id="8156" href="Peras.SmallStep.html#8156" class="Bound">s</a> <a id="8158" class="Symbol">=</a> <a id="8160" href="Peras.SmallStep.html#7946" class="Function">BlockSelection&#39;</a> <a id="8176" href="Peras.SmallStep.html#8156" class="Bound">s</a> <a id="8178" href="Haskell.Prim.html#1330" class="Function Operator">∘</a> <a id="8180" href="Peras.SmallStep.html#5498" class="Function">preferredChain</a>
</pre>
<h4 id="voting-rules">Voting rules</h4>
VR-1A: A party has seen a certificate <code>cert-r−1</code> for round
<code>r−1</code>
<pre class="Agda">    <a id="8295" href="Peras.SmallStep.html#8295" class="Function">VotingRule-1A</a> <a id="8309" class="Symbol">:</a> <a id="8311" href="Peras.Numbering.html#1962" class="Record">RoundNumber</a> <a id="8323" class="Symbol">→</a> <a id="8325" href="Peras.SmallStep.html#6843" class="Bound">T</a> <a id="8327" class="Symbol">→</a> <a id="8329" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="8337" href="Peras.SmallStep.html#8295" class="Function">VotingRule-1A</a> <a id="8351" href="Peras.SmallStep.html#8351" class="Bound">r</a> <a id="8353" href="Peras.SmallStep.html#8353" class="Bound">t</a> <a id="8355" class="Symbol">=</a> <a id="8357" href="Peras.SmallStep.html#8351" class="Bound">r</a> <a id="8359" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="8361" href="Peras.Numbering.html#3684" class="Function">nextRound</a> <a id="8371" class="Symbol">(</a><a id="8372" href="Peras.Block.html#2251" class="Field">round</a> <a id="8378" class="Symbol">(</a><a id="8379" href="Peras.SmallStep.html#5911" class="Function">latestCertSeen</a> <a id="8394" href="Peras.SmallStep.html#8353" class="Bound">t</a><a id="8395" class="Symbol">))</a>
</pre>
VR-1B: The extends the block certified by <code>cert-r−1</code>,
<pre class="Agda">    <a id="8469" href="Peras.SmallStep.html#8469" class="Function">VotingRule-1B</a> <a id="8483" class="Symbol">:</a> <a id="8485" href="Peras.Numbering.html#1035" class="Record">SlotNumber</a> <a id="8496" class="Symbol">→</a> <a id="8498" href="Peras.SmallStep.html#6843" class="Bound">T</a> <a id="8500" class="Symbol">→</a> <a id="8502" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="8510" href="Peras.SmallStep.html#8469" class="Function">VotingRule-1B</a> <a id="8524" href="Peras.SmallStep.html#8524" class="Bound">s</a> <a id="8526" href="Peras.SmallStep.html#8526" class="Bound">t</a> <a id="8528" class="Symbol">=</a> <a id="8530" href="Peras.Chain.html#3484" class="Function">Extends</a> <a id="8538" class="Symbol">(</a><a id="8539" href="Peras.SmallStep.html#8092" class="Function">BlockSelection</a> <a id="8554" href="Peras.SmallStep.html#8524" class="Bound">s</a> <a id="8556" href="Peras.SmallStep.html#8526" class="Bound">t</a><a id="8557" class="Symbol">)</a> <a id="8559" class="Symbol">(</a><a id="8560" href="Peras.SmallStep.html#5911" class="Function">latestCertSeen</a> <a id="8575" href="Peras.SmallStep.html#8526" class="Bound">t</a><a id="8576" class="Symbol">)</a> <a id="8578" class="Symbol">(</a><a id="8579" href="Peras.SmallStep.html#5468" class="Function">chains</a> <a id="8586" href="Peras.SmallStep.html#8526" class="Bound">t</a><a id="8587" class="Symbol">)</a>
</pre>
VR-1: Both VR-1A and VR-1B hold
<pre class="Agda">    <a id="8637" href="Peras.SmallStep.html#8637" class="Function">VotingRule-1</a> <a id="8650" class="Symbol">:</a> <a id="8652" href="Peras.Numbering.html#1035" class="Record">SlotNumber</a> <a id="8663" class="Symbol">→</a> <a id="8665" href="Peras.SmallStep.html#6843" class="Bound">T</a> <a id="8667" class="Symbol">→</a> <a id="8669" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="8677" href="Peras.SmallStep.html#8637" class="Function">VotingRule-1</a> <a id="8690" href="Peras.SmallStep.html#8690" class="Bound">s</a> <a id="8692" href="Peras.SmallStep.html#8692" class="Bound">t</a> <a id="8694" class="Symbol">=</a>
        <a id="8704" href="Peras.SmallStep.html#8295" class="Function">VotingRule-1A</a> <a id="8718" class="Symbol">(</a><a id="8719" href="Peras.Chain.html#3997" class="Function">v-round</a> <a id="8727" href="Peras.SmallStep.html#8690" class="Bound">s</a><a id="8728" class="Symbol">)</a> <a id="8730" href="Peras.SmallStep.html#8692" class="Bound">t</a>
      <a id="8738" href="Haskell.Prim.Tuple.html#169" class="Record Operator">×</a> <a id="8740" href="Peras.SmallStep.html#8469" class="Function">VotingRule-1B</a> <a id="8754" href="Peras.SmallStep.html#8690" class="Bound">s</a> <a id="8756" href="Peras.SmallStep.html#8692" class="Bound">t</a>
</pre>
VR-2A: The last certificate a party has seen is from a round at least R
rounds back
<pre class="Agda">    <a id="8858" href="Peras.SmallStep.html#8858" class="Function">VotingRule-2A</a> <a id="8872" class="Symbol">:</a> <a id="8874" href="Peras.Numbering.html#1962" class="Record">RoundNumber</a> <a id="8886" class="Symbol">→</a> <a id="8888" href="Peras.SmallStep.html#6843" class="Bound">T</a> <a id="8890" class="Symbol">→</a> <a id="8892" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="8900" href="Peras.SmallStep.html#8858" class="Function">VotingRule-2A</a> <a id="8914" class="Symbol">(</a><a id="8915" href="Peras.Numbering.html#2000" class="InductiveConstructor">MkRoundNumber</a> <a id="8929" href="Peras.SmallStep.html#8929" class="Bound">r</a><a id="8930" class="Symbol">)</a> <a id="8932" href="Peras.SmallStep.html#8932" class="Bound">t</a> <a id="8934" class="Symbol">=</a> <a id="8936" href="Peras.SmallStep.html#8929" class="Bound">r</a> <a id="8938" href="Data.Nat.Base.html#2259" class="Function Operator">≥</a> <a id="8940" href="Peras.Block.html#2304" class="Function">roundNumber</a> <a id="8952" class="Symbol">(</a><a id="8953" href="Peras.SmallStep.html#5911" class="Function">latestCertSeen</a> <a id="8968" href="Peras.SmallStep.html#8932" class="Bound">t</a><a id="8969" class="Symbol">)</a> <a id="8971" href="Haskell.Prim.Num.html#547" class="Field Operator">+</a> <a id="8973" href="Peras.Params.html#221" class="Field">R</a>
</pre>
VR-2B: The last certificate included in a party’s current chain is from
a round exactly c⋆K rounds ago for some c : ℕ, c ≥ 0 <!--
<pre class="Agda">    <a id="9121" href="Peras.SmallStep.html#9121" class="Function Operator">_mod_</a> <a id="9127" class="Symbol">:</a> <a id="9129" href="Agda.Builtin.Nat.html#203" class="Datatype">Nat</a> <a id="9133" class="Symbol">→</a> <a id="9135" class="Symbol">(</a><a id="9136" href="Peras.SmallStep.html#9136" class="Bound">n</a> <a id="9138" class="Symbol">:</a> <a id="9140" href="Agda.Builtin.Nat.html#203" class="Datatype">Nat</a><a id="9143" class="Symbol">)</a> <a id="9145" class="Symbol">→</a> <a id="9147" class="Symbol">⦃</a> <a id="9149" href="Data.Nat.Base.html#3260" class="Record">NonZero</a> <a id="9157" href="Peras.SmallStep.html#9136" class="Bound">n</a> <a id="9159" class="Symbol">⦄</a> <a id="9161" class="Symbol">→</a> <a id="9163" href="Agda.Builtin.Nat.html#203" class="Datatype">Nat</a>
    <a id="9171" href="Peras.SmallStep.html#9121" class="Function Operator">_mod_</a> <a id="9177" href="Peras.SmallStep.html#9177" class="Bound">a</a> <a id="9179" href="Peras.SmallStep.html#9179" class="Bound">b</a> <a id="9181" class="Symbol">⦃</a> <a id="9183" href="Peras.SmallStep.html#9183" class="Bound">prf</a> <a id="9187" class="Symbol">⦄</a> <a id="9189" class="Symbol">=</a> <a id="9191" href="Data.Nat.Base.html#7279" class="Function Operator">_%_</a> <a id="9195" href="Peras.SmallStep.html#9177" class="Bound">a</a> <a id="9197" href="Peras.SmallStep.html#9179" class="Bound">b</a> <a id="9199" class="Symbol">⦃</a> <a id="9201" href="Peras.SmallStep.html#9183" class="Bound">prf</a> <a id="9205" class="Symbol">⦄</a>
</pre>-->
<pre class="Agda">    <a id="9227" href="Peras.SmallStep.html#9227" class="Function">VotingRule-2B</a> <a id="9241" class="Symbol">:</a> <a id="9243" href="Peras.Numbering.html#1962" class="Record">RoundNumber</a> <a id="9255" class="Symbol">→</a> <a id="9257" href="Peras.SmallStep.html#6843" class="Bound">T</a> <a id="9259" class="Symbol">→</a> <a id="9261" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="9269" href="Peras.SmallStep.html#9227" class="Function">VotingRule-2B</a> <a id="9283" class="Symbol">(</a><a id="9284" href="Peras.Numbering.html#2000" class="InductiveConstructor">MkRoundNumber</a> <a id="9298" href="Peras.SmallStep.html#9298" class="Bound">r</a><a id="9299" class="Symbol">)</a> <a id="9301" href="Peras.SmallStep.html#9301" class="Bound">t</a> <a id="9303" class="Symbol">=</a>
        <a id="9313" href="Peras.SmallStep.html#9298" class="Bound">r</a> <a id="9315" href="Data.Nat.Base.html#2289" class="Function Operator">&gt;</a> <a id="9317" href="Peras.Block.html#2304" class="Function">roundNumber</a> <a id="9329" class="Symbol">(</a><a id="9330" href="Peras.SmallStep.html#5783" class="Function">latestCertOnChain</a> <a id="9348" href="Peras.SmallStep.html#9301" class="Bound">t</a><a id="9349" class="Symbol">)</a>
      <a id="9357" href="Haskell.Prim.Tuple.html#169" class="Record Operator">×</a> <a id="9359" href="Peras.SmallStep.html#9298" class="Bound">r</a> <a id="9361" href="Peras.SmallStep.html#9121" class="Function Operator">mod</a> <a id="9365" href="Peras.Params.html#207" class="Field">K</a> <a id="9367" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="9369" class="Symbol">(</a><a id="9370" href="Peras.Block.html#2304" class="Function">roundNumber</a> <a id="9382" class="Symbol">(</a><a id="9383" href="Peras.SmallStep.html#5783" class="Function">latestCertOnChain</a> <a id="9401" href="Peras.SmallStep.html#9301" class="Bound">t</a><a id="9402" class="Symbol">))</a> <a id="9405" href="Peras.SmallStep.html#9121" class="Function Operator">mod</a> <a id="9409" href="Peras.Params.html#207" class="Field">K</a>
</pre>
VR-2: Both VR-2A and VR-2B hold
<pre class="Agda">    <a id="9459" href="Peras.SmallStep.html#9459" class="Function">VotingRule-2</a> <a id="9472" class="Symbol">:</a> <a id="9474" href="Peras.Numbering.html#1962" class="Record">RoundNumber</a> <a id="9486" class="Symbol">→</a> <a id="9488" href="Peras.SmallStep.html#6843" class="Bound">T</a> <a id="9490" class="Symbol">→</a> <a id="9492" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="9500" href="Peras.SmallStep.html#9459" class="Function">VotingRule-2</a> <a id="9513" href="Peras.SmallStep.html#9513" class="Bound">r</a> <a id="9515" href="Peras.SmallStep.html#9515" class="Bound">t</a> <a id="9517" class="Symbol">=</a>
        <a id="9527" href="Peras.SmallStep.html#8858" class="Function">VotingRule-2A</a> <a id="9541" href="Peras.SmallStep.html#9513" class="Bound">r</a> <a id="9543" href="Peras.SmallStep.html#9515" class="Bound">t</a>
      <a id="9551" href="Haskell.Prim.Tuple.html#169" class="Record Operator">×</a> <a id="9553" href="Peras.SmallStep.html#9227" class="Function">VotingRule-2B</a> <a id="9567" href="Peras.SmallStep.html#9513" class="Bound">r</a> <a id="9569" href="Peras.SmallStep.html#9515" class="Bound">t</a>
</pre>
If either VR-1A and VR-1B or VR-2A and VR-2B hold, voting is expected
<pre class="Agda">    <a id="9657" href="Peras.SmallStep.html#9657" class="Function">VotingRule</a> <a id="9668" class="Symbol">:</a> <a id="9670" href="Peras.Numbering.html#1035" class="Record">SlotNumber</a> <a id="9681" class="Symbol">→</a> <a id="9683" href="Peras.SmallStep.html#6843" class="Bound">T</a> <a id="9685" class="Symbol">→</a> <a id="9687" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="9695" href="Peras.SmallStep.html#9657" class="Function">VotingRule</a> <a id="9706" href="Peras.SmallStep.html#9706" class="Bound">s</a> <a id="9708" href="Peras.SmallStep.html#9708" class="Bound">t</a> <a id="9710" class="Symbol">=</a>
      <a id="9718" href="Haskell.Prim.Either.html#159" class="Datatype">Either</a>
        <a id="9733" class="Symbol">(</a><a id="9734" href="Peras.SmallStep.html#8637" class="Function">VotingRule-1</a> <a id="9747" href="Peras.SmallStep.html#9706" class="Bound">s</a> <a id="9749" href="Peras.SmallStep.html#9708" class="Bound">t</a><a id="9750" class="Symbol">)</a>
        <a id="9760" class="Symbol">(</a><a id="9761" href="Peras.SmallStep.html#9459" class="Function">VotingRule-2</a> <a id="9774" class="Symbol">(</a><a id="9775" href="Peras.Chain.html#3997" class="Function">v-round</a> <a id="9783" href="Peras.SmallStep.html#9706" class="Bound">s</a><a id="9784" class="Symbol">)</a> <a id="9786" href="Peras.SmallStep.html#9708" class="Bound">t</a><a id="9787" class="Symbol">)</a>
</pre>
<h3 id="state">State</h3>
<p>The small-step semantics rely on a global state, which consists of
the following fields:</p>
<ul>
<li>Current slot of the system</li>
<li>Map with local state per party</li>
<li>All the messages that have been sent but not yet been delivered</li>
<li>All the messages that have been sent</li>
<li>Adversarial state</li>
</ul>
<pre class="Agda">    <a id="10094" class="Keyword">record</a> <a id="10101" href="Peras.SmallStep.html#10101" class="Record">State</a> <a id="10107" class="Symbol">:</a> <a id="10109" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="10113" class="Keyword">where</a>
      <a id="10125" class="Keyword">constructor</a> <a id="10137" href="Peras.SmallStep.html#10137" class="InductiveConstructor Operator">⟦_,_,_,_,_⟧</a>
      <a id="10155" class="Keyword">field</a>
        <a id="10169" href="Peras.SmallStep.html#10169" class="Field">clock</a> <a id="10175" class="Symbol">:</a> <a id="10177" href="Peras.Numbering.html#1035" class="Record">SlotNumber</a>
        <a id="10196" href="Peras.SmallStep.html#10196" class="Field">blockTrees</a> <a id="10207" class="Symbol">:</a> <a id="10209" href="Prelude.AssocList.html#211" class="Function">AssocList</a> <a id="10219" href="Peras.Block.html#842" class="Function">PartyId</a> <a id="10227" href="Peras.SmallStep.html#6843" class="Bound">T</a>
        <a id="10237" href="Peras.SmallStep.html#10237" class="Field">messages</a> <a id="10246" class="Symbol">:</a> <a id="10248" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="10253" href="Peras.SmallStep.html#2673" class="Record">Envelope</a>
        <a id="10270" href="Peras.SmallStep.html#10270" class="Field">history</a> <a id="10278" class="Symbol">:</a> <a id="10280" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="10285" href="Peras.SmallStep.html#2281" class="Datatype">Message</a>
        <a id="10301" href="Peras.SmallStep.html#10301" class="Field">adversarialState</a> <a id="10318" class="Symbol">:</a> <a id="10320" href="Peras.SmallStep.html#6889" class="Bound">S</a>

      <a id="10329" href="Peras.SmallStep.html#10329" class="Function">v-rnd</a> <a id="10335" class="Symbol">:</a> <a id="10337" href="Peras.Numbering.html#1962" class="Record">RoundNumber</a>
      <a id="10355" href="Peras.SmallStep.html#10329" class="Function">v-rnd</a> <a id="10361" class="Symbol">=</a> <a id="10363" href="Peras.Chain.html#3997" class="Function">v-round</a> <a id="10371" href="Peras.SmallStep.html#10169" class="Field">clock</a>

      <a id="10384" href="Peras.SmallStep.html#10384" class="Function">v-rnd&#39;</a> <a id="10391" class="Symbol">:</a> <a id="10393" href="Agda.Builtin.Nat.html#203" class="Datatype">Nat</a>
      <a id="10403" href="Peras.SmallStep.html#10384" class="Function">v-rnd&#39;</a> <a id="10410" class="Symbol">=</a> <a id="10412" href="Peras.Numbering.html#2022" class="Field">getRoundNumber</a> <a id="10427" href="Peras.SmallStep.html#10329" class="Function">v-rnd</a>
</pre>
<h4 id="progress">Progress</h4>
Rather than keeping track of progress, we introduce a predicate stating
that all messages that are not delayed have been delivered. This is a
precondition that must hold before transitioning to the next slot.
<pre class="Agda">    <a id="10673" href="Peras.SmallStep.html#10673" class="Function">Fetched</a> <a id="10681" class="Symbol">:</a> <a id="10683" href="Peras.SmallStep.html#10101" class="Record">State</a> <a id="10689" class="Symbol">→</a> <a id="10691" href="Agda.Primitive.html#388" class="Primitive">Set</a>
    <a id="10699" href="Peras.SmallStep.html#10673" class="Function">Fetched</a> <a id="10707" href="Peras.SmallStep.html#10707" class="Bound">s</a> <a id="10709" class="Symbol">=</a> <a id="10711" href="Haskell.Prim.html#2804" class="Datatype">All</a> <a id="10715" class="Symbol">(λ</a> <a id="10718" class="Symbol">{</a> <a id="10720" href="Peras.SmallStep.html#10720" class="Bound">z</a> <a id="10722" class="Symbol">→</a> <a id="10724" href="Peras.SmallStep.html#2816" class="Field">delay</a> <a id="10730" href="Peras.SmallStep.html#10720" class="Bound">z</a> <a id="10732" href="Relation.Binary.PropositionalEquality.Core.html#858" class="Function Operator">≢</a> <a id="10734" href="Peras.SmallStep.html#2498" class="InductiveConstructor">𝟘</a> <a id="10736" class="Symbol">})</a> <a id="10739" class="Symbol">(</a><a id="10740" href="Peras.SmallStep.html#10237" class="Field">messages</a> <a id="10749" href="Peras.SmallStep.html#10707" class="Bound">s</a><a id="10750" class="Symbol">)</a>
      <a id="10758" class="Keyword">where</a> <a id="10764" class="Keyword">open</a> <a id="10769" href="Peras.SmallStep.html#10101" class="Module">State</a>
</pre>
Ticking the global clock increments the slot number and decrements the
delay of all the messages in the message buffer.
<pre class="Agda">    <a id="10911" href="Peras.SmallStep.html#10911" class="Function">tick</a> <a id="10916" class="Symbol">:</a> <a id="10918" href="Peras.SmallStep.html#10101" class="Record">State</a> <a id="10924" class="Symbol">→</a> <a id="10926" href="Peras.SmallStep.html#10101" class="Record">State</a>
    <a id="10936" href="Peras.SmallStep.html#10911" class="Function">tick</a> <a id="10941" href="Peras.SmallStep.html#10941" class="Bound">M</a> <a id="10943" class="Symbol">=</a>
      <a id="10951" class="Keyword">record</a> <a id="10958" href="Peras.SmallStep.html#10941" class="Bound">M</a>
        <a id="10968" class="Symbol">{</a> <a id="10970" href="Peras.SmallStep.html#10169" class="Field">clock</a> <a id="10976" class="Symbol">=</a> <a id="10978" href="Peras.Numbering.html#1114" class="Function">next</a> <a id="10983" href="Peras.SmallStep.html#10169" class="Field">clock</a>
        <a id="10997" class="Symbol">;</a> <a id="10999" href="Peras.SmallStep.html#10237" class="Field">messages</a> <a id="11008" class="Symbol">=</a>
            <a id="11022" href="Haskell.Prim.List.html#211" class="Function">map</a> <a id="11026" class="Symbol">(λ</a> <a id="11029" class="Keyword">where</a> <a id="11035" href="Peras.SmallStep.html#11035" class="Bound">e</a> <a id="11037" class="Symbol">→</a> <a id="11039" class="Keyword">record</a> <a id="11046" href="Peras.SmallStep.html#11035" class="Bound">e</a> <a id="11048" class="Symbol">{</a> <a id="11050" href="Peras.SmallStep.html#2816" class="Field">delay</a> <a id="11056" class="Symbol">=</a> <a id="11058" href="Data.Fin.Base.html#6461" class="Function">Data.Fin.pred</a> <a id="11072" class="Symbol">(</a><a id="11073" href="Peras.SmallStep.html#2816" class="Field">delay</a> <a id="11079" href="Peras.SmallStep.html#11035" class="Bound">e</a><a id="11080" class="Symbol">)</a> <a id="11082" class="Symbol">})</a>
              <a id="11099" href="Peras.SmallStep.html#10237" class="Field">messages</a>
        <a id="11116" class="Symbol">}</a>
      <a id="11124" class="Keyword">where</a> <a id="11130" class="Keyword">open</a> <a id="11135" href="Peras.SmallStep.html#10101" class="Module">State</a> <a id="11141" href="Peras.SmallStep.html#10941" class="Bound">M</a>
</pre>
Updating the global state inserting the updated block-tree for a given
party, adding messages to the message buffer for the other parties and
appending the history
<pre class="Agda">    <a id="11323" href="Peras.SmallStep.html#11323" class="Function Operator">_,_⇑_</a> <a id="11329" class="Symbol">:</a> <a id="11331" href="Peras.SmallStep.html#2281" class="Datatype">Message</a> <a id="11339" class="Symbol">→</a> <a id="11341" class="Symbol">(</a><a id="11342" href="Peras.Block.html#842" class="Function">PartyId</a> <a id="11350" class="Symbol">→</a> <a id="11352" href="Peras.SmallStep.html#2461" class="Function">Delay</a><a id="11357" class="Symbol">)</a> <a id="11359" class="Symbol">→</a> <a id="11361" href="Peras.SmallStep.html#10101" class="Record">State</a> <a id="11367" class="Symbol">→</a> <a id="11369" href="Peras.SmallStep.html#10101" class="Record">State</a>
    <a id="11379" href="Peras.SmallStep.html#11379" class="Bound">m</a> <a id="11381" href="Peras.SmallStep.html#11323" class="Function Operator">,</a> <a id="11383" href="Peras.SmallStep.html#11383" class="Bound">fᵈ</a> <a id="11386" href="Peras.SmallStep.html#11323" class="Function Operator">⇑</a> <a id="11388" href="Peras.SmallStep.html#11388" class="Bound">M</a> <a id="11390" class="Symbol">=</a>
      <a id="11398" class="Keyword">record</a> <a id="11405" href="Peras.SmallStep.html#11388" class="Bound">M</a>
        <a id="11415" class="Symbol">{</a> <a id="11417" href="Peras.SmallStep.html#10237" class="Field">messages</a> <a id="11426" class="Symbol">=</a>
            <a id="11440" href="Haskell.Prim.List.html#211" class="Function">map</a> <a id="11444" class="Symbol">(λ</a> <a id="11447" class="Symbol">(</a><a id="11448" href="Peras.SmallStep.html#11448" class="Bound">p</a> <a id="11450" href="Peras.SmallStep.html#659" class="InductiveConstructor Operator">,ᵖ</a> <a id="11453" href="Peras.SmallStep.html#11453" class="Bound">h</a><a id="11454" class="Symbol">)</a> <a id="11456" class="Symbol">→</a> <a id="11458" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">⦅</a> <a id="11460" href="Peras.SmallStep.html#11448" class="Bound">p</a> <a id="11462" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">,</a> <a id="11464" href="Peras.SmallStep.html#11453" class="Bound">h</a> <a id="11466" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">,</a> <a id="11468" href="Peras.SmallStep.html#11379" class="Bound">m</a> <a id="11470" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">,</a> <a id="11472" href="Peras.SmallStep.html#11383" class="Bound">fᵈ</a> <a id="11475" href="Peras.SmallStep.html#11448" class="Bound">p</a> <a id="11477" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">⦆</a><a id="11478" class="Symbol">)</a> <a id="11480" href="Peras.SmallStep.html#6992" class="Bound">parties</a>
              <a id="11502" href="Haskell.Prim.List.html#310" class="Function Operator">++</a> <a id="11505" href="Peras.SmallStep.html#10237" class="Field">messages</a>

        <a id="11523" class="Symbol">;</a> <a id="11525" href="Peras.SmallStep.html#10270" class="Field">history</a> <a id="11533" class="Symbol">=</a> <a id="11535" href="Peras.SmallStep.html#11379" class="Bound">m</a> <a id="11537" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="11539" href="Peras.SmallStep.html#10270" class="Field">history</a>
        <a id="11555" class="Symbol">}</a>
      <a id="11563" class="Keyword">where</a> <a id="11569" class="Keyword">open</a> <a id="11574" href="Peras.SmallStep.html#10101" class="Module">State</a> <a id="11580" href="Peras.SmallStep.html#11388" class="Bound">M</a>

    <a id="11587" href="Peras.SmallStep.html#11587" class="Function Operator">delay_by_update_</a> <a id="11604" class="Symbol">:</a> <a id="11606" href="Peras.SmallStep.html#2281" class="Datatype">Message</a> <a id="11614" class="Symbol">→</a> <a id="11616" class="Symbol">(</a><a id="11617" href="Peras.Block.html#842" class="Function">PartyId</a> <a id="11625" class="Symbol">→</a> <a id="11627" href="Peras.SmallStep.html#2461" class="Function">Delay</a><a id="11632" class="Symbol">)</a> <a id="11634" class="Symbol">→</a> <a id="11636" href="Peras.SmallStep.html#10101" class="Record">State</a> <a id="11642" class="Symbol">→</a> <a id="11644" href="Peras.SmallStep.html#10101" class="Record">State</a>
    <a id="11654" href="Peras.SmallStep.html#11587" class="Function Operator">delay</a> <a id="11660" href="Peras.SmallStep.html#11660" class="Bound">m</a><a id="11661" class="Symbol">@(</a><a id="11663" href="Peras.SmallStep.html#2305" class="InductiveConstructor">ChainMsg</a> <a id="11672" href="Peras.SmallStep.html#11672" class="Bound">x</a><a id="11673" class="Symbol">)</a> <a id="11675" href="Peras.SmallStep.html#11587" class="Function Operator">by</a> <a id="11678" href="Peras.SmallStep.html#11678" class="Bound">fᵈ</a> <a id="11681" href="Peras.SmallStep.html#11587" class="Function Operator">update</a> <a id="11688" href="Peras.SmallStep.html#11688" class="Bound">M</a> <a id="11690" class="Symbol">=</a> <a id="11692" href="Peras.SmallStep.html#11660" class="Bound">m</a> <a id="11694" href="Peras.SmallStep.html#11323" class="Function Operator">,</a> <a id="11696" href="Peras.SmallStep.html#11678" class="Bound">fᵈ</a> <a id="11699" href="Peras.SmallStep.html#11323" class="Function Operator">⇑</a> <a id="11701" href="Peras.SmallStep.html#11688" class="Bound">M</a>
    <a id="11707" href="Peras.SmallStep.html#11587" class="Function Operator">delay</a> <a id="11713" href="Peras.SmallStep.html#11713" class="Bound">m</a><a id="11714" class="Symbol">@(</a><a id="11716" href="Peras.SmallStep.html#2357" class="InductiveConstructor">VoteMsg</a> <a id="11724" href="Peras.SmallStep.html#11724" class="Bound">x</a><a id="11725" class="Symbol">)</a> <a id="11727" href="Peras.SmallStep.html#11587" class="Function Operator">by</a> <a id="11730" href="Peras.SmallStep.html#11730" class="Bound">fᵈ</a> <a id="11733" href="Peras.SmallStep.html#11587" class="Function Operator">update</a> <a id="11740" href="Peras.SmallStep.html#11740" class="Bound">M</a> <a id="11742" class="Symbol">=</a> <a id="11744" href="Peras.SmallStep.html#11713" class="Bound">m</a> <a id="11746" href="Peras.SmallStep.html#11323" class="Function Operator">,</a> <a id="11748" href="Peras.SmallStep.html#11730" class="Bound">fᵈ</a> <a id="11751" href="Peras.SmallStep.html#11323" class="Function Operator">⇑</a> <a id="11753" href="Peras.SmallStep.html#11740" class="Bound">M</a>
</pre>
<h2 id="fetching">Fetching</h2>
<p>A party receives messages from the global state by fetching messages
assigned to the party, updating the local block tree and putting the
local state back into the global state.</p>
<pre class="Agda">    <a id="11963" class="Keyword">data</a> <a id="11968" href="Peras.SmallStep.html#11968" class="Datatype Operator">_⊢_[_]⇀_</a> <a id="11977" class="Symbol">:</a> <a id="11979" class="Symbol">{</a><a id="11980" href="Peras.SmallStep.html#11980" class="Bound">p</a> <a id="11982" class="Symbol">:</a> <a id="11984" href="Peras.Block.html#842" class="Function">PartyId</a><a id="11991" class="Symbol">}</a> <a id="11993" class="Symbol">→</a> <a id="11995" href="Peras.Block.html#1406" class="Datatype">Honesty</a> <a id="12003" href="Peras.SmallStep.html#11980" class="Bound">p</a> <a id="12005" class="Symbol">→</a> <a id="12007" href="Peras.SmallStep.html#10101" class="Record">State</a> <a id="12013" class="Symbol">→</a> <a id="12015" href="Peras.SmallStep.html#2281" class="Datatype">Message</a> <a id="12023" class="Symbol">→</a> <a id="12025" href="Peras.SmallStep.html#10101" class="Record">State</a> <a id="12031" class="Symbol">→</a> <a id="12033" href="Agda.Primitive.html#388" class="Primitive">Set</a>
      <a id="12043" class="Keyword">where</a>
</pre>
An honest party consumes a message from the global message buffer and
updates the local state
<pre class="Agda">      <a id="12161" href="Peras.SmallStep.html#12161" class="InductiveConstructor">honest</a> <a id="12168" class="Symbol">:</a> <a id="12170" class="Symbol">∀</a> <a id="12172" class="Symbol">{</a><a id="12173" href="Peras.SmallStep.html#12173" class="Bound">p</a><a id="12174" class="Symbol">}</a> <a id="12176" class="Symbol">{</a><a id="12177" href="Peras.SmallStep.html#12177" class="Bound">t</a> <a id="12179" href="Peras.SmallStep.html#12179" class="Bound">t′</a><a id="12181" class="Symbol">}</a> <a id="12183" class="Symbol">{</a><a id="12184" href="Peras.SmallStep.html#12184" class="Bound">m</a><a id="12185" class="Symbol">}</a> <a id="12187" class="Symbol">{</a><a id="12188" href="Peras.SmallStep.html#12188" class="Bound">N</a><a id="12189" class="Symbol">}</a> <a id="12191" class="Symbol">→</a> <a id="12193" class="Keyword">let</a> <a id="12197" class="Keyword">open</a> <a id="12202" href="Peras.SmallStep.html#10101" class="Module">State</a> <a id="12208" href="Peras.SmallStep.html#12188" class="Bound">N</a> <a id="12210" class="Keyword">in</a>
          <a id="12223" href="Peras.SmallStep.html#10196" class="Field">blockTrees</a> <a id="12234" href="Prelude.AssocList.html#847" class="Function Operator">⁉</a> <a id="12236" href="Peras.SmallStep.html#12173" class="Bound">p</a> <a id="12238" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="12240" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="12245" href="Peras.SmallStep.html#12177" class="Bound">t</a>
        <a id="12255" class="Symbol">→</a> <a id="12257" class="Symbol">(</a><a id="12258" href="Peras.SmallStep.html#12258" class="Bound">m∈ms</a> <a id="12263" class="Symbol">:</a> <a id="12265" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">⦅</a> <a id="12267" href="Peras.SmallStep.html#12173" class="Bound">p</a> <a id="12269" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">,</a> <a id="12271" href="Peras.Block.html#1439" class="InductiveConstructor">Honest</a> <a id="12278" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">,</a> <a id="12280" href="Peras.SmallStep.html#12184" class="Bound">m</a> <a id="12282" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">,</a> <a id="12284" href="Peras.SmallStep.html#2498" class="InductiveConstructor">𝟘</a> <a id="12286" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">⦆</a> <a id="12288" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="12290" href="Peras.SmallStep.html#10237" class="Field">messages</a><a id="12298" class="Symbol">)</a>
        <a id="12308" class="Symbol">→</a> <a id="12310" href="Peras.SmallStep.html#12177" class="Bound">t</a> <a id="12312" href="Peras.SmallStep.html#7374" class="Datatype Operator">[</a> <a id="12314" href="Peras.SmallStep.html#12184" class="Bound">m</a> <a id="12316" href="Peras.SmallStep.html#7374" class="Datatype Operator">]→</a> <a id="12319" href="Peras.SmallStep.html#12179" class="Bound">t′</a>
          <a id="12332" class="Comment">---------------------------------------------</a>
        <a id="12386" class="Symbol">→</a> <a id="12388" href="Peras.Block.html#1439" class="InductiveConstructor">Honest</a> <a id="12395" class="Symbol">{</a><a id="12396" href="Peras.SmallStep.html#12173" class="Bound">p</a><a id="12397" class="Symbol">}</a> <a id="12399" href="Peras.SmallStep.html#11968" class="Datatype Operator">⊢</a>
          <a id="12411" href="Peras.SmallStep.html#12188" class="Bound">N</a> <a id="12413" href="Peras.SmallStep.html#11968" class="Datatype Operator">[</a> <a id="12415" href="Peras.SmallStep.html#12184" class="Bound">m</a> <a id="12417" href="Peras.SmallStep.html#11968" class="Datatype Operator">]⇀</a> <a id="12420" class="Keyword">record</a> <a id="12427" href="Peras.SmallStep.html#12188" class="Bound">N</a>
            <a id="12441" class="Symbol">{</a> <a id="12443" href="Peras.SmallStep.html#10196" class="Field">blockTrees</a> <a id="12454" class="Symbol">=</a> <a id="12456" href="Prelude.AssocList.html#1398" class="Function">set</a> <a id="12460" href="Peras.SmallStep.html#12173" class="Bound">p</a> <a id="12462" href="Peras.SmallStep.html#12179" class="Bound">t′</a> <a id="12465" href="Peras.SmallStep.html#10196" class="Field">blockTrees</a>
            <a id="12488" class="Symbol">;</a> <a id="12490" href="Peras.SmallStep.html#10237" class="Field">messages</a> <a id="12499" class="Symbol">=</a> <a id="12501" href="Peras.SmallStep.html#10237" class="Field">messages</a> <a id="12510" href="Data.List.Membership.Setoid.html#1155" class="Function Operator">─</a> <a id="12512" href="Peras.SmallStep.html#12258" class="Bound">m∈ms</a>
            <a id="12529" class="Symbol">}</a>
</pre>
An adversarial party might delay a message
<pre class="Agda">      <a id="12592" href="Peras.SmallStep.html#12592" class="InductiveConstructor">corrupt</a> <a id="12600" class="Symbol">:</a> <a id="12602" class="Symbol">∀</a> <a id="12604" class="Symbol">{</a><a id="12605" href="Peras.SmallStep.html#12605" class="Bound">p</a><a id="12606" class="Symbol">}</a> <a id="12608" class="Symbol">{</a><a id="12609" href="Peras.SmallStep.html#12609" class="Bound">as</a><a id="12611" class="Symbol">}</a> <a id="12613" class="Symbol">{</a><a id="12614" href="Peras.SmallStep.html#12614" class="Bound">m</a><a id="12615" class="Symbol">}</a> <a id="12617" class="Symbol">{</a><a id="12618" href="Peras.SmallStep.html#12618" class="Bound">N</a><a id="12619" class="Symbol">}</a> <a id="12621" class="Symbol">→</a> <a id="12623" class="Keyword">let</a> <a id="12627" class="Keyword">open</a> <a id="12632" href="Peras.SmallStep.html#10101" class="Module">State</a> <a id="12638" href="Peras.SmallStep.html#12618" class="Bound">N</a> <a id="12640" class="Keyword">in</a>
          <a id="12653" class="Symbol">(</a><a id="12654" href="Peras.SmallStep.html#12654" class="Bound">m∈ms</a> <a id="12659" class="Symbol">:</a> <a id="12661" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">⦅</a> <a id="12663" href="Peras.SmallStep.html#12605" class="Bound">p</a> <a id="12665" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">,</a> <a id="12667" href="Peras.Block.html#1483" class="InductiveConstructor">Corrupt</a> <a id="12675" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">,</a> <a id="12677" href="Peras.SmallStep.html#12614" class="Bound">m</a> <a id="12679" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">,</a> <a id="12681" href="Peras.SmallStep.html#2498" class="InductiveConstructor">𝟘</a> <a id="12683" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">⦆</a> <a id="12685" href="Data.List.Membership.Setoid.html#950" class="Function Operator">∈</a> <a id="12687" href="Peras.SmallStep.html#10237" class="Field">messages</a><a id="12695" class="Symbol">)</a>
          <a id="12707" class="Comment">----------------------------------------------</a>
        <a id="12762" class="Symbol">→</a> <a id="12764" href="Peras.Block.html#1483" class="InductiveConstructor">Corrupt</a> <a id="12772" class="Symbol">{</a><a id="12773" href="Peras.SmallStep.html#12605" class="Bound">p</a><a id="12774" class="Symbol">}</a> <a id="12776" href="Peras.SmallStep.html#11968" class="Datatype Operator">⊢</a>
          <a id="12788" href="Peras.SmallStep.html#12618" class="Bound">N</a> <a id="12790" href="Peras.SmallStep.html#11968" class="Datatype Operator">[</a> <a id="12792" href="Peras.SmallStep.html#12614" class="Bound">m</a> <a id="12794" href="Peras.SmallStep.html#11968" class="Datatype Operator">]⇀</a> <a id="12797" class="Keyword">record</a> <a id="12804" href="Peras.SmallStep.html#12618" class="Bound">N</a>
            <a id="12818" class="Symbol">{</a> <a id="12820" href="Peras.SmallStep.html#10237" class="Field">messages</a> <a id="12829" class="Symbol">=</a> <a id="12831" href="Peras.SmallStep.html#12654" class="Bound">m∈ms</a> <a id="12836" href="Peras.SmallStep.html#359" class="Function Operator">∷ˡ=</a> <a id="12840" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">⦅</a> <a id="12842" href="Peras.SmallStep.html#12605" class="Bound">p</a> <a id="12844" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">,</a> <a id="12846" href="Peras.Block.html#1483" class="InductiveConstructor">Corrupt</a> <a id="12854" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">,</a> <a id="12856" href="Peras.SmallStep.html#12614" class="Bound">m</a> <a id="12858" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">,</a> <a id="12860" href="Peras.SmallStep.html#2518" class="InductiveConstructor">𝟙</a> <a id="12862" href="Peras.SmallStep.html#2710" class="InductiveConstructor Operator">⦆</a>
            <a id="12876" class="Symbol">;</a> <a id="12878" href="Peras.SmallStep.html#10301" class="Field">adversarialState</a> <a id="12895" class="Symbol">=</a> <a id="12897" href="Peras.SmallStep.html#12609" class="Bound">as</a>
            <a id="12912" class="Symbol">}</a>
</pre>
<h2 id="voting">Voting</h2>
Helper function for creating a vote
<pre class="Agda">    <a id="12977" href="Peras.SmallStep.html#12977" class="Function">createVote</a> <a id="12988" class="Symbol">:</a> <a id="12990" href="Peras.Numbering.html#1035" class="Record">SlotNumber</a> <a id="13001" class="Symbol">→</a> <a id="13003" href="Peras.Block.html#842" class="Function">PartyId</a> <a id="13011" class="Symbol">→</a> <a id="13013" href="Peras.Crypto.html#2454" class="Record">MembershipProof</a> <a id="13029" class="Symbol">→</a> <a id="13031" href="Peras.Crypto.html#3408" class="Record">Signature</a> <a id="13041" class="Symbol">→</a> <a id="13043" href="Peras.Crypto.html#1835" class="Record">Hash</a> <a id="13048" href="Peras.Block.html#2100" class="Record">Block</a> <a id="13054" class="Symbol">→</a> <a id="13056" href="Peras.Chain.html#899" class="Record">Vote</a>
    <a id="13065" href="Peras.SmallStep.html#12977" class="Function">createVote</a> <a id="13076" href="Peras.SmallStep.html#13076" class="Bound">s</a> <a id="13078" href="Peras.SmallStep.html#13078" class="Bound">p</a> <a id="13080" href="Peras.SmallStep.html#13080" class="Bound">prf</a> <a id="13084" href="Peras.SmallStep.html#13084" class="Bound">sig</a> <a id="13088" href="Peras.SmallStep.html#13088" class="Bound">hb</a> <a id="13091" class="Symbol">=</a>
      <a id="13099" class="Keyword">record</a>
        <a id="13114" class="Symbol">{</a> <a id="13116" href="Peras.Chain.html#945" class="Field">votingRound</a> <a id="13128" class="Symbol">=</a> <a id="13130" href="Peras.Chain.html#3997" class="Function">v-round</a> <a id="13138" href="Peras.SmallStep.html#13076" class="Bound">s</a>
        <a id="13148" class="Symbol">;</a> <a id="13150" href="Peras.Chain.html#979" class="Field">creatorId</a> <a id="13160" class="Symbol">=</a> <a id="13162" href="Peras.SmallStep.html#13078" class="Bound">p</a>
        <a id="13172" class="Symbol">;</a> <a id="13174" href="Peras.Chain.html#1009" class="Field">proofM</a> <a id="13181" class="Symbol">=</a> <a id="13183" href="Peras.SmallStep.html#13080" class="Bound">prf</a>
        <a id="13195" class="Symbol">;</a> <a id="13197" href="Peras.Chain.html#1047" class="Field">blockHash</a> <a id="13207" class="Symbol">=</a> <a id="13209" href="Peras.SmallStep.html#13088" class="Bound">hb</a>
        <a id="13220" class="Symbol">;</a> <a id="13222" href="Peras.Chain.html#1080" class="Field">signature</a> <a id="13232" class="Symbol">=</a> <a id="13234" href="Peras.SmallStep.html#13084" class="Bound">sig</a>
        <a id="13246" class="Symbol">}</a>
</pre>
<p>A party can vote for a block, if * the current slot is the first slot
in a voting round * the party is a member of the voting committee * the
chain is not in a cool-down phase</p>
Voting updates the party’s local state and for all other parties a
message is added to be consumed immediately.
<pre class="Agda">    <a id="13559" class="Keyword">infix</a> <a id="13565" class="Number">2</a> <a id="13567" href="Peras.SmallStep.html#13583" class="Datatype Operator">_⊢_⇉_</a>

    <a id="13578" class="Keyword">data</a> <a id="13583" href="Peras.SmallStep.html#13583" class="Datatype Operator">_⊢_⇉_</a> <a id="13589" class="Symbol">:</a> <a id="13591" class="Symbol">{</a><a id="13592" href="Peras.SmallStep.html#13592" class="Bound">p</a> <a id="13594" class="Symbol">:</a> <a id="13596" href="Peras.Block.html#842" class="Function">PartyId</a><a id="13603" class="Symbol">}</a> <a id="13605" class="Symbol">→</a> <a id="13607" href="Peras.Block.html#1406" class="Datatype">Honesty</a> <a id="13615" href="Peras.SmallStep.html#13592" class="Bound">p</a> <a id="13617" class="Symbol">→</a> <a id="13619" href="Peras.SmallStep.html#10101" class="Record">State</a> <a id="13625" class="Symbol">→</a> <a id="13627" href="Peras.SmallStep.html#10101" class="Record">State</a> <a id="13633" class="Symbol">→</a> <a id="13635" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="13639" class="Keyword">where</a>

      <a id="13652" href="Peras.SmallStep.html#13652" class="InductiveConstructor">honest</a> <a id="13659" class="Symbol">:</a> <a id="13661" class="Symbol">∀</a> <a id="13663" class="Symbol">{</a><a id="13664" href="Peras.SmallStep.html#13664" class="Bound">p</a><a id="13665" class="Symbol">}</a> <a id="13667" class="Symbol">{</a><a id="13668" href="Peras.SmallStep.html#13668" class="Bound">t</a><a id="13669" class="Symbol">}</a> <a id="13671" class="Symbol">{</a><a id="13672" href="Peras.SmallStep.html#13672" class="Bound">M</a><a id="13673" class="Symbol">}</a> <a id="13675" class="Symbol">{</a><a id="13676" href="Peras.SmallStep.html#13676" class="Bound">π</a><a id="13677" class="Symbol">}</a> <a id="13679" class="Symbol">{</a><a id="13680" href="Peras.SmallStep.html#13680" class="Bound">σ</a><a id="13681" class="Symbol">}</a> <a id="13683" class="Symbol">{</a><a id="13684" href="Peras.SmallStep.html#13684" class="Bound">b</a><a id="13685" class="Symbol">}</a>
        <a id="13695" class="Symbol">→</a> <a id="13697" class="Keyword">let</a>
            <a id="13713" class="Keyword">open</a> <a id="13718" href="Peras.SmallStep.html#10101" class="Module">State</a>
            <a id="13736" href="Peras.SmallStep.html#13736" class="Bound">s</a> <a id="13738" class="Symbol">=</a> <a id="13740" href="Peras.SmallStep.html#10169" class="Field">clock</a> <a id="13746" href="Peras.SmallStep.html#13672" class="Bound">M</a>
            <a id="13760" href="Peras.SmallStep.html#13760" class="Bound">r</a> <a id="13762" class="Symbol">=</a> <a id="13764" href="Peras.Chain.html#3997" class="Function">v-round</a> <a id="13772" href="Peras.SmallStep.html#13736" class="Bound">s</a>
            <a id="13786" href="Peras.SmallStep.html#13786" class="Bound">v</a> <a id="13788" class="Symbol">=</a> <a id="13790" href="Peras.SmallStep.html#12977" class="Function">createVote</a> <a id="13801" href="Peras.SmallStep.html#13736" class="Bound">s</a> <a id="13803" href="Peras.SmallStep.html#13664" class="Bound">p</a> <a id="13805" href="Peras.SmallStep.html#13676" class="Bound">π</a> <a id="13807" href="Peras.SmallStep.html#13680" class="Bound">σ</a> <a id="13809" href="Peras.SmallStep.html#13684" class="Bound">b</a>
          <a id="13821" class="Keyword">in</a>
          <a id="13834" href="Peras.SmallStep.html#8092" class="Function">BlockSelection</a> <a id="13849" href="Peras.SmallStep.html#13736" class="Bound">s</a> <a id="13851" href="Peras.SmallStep.html#13668" class="Bound">t</a> <a id="13853" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="13855" href="Peras.SmallStep.html#13684" class="Bound">b</a>
        <a id="13865" class="Symbol">→</a> <a id="13867" href="Peras.SmallStep.html#10196" class="Field">blockTrees</a> <a id="13878" href="Peras.SmallStep.html#13672" class="Bound">M</a> <a id="13880" href="Prelude.AssocList.html#847" class="Function Operator">⁉</a> <a id="13882" href="Peras.SmallStep.html#13664" class="Bound">p</a> <a id="13884" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="13886" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="13891" href="Peras.SmallStep.html#13668" class="Bound">t</a>
        <a id="13901" class="Symbol">→</a> <a id="13903" class="Symbol">(</a><a id="13904" href="Peras.SmallStep.html#13904" class="Bound">sig</a> <a id="13908" class="Symbol">:</a> <a id="13910" href="Peras.Chain.html#1896" class="Field">IsVoteSignature</a> <a id="13926" href="Peras.SmallStep.html#13786" class="Bound">v</a> <a id="13928" href="Peras.SmallStep.html#13680" class="Bound">σ</a><a id="13929" class="Symbol">)</a>
        <a id="13939" class="Symbol">→</a> <a id="13941" href="Peras.Chain.html#3807" class="Function">StartOfRound</a> <a id="13954" href="Peras.SmallStep.html#13736" class="Bound">s</a> <a id="13956" href="Peras.SmallStep.html#13760" class="Bound">r</a>
        <a id="13966" class="Symbol">→</a> <a id="13968" class="Symbol">(</a><a id="13969" href="Peras.SmallStep.html#13969" class="Bound">mem</a> <a id="13973" class="Symbol">:</a> <a id="13975" href="Peras.Chain.html#1779" class="Field">IsCommitteeMember</a> <a id="13993" href="Peras.SmallStep.html#13664" class="Bound">p</a> <a id="13995" href="Peras.SmallStep.html#13760" class="Bound">r</a> <a id="13997" href="Peras.SmallStep.html#13676" class="Bound">π</a><a id="13998" class="Symbol">)</a>
        <a id="14008" class="Symbol">→</a> <a id="14010" href="Peras.SmallStep.html#9657" class="Function">VotingRule</a> <a id="14021" href="Peras.SmallStep.html#13736" class="Bound">s</a> <a id="14023" href="Peras.SmallStep.html#13668" class="Bound">t</a>
        <a id="14033" class="Symbol">→</a> <a id="14035" class="Symbol">(</a><a id="14036" href="Peras.SmallStep.html#14036" class="Bound">fᵈ</a> <a id="14039" class="Symbol">:</a> <a id="14041" href="Peras.Block.html#842" class="Function">PartyId</a> <a id="14049" class="Symbol">→</a> <a id="14051" href="Peras.SmallStep.html#2461" class="Function">Delay</a><a id="14056" class="Symbol">)</a>
          <a id="14068" class="Comment">----------------------------------------------</a>
        <a id="14123" class="Symbol">→</a> <a id="14125" href="Peras.Block.html#1439" class="InductiveConstructor">Honest</a> <a id="14132" class="Symbol">{</a><a id="14133" href="Peras.SmallStep.html#13664" class="Bound">p</a><a id="14134" class="Symbol">}</a> <a id="14136" href="Peras.SmallStep.html#13583" class="Datatype Operator">⊢</a>
            <a id="14150" href="Peras.SmallStep.html#13672" class="Bound">M</a> <a id="14152" href="Peras.SmallStep.html#13583" class="Datatype Operator">⇉</a> <a id="14154" href="Peras.SmallStep.html#11587" class="Function Operator">delay</a> <a id="14160" href="Peras.SmallStep.html#2357" class="InductiveConstructor">VoteMsg</a> <a id="14168" class="Symbol">(</a><a id="14169" href="Peras.SmallStep.html#13969" class="Bound">mem</a> <a id="14173" href="Haskell.Prim.Tuple.html#211" class="InductiveConstructor Operator">,</a> <a id="14175" href="Peras.SmallStep.html#13904" class="Bound">sig</a><a id="14178" class="Symbol">)</a> <a id="14180" href="Peras.SmallStep.html#11587" class="Function Operator">by</a> <a id="14183" href="Peras.SmallStep.html#14036" class="Bound">fᵈ</a>
                 <a id="14203" href="Peras.SmallStep.html#11587" class="Function Operator">update</a> <a id="14210" href="Peras.SmallStep.html#13672" class="Bound">M</a>
</pre>
<p>Rather than creating a delayed vote, an adversary can honestly create
it and delay the message.</p>
<h2 id="block-creation">Block creation</h2>
<p>Certificates are conditionally added to a block. The following
function determines if there needs to be a certificate provided for a
given voting round and a local block-tree. The conditions are as
follows</p>
<ol type="a">
<li>There is no certificate from 2 rounds ago in certs</li>
<li>The last seen certificate is not expired</li>
<li>The last seen certificate is from a later round than the last
certificate on chain</li>
</ol>
<pre class="Agda">    <a id="14739" href="Peras.SmallStep.html#14739" class="Function">needCert</a> <a id="14748" class="Symbol">:</a> <a id="14750" href="Peras.Numbering.html#1962" class="Record">RoundNumber</a> <a id="14762" class="Symbol">→</a> <a id="14764" href="Peras.SmallStep.html#6843" class="Bound">T</a> <a id="14766" class="Symbol">→</a> <a id="14768" href="Haskell.Prim.Maybe.html#101" class="Datatype">Maybe</a> <a id="14774" href="Peras.Block.html#2142" class="Record">Certificate</a>
    <a id="14790" href="Peras.SmallStep.html#14739" class="Function">needCert</a> <a id="14799" class="Symbol">(</a><a id="14800" href="Peras.Numbering.html#2000" class="InductiveConstructor">MkRoundNumber</a> <a id="14814" href="Peras.SmallStep.html#14814" class="Bound">r</a><a id="14815" class="Symbol">)</a> <a id="14817" href="Peras.SmallStep.html#14817" class="Bound">t</a> <a id="14819" class="Symbol">=</a>
      <a id="14827" class="Keyword">let</a>
        <a id="14839" href="Peras.SmallStep.html#14839" class="Bound">cert⋆</a> <a id="14845" class="Symbol">=</a> <a id="14847" href="Peras.SmallStep.html#5783" class="Function">latestCertOnChain</a> <a id="14865" href="Peras.SmallStep.html#14817" class="Bound">t</a>
        <a id="14875" href="Peras.SmallStep.html#14875" class="Bound">cert′</a> <a id="14881" class="Symbol">=</a> <a id="14883" href="Peras.SmallStep.html#5911" class="Function">latestCertSeen</a> <a id="14898" href="Peras.SmallStep.html#14817" class="Bound">t</a>
      <a id="14906" class="Keyword">in</a>
        <a id="14917" href="Haskell.Prim.html#1713" class="Function Operator">if</a> <a id="14920" href="Haskell.Prim.Bool.html#273" class="Function">not</a> <a id="14924" class="Symbol">(</a><a id="14925" href="Haskell.Prim.Foldable.html#604" class="Field">any</a> <a id="14929" class="Symbol">(λ</a> <a id="14932" href="Peras.SmallStep.html#14932" class="Bound">c</a> <a id="14934" class="Symbol">→</a> <a id="14936" href="Peras.Block.html#2304" class="Function">roundNumber</a> <a id="14948" href="Peras.SmallStep.html#14932" class="Bound">c</a> <a id="14950" href="Haskell.Prim.Num.html#547" class="Field Operator">+</a> <a id="14952" class="Number">2</a> <a id="14954" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="14957" href="Peras.SmallStep.html#14814" class="Bound">r</a><a id="14958" class="Symbol">)</a> <a id="14960" class="Symbol">(</a><a id="14961" href="Peras.SmallStep.html#5610" class="Function">certs</a> <a id="14967" href="Peras.SmallStep.html#14817" class="Bound">t</a><a id="14968" class="Symbol">))</a> <a id="14971" class="Comment">-- (a)</a>
           <a id="14989" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="14992" class="Symbol">(</a><a id="14993" href="Peras.SmallStep.html#14814" class="Bound">r</a> <a id="14995" href="Haskell.Prim.Ord.html#1144" class="Field Operator">&lt;=</a> <a id="14998" href="Peras.Params.html#249" class="Field">A</a> <a id="15000" href="Haskell.Prim.Num.html#547" class="Field Operator">+</a> <a id="15002" href="Peras.Block.html#2304" class="Function">roundNumber</a> <a id="15014" href="Peras.SmallStep.html#14875" class="Bound">cert′</a><a id="15019" class="Symbol">)</a>                    <a id="15040" class="Comment">-- (b)</a>
           <a id="15058" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="15061" class="Symbol">(</a><a id="15062" href="Peras.Block.html#2304" class="Function">roundNumber</a> <a id="15074" href="Peras.SmallStep.html#14839" class="Bound">cert⋆</a> <a id="15080" href="Haskell.Prim.Ord.html#1072" class="Field Operator">&lt;</a> <a id="15082" href="Peras.Block.html#2304" class="Function">roundNumber</a> <a id="15094" href="Peras.SmallStep.html#14875" class="Bound">cert′</a><a id="15099" class="Symbol">)</a>         <a id="15109" class="Comment">-- (c)</a>
        <a id="15124" href="Haskell.Prim.html#1713" class="Function Operator">then</a> <a id="15129" href="Haskell.Prim.Maybe.html#162" class="InductiveConstructor">Just</a> <a id="15134" href="Peras.SmallStep.html#14875" class="Bound">cert′</a>
        <a id="15148" href="Haskell.Prim.html#1713" class="Function Operator">else</a> <a id="15153" href="Haskell.Prim.Maybe.html#142" class="InductiveConstructor">Nothing</a>
</pre>
Helper function for creating a block
<pre class="Agda">    <a id="15214" href="Peras.SmallStep.html#15214" class="Function">createBlock</a> <a id="15226" class="Symbol">:</a> <a id="15228" href="Peras.Numbering.html#1035" class="Record">SlotNumber</a> <a id="15239" class="Symbol">→</a> <a id="15241" href="Peras.Block.html#842" class="Function">PartyId</a> <a id="15249" class="Symbol">→</a> <a id="15251" href="Peras.Crypto.html#2886" class="Record">LeadershipProof</a> <a id="15267" class="Symbol">→</a> <a id="15269" href="Peras.Crypto.html#3408" class="Record">Signature</a> <a id="15279" class="Symbol">→</a> <a id="15281" href="Peras.SmallStep.html#6843" class="Bound">T</a> <a id="15283" class="Symbol">→</a> <a id="15285" href="Peras.Block.html#2100" class="Record">Block</a>
    <a id="15295" href="Peras.SmallStep.html#15214" class="Function">createBlock</a> <a id="15307" href="Peras.SmallStep.html#15307" class="Bound">s</a> <a id="15309" href="Peras.SmallStep.html#15309" class="Bound">p</a> <a id="15311" href="Peras.SmallStep.html#15311" class="Bound">π</a> <a id="15313" href="Peras.SmallStep.html#15313" class="Bound">σ</a> <a id="15315" href="Peras.SmallStep.html#15315" class="Bound">t</a> <a id="15317" class="Symbol">=</a>
      <a id="15325" class="Keyword">record</a>
        <a id="15340" class="Symbol">{</a> <a id="15342" href="Peras.Block.html#2538" class="Field">slotNumber</a> <a id="15353" class="Symbol">=</a> <a id="15355" href="Peras.SmallStep.html#15307" class="Bound">s</a>
        <a id="15365" class="Symbol">;</a> <a id="15367" href="Peras.Block.html#2570" class="Field">creatorId</a> <a id="15377" class="Symbol">=</a> <a id="15379" href="Peras.SmallStep.html#15309" class="Bound">p</a>
        <a id="15389" class="Symbol">;</a> <a id="15391" href="Peras.Block.html#2598" class="Field">parentBlock</a> <a id="15403" class="Symbol">=</a> <a id="15405" href="Peras.Block.html#4809" class="Function">tipHash</a> <a id="15413" class="Symbol">(</a><a id="15414" href="Peras.SmallStep.html#5498" class="Function">preferredChain</a> <a id="15429" href="Peras.SmallStep.html#15315" class="Bound">t</a><a id="15430" class="Symbol">)</a>
        <a id="15440" class="Symbol">;</a> <a id="15442" href="Peras.Block.html#2631" class="Field">certificate</a> <a id="15454" class="Symbol">=</a> <a id="15456" href="Peras.SmallStep.html#14739" class="Function">needCert</a> <a id="15465" class="Symbol">(</a><a id="15466" href="Peras.Chain.html#3997" class="Function">v-round</a> <a id="15474" href="Peras.SmallStep.html#15307" class="Bound">s</a><a id="15475" class="Symbol">)</a> <a id="15477" href="Peras.SmallStep.html#15315" class="Bound">t</a>
        <a id="15487" class="Symbol">;</a> <a id="15489" href="Peras.Block.html#2671" class="Field">leadershipProof</a> <a id="15505" class="Symbol">=</a> <a id="15507" href="Peras.SmallStep.html#15311" class="Bound">π</a>
        <a id="15517" class="Symbol">;</a> <a id="15519" href="Peras.Block.html#2743" class="Field">bodyHash</a> <a id="15528" class="Symbol">=</a> <a id="15530" href="Peras.Crypto.html#2326" class="Field">hash</a> <a id="15535" class="Symbol">(</a><a id="15536" href="Peras.SmallStep.html#6934" class="Bound">txSelection</a> <a id="15548" href="Peras.SmallStep.html#15307" class="Bound">s</a> <a id="15550" href="Peras.SmallStep.html#15309" class="Bound">p</a><a id="15551" class="Symbol">)</a>
        <a id="15561" class="Symbol">;</a> <a id="15563" href="Peras.Block.html#2713" class="Field">signature</a> <a id="15573" class="Symbol">=</a> <a id="15575" href="Peras.SmallStep.html#15313" class="Bound">σ</a>
        <a id="15585" class="Symbol">}</a>
</pre>
<p>A party can create a new block by adding it to the local block tree
and diffuse the block creation messages to the other parties. Block
creation is possible, if as in <em>Praos</em></p>
<ul>
<li>the block signature is correct</li>
<li>the party is the slot leader</li>
</ul>
Block creation updates the party’s local state and for all other parties
a message is added to the message buffer
<pre class="Agda">    <a id="15962" class="Keyword">infix</a> <a id="15968" class="Number">2</a> <a id="15970" href="Peras.SmallStep.html#15986" class="Datatype Operator">_⊢_↷_</a>

    <a id="15981" class="Keyword">data</a> <a id="15986" href="Peras.SmallStep.html#15986" class="Datatype Operator">_⊢_↷_</a> <a id="15992" class="Symbol">:</a> <a id="15994" class="Symbol">{</a><a id="15995" href="Peras.SmallStep.html#15995" class="Bound">p</a> <a id="15997" class="Symbol">:</a> <a id="15999" href="Peras.Block.html#842" class="Function">PartyId</a><a id="16006" class="Symbol">}</a> <a id="16008" class="Symbol">→</a> <a id="16010" href="Peras.Block.html#1406" class="Datatype">Honesty</a> <a id="16018" href="Peras.SmallStep.html#15995" class="Bound">p</a> <a id="16020" class="Symbol">→</a> <a id="16022" href="Peras.SmallStep.html#10101" class="Record">State</a> <a id="16028" class="Symbol">→</a> <a id="16030" href="Peras.SmallStep.html#10101" class="Record">State</a> <a id="16036" class="Symbol">→</a> <a id="16038" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="16042" class="Keyword">where</a>

      <a id="16055" href="Peras.SmallStep.html#16055" class="InductiveConstructor">honest</a> <a id="16062" class="Symbol">:</a> <a id="16064" class="Symbol">∀</a> <a id="16066" class="Symbol">{</a><a id="16067" href="Peras.SmallStep.html#16067" class="Bound">p</a><a id="16068" class="Symbol">}</a> <a id="16070" class="Symbol">{</a><a id="16071" href="Peras.SmallStep.html#16071" class="Bound">t</a><a id="16072" class="Symbol">}</a> <a id="16074" class="Symbol">{</a><a id="16075" href="Peras.SmallStep.html#16075" class="Bound">M</a><a id="16076" class="Symbol">}</a> <a id="16078" class="Symbol">{</a><a id="16079" href="Peras.SmallStep.html#16079" class="Bound">π</a><a id="16080" class="Symbol">}</a> <a id="16082" class="Symbol">{</a><a id="16083" href="Peras.SmallStep.html#16083" class="Bound">σ</a><a id="16084" class="Symbol">}</a>
        <a id="16094" class="Symbol">→</a> <a id="16096" class="Keyword">let</a>
            <a id="16112" class="Keyword">open</a> <a id="16117" href="Peras.SmallStep.html#10101" class="Module">State</a>
            <a id="16135" href="Peras.SmallStep.html#16135" class="Bound">s</a> <a id="16137" class="Symbol">=</a> <a id="16139" href="Peras.SmallStep.html#10169" class="Field">clock</a> <a id="16145" href="Peras.SmallStep.html#16075" class="Bound">M</a>
            <a id="16159" href="Peras.SmallStep.html#16159" class="Bound">b</a> <a id="16161" class="Symbol">=</a> <a id="16163" href="Peras.SmallStep.html#15214" class="Function">createBlock</a> <a id="16175" href="Peras.SmallStep.html#16135" class="Bound">s</a> <a id="16177" href="Peras.SmallStep.html#16067" class="Bound">p</a> <a id="16179" href="Peras.SmallStep.html#16079" class="Bound">π</a> <a id="16181" href="Peras.SmallStep.html#16083" class="Bound">σ</a> <a id="16183" href="Peras.SmallStep.html#16071" class="Bound">t</a>
            <a id="16197" href="Peras.SmallStep.html#16197" class="Bound">pref</a> <a id="16202" class="Symbol">=</a> <a id="16204" href="Peras.SmallStep.html#5498" class="Function">preferredChain</a> <a id="16219" href="Peras.SmallStep.html#16071" class="Bound">t</a>
          <a id="16231" class="Keyword">in</a>
          <a id="16244" href="Peras.SmallStep.html#10196" class="Field">blockTrees</a> <a id="16255" href="Peras.SmallStep.html#16075" class="Bound">M</a> <a id="16257" href="Prelude.AssocList.html#847" class="Function Operator">⁉</a> <a id="16259" href="Peras.SmallStep.html#16067" class="Bound">p</a> <a id="16261" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="16263" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="16268" href="Peras.SmallStep.html#16071" class="Bound">t</a>
        <a id="16278" class="Symbol">→</a> <a id="16280" class="Symbol">(</a><a id="16281" href="Peras.SmallStep.html#16281" class="Bound">vc</a> <a id="16284" class="Symbol">:</a> <a id="16286" href="Peras.Chain.html#4844" class="Datatype">ValidChain</a> <a id="16297" class="Symbol">(</a><a id="16298" href="Peras.SmallStep.html#16159" class="Bound">b</a> <a id="16300" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="16302" href="Peras.SmallStep.html#16197" class="Bound">pref</a><a id="16306" class="Symbol">))</a>
        <a id="16317" class="Symbol">→</a> <a id="16319" class="Symbol">(</a><a id="16320" href="Peras.SmallStep.html#16320" class="Bound">fᵈ</a> <a id="16323" class="Symbol">:</a> <a id="16325" href="Peras.Block.html#842" class="Function">PartyId</a> <a id="16333" class="Symbol">→</a> <a id="16335" href="Peras.SmallStep.html#2461" class="Function">Delay</a><a id="16340" class="Symbol">)</a>
          <a id="16352" class="Comment">----------------------------</a>
        <a id="16389" class="Symbol">→</a> <a id="16391" href="Peras.Block.html#1439" class="InductiveConstructor">Honest</a> <a id="16398" class="Symbol">{</a><a id="16399" href="Peras.SmallStep.html#16067" class="Bound">p</a><a id="16400" class="Symbol">}</a> <a id="16402" href="Peras.SmallStep.html#15986" class="Datatype Operator">⊢</a>
            <a id="16416" href="Peras.SmallStep.html#16075" class="Bound">M</a> <a id="16418" href="Peras.SmallStep.html#15986" class="Datatype Operator">↷</a> <a id="16420" href="Peras.SmallStep.html#11587" class="Function Operator">delay</a> <a id="16426" href="Peras.SmallStep.html#2305" class="InductiveConstructor">ChainMsg</a> <a id="16435" href="Peras.SmallStep.html#16281" class="Bound">vc</a> <a id="16438" href="Peras.SmallStep.html#11587" class="Function Operator">by</a> <a id="16441" href="Peras.SmallStep.html#16320" class="Bound">fᵈ</a>
                 <a id="16461" href="Peras.SmallStep.html#11587" class="Function Operator">update</a> <a id="16468" href="Peras.SmallStep.html#16075" class="Bound">M</a>
</pre>
<h2 id="small-step-semantics-1">Small-step semantics</h2>
The small-step semantics describe the evolution of the global state.
<pre class="Agda">    <a id="16580" class="Keyword">variable</a>
      <a id="16595" href="Peras.SmallStep.html#16595" class="Generalizable">M</a> <a id="16597" href="Peras.SmallStep.html#16597" class="Generalizable">N</a> <a id="16599" href="Peras.SmallStep.html#16599" class="Generalizable">O</a> <a id="16601" class="Symbol">:</a> <a id="16603" href="Peras.SmallStep.html#10101" class="Record">State</a>
      <a id="16615" href="Peras.SmallStep.html#16615" class="Generalizable">p</a> <a id="16617" class="Symbol">:</a> <a id="16619" href="Peras.Block.html#842" class="Function">PartyId</a>
      <a id="16633" href="Peras.SmallStep.html#16633" class="Generalizable">h</a> <a id="16635" class="Symbol">:</a> <a id="16637" href="Peras.Block.html#1406" class="Datatype">Honesty</a> <a id="16645" href="Peras.SmallStep.html#16615" class="Generalizable">p</a>
</pre>
<p>The relation allows</p>
<ul>
<li>Fetching messages at the beginning of each slot</li>
<li>Block creation</li>
<li>Voting</li>
<li>Transitioning to next slot
<pre class="Agda">    <a id="16789" class="Keyword">data</a> <a id="16794" href="Peras.SmallStep.html#16794" class="Datatype Operator">_↝_</a> <a id="16798" class="Symbol">:</a> <a id="16800" href="Peras.SmallStep.html#10101" class="Record">State</a> <a id="16806" class="Symbol">→</a> <a id="16808" href="Peras.SmallStep.html#10101" class="Record">State</a> <a id="16814" class="Symbol">→</a> <a id="16816" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="16820" class="Keyword">where</a>

    <a id="16833" href="Peras.SmallStep.html#16833" class="InductiveConstructor">Fetch</a> <a id="16839" class="Symbol">:</a> <a id="16841" class="Symbol">∀</a> <a id="16843" class="Symbol">{</a><a id="16844" href="Peras.SmallStep.html#16844" class="Bound">m</a><a id="16845" class="Symbol">}</a> <a id="16847" class="Symbol">→</a>
      <a id="16857" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="16859" href="Peras.SmallStep.html#16633" class="Generalizable">h</a> <a id="16861" href="Peras.SmallStep.html#11968" class="Datatype Operator">⊢</a> <a id="16863" href="Peras.SmallStep.html#16595" class="Generalizable">M</a> <a id="16865" href="Peras.SmallStep.html#11968" class="Datatype Operator">[</a> <a id="16867" href="Peras.SmallStep.html#16844" class="Bound">m</a> <a id="16869" href="Peras.SmallStep.html#11968" class="Datatype Operator">]⇀</a> <a id="16872" href="Peras.SmallStep.html#16597" class="Generalizable">N</a>
        <a id="16884" href="Prelude.InferenceRules.html#14206" class="Function Operator">──────────────</a>
        <a id="16909" href="Peras.SmallStep.html#16595" class="Generalizable">M</a> <a id="16911" href="Peras.SmallStep.html#16794" class="Datatype Operator">↝</a> <a id="16913" href="Peras.SmallStep.html#16597" class="Generalizable">N</a>

    <a id="16922" href="Peras.SmallStep.html#16922" class="InductiveConstructor">CreateVote</a> <a id="16933" class="Symbol">:</a>
      <a id="16943" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="16945" href="Peras.SmallStep.html#10673" class="Function">Fetched</a> <a id="16953" href="Peras.SmallStep.html#16595" class="Generalizable">M</a>
      <a id="16963" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="16965" href="Peras.SmallStep.html#16633" class="Generalizable">h</a> <a id="16967" href="Peras.SmallStep.html#13583" class="Datatype Operator">⊢</a> <a id="16969" href="Peras.SmallStep.html#16595" class="Generalizable">M</a> <a id="16971" href="Peras.SmallStep.html#13583" class="Datatype Operator">⇉</a> <a id="16973" href="Peras.SmallStep.html#16597" class="Generalizable">N</a>
        <a id="16985" href="Prelude.InferenceRules.html#14291" class="Function Operator">─────────</a>
        <a id="17005" href="Peras.SmallStep.html#16595" class="Generalizable">M</a> <a id="17007" href="Peras.SmallStep.html#16794" class="Datatype Operator">↝</a> <a id="17009" href="Peras.SmallStep.html#16597" class="Generalizable">N</a>

    <a id="17018" href="Peras.SmallStep.html#17018" class="InductiveConstructor">CreateBlock</a> <a id="17030" class="Symbol">:</a>
      <a id="17040" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="17042" href="Peras.SmallStep.html#10673" class="Function">Fetched</a> <a id="17050" href="Peras.SmallStep.html#16595" class="Generalizable">M</a>
      <a id="17060" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="17062" href="Peras.SmallStep.html#16633" class="Generalizable">h</a> <a id="17064" href="Peras.SmallStep.html#15986" class="Datatype Operator">⊢</a> <a id="17066" href="Peras.SmallStep.html#16595" class="Generalizable">M</a> <a id="17068" href="Peras.SmallStep.html#15986" class="Datatype Operator">↷</a> <a id="17070" href="Peras.SmallStep.html#16597" class="Generalizable">N</a>
        <a id="17082" href="Prelude.InferenceRules.html#14291" class="Function Operator">─────────</a>
        <a id="17102" href="Peras.SmallStep.html#16595" class="Generalizable">M</a> <a id="17104" href="Peras.SmallStep.html#16794" class="Datatype Operator">↝</a> <a id="17106" href="Peras.SmallStep.html#16597" class="Generalizable">N</a>

    <a id="17115" href="Peras.SmallStep.html#17115" class="InductiveConstructor">NextSlot</a> <a id="17124" class="Symbol">:</a>
      <a id="17134" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="17136" href="Peras.SmallStep.html#10673" class="Function">Fetched</a> <a id="17144" href="Peras.SmallStep.html#16595" class="Generalizable">M</a>
        <a id="17156" href="Prelude.InferenceRules.html#14276" class="Function Operator">──────────</a>
        <a id="17177" href="Peras.SmallStep.html#16595" class="Generalizable">M</a> <a id="17179" href="Peras.SmallStep.html#16794" class="Datatype Operator">↝</a> <a id="17181" href="Peras.SmallStep.html#10911" class="Function">tick</a> <a id="17186" href="Peras.SmallStep.html#16595" class="Generalizable">M</a>
</pre>
<h4 id="reflexive-transitive-closure">Reflexive, transitive closure</h4>
List-like structure for defining execution paths.
<pre class="Agda">    <a id="17289" class="Keyword">infix</a>  <a id="17296" class="Number">2</a> <a id="17298" href="Peras.SmallStep.html#17345" class="Datatype Operator">_↝⋆_</a>
  <a id="17307" class="Keyword">infixr</a> <a id="17314" class="Number">2</a> <a id="17316" href="Peras.SmallStep.html#17401" class="InductiveConstructor Operator">_↣_</a>
  <a id="17324" class="Keyword">infix</a>  <a id="17331" class="Number">3</a> <a id="17333" href="Peras.SmallStep.html#17384" class="InductiveConstructor">∎</a>

  <a id="17340" class="Keyword">data</a> <a id="17345" href="Peras.SmallStep.html#17345" class="Datatype Operator">_↝⋆_</a> <a id="17350" class="Symbol">:</a> <a id="17352" href="Peras.SmallStep.html#10101" class="Record">State</a> <a id="17358" class="Symbol">→</a> <a id="17360" href="Peras.SmallStep.html#10101" class="Record">State</a> <a id="17366" class="Symbol">→</a> <a id="17368" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="17372" class="Keyword">where</a>
    <a id="17384" href="Peras.SmallStep.html#17384" class="InductiveConstructor">∎</a> <a id="17386" class="Symbol">:</a> <a id="17388" href="Peras.SmallStep.html#16595" class="Generalizable">M</a> <a id="17390" href="Peras.SmallStep.html#17345" class="Datatype Operator">↝⋆</a> <a id="17393" href="Peras.SmallStep.html#16595" class="Generalizable">M</a>
    <a id="17401" href="Peras.SmallStep.html#17401" class="InductiveConstructor Operator">_↣_</a> <a id="17405" class="Symbol">:</a> <a id="17407" href="Peras.SmallStep.html#16595" class="Generalizable">M</a> <a id="17409" href="Peras.SmallStep.html#16794" class="Datatype Operator">↝</a> <a id="17411" href="Peras.SmallStep.html#16597" class="Generalizable">N</a> <a id="17413" class="Symbol">→</a> <a id="17415" href="Peras.SmallStep.html#16597" class="Generalizable">N</a> <a id="17417" href="Peras.SmallStep.html#17345" class="Datatype Operator">↝⋆</a> <a id="17420" href="Peras.SmallStep.html#16599" class="Generalizable">O</a> <a id="17422" class="Symbol">→</a> <a id="17424" href="Peras.SmallStep.html#16595" class="Generalizable">M</a> <a id="17426" href="Peras.SmallStep.html#17345" class="Datatype Operator">↝⋆</a> <a id="17429" href="Peras.SmallStep.html#16599" class="Generalizable">O</a>
</pre>
<pre class="Agda">    <a id="17447" class="Keyword">infixr</a> <a id="17454" class="Number">2</a> <a id="17456" href="Peras.SmallStep.html#17467" class="Function Operator">_++&#39;_</a>

  <a id="17467" href="Peras.SmallStep.html#17467" class="Function Operator">_++&#39;_</a> <a id="17473" class="Symbol">:</a>
      <a id="17483" href="Peras.SmallStep.html#16595" class="Generalizable">M</a> <a id="17485" href="Peras.SmallStep.html#17345" class="Datatype Operator">↝⋆</a> <a id="17488" href="Peras.SmallStep.html#16597" class="Generalizable">N</a>
    <a id="17496" class="Symbol">→</a> <a id="17498" href="Peras.SmallStep.html#16597" class="Generalizable">N</a> <a id="17500" href="Peras.SmallStep.html#17345" class="Datatype Operator">↝⋆</a> <a id="17503" href="Peras.SmallStep.html#16599" class="Generalizable">O</a>
    <a id="17511" class="Symbol">→</a> <a id="17513" href="Peras.SmallStep.html#16595" class="Generalizable">M</a> <a id="17515" href="Peras.SmallStep.html#17345" class="Datatype Operator">↝⋆</a> <a id="17518" href="Peras.SmallStep.html#16599" class="Generalizable">O</a>
  <a id="17524" href="Peras.SmallStep.html#17384" class="InductiveConstructor">∎</a> <a id="17526" href="Peras.SmallStep.html#17467" class="Function Operator">++&#39;</a> <a id="17530" href="Peras.SmallStep.html#17530" class="Bound">M↝⋆O</a> <a id="17535" class="Symbol">=</a> <a id="17537" href="Peras.SmallStep.html#17530" class="Bound">M↝⋆O</a>
  <a id="17546" class="Symbol">(</a><a id="17547" href="Peras.SmallStep.html#17547" class="Bound">M↝M₁</a> <a id="17552" href="Peras.SmallStep.html#17401" class="InductiveConstructor Operator">↣</a> <a id="17554" href="Peras.SmallStep.html#17554" class="Bound">M₁↝⋆N</a><a id="17559" class="Symbol">)</a> <a id="17561" href="Peras.SmallStep.html#17467" class="Function Operator">++&#39;</a> <a id="17565" href="Peras.SmallStep.html#17565" class="Bound">N↝⋆O</a> <a id="17570" class="Symbol">=</a> <a id="17572" href="Peras.SmallStep.html#17547" class="Bound">M↝M₁</a> <a id="17577" href="Peras.SmallStep.html#17401" class="InductiveConstructor Operator">↣</a> <a id="17579" href="Peras.SmallStep.html#17554" class="Bound">M₁↝⋆N</a> <a id="17585" href="Peras.SmallStep.html#17467" class="Function Operator">++&#39;</a> <a id="17589" href="Peras.SmallStep.html#17565" class="Bound">N↝⋆O</a>
</pre>
<pre class="Agda">  <a id="17608" class="Keyword">open</a> <a id="17613" href="Peras.SmallStep.html#6821" class="Module">Semantics</a> <a id="17623" class="Keyword">public</a>
</pre></li>
</ul>
</body>
</html>
