<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Peras.Block</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="Agda.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<pre class="Agda"><a id="9" class="Keyword">module</a> <a id="16" href="Peras.Block.html" class="Module">Peras.Block</a> <a id="28" class="Keyword">where</a>
</pre>
<!--
<pre class="Agda"><a id="52" class="Keyword">open</a> <a id="57" class="Keyword">import</a> <a id="64" href="Haskell.Prelude.html" class="Module">Haskell.Prelude</a>
<a id="80" class="Keyword">open</a> <a id="85" class="Keyword">import</a> <a id="92" href="Haskell.Law.Bool.html" class="Module">Haskell.Law.Bool</a>

<a id="110" class="Keyword">open</a> <a id="115" class="Keyword">import</a> <a id="122" href="Peras.Crypto.html" class="Module">Peras.Crypto</a>
<a id="135" class="Keyword">open</a> <a id="140" class="Keyword">import</a> <a id="147" href="Peras.Numbering.html" class="Module">Peras.Numbering</a>
<a id="163" class="Keyword">open</a> <a id="168" class="Keyword">import</a> <a id="175" href="Peras.Util.html" class="Module">Peras.Util</a>

<a id="187" class="Keyword">open</a> <a id="192" class="Keyword">import</a> <a id="199" href="Data.Product.html" class="Module">Data.Product</a> <a id="212" class="Keyword">using</a> <a id="218" class="Symbol">(</a><a id="219" href="Data.Product.Base.html#852" class="Function">∃</a><a id="220" class="Symbol">;</a> <a id="222" href="Data.Product.Base.html#1371" class="Function">∃-syntax</a><a id="230" class="Symbol">)</a>
<a id="232" class="Keyword">open</a> <a id="237" class="Keyword">import</a> <a id="244" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="282" class="Keyword">using</a> <a id="288" class="Symbol">(</a><a id="289" href="Relation.Binary.PropositionalEquality.Core.html#1158" class="Function">cong</a><a id="293" class="Symbol">;</a> <a id="295" href="Relation.Binary.PropositionalEquality.Core.html#1395" class="Function">cong₂</a><a id="300" class="Symbol">)</a>

<a id="303" class="Symbol">{-#</a> <a id="307" class="Keyword">FOREIGN</a> <a id="315" class="Pragma">AGDA2HS</a>
<a id="323" class="Symbol">{-#</a> <a id="327" class="Pragma">LANGUAGE</a> <a id="336" class="Pragma">DeriveGeneric</a> <a id="350" class="Symbol">#-}</a>
<a id="354" class="Symbol">{-#</a> <a id="358" class="Pragma">OPTIONS_GHC</a> <a id="370" class="Pragma">-fno-warn-missing-pattern-synonym-signatures</a> <a id="415" class="Symbol">#-}</a>
<a id="419" class="Symbol">{-#</a> <a id="423" class="Pragma">OPTIONS_GHC</a> <a id="435" class="Pragma">-fno-warn-missing-signatures</a> <a id="464" class="Symbol">#-}</a>
<a id="468" class="Symbol">{-#</a> <a id="472" class="Pragma">OPTIONS_GHC</a> <a id="484" class="Pragma">-fno-warn-name-shadowing</a> <a id="509" class="Symbol">#-}</a>
<a id="513" class="Symbol">{-#</a> <a id="517" class="Pragma">OPTIONS_GHC</a> <a id="529" class="Pragma">-fno-warn-type-defaults</a> <a id="553" class="Symbol">#-}</a>
<a id="557" class="Symbol">{-#</a> <a id="561" class="Pragma">OPTIONS_GHC</a> <a id="573" class="Pragma">-fno-warn-unused-imports</a> <a id="598" class="Symbol">#-}</a>
<a id="602" class="Symbol">{-#</a> <a id="606" class="Pragma">OPTIONS_GHC</a> <a id="618" class="Pragma">-fno-warn-unused-matches</a> <a id="643" class="Symbol">#-}</a>
<a id="647" class="Pragma">import</a> <a id="654" class="Pragma">GHC.Generics</a> <a id="667" class="Pragma">(Generic)</a>
<a id="677" class="Pragma">import</a> <a id="684" class="Pragma">Peras.Crypto</a> <a id="697" class="Pragma">(Hash</a> <a id="703" class="Pragma">(..),</a> <a id="709" class="Pragma">Hashable</a> <a id="718" class="Pragma">(..))</a>
<a id="724" class="Pragma">import</a> <a id="731" class="Pragma">Prelude</a> <a id="739" class="Pragma">hiding</a> <a id="746" class="Pragma">(round)</a>
<a id="754" class="Symbol">#-}</a>

<a id="759" class="Symbol">{-#</a> <a id="763" class="Keyword">FOREIGN</a> <a id="771" class="Pragma">GHC</a>
<a id="775" class="Pragma">import</a> <a id="782" class="Pragma">qualified</a> <a id="792" class="Pragma">Peras.Block</a> <a id="804" class="Pragma">as</a> <a id="807" class="Pragma">G</a>
<a id="809" class="Symbol">#-}</a>
</pre>-->
<h2 id="partyid">PartyId</h2>
<pre class="Agda"><a id="PartyId"></a><a id="842" href="Peras.Block.html#842" class="Function">PartyId</a> <a id="850" class="Symbol">=</a> <a id="852" href="Agda.Builtin.Nat.html#203" class="Datatype">Nat</a>
</pre>
<!--
<pre class="Agda"><a id="874" class="Symbol">{-#</a> <a id="878" class="Keyword">FOREIGN</a> <a id="886" class="Pragma">AGDA2HS</a>
<a id="894" class="Pragma">--</a> <a id="897" class="Pragma">Use</a> <a id="901" class="Pragma">`Integer`</a> <a id="911" class="Pragma">for</a> <a id="915" class="Pragma">compatibility</a> <a id="929" class="Pragma">with</a> <a id="934" class="Pragma">`MAlonzo`.</a>
<a id="945" class="Pragma">type</a> <a id="950" class="Pragma">PartyId</a> <a id="958" class="Pragma">=</a> <a id="960" class="Pragma">Integer</a>
<a id="968" class="Symbol">#-}</a>
</pre>-->
<h2 id="party">Party</h2>
<pre class="Agda"><a id="999" class="Keyword">record</a> <a id="Party"></a><a id="1006" href="Peras.Block.html#1006" class="Record">Party</a> <a id="1012" class="Symbol">:</a> <a id="1014" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1018" class="Keyword">where</a>
  <a id="1026" class="Keyword">constructor</a> <a id="MkParty"></a><a id="1038" href="Peras.Block.html#1038" class="InductiveConstructor">MkParty</a>
  <a id="1048" class="Keyword">field</a> <a id="Party.pid"></a><a id="1054" href="Peras.Block.html#1054" class="Field">pid</a> <a id="1058" class="Symbol">:</a> <a id="1060" href="Peras.Block.html#842" class="Function">PartyId</a>
        <a id="Party.pkey"></a><a id="1076" href="Peras.Block.html#1076" class="Field">pkey</a> <a id="1081" class="Symbol">:</a> <a id="1083" href="Peras.Crypto.html#3968" class="Record">VerificationKey</a>

<a id="1100" class="Keyword">open</a> <a id="1105" href="Peras.Block.html#1006" class="Module">Party</a> <a id="1111" class="Keyword">public</a>

<a id="1119" class="Keyword">instance</a>
  <a id="iPartyEq"></a><a id="1130" href="Peras.Block.html#1130" class="Function">iPartyEq</a> <a id="1139" class="Symbol">:</a> <a id="1141" href="Haskell.Prim.Eq.html#401" class="Record">Eq</a> <a id="1144" href="Peras.Block.html#1006" class="Record">Party</a>
  <a id="1152" href="Peras.Block.html#1130" class="Function">iPartyEq</a> <a id="1161" class="Symbol">.</a><a id="1162" href="Haskell.Prim.Eq.html#453" class="Field Operator">_==_</a> <a id="1167" href="Peras.Block.html#1167" class="Bound">x</a> <a id="1169" href="Peras.Block.html#1169" class="Bound">y</a> <a id="1171" class="Symbol">=</a> <a id="1173" href="Peras.Block.html#1054" class="Field">pid</a> <a id="1177" href="Peras.Block.html#1167" class="Bound">x</a> <a id="1179" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="1182" href="Peras.Block.html#1054" class="Field">pid</a> <a id="1186" href="Peras.Block.html#1169" class="Bound">y</a> <a id="1188" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="1191" href="Peras.Block.html#1076" class="Field">pkey</a> <a id="1196" href="Peras.Block.html#1167" class="Bound">x</a> <a id="1198" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="1201" href="Peras.Block.html#1076" class="Field">pkey</a> <a id="1206" href="Peras.Block.html#1169" class="Bound">y</a>
</pre>
<!--
<pre class="Agda"><a id="1226" class="Symbol">{-#</a> <a id="1230" class="Keyword">COMPILE</a> <a id="1238" class="Keyword">AGDA2HS</a> <a id="1246" href="Peras.Block.html#1006" class="Record">Party</a> <a id="1252" class="Pragma">deriving</a> <a id="1261" class="Pragma">(Generic)</a> <a id="1271" class="Symbol">#-}</a>
<a id="1275" class="Symbol">{-#</a> <a id="1279" class="Keyword">COMPILE</a> <a id="1287" class="Keyword">GHC</a> <a id="1291" href="Peras.Block.html#1006" class="Record">Party</a> <a id="1297" class="Pragma">=</a> <a id="1299" class="Pragma">data</a> <a id="1304" class="Pragma">G.Party</a> <a id="1312" class="Pragma">(G.MkParty)</a> <a id="1324" class="Symbol">#-}</a>
<a id="1328" class="Symbol">{-#</a> <a id="1332" class="Keyword">COMPILE</a> <a id="1340" class="Keyword">AGDA2HS</a> <a id="1348" href="Peras.Block.html#1130" class="Function">iPartyEq</a> <a id="1357" class="Symbol">#-}</a>
</pre>-->
<h2 id="honesty-of-a-party">Honesty of a party</h2>
<pre class="Agda"><a id="1401" class="Keyword">data</a> <a id="Honesty"></a><a id="1406" href="Peras.Block.html#1406" class="Datatype">Honesty</a> <a id="1414" class="Symbol">:</a> <a id="1416" href="Peras.Block.html#842" class="Function">PartyId</a> <a id="1424" class="Symbol">→</a> <a id="1426" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1430" class="Keyword">where</a>

  <a id="Honesty.Honest"></a><a id="1439" href="Peras.Block.html#1439" class="InductiveConstructor">Honest</a> <a id="1446" class="Symbol">:</a> <a id="1448" class="Symbol">∀</a> <a id="1450" class="Symbol">{</a><a id="1451" href="Peras.Block.html#1451" class="Bound">p</a> <a id="1453" class="Symbol">:</a> <a id="1455" href="Peras.Block.html#842" class="Function">PartyId</a><a id="1462" class="Symbol">}</a>
    <a id="1468" class="Symbol">→</a> <a id="1470" href="Peras.Block.html#1406" class="Datatype">Honesty</a> <a id="1478" href="Peras.Block.html#1451" class="Bound">p</a>

  <a id="Honesty.Corrupt"></a><a id="1483" href="Peras.Block.html#1483" class="InductiveConstructor">Corrupt</a> <a id="1491" class="Symbol">:</a> <a id="1493" class="Symbol">∀</a> <a id="1495" class="Symbol">{</a><a id="1496" href="Peras.Block.html#1496" class="Bound">p</a> <a id="1498" class="Symbol">:</a> <a id="1500" href="Peras.Block.html#842" class="Function">PartyId</a><a id="1507" class="Symbol">}</a>
    <a id="1513" class="Symbol">→</a> <a id="1515" href="Peras.Block.html#1406" class="Datatype">Honesty</a> <a id="1523" href="Peras.Block.html#1496" class="Bound">p</a>
</pre>
<pre class="Agda"><a id="PartyTup"></a><a id="1538" href="Peras.Block.html#1538" class="Function">PartyTup</a> <a id="1547" class="Symbol">=</a> <a id="1549" href="Data.Product.Base.html#1371" class="Function">∃[</a> <a id="1552" href="Peras.Block.html#1552" class="Bound">p</a> <a id="1554" href="Data.Product.Base.html#1371" class="Function">]</a> <a id="1556" class="Symbol">(</a><a id="1557" href="Peras.Block.html#1406" class="Datatype">Honesty</a> <a id="1565" href="Peras.Block.html#1552" class="Bound">p</a><a id="1566" class="Symbol">)</a>
<a id="Parties"></a><a id="1568" href="Peras.Block.html#1568" class="Function">Parties</a> <a id="1576" class="Symbol">=</a> <a id="1578" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1583" href="Peras.Block.html#1538" class="Function">PartyTup</a>
</pre>
<h2 id="transactions">Transactions</h2>
<pre class="Agda"><a id="Tx"></a><a id="1622" href="Peras.Block.html#1622" class="Function">Tx</a> <a id="1625" class="Symbol">=</a> <a id="1627" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
</pre>
<!--
<pre class="Agda"><a id="1647" class="Symbol">{-#</a> <a id="1651" class="Keyword">COMPILE</a> <a id="1659" class="Keyword">AGDA2HS</a> <a id="1667" href="Peras.Block.html#1622" class="Function">Tx</a> <a id="1670" class="Symbol">#-}</a>
</pre>-->
<h2 id="block-and-certificate">Block and Certificate</h2>
<p>In addition to a Praos block, there is an optional field for the
included certificate. <strong>Note</strong>: What we name
<code>Block</code> is actually a block <em>Header</em>, we use
<code>BlockBody</code> to contain the payload.</p>
<p>A Peras Certificate represents an aggregated quorum of votes for a
specific block at a specific round. Such a certificate is supposed to be
self-contained and verifiable by any node.</p>
<pre class="Agda"><a id="2093" class="Keyword">record</a> <a id="Block"></a><a id="2100" href="Peras.Block.html#2100" class="Record">Block</a> <a id="2106" class="Symbol">:</a> <a id="2108" href="Agda.Primitive.html#388" class="Primitive">Set</a>
<a id="2112" class="Keyword">record</a> <a id="BlockBody"></a><a id="2119" href="Peras.Block.html#2119" class="Record">BlockBody</a> <a id="2129" class="Symbol">:</a> <a id="2131" href="Agda.Primitive.html#388" class="Primitive">Set</a>
<a id="2135" class="Keyword">record</a> <a id="Certificate"></a><a id="2142" href="Peras.Block.html#2142" class="Record">Certificate</a> <a id="2154" class="Symbol">:</a> <a id="2156" href="Agda.Primitive.html#388" class="Primitive">Set</a>

<a id="Payload"></a><a id="2161" href="Peras.Block.html#2161" class="Function">Payload</a> <a id="2169" class="Symbol">=</a> <a id="2171" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2176" href="Peras.Block.html#1622" class="Function">Tx</a>

<a id="2180" class="Keyword">record</a> <a id="2187" href="Peras.Block.html#2142" class="Record">Certificate</a> <a id="2199" class="Keyword">where</a>
  <a id="2207" class="Keyword">constructor</a> <a id="MkCertificate"></a><a id="2219" href="Peras.Block.html#2219" class="InductiveConstructor">MkCertificate</a>
  <a id="2235" class="Keyword">pattern</a>
  <a id="2245" class="Keyword">field</a> <a id="Certificate.round"></a><a id="2251" href="Peras.Block.html#2251" class="Field">round</a> <a id="2257" class="Symbol">:</a> <a id="2259" href="Peras.Numbering.html#1962" class="Record">RoundNumber</a>
        <a id="Certificate.blockRef"></a><a id="2279" href="Peras.Block.html#2279" class="Field">blockRef</a> <a id="2288" class="Symbol">:</a> <a id="2290" href="Peras.Crypto.html#1835" class="Record">Hash</a> <a id="2295" href="Peras.Block.html#2100" class="Record">Block</a>

  <a id="Certificate.roundNumber"></a><a id="2304" href="Peras.Block.html#2304" class="Function">roundNumber</a> <a id="2316" class="Symbol">:</a> <a id="2318" href="Agda.Builtin.Nat.html#203" class="Datatype">Nat</a>
  <a id="2324" href="Peras.Block.html#2304" class="Function">roundNumber</a> <a id="2336" class="Symbol">=</a> <a id="2338" href="Peras.Numbering.html#2022" class="Field">getRoundNumber</a> <a id="2353" href="Peras.Block.html#2251" class="Field">round</a>

<a id="2360" class="Keyword">open</a> <a id="2365" href="Peras.Block.html#2142" class="Module">Certificate</a> <a id="2377" class="Keyword">public</a>

<a id="latestCert"></a><a id="2385" href="Peras.Block.html#2385" class="Function">latestCert</a> <a id="2396" class="Symbol">:</a> <a id="2398" href="Peras.Block.html#2142" class="Record">Certificate</a> <a id="2410" class="Symbol">→</a> <a id="2412" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2417" href="Peras.Block.html#2142" class="Record">Certificate</a> <a id="2429" class="Symbol">→</a> <a id="2431" href="Peras.Block.html#2142" class="Record">Certificate</a>
<a id="2443" href="Peras.Block.html#2385" class="Function">latestCert</a> <a id="2454" href="Peras.Block.html#2454" class="Bound">c</a> <a id="2456" class="Symbol">=</a> <a id="2458" href="Peras.Util.html#1032" class="Function">maximumBy</a> <a id="2468" href="Peras.Block.html#2454" class="Bound">c</a> <a id="2470" class="Symbol">(</a><a id="2471" href="Peras.Util.html#1292" class="Function">comparing</a> <a id="2481" href="Peras.Block.html#2251" class="Field">round</a><a id="2486" class="Symbol">)</a>

<a id="2489" class="Keyword">record</a> <a id="2496" href="Peras.Block.html#2100" class="Record">Block</a> <a id="2502" class="Keyword">where</a>
  <a id="2510" class="Keyword">constructor</a> <a id="MkBlock"></a><a id="2522" href="Peras.Block.html#2522" class="InductiveConstructor">MkBlock</a>
  <a id="2532" class="Keyword">field</a> <a id="Block.slotNumber"></a><a id="2538" href="Peras.Block.html#2538" class="Field">slotNumber</a> <a id="2549" class="Symbol">:</a> <a id="2551" href="Peras.Numbering.html#1035" class="Record">SlotNumber</a>
        <a id="Block.creatorId"></a><a id="2570" href="Peras.Block.html#2570" class="Field">creatorId</a> <a id="2580" class="Symbol">:</a> <a id="2582" href="Peras.Block.html#842" class="Function">PartyId</a>
        <a id="Block.parentBlock"></a><a id="2598" href="Peras.Block.html#2598" class="Field">parentBlock</a> <a id="2610" class="Symbol">:</a> <a id="2612" href="Peras.Crypto.html#1835" class="Record">Hash</a> <a id="2617" href="Peras.Block.html#2100" class="Record">Block</a>
        <a id="Block.certificate"></a><a id="2631" href="Peras.Block.html#2631" class="Field">certificate</a> <a id="2643" class="Symbol">:</a> <a id="2645" href="Haskell.Prim.Maybe.html#101" class="Datatype">Maybe</a> <a id="2651" href="Peras.Block.html#2142" class="Record">Certificate</a>
        <a id="Block.leadershipProof"></a><a id="2671" href="Peras.Block.html#2671" class="Field">leadershipProof</a> <a id="2687" class="Symbol">:</a> <a id="2689" href="Peras.Crypto.html#2886" class="Record">LeadershipProof</a>
        <a id="Block.signature"></a><a id="2713" href="Peras.Block.html#2713" class="Field">signature</a> <a id="2723" class="Symbol">:</a> <a id="2725" href="Peras.Crypto.html#3408" class="Record">Signature</a>
        <a id="Block.bodyHash"></a><a id="2743" href="Peras.Block.html#2743" class="Field">bodyHash</a> <a id="2752" class="Symbol">:</a> <a id="2754" href="Peras.Crypto.html#1835" class="Record">Hash</a> <a id="2759" href="Peras.Block.html#2161" class="Function">Payload</a>

  <a id="Block.slotNumber&#39;"></a><a id="2770" href="Peras.Block.html#2770" class="Function">slotNumber&#39;</a> <a id="2782" class="Symbol">:</a> <a id="2784" href="Agda.Builtin.Nat.html#203" class="Datatype">Nat</a>
  <a id="2790" href="Peras.Block.html#2770" class="Function">slotNumber&#39;</a> <a id="2802" class="Symbol">=</a> <a id="2804" href="Peras.Numbering.html#1093" class="Field">getSlotNumber</a> <a id="2818" href="Peras.Block.html#2538" class="Field">slotNumber</a>

<a id="2830" class="Keyword">open</a> <a id="2835" href="Peras.Block.html#2100" class="Module">Block</a> <a id="2841" class="Keyword">public</a>

<a id="2849" class="Keyword">record</a> <a id="2856" href="Peras.Block.html#2119" class="Record">BlockBody</a> <a id="2866" class="Keyword">where</a>
  <a id="2874" class="Keyword">constructor</a> <a id="MkBlockBody"></a><a id="2886" href="Peras.Block.html#2886" class="InductiveConstructor">MkBlockBody</a>
  <a id="2900" class="Keyword">field</a> <a id="BlockBody.blockHash"></a><a id="2906" href="Peras.Block.html#2906" class="Field">blockHash</a> <a id="2916" class="Symbol">:</a> <a id="2918" href="Peras.Crypto.html#1835" class="Record">Hash</a> <a id="2923" href="Peras.Block.html#2161" class="Function">Payload</a>
        <a id="BlockBody.payload"></a><a id="2939" href="Peras.Block.html#2939" class="Field">payload</a> <a id="2947" class="Symbol">:</a> <a id="2949" href="Peras.Block.html#2161" class="Function">Payload</a>

<a id="2958" class="Keyword">open</a> <a id="2963" href="Peras.Block.html#2119" class="Module">BlockBody</a> <a id="2973" class="Keyword">public</a>
</pre>
<!--
<pre class="Agda"><a id="2997" class="Symbol">{-#</a> <a id="3001" class="Keyword">COMPILE</a> <a id="3009" class="Keyword">AGDA2HS</a> <a id="3017" href="Peras.Block.html#2161" class="Function">Payload</a> <a id="3025" class="Symbol">#-}</a>
<a id="3029" class="Symbol">{-#</a> <a id="3033" class="Keyword">COMPILE</a> <a id="3041" class="Keyword">AGDA2HS</a> <a id="3049" href="Peras.Block.html#2100" class="Record">Block</a> <a id="3055" class="Pragma">deriving</a> <a id="3064" class="Pragma">(Generic)</a> <a id="3074" class="Symbol">#-}</a>
<a id="3078" class="Symbol">{-#</a> <a id="3082" class="Keyword">COMPILE</a> <a id="3090" class="Keyword">GHC</a> <a id="3094" href="Peras.Block.html#2100" class="Record">Block</a> <a id="3100" class="Pragma">=</a> <a id="3102" class="Pragma">data</a> <a id="3107" class="Pragma">G.Block</a> <a id="3115" class="Pragma">(G.MkBlock)</a> <a id="3127" class="Symbol">#-}</a>
<a id="3131" class="Symbol">{-#</a> <a id="3135" class="Keyword">COMPILE</a> <a id="3143" class="Keyword">AGDA2HS</a> <a id="3151" href="Peras.Block.html#2119" class="Record">BlockBody</a> <a id="3161" class="Pragma">deriving</a> <a id="3170" class="Pragma">(Generic)</a> <a id="3180" class="Symbol">#-}</a>
<a id="3184" class="Symbol">{-#</a> <a id="3188" class="Keyword">COMPILE</a> <a id="3196" class="Keyword">GHC</a> <a id="3200" href="Peras.Block.html#2119" class="Record">BlockBody</a> <a id="3210" class="Pragma">=</a> <a id="3212" class="Pragma">data</a> <a id="3217" class="Pragma">G.BlockBody</a> <a id="3229" class="Pragma">(G.MkBlockBody)</a> <a id="3245" class="Symbol">#-}</a>
<a id="3249" class="Symbol">{-#</a> <a id="3253" class="Keyword">COMPILE</a> <a id="3261" class="Keyword">AGDA2HS</a> <a id="3269" href="Peras.Block.html#2142" class="Record">Certificate</a> <a id="3281" class="Pragma">deriving</a> <a id="3290" class="Pragma">(Generic)</a> <a id="3300" class="Symbol">#-}</a>
<a id="3304" class="Symbol">{-#</a> <a id="3308" class="Keyword">COMPILE</a> <a id="3316" class="Keyword">GHC</a> <a id="3320" href="Peras.Block.html#2142" class="Record">Certificate</a> <a id="3332" class="Pragma">=</a> <a id="3334" class="Pragma">data</a> <a id="3339" class="Pragma">G.Certificate</a> <a id="3353" class="Pragma">(G.MkCertificate)</a> <a id="3371" class="Symbol">#-}</a>
</pre>-->
<pre class="Agda"><a id="3392" class="Keyword">instance</a>
  <a id="iCertificateEq"></a><a id="3403" href="Peras.Block.html#3403" class="Function">iCertificateEq</a> <a id="3418" class="Symbol">:</a> <a id="3420" href="Haskell.Prim.Eq.html#401" class="Record">Eq</a> <a id="3423" href="Peras.Block.html#2142" class="Record">Certificate</a>
  <a id="3437" href="Peras.Block.html#3403" class="Function">iCertificateEq</a> <a id="3452" class="Symbol">.</a><a id="3453" href="Haskell.Prim.Eq.html#453" class="Field Operator">_==_</a> <a id="3458" href="Peras.Block.html#3458" class="Bound">x</a> <a id="3460" href="Peras.Block.html#3460" class="Bound">y</a> <a id="3462" class="Symbol">=</a> <a id="3464" href="Peras.Block.html#2251" class="Field">round</a> <a id="3470" href="Peras.Block.html#3458" class="Bound">x</a> <a id="3472" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="3475" href="Peras.Block.html#2251" class="Field">round</a> <a id="3481" href="Peras.Block.html#3460" class="Bound">y</a> <a id="3483" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="3486" href="Peras.Block.html#2279" class="Field">blockRef</a> <a id="3495" href="Peras.Block.html#3458" class="Bound">x</a> <a id="3497" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="3500" href="Peras.Block.html#2279" class="Field">blockRef</a> <a id="3509" href="Peras.Block.html#3460" class="Bound">y</a>

<a id="eqCertificate-sound"></a><a id="3512" href="Peras.Block.html#3512" class="Function">eqCertificate-sound</a> <a id="3532" class="Symbol">:</a> <a id="3534" class="Symbol">∀</a> <a id="3536" class="Symbol">{</a><a id="3537" href="Peras.Block.html#3537" class="Bound">c₁</a> <a id="3540" href="Peras.Block.html#3540" class="Bound">c₂</a> <a id="3543" class="Symbol">:</a> <a id="3545" href="Peras.Block.html#2142" class="Record">Certificate</a><a id="3556" class="Symbol">}</a> <a id="3558" class="Symbol">→</a> <a id="3560" class="Symbol">(</a><a id="3561" href="Peras.Block.html#3537" class="Bound">c₁</a> <a id="3564" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="3567" href="Peras.Block.html#3540" class="Bound">c₂</a><a id="3569" class="Symbol">)</a> <a id="3571" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3573" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">True</a> <a id="3578" class="Symbol">→</a> <a id="3580" href="Peras.Block.html#3537" class="Bound">c₁</a> <a id="3583" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3585" href="Peras.Block.html#3540" class="Bound">c₂</a>
<a id="3588" href="Peras.Block.html#3512" class="Function">eqCertificate-sound</a> <a id="3608" class="Symbol">{</a><a id="3609" href="Peras.Block.html#2219" class="InductiveConstructor">MkCertificate</a> <a id="3623" href="Peras.Block.html#3623" class="Bound">round₁</a> <a id="3630" href="Peras.Block.html#3630" class="Bound">blockRef₁</a><a id="3639" class="Symbol">}</a> <a id="3641" class="Symbol">{</a><a id="3642" href="Peras.Block.html#2219" class="InductiveConstructor">MkCertificate</a> <a id="3656" href="Peras.Block.html#3656" class="Bound">round₂</a> <a id="3663" href="Peras.Block.html#3663" class="Bound">blockRef₂</a><a id="3672" class="Symbol">}</a> <a id="3674" href="Peras.Block.html#3674" class="Bound">x</a>
  <a id="3678" class="Symbol">=</a> <a id="3680" class="Keyword">let</a> <a id="3684" href="Peras.Block.html#3684" class="Bound">l</a> <a id="3686" class="Symbol">=</a> <a id="3688" href="Haskell.Law.Bool.html#679" class="Function">&amp;&amp;-leftTrue</a> <a id="3700" class="Symbol">(</a><a id="3701" href="Peras.Numbering.html#2022" class="Field">getRoundNumber</a> <a id="3716" href="Peras.Block.html#3623" class="Bound">round₁</a> <a id="3723" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="3726" href="Peras.Numbering.html#2022" class="Field">getRoundNumber</a> <a id="3741" href="Peras.Block.html#3656" class="Bound">round₂</a><a id="3747" class="Symbol">)</a> <a id="3749" class="Symbol">_</a> <a id="3751" href="Peras.Block.html#3674" class="Bound">x</a>
        <a id="3761" href="Peras.Block.html#3761" class="Bound">r</a> <a id="3763" class="Symbol">=</a> <a id="3765" href="Haskell.Law.Bool.html#882" class="Function">&amp;&amp;-rightTrue</a> <a id="3778" class="Symbol">_</a> <a id="3780" class="Symbol">(</a><a id="3781" href="Peras.Crypto.html#699" class="Postulate">eqBS</a> <a id="3786" class="Symbol">(</a><a id="3787" href="Peras.Crypto.html#1891" class="Field">hashBytes</a> <a id="3797" href="Peras.Block.html#3630" class="Bound">blockRef₁</a><a id="3806" class="Symbol">)</a> <a id="3808" class="Symbol">(</a><a id="3809" href="Peras.Crypto.html#1891" class="Field">hashBytes</a> <a id="3819" href="Peras.Block.html#3663" class="Bound">blockRef₂</a><a id="3828" class="Symbol">))</a> <a id="3831" href="Peras.Block.html#3674" class="Bound">x</a>
    <a id="3837" class="Keyword">in</a> <a id="3840" href="Relation.Binary.PropositionalEquality.Core.html#1395" class="Function">cong₂</a> <a id="3846" href="Peras.Block.html#2219" class="InductiveConstructor">MkCertificate</a> <a id="3860" class="Symbol">(</a><a id="3861" href="Relation.Binary.PropositionalEquality.Core.html#1158" class="Function">cong</a> <a id="3866" href="Peras.Numbering.html#2000" class="InductiveConstructor">MkRoundNumber</a> <a id="3880" class="Symbol">(</a><a id="3881" href="Peras.Block.html#3933" class="Function">eqℕ-sound</a> <a id="3891" href="Peras.Block.html#3684" class="Bound">l</a><a id="3892" class="Symbol">))</a> <a id="3895" class="Symbol">(</a><a id="3896" href="Peras.Crypto.html#2040" class="Function">MkHash-inj</a> <a id="3907" class="Symbol">(</a><a id="3908" href="Peras.Crypto.html#916" class="Postulate">lem-eqBS</a> <a id="3917" href="Peras.Block.html#3761" class="Bound">r</a><a id="3918" class="Symbol">))</a>
  <a id="3923" class="Keyword">where</a>
    <a id="3933" href="Peras.Block.html#3933" class="Function">eqℕ-sound</a> <a id="3943" class="Symbol">:</a> <a id="3945" class="Symbol">{</a><a id="3946" href="Peras.Block.html#3946" class="Bound">n</a> <a id="3948" href="Peras.Block.html#3948" class="Bound">m</a> <a id="3950" class="Symbol">:</a> <a id="3952" href="Agda.Builtin.Nat.html#203" class="Datatype">Nat</a><a id="3955" class="Symbol">}</a> <a id="3957" class="Symbol">→</a> <a id="3959" class="Symbol">(</a><a id="3960" href="Peras.Block.html#3946" class="Bound">n</a> <a id="3962" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="3965" href="Peras.Block.html#3948" class="Bound">m</a><a id="3966" class="Symbol">)</a> <a id="3968" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3970" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">True</a> <a id="3975" class="Symbol">→</a> <a id="3977" href="Peras.Block.html#3946" class="Bound">n</a> <a id="3979" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="3981" href="Peras.Block.html#3948" class="Bound">m</a>
    <a id="3987" href="Peras.Block.html#3933" class="Function">eqℕ-sound</a> <a id="3997" class="Symbol">{</a><a id="3998" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a><a id="4002" class="Symbol">}</a>  <a id="4005" class="Symbol">{</a><a id="4006" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a><a id="4010" class="Symbol">}</a>   <a id="4014" class="Symbol">_</a>  <a id="4017" class="Symbol">=</a> <a id="4019" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a>
    <a id="4028" href="Peras.Block.html#3933" class="Function">eqℕ-sound</a> <a id="4038" class="Symbol">{</a><a id="4039" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="4043" href="Peras.Block.html#4043" class="Bound">n</a><a id="4044" class="Symbol">}</a> <a id="4046" class="Symbol">{</a><a id="4047" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="4051" href="Peras.Block.html#4051" class="Bound">m</a><a id="4052" class="Symbol">}</a> <a id="4054" href="Peras.Block.html#4054" class="Bound">prf</a> <a id="4058" class="Symbol">=</a> <a id="4060" href="Relation.Binary.PropositionalEquality.Core.html#1158" class="Function">cong</a> <a id="4065" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="4069" class="Symbol">(</a><a id="4070" href="Peras.Block.html#3933" class="Function">eqℕ-sound</a> <a id="4080" href="Peras.Block.html#4054" class="Bound">prf</a><a id="4083" class="Symbol">)</a>

<a id="4086" class="Keyword">instance</a>
  <a id="iBlockEq"></a><a id="4097" href="Peras.Block.html#4097" class="Function">iBlockEq</a> <a id="4106" class="Symbol">:</a> <a id="4108" href="Haskell.Prim.Eq.html#401" class="Record">Eq</a> <a id="4111" href="Peras.Block.html#2100" class="Record">Block</a>
  <a id="4119" href="Peras.Block.html#4097" class="Function">iBlockEq</a> <a id="4128" class="Symbol">.</a><a id="4129" href="Haskell.Prim.Eq.html#453" class="Field Operator">_==_</a> <a id="4134" href="Peras.Block.html#4134" class="Bound">x</a> <a id="4136" href="Peras.Block.html#4136" class="Bound">y</a> <a id="4138" class="Symbol">=</a> <a id="4140" href="Peras.Block.html#2538" class="Field">slotNumber</a> <a id="4151" href="Peras.Block.html#4134" class="Bound">x</a> <a id="4153" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="4156" href="Peras.Block.html#2538" class="Field">slotNumber</a> <a id="4167" href="Peras.Block.html#4136" class="Bound">y</a>
                         <a id="4194" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="4197" href="Peras.Block.html#2570" class="Field">creatorId</a> <a id="4207" href="Peras.Block.html#4134" class="Bound">x</a> <a id="4209" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="4212" href="Peras.Block.html#2570" class="Field">creatorId</a> <a id="4222" href="Peras.Block.html#4136" class="Bound">y</a>
                         <a id="4249" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="4252" href="Peras.Block.html#2598" class="Field">parentBlock</a> <a id="4264" href="Peras.Block.html#4134" class="Bound">x</a> <a id="4266" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="4269" href="Peras.Block.html#2598" class="Field">parentBlock</a> <a id="4281" href="Peras.Block.html#4136" class="Bound">y</a>
                         <a id="4308" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="4311" href="Peras.Block.html#2671" class="Field">leadershipProof</a> <a id="4327" href="Peras.Block.html#4134" class="Bound">x</a> <a id="4329" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="4332" href="Peras.Block.html#2671" class="Field">leadershipProof</a> <a id="4348" href="Peras.Block.html#4136" class="Bound">y</a>
                         <a id="4375" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="4378" href="Peras.Block.html#2631" class="Field">certificate</a> <a id="4390" href="Peras.Block.html#4134" class="Bound">x</a> <a id="4392" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="4395" href="Peras.Block.html#2631" class="Field">certificate</a> <a id="4407" href="Peras.Block.html#4136" class="Bound">y</a>
                         <a id="4434" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="4437" href="Peras.Block.html#2713" class="Field">signature</a> <a id="4447" href="Peras.Block.html#4134" class="Bound">x</a> <a id="4449" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="4452" href="Peras.Block.html#2713" class="Field">signature</a> <a id="4462" href="Peras.Block.html#4136" class="Bound">y</a>
                         <a id="4489" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="4492" href="Peras.Block.html#2743" class="Field">bodyHash</a> <a id="4501" href="Peras.Block.html#4134" class="Bound">x</a> <a id="4503" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="4506" href="Peras.Block.html#2743" class="Field">bodyHash</a> <a id="4515" href="Peras.Block.html#4136" class="Bound">y</a>
                         <a id="4542" class="Comment">-- FIXME: In principle, we only need to check equality of the signatures.</a>

<a id="4617" class="Keyword">instance</a>
  <a id="iBlockBodyEq"></a><a id="4628" href="Peras.Block.html#4628" class="Function">iBlockBodyEq</a> <a id="4641" class="Symbol">:</a> <a id="4643" href="Haskell.Prim.Eq.html#401" class="Record">Eq</a> <a id="4646" href="Peras.Block.html#2119" class="Record">BlockBody</a>
  <a id="4658" href="Peras.Block.html#4628" class="Function">iBlockBodyEq</a> <a id="4671" class="Symbol">.</a><a id="4672" href="Haskell.Prim.Eq.html#453" class="Field Operator">_==_</a> <a id="4677" href="Peras.Block.html#4677" class="Bound">x</a> <a id="4679" href="Peras.Block.html#4679" class="Bound">y</a> <a id="4681" class="Symbol">=</a> <a id="4683" href="Peras.Block.html#2906" class="Field">blockHash</a> <a id="4693" href="Peras.Block.html#4677" class="Bound">x</a> <a id="4695" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="4698" href="Peras.Block.html#2906" class="Field">blockHash</a> <a id="4708" href="Peras.Block.html#4679" class="Bound">y</a> <a id="4710" href="Haskell.Prim.Bool.html#138" class="Function Operator">&amp;&amp;</a> <a id="4713" href="Peras.Block.html#2939" class="Field">payload</a> <a id="4721" href="Peras.Block.html#4677" class="Bound">x</a> <a id="4723" href="Haskell.Prim.Eq.html#453" class="Field Operator">==</a> <a id="4726" href="Peras.Block.html#2939" class="Field">payload</a> <a id="4734" href="Peras.Block.html#4679" class="Bound">y</a>

<a id="4737" class="Keyword">module</a> <a id="4744" href="Peras.Block.html#4744" class="Module">_</a> <a id="4746" class="Symbol">{</a><a id="4747" href="Peras.Block.html#4747" class="Bound">a</a> <a id="4749" class="Symbol">:</a> <a id="4751" href="Agda.Primitive.html#388" class="Primitive">Set</a><a id="4754" class="Symbol">}</a> <a id="4756" class="Symbol">⦃</a> <a id="4758" href="Peras.Block.html#4758" class="Bound">_</a> <a id="4760" class="Symbol">:</a> <a id="4762" href="Peras.Crypto.html#2287" class="Record">Hashable</a> <a id="4771" href="Peras.Block.html#4747" class="Bound">a</a> <a id="4773" class="Symbol">⦄</a>
  <a id="4777" class="Keyword">where</a>

  <a id="4786" class="Keyword">open</a> <a id="4791" href="Peras.Crypto.html#2287" class="Module">Hashable</a> <a id="4800" class="Symbol">⦃...⦄</a>

  <a id="4809" href="Peras.Block.html#4809" class="Function">tipHash</a> <a id="4817" class="Symbol">:</a> <a id="4819" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="4824" href="Peras.Block.html#4747" class="Bound">a</a> <a id="4826" class="Symbol">→</a> <a id="4828" href="Peras.Crypto.html#1835" class="Record">Hash</a> <a id="4833" href="Peras.Block.html#4747" class="Bound">a</a>
  <a id="4837" href="Peras.Block.html#4809" class="Function">tipHash</a> <a id="4845" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="4848" class="Symbol">=</a> <a id="4850" href="Peras.Crypto.html#1876" class="InductiveConstructor">MkHash</a> <a id="4857" href="Peras.Crypto.html#676" class="Postulate">emptyBS</a>
  <a id="4867" href="Peras.Block.html#4809" class="Function">tipHash</a> <a id="4875" class="Symbol">(</a><a id="4876" href="Peras.Block.html#4876" class="Bound">x</a> <a id="4878" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="4880" class="Symbol">_)</a> <a id="4883" class="Symbol">=</a> <a id="4885" href="Peras.Crypto.html#2326" class="Field">hash</a> <a id="4890" href="Peras.Block.html#4876" class="Bound">x</a>

<a id="4893" class="Keyword">private</a>
  <a id="4903" class="Keyword">open</a> <a id="4908" href="Peras.Crypto.html#2287" class="Module">Hashable</a>
  <a id="4919" class="Keyword">instance</a>
    <a id="hashBlock"></a><a id="4932" href="Peras.Block.html#4932" class="Function">hashBlock</a> <a id="4942" class="Symbol">:</a> <a id="4944" href="Peras.Crypto.html#2287" class="Record">Hashable</a> <a id="4953" href="Peras.Block.html#2100" class="Record">Block</a>
    <a id="4963" href="Peras.Block.html#4932" class="Function">hashBlock</a> <a id="4973" class="Symbol">.</a><a id="4974" href="Peras.Crypto.html#2326" class="Field">hash</a> <a id="4979" class="Symbol">=</a> <a id="4981" href="Peras.Crypto.html#1876" class="InductiveConstructor">MkHash</a> <a id="4988" href="Haskell.Prim.html#1330" class="Function Operator">∘</a> <a id="4990" href="Peras.Crypto.html#3464" class="Field">bytesS</a> <a id="4997" href="Haskell.Prim.html#1330" class="Function Operator">∘</a> <a id="4999" href="Peras.Block.html#2713" class="Field">signature</a>

<a id="5010" class="Symbol">{-#</a> <a id="5014" class="Keyword">COMPILE</a> <a id="5022" class="Keyword">AGDA2HS</a> <a id="5030" href="Peras.Block.html#4809" class="Function">tipHash</a> <a id="5038" class="Symbol">#-}</a>
<a id="5042" class="Symbol">{-#</a> <a id="5046" class="Keyword">COMPILE</a> <a id="5054" class="Keyword">AGDA2HS</a> <a id="5062" href="Peras.Block.html#3403" class="Function">iCertificateEq</a> <a id="5077" class="Symbol">#-}</a>
<a id="5081" class="Symbol">{-#</a> <a id="5085" class="Keyword">COMPILE</a> <a id="5093" class="Keyword">AGDA2HS</a> <a id="5101" href="Peras.Block.html#4097" class="Function">iBlockEq</a> <a id="5110" class="Symbol">#-}</a>
<a id="5114" class="Symbol">{-#</a> <a id="5118" class="Keyword">COMPILE</a> <a id="5126" class="Keyword">AGDA2HS</a> <a id="5134" href="Peras.Block.html#4628" class="Function">iBlockBodyEq</a> <a id="5147" class="Symbol">#-}</a>
<a id="5151" class="Symbol">{-#</a> <a id="5155" class="Keyword">COMPILE</a> <a id="5163" class="Keyword">AGDA2HS</a> <a id="5171" href="Peras.Block.html#4932" class="Function">hashBlock</a> <a id="5181" class="Symbol">#-}</a>
</pre>
</body>
</html>
