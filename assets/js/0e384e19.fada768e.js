"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[3976],{1512:(e,s,a)=>{a.r(s),a.d(s,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>h});var n=a(4848),t=a(8453);const i={sidebar_label:"Introduction",sidebar_position:1},r="What is Peras?",o={id:"intro",title:"What is Peras?",description:"Peras, or more precisely Ouroboros Peras, is an extension of Ouroboros Praos that addresses one of the known issues of blockchains based on Nakamoto-style consensus, namely settlement time. Peras achieves that goal while being self-healing, preserving the security of Praos, and being light on resources.",source:"@site/docs/intro.md",sourceDirName:".",slug:"/intro",permalink:"/docs/intro",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/intro.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_label:"Introduction",sidebar_position:1},sidebar:"DocumentsSidebar",next:{title:"F.A.Q.",permalink:"/docs/faq"}},l={},h=[{value:"What is settlement?",id:"what-is-settlement",level:2},{value:"What&#39;s current settlement value?",id:"whats-current-settlement-value",level:2},{value:"How is k determined?",id:"how-is-k-determined",level:3},{value:"What happens in practice?",id:"what-happens-in-practice",level:3},{value:"How does Peras work?",id:"how-does-peras-work",level:2},{value:"How does the protocol work?",id:"how-does-the-protocol-work",level:3},{value:"What are the benefits?",id:"what-are-the-benefits",level:3},{value:"Where to go from here?",id:"where-to-go-from-here",level:2}];function c(e){const s={a:"a",admonition:"admonition",annotation:"annotation",blockquote:"blockquote",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",msup:"msup",p:"p",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{id:"what-is-peras",children:"What is Peras?"}),"\n",(0,n.jsxs)(s.p,{children:["Peras, or more precisely Ouroboros Peras, is an extension of ",(0,n.jsx)(s.a,{href:"https://iohk.io/en/research/library/papers/ouroboros-praos-an-adaptively-secure-semi-synchronous-proof-of-stake-protocol/",children:"Ouroboros Praos"})," that addresses one of the known issues of blockchains based on Nakamoto-style consensus, namely ",(0,n.jsx)(s.em,{children:"settlement time"}),". Peras achieves that goal while being ",(0,n.jsx)(s.em,{children:"self-healing"}),", preserving the security of Praos, and being light on resources."]}),"\n",(0,n.jsxs)(s.admonition,{type:"important",children:[(0,n.jsxs)(s.p,{children:["This site documents the ",(0,n.jsx)(s.strong,{children:"pre-alpha"})," version of the protocol, which already provides strong guarantees of settlement bounds, adapts to fluctuating participation, and can recover from failures."]}),(0,n.jsx)(s.p,{children:"Research work is still ongoing to refine the protocol and provide even better guarantees in the face of high adversarial stake."})]}),"\n",(0,n.jsx)(s.h2,{id:"what-is-settlement",children:"What is settlement?"}),"\n",(0,n.jsxs)(s.p,{children:["Recall that in Cardano, like in all Nakamoto-style consensus blockchains, new blocks are added to the chain in a probabilistic way. The protocol gives each ",(0,n.jsx)(s.em,{children:"Stake-Pool Operator"})," (SPO) the right to ",(0,n.jsx)(s.em,{children:"forge"})," a new block every slot depending on the amount of stake they represent, and the protocol parameters are defined in such a way that one new block is created every 20 slots. A newly forged block is then propagated across the network and adopted by other nodes following the ",(0,n.jsx)(s.em,{children:"longest chain"})," principle: when a given node receives a new chain, i.e. a chain extended with a new block, it adopts it as its own if and only if the new chain is longer than any other previously known chain."]}),"\n",(0,n.jsx)(s.p,{children:"Because of the distributed, decentralized and probabilistic nature of the protocol, it's perfectly possible that two or more chains coexist simultaneously across the network:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"More than one SPO can be elected to create a new block at approximately the same time,"}),"\n",(0,n.jsx)(s.li,{children:"Blocks take some time to reach all network nodes giving rise to the possibility of different nodes having different views of the best chain,"}),"\n",(0,n.jsx)(s.li,{children:"Nodes come and go,"}),"\n",(0,n.jsx)(s.li,{children:"Transactions included in blocks also need to travel across the network before reaching the SPO that will forge a block including them,"}),"\n",(0,n.jsx)(s.li,{children:"..."}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["This phenomenon is known as ",(0,n.jsx)(s.em,{children:"forking"}),": a node's current best chain can be superseded by a new best chain which is very similar but for the last few blocks. Short (eg. a couple of blocks long) forks happen all the time, and they are usually non-problematic: rolled back blocks will be mostly identical, including the same transactions perhaps distributed differently among blocks, or with minor differences. But they can be harmful: if an end-user takes a decision, for example to ship some goods to another user, based on some transaction that's later rolled back and never appears again because it was actually invalid, double-spending some UTxO, this opens up the possibility of fraud."]}),"\n",(0,n.jsxs)(s.p,{children:["Therefore, from the point of view of an end-user submitting to or depending on a specific transaction, the important question is: ",(0,n.jsx)(s.em,{children:"When can they consider their transaction will never be rolled back"}),"? In other words, when can they consider the transaction to be ",(0,n.jsx)(s.em,{children:"settled"}),"?"]}),"\n",(0,n.jsxs)(s.p,{children:["In the context of this work, settlement is henceforth defined from an ",(0,n.jsx)(s.em,{children:"observability"})," perspective:"]}),"\n",(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsx)(s.p,{children:"Settlement time is the duration after which a block (or transaction) added to node's best chain has a negligible probability of being rolled back because of a fork"}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"whats-current-settlement-value",children:"What's current settlement value?"}),"\n",(0,n.jsxs)(s.p,{children:["It turns out giving a precise answer to this question is convoluted, and depends on various characteristics of the protocol, most notably the expected diffusion time (\u0394) across the network, and assumptions about the fraction of ",(0,n.jsx)(s.em,{children:"adversarial stake"}),". When reasoning about blockchain properties, the relative power between ",(0,n.jsx)(s.em,{children:"honest"})," nodes, i.e. the nodes that respect the protocol, and ",(0,n.jsx)(s.em,{children:"adversarial"})," nodes, i.e. the ones that can do whatever they want, is extremely important."]}),"\n",(0,n.jsxs)(s.p,{children:["Ouroboros Praos has been ",(0,n.jsx)(s.a,{href:"https://iohk.io/en/research/library/papers/ouroboros-praos-an-adaptively-secure-semi-synchronous-proof-of-stake-protocol/",children:"proven to be safe"})," up to 50% adversarial stake: as long as the adversary does not control majority of the stake, it guarantees various key properties of the chain which we can summarize informally by saying all honest nodes will ultimately agree on the same, honest, chain. However, this robustness comes at a price which is the time nodes have to wait to consider a block (therefore a chain) ",(0,n.jsx)(s.em,{children:"settled"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:["In Cardano a node considers a block definitely ",(0,n.jsx)(s.em,{children:"settled"}),", or ",(0,n.jsx)(s.em,{children:"immutable"}),", once it is ",(0,n.jsxs)(s.span,{className:"katex",children:[(0,n.jsx)(s.span,{className:"katex-mathml",children:(0,n.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(s.semantics,{children:[(0,n.jsx)(s.mrow,{children:(0,n.jsx)(s.mi,{children:"k"})}),(0,n.jsx)(s.annotation,{encoding:"application/x-tex",children:"k"})]})})}),(0,n.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.6944em"}}),(0,n.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03148em"},children:"k"})]})})]})," blocks behind the current tip of its best chain, where ",(0,n.jsxs)(s.span,{className:"katex",children:[(0,n.jsx)(s.span,{className:"katex-mathml",children:(0,n.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(s.semantics,{children:[(0,n.jsxs)(s.mrow,{children:[(0,n.jsx)(s.mi,{children:"k"}),(0,n.jsx)(s.mo,{children:"="}),(0,n.jsx)(s.mn,{children:"2160"})]}),(0,n.jsx)(s.annotation,{encoding:"application/x-tex",children:"k=2160"})]})})}),(0,n.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.6944em"}}),(0,n.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03148em"},children:"k"}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,n.jsx)(s.span,{className:"mrel",children:"="}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.6444em"}}),(0,n.jsx)(s.span,{className:"mord",children:"2160"})]})]})]}),". Assuming average interblock arrival rate of 20 seconds, this means a block is settled after about 12 hours."]}),"\n",(0,n.jsxs)(s.h3,{id:"how-is-k-determined",children:["How is ",(0,n.jsxs)(s.span,{className:"katex",children:[(0,n.jsx)(s.span,{className:"katex-mathml",children:(0,n.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(s.semantics,{children:[(0,n.jsx)(s.mrow,{children:(0,n.jsx)(s.mi,{children:"k"})}),(0,n.jsx)(s.annotation,{encoding:"application/x-tex",children:"k"})]})})}),(0,n.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.6944em"}}),(0,n.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03148em"},children:"k"})]})})]})," determined?"]}),"\n",(0,n.jsxs)(s.p,{children:["The question of settlement time has been given a mathematically rigorous treatment in the paper ",(0,n.jsx)(s.a,{href:"https://iohk.io/en/research/library/papers/practical-settlement-bounds-for-longest-chain-consensus/",children:"Practical Settlement Bounds for Longest-Chain consensus"}),", whose main findings can be summarized in the following picture."]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{alt:"Fork probability for 10% adversarial stake",src:a(8423).A+"#scale50",width:"2028",height:"1516"})}),"\n",(0,n.jsx)(s.p,{children:"This graph reads as follows: assuming an adversarial stake of at most 10%, and a diffusion bound \u0394 of 5 seconds, the probability of a block being rolled back after a node has observed 20 blocks is 0.001%."}),"\n",(0,n.jsx)(s.p,{children:"If \u0394 drops to 2s, e.g. if we consider the network to be faster and more reliable, then this probability also drops to 0.0001%."}),"\n",(0,n.jsxs)(s.p,{children:["On Cardano's mainnet, because of the much more stringent security requirements, we'll require a much lower failure rate of ",(0,n.jsxs)(s.span,{className:"katex",children:[(0,n.jsx)(s.span,{className:"katex-mathml",children:(0,n.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(s.semantics,{children:[(0,n.jsxs)(s.mrow,{children:[(0,n.jsxs)(s.msup,{children:[(0,n.jsx)(s.mn,{children:"2"}),(0,n.jsx)(s.mn,{children:"6"})]}),(0,n.jsx)(s.mn,{children:"0"})]}),(0,n.jsx)(s.annotation,{encoding:"application/x-tex",children:"2^60"})]})})}),(0,n.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.8141em"}}),(0,n.jsxs)(s.span,{className:"mord",children:[(0,n.jsx)(s.span,{className:"mord",children:"2"}),(0,n.jsx)(s.span,{className:"msupsub",children:(0,n.jsx)(s.span,{className:"vlist-t",children:(0,n.jsx)(s.span,{className:"vlist-r",children:(0,n.jsx)(s.span,{className:"vlist",style:{height:"0.8141em"},children:(0,n.jsxs)(s.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,n.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:"6"})})]})})})})})]}),(0,n.jsx)(s.span,{className:"mord",children:"0"})]})})]}),". Assuming the adversary has at most 35% stake and huge ",(0,n.jsx)(s.em,{children:"grinding power"}),", and network propagation delay ",(0,n.jsxs)(s.span,{className:"katex",children:[(0,n.jsx)(s.span,{className:"katex-mathml",children:(0,n.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(s.semantics,{children:[(0,n.jsxs)(s.mrow,{children:[(0,n.jsx)(s.mi,{mathvariant:"normal",children:"\u0394"}),(0,n.jsx)(s.mo,{children:"="}),(0,n.jsx)(s.mn,{children:"5"}),(0,n.jsx)(s.mi,{children:"s"})]}),(0,n.jsx)(s.annotation,{encoding:"application/x-tex",children:"\u0394=5s"})]})})}),(0,n.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.6833em"}}),(0,n.jsx)(s.span,{className:"mord",children:"\u0394"}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,n.jsx)(s.span,{className:"mrel",children:"="}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.6444em"}}),(0,n.jsx)(s.span,{className:"mord",children:"5"}),(0,n.jsx)(s.span,{className:"mord mathnormal",children:"s"})]})]})]}),", the same computation yields roughly the current value of ",(0,n.jsxs)(s.span,{className:"katex",children:[(0,n.jsx)(s.span,{className:"katex-mathml",children:(0,n.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(s.semantics,{children:[(0,n.jsx)(s.mrow,{children:(0,n.jsx)(s.mi,{children:"k"})}),(0,n.jsx)(s.annotation,{encoding:"application/x-tex",children:"k"})]})})}),(0,n.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.6944em"}}),(0,n.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03148em"},children:"k"})]})})]}),", i.e. a bit over 2000 blocks."]}),"\n",(0,n.jsx)(s.h3,{id:"what-happens-in-practice",children:"What happens in practice?"}),"\n",(0,n.jsxs)(s.p,{children:["In practice we know that ",(0,n.jsx)(s.em,{children:"core nodes"}),", e.g.. block producing nodes or relays, seldom observe forks longer than 2 blocks. And most wallets, explorers, DApps, and other end-user facing systems provide feedback about transaction settlement under the name ",(0,n.jsx)(s.em,{children:"number of confirmations"})," which is exactly the same thing: the number of blocks past current best chain's tip of the block containing the transaction. A ",(0,n.jsx)(s.em,{children:"number of confirmations"})," higher than 10 is considered ",(0,n.jsx)(s.em,{children:"high"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:['However, it\'s quite possible an adversary is "lurking in the shadows", building a ',(0,n.jsx)(s.em,{children:"private chain"}),' and awaiting the best time to take over the network and roll back transactions which would have normally be considered safe. This idea of private chains or "selfish mining" has been detailed in the classical paper ',(0,n.jsx)(s.a,{href:"https://arxiv.org/abs/1311.0243",children:"Majority is not enough"}),", and it is critical to address this problem to ensure the security of any decentralised blockchain. This explains why we observe such a difference between the theoretical settlement bound provided by the protocol, and the practically observed one."]}),"\n",(0,n.jsx)(s.h2,{id:"how-does-peras-work",children:"How does Peras work?"}),"\n",(0,n.jsx)(s.p,{children:"Peras exists to bridge that gap and make settlement bounds closer to practical values, e.g. to dramatically decrease the probability of a fork even after only a few blocks."}),"\n",(0,n.jsxs)(s.p,{children:["The key idea of Peras is to use stake-based voting to ",(0,n.jsx)(s.em,{children:"boost"})," the weight of blocks on which a majority  of SPOs agree. The chain selection rule is then modified to select the ",(0,n.jsx)(s.em,{children:"heaviest"})," chain instead of the ",(0,n.jsx)(s.em,{children:"longest"})," one."]}),"\n",(0,n.jsx)(s.h3,{id:"how-does-the-protocol-work",children:"How does the protocol work?"}),"\n",(0,n.jsx)(s.p,{children:"From a high-level perspective, the protocol works as follows:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["At the beginning of each ",(0,n.jsx)(s.em,{children:"round"}),", a randomly selected ",(0,n.jsx)(s.em,{children:"committee"})," of SPOs ",(0,n.jsx)(s.em,{children:"vote"})," for the block at a fixed depth from their current best chain tip, with each vote having a weight correlated to the SPO's stake,"]}),"\n",(0,n.jsxs)(s.li,{children:["Time is divided in fixed-length ",(0,n.jsx)(s.em,{children:"rounds"})," with a duration in the order of a few tens of slots,"]}),"\n",(0,n.jsx)(s.li,{children:"The votes are broadcast to all nodes across the network,"}),"\n",(0,n.jsxs)(s.li,{children:["If a node sees a ",(0,n.jsx)(s.em,{children:"quorum"})," of vote for the same block, it can issue a ",(0,n.jsx)(s.em,{children:"certificate"})," which ",(0,n.jsx)(s.em,{children:"boosts"})," the weight of this block,"]}),"\n",(0,n.jsx)(s.li,{children:"Certificates are also diffused across the network on demand, to those nodes which don't have equivalent votes,"}),"\n",(0,n.jsxs)(s.li,{children:["If a node does not receive a quorum for a round, either from votes or a certificate, it enters a ",(0,n.jsx)(s.em,{children:"cooldown"})," period during which any vote or certificate are ",(0,n.jsx)(s.em,{children:"ignored"}),",","\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"A node exits cooldown after a fixed number of rounds, and starts voting again."}),"\n",(0,n.jsx)(s.li,{children:"When it enters cooldown, a block producer also appends the latest certificate to the block it forges."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"what-are-the-benefits",children:"What are the benefits?"}),"\n",(0,n.jsxs)(s.p,{children:["The exact effect of Peras depends on the values of various protocol parameters which are detailed in the ",(0,n.jsx)(s.a,{href:"/docs/reports/tech-report-2",children:"Technical Report"}),". Based on the ",(0,n.jsx)(s.a,{href:"/docs/reports/tech-report-2#recommendations-for-peras-parameters",children:"recommendations"})," provided in the report"]}),"\n",(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsx)(s.p,{children:"anyone seeing a transaction appearing in a block need wait no more\nthan two minutes to be certain whether the transaction is on the\npreferred chain (effectively permanently, less than a one in a\ntrillion probability even at 45% adversarial stake) versus having\nbeen discarded because of a roll back"}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:['Importantly, Peras does not change the underlying security guarantees of Ouroboros Praos, and reverts to it in the event of a cooldown. Moreover, it adapts to fluctuating participation of SPOs and can recover from temporary "failures", e.g. if an adversary manages to temporarily reach a ',(0,n.jsx)(s.em,{children:"quorum"}),", they only will be able to takeover the chain if they manage to maintain that superiority over time, otherwise the honest parties will take over."]}),"\n",(0,n.jsx)(s.h2,{id:"where-to-go-from-here",children:"Where to go from here?"}),"\n",(0,n.jsx)(s.p,{children:"A lot more details about Peras protocol can be found in various places:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["For detailed analysis of the protocol, please refer to ",(0,n.jsx)(s.a,{href:"/docs/reports/tech-report-2",children:"Technical Report #2"})]}),"\n",(0,n.jsxs)(s.li,{children:["For a formal description, refer to the ",(0,n.jsx)(s.a,{href:"pathname:///agda_html/Peras.SmallStep.html",children:"Agda Specification"})]}),"\n",(0,n.jsxs)(s.li,{children:["Conformance tests are available in the ",(0,n.jsx)(s.a,{href:"https://github.com/input-output-hk/peras-design",children:"Peras repository"})]}),"\n",(0,n.jsxs)(s.li,{children:["A live simulation of the protocol is available ",(0,n.jsx)(s.a,{href:"https://peras-simulation.cardano-scaling.org",children:"https://peras-simulation.cardano-scaling.org"})]}),"\n"]})]})}function d(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8423:(e,s,a)=>{a.d(s,{A:()=>n});const n=a.p+"assets/images/settlement-failure-probability-306f400a2fdfb6d8050525a6167d2144.png"},8453:(e,s,a)=>{a.d(s,{R:()=>r,x:()=>o});var n=a(6540);const t={},i=n.createContext(t);function r(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);